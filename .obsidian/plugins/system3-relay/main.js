/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var uv=Object.create;var Mo=Object.defineProperty;var fv=Object.getOwnPropertyDescriptor;var dv=Object.getOwnPropertyNames;var hv=Object.getPrototypeOf,pv=Object.prototype.hasOwnProperty;var mv=(n,e,t)=>e in n?Mo(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Xl=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),Zl=(n,e)=>{for(var t in e)Mo(n,t,{get:e[t],enumerable:!0})},rh=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of dv(e))!pv.call(n,s)&&s!==t&&Mo(n,s,{get:()=>e[s],enumerable:!(r=fv(e,s))||r.enumerable});return n};var Ro=(n,e,t)=>(t=n!=null?uv(hv(n)):{},rh(e||!n||!n.__esModule?Mo(t,"default",{value:n,enumerable:!0}):t,n)),gv=n=>rh(Mo({},"__esModule",{value:!0}),n);var it=(n,e,t)=>(mv(n,typeof e!="symbol"?e+"":e,t),t);var Wi=Xl((nT,sh)=>{"use strict";function vr(n){if(typeof n!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(n))}function nh(n,e){for(var t="",r=0,s=-1,o=0,i,l=0;l<=n.length;++l){if(l<n.length)i=n.charCodeAt(l);else{if(i===47)break;i=47}if(i===47){if(!(s===l-1||o===1))if(s!==l-1&&o===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var c=t.lastIndexOf("/");if(c!==t.length-1){c===-1?(t="",r=0):(t=t.slice(0,c),r=t.length-1-t.lastIndexOf("/")),s=l,o=0;continue}}else if(t.length===2||t.length===1){t="",r=0,s=l,o=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+="/"+n.slice(s+1,l):t=n.slice(s+1,l),r=l-s-1;s=l,o=0}else i===46&&o!==-1?++o:o=-1}return t}function yv(n,e){var t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+r:t+n+r:r}var ms={resolve:function(){for(var e="",t=!1,r,s=arguments.length-1;s>=-1&&!t;s--){var o;s>=0?o=arguments[s]:(r===void 0&&(r=process.cwd()),o=r),vr(o),o.length!==0&&(e=o+"/"+e,t=o.charCodeAt(0)===47)}return e=nh(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(vr(e),e.length===0)return".";var t=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=nh(e,!t),e.length===0&&!t&&(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return vr(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];vr(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":ms.normalize(e)},relative:function(e,t){if(vr(e),vr(t),e===t||(e=ms.resolve(e),t=ms.resolve(t),e===t))return"";for(var r=1;r<e.length&&e.charCodeAt(r)===47;++r);for(var s=e.length,o=s-r,i=1;i<t.length&&t.charCodeAt(i)===47;++i);for(var l=t.length,c=l-i,f=o<c?o:c,d=-1,p=0;p<=f;++p){if(p===f){if(c>f){if(t.charCodeAt(i+p)===47)return t.slice(i+p+1);if(p===0)return t.slice(i+p)}else o>f&&(e.charCodeAt(r+p)===47?d=p:p===0&&(d=0));break}var g=e.charCodeAt(r+p),_=t.charCodeAt(i+p);if(g!==_)break;g===47&&(d=p)}var y="";for(p=r+d+1;p<=s;++p)(p===s||e.charCodeAt(p)===47)&&(y.length===0?y+="..":y+="/..");return y.length>0?y+t.slice(i+d):(i+=d,t.charCodeAt(i)===47&&++i,t.slice(i))},_makeLong:function(e){return e},dirname:function(e){if(vr(e),e.length===0)return".";for(var t=e.charCodeAt(0),r=t===47,s=-1,o=!0,i=e.length-1;i>=1;--i)if(t=e.charCodeAt(i),t===47){if(!o){s=i;break}}else o=!1;return s===-1?r?"/":".":r&&s===1?"//":e.slice(0,s)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');vr(e);var r=0,s=-1,o=!0,i;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var l=t.length-1,c=-1;for(i=e.length-1;i>=0;--i){var f=e.charCodeAt(i);if(f===47){if(!o){r=i+1;break}}else c===-1&&(o=!1,c=i+1),l>=0&&(f===t.charCodeAt(l)?--l===-1&&(s=i):(l=-1,s=c))}return r===s?s=c:s===-1&&(s=e.length),e.slice(r,s)}else{for(i=e.length-1;i>=0;--i)if(e.charCodeAt(i)===47){if(!o){r=i+1;break}}else s===-1&&(o=!1,s=i+1);return s===-1?"":e.slice(r,s)}},extname:function(e){vr(e);for(var t=-1,r=0,s=-1,o=!0,i=0,l=e.length-1;l>=0;--l){var c=e.charCodeAt(l);if(c===47){if(!o){r=l+1;break}continue}s===-1&&(o=!1,s=l+1),c===46?t===-1?t=l:i!==1&&(i=1):t!==-1&&(i=-1)}return t===-1||s===-1||i===0||i===1&&t===s-1&&t===r+1?"":e.slice(t,s)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return yv("/",e)},parse:function(e){vr(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var r=e.charCodeAt(0),s=r===47,o;s?(t.root="/",o=1):o=0;for(var i=-1,l=0,c=-1,f=!0,d=e.length-1,p=0;d>=o;--d){if(r=e.charCodeAt(d),r===47){if(!f){l=d+1;break}continue}c===-1&&(f=!1,c=d+1),r===46?i===-1?i=d:p!==1&&(p=1):i!==-1&&(p=-1)}return i===-1||c===-1||p===0||p===1&&i===c-1&&i===l+1?c!==-1&&(l===0&&s?t.base=t.name=e.slice(1,c):t.base=t.name=e.slice(l,c)):(l===0&&s?(t.name=e.slice(1,i),t.base=e.slice(1,c)):(t.name=e.slice(l,i),t.base=e.slice(l,c)),t.ext=e.slice(i,c)),l>0?t.dir=e.slice(0,l-1):s&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};ms.posix=ms;sh.exports=ms});var Xm=Xl((CR,so)=>{var K=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},Pe=-1,Oe=1,he=0;K.Diff=function(n,e){return[n,e]};K.prototype.diff_main=function(n,e,t,r){typeof r=="undefined"&&(this.Diff_Timeout<=0?r=Number.MAX_VALUE:r=new Date().getTime()+this.Diff_Timeout*1e3);var s=r;if(n==null||e==null)throw new Error("Null input. (diff_main)");if(n==e)return n?[new K.Diff(he,n)]:[];typeof t=="undefined"&&(t=!0);var o=t,i=this.diff_commonPrefix(n,e),l=n.substring(0,i);n=n.substring(i),e=e.substring(i),i=this.diff_commonSuffix(n,e);var c=n.substring(n.length-i);n=n.substring(0,n.length-i),e=e.substring(0,e.length-i);var f=this.diff_compute_(n,e,o,s);return l&&f.unshift(new K.Diff(he,l)),c&&f.push(new K.Diff(he,c)),this.diff_cleanupMerge(f),f};K.prototype.diff_compute_=function(n,e,t,r){var s;if(!n)return[new K.Diff(Oe,e)];if(!e)return[new K.Diff(Pe,n)];var o=n.length>e.length?n:e,i=n.length>e.length?e:n,l=o.indexOf(i);if(l!=-1)return s=[new K.Diff(Oe,o.substring(0,l)),new K.Diff(he,i),new K.Diff(Oe,o.substring(l+i.length))],n.length>e.length&&(s[0][0]=s[2][0]=Pe),s;if(i.length==1)return[new K.Diff(Pe,n),new K.Diff(Oe,e)];var c=this.diff_halfMatch_(n,e);if(c){var f=c[0],d=c[1],p=c[2],g=c[3],_=c[4],y=this.diff_main(f,p,t,r),b=this.diff_main(d,g,t,r);return y.concat([new K.Diff(he,_)],b)}return t&&n.length>100&&e.length>100?this.diff_lineMode_(n,e,r):this.diff_bisect_(n,e,r)};K.prototype.diff_lineMode_=function(n,e,t){var r=this.diff_linesToChars_(n,e);n=r.chars1,e=r.chars2;var s=r.lineArray,o=this.diff_main(n,e,!1,t);this.diff_charsToLines_(o,s),this.diff_cleanupSemantic(o),o.push(new K.Diff(he,""));for(var i=0,l=0,c=0,f="",d="";i<o.length;){switch(o[i][0]){case Oe:c++,d+=o[i][1];break;case Pe:l++,f+=o[i][1];break;case he:if(l>=1&&c>=1){o.splice(i-l-c,l+c),i=i-l-c;for(var p=this.diff_main(f,d,!1,t),g=p.length-1;g>=0;g--)o.splice(i,0,p[g]);i=i+p.length}c=0,l=0,f="",d="";break}i++}return o.pop(),o};K.prototype.diff_bisect_=function(n,e,t){for(var r=n.length,s=e.length,o=Math.ceil((r+s)/2),i=o,l=2*o,c=new Array(l),f=new Array(l),d=0;d<l;d++)c[d]=-1,f[d]=-1;c[i+1]=0,f[i+1]=0;for(var p=r-s,g=p%2!=0,_=0,y=0,b=0,C=0,x=0;x<o&&!(new Date().getTime()>t);x++){for(var M=-x+_;M<=x-y;M+=2){var W=i+M,S;M==-x||M!=x&&c[W-1]<c[W+1]?S=c[W+1]:S=c[W-1]+1;for(var R=S-M;S<r&&R<s&&n.charAt(S)==e.charAt(R);)S++,R++;if(c[W]=S,S>r)y+=2;else if(R>s)_+=2;else if(g){var O=i+p-M;if(O>=0&&O<l&&f[O]!=-1){var U=r-f[O];if(S>=U)return this.diff_bisectSplit_(n,e,S,R,t)}}}for(var I=-x+b;I<=x-C;I+=2){var O=i+I,U;I==-x||I!=x&&f[O-1]<f[O+1]?U=f[O+1]:U=f[O-1]+1;for(var oe=U-I;U<r&&oe<s&&n.charAt(r-U-1)==e.charAt(s-oe-1);)U++,oe++;if(f[O]=U,U>r)C+=2;else if(oe>s)b+=2;else if(!g){var W=i+p-I;if(W>=0&&W<l&&c[W]!=-1){var S=c[W],R=i+S-W;if(U=r-U,S>=U)return this.diff_bisectSplit_(n,e,S,R,t)}}}}return[new K.Diff(Pe,n),new K.Diff(Oe,e)]};K.prototype.diff_bisectSplit_=function(n,e,t,r,s){var o=n.substring(0,t),i=e.substring(0,r),l=n.substring(t),c=e.substring(r),f=this.diff_main(o,i,!1,s),d=this.diff_main(l,c,!1,s);return f.concat(d)};K.prototype.diff_linesToChars_=function(n,e){var t=[],r={};t[0]="";function s(c){for(var f="",d=0,p=-1,g=t.length;p<c.length-1;){p=c.indexOf(`
`,d),p==-1&&(p=c.length-1);var _=c.substring(d,p+1);(r.hasOwnProperty?r.hasOwnProperty(_):r[_]!==void 0)?f+=String.fromCharCode(r[_]):(g==o&&(_=c.substring(d),p=c.length),f+=String.fromCharCode(g),r[_]=g,t[g++]=_),d=p+1}return f}var o=4e4,i=s(n);o=65535;var l=s(e);return{chars1:i,chars2:l,lineArray:t}};K.prototype.diff_charsToLines_=function(n,e){for(var t=0;t<n.length;t++){for(var r=n[t][1],s=[],o=0;o<r.length;o++)s[o]=e[r.charCodeAt(o)];n[t][1]=s.join("")}};K.prototype.diff_commonPrefix=function(n,e){if(!n||!e||n.charAt(0)!=e.charAt(0))return 0;for(var t=0,r=Math.min(n.length,e.length),s=r,o=0;t<s;)n.substring(o,s)==e.substring(o,s)?(t=s,o=t):r=s,s=Math.floor((r-t)/2+t);return s};K.prototype.diff_commonSuffix=function(n,e){if(!n||!e||n.charAt(n.length-1)!=e.charAt(e.length-1))return 0;for(var t=0,r=Math.min(n.length,e.length),s=r,o=0;t<s;)n.substring(n.length-s,n.length-o)==e.substring(e.length-s,e.length-o)?(t=s,o=t):r=s,s=Math.floor((r-t)/2+t);return s};K.prototype.diff_commonOverlap_=function(n,e){var t=n.length,r=e.length;if(t==0||r==0)return 0;t>r?n=n.substring(t-r):t<r&&(e=e.substring(0,t));var s=Math.min(t,r);if(n==e)return s;for(var o=0,i=1;;){var l=n.substring(s-i),c=e.indexOf(l);if(c==-1)return o;i+=c,(c==0||n.substring(s-i)==e.substring(0,i))&&(o=i,i++)}};K.prototype.diff_halfMatch_=function(n,e){if(this.Diff_Timeout<=0)return null;var t=n.length>e.length?n:e,r=n.length>e.length?e:n;if(t.length<4||r.length*2<t.length)return null;var s=this;function o(y,b,C){for(var x=y.substring(C,C+Math.floor(y.length/4)),M=-1,W="",S,R,O,U;(M=b.indexOf(x,M+1))!=-1;){var I=s.diff_commonPrefix(y.substring(C),b.substring(M)),oe=s.diff_commonSuffix(y.substring(0,C),b.substring(0,M));W.length<oe+I&&(W=b.substring(M-oe,M)+b.substring(M,M+I),S=y.substring(0,C-oe),R=y.substring(C+I),O=b.substring(0,M-oe),U=b.substring(M+I))}return W.length*2>=y.length?[S,R,O,U,W]:null}var i=o(t,r,Math.ceil(t.length/4)),l=o(t,r,Math.ceil(t.length/2)),c;if(!i&&!l)return null;l?i?c=i[4].length>l[4].length?i:l:c=l:c=i;var f,d,p,g;n.length>e.length?(f=c[0],d=c[1],p=c[2],g=c[3]):(p=c[0],g=c[1],f=c[2],d=c[3]);var _=c[4];return[f,d,p,g,_]};K.prototype.diff_cleanupSemantic=function(n){for(var e=!1,t=[],r=0,s=null,o=0,i=0,l=0,c=0,f=0;o<n.length;)n[o][0]==he?(t[r++]=o,i=c,l=f,c=0,f=0,s=n[o][1]):(n[o][0]==Oe?c+=n[o][1].length:f+=n[o][1].length,s&&s.length<=Math.max(i,l)&&s.length<=Math.max(c,f)&&(n.splice(t[r-1],0,new K.Diff(Pe,s)),n[t[r-1]+1][0]=Oe,r--,r--,o=r>0?t[r-1]:-1,i=0,l=0,c=0,f=0,s=null,e=!0)),o++;for(e&&this.diff_cleanupMerge(n),this.diff_cleanupSemanticLossless(n),o=1;o<n.length;){if(n[o-1][0]==Pe&&n[o][0]==Oe){var d=n[o-1][1],p=n[o][1],g=this.diff_commonOverlap_(d,p),_=this.diff_commonOverlap_(p,d);g>=_?(g>=d.length/2||g>=p.length/2)&&(n.splice(o,0,new K.Diff(he,p.substring(0,g))),n[o-1][1]=d.substring(0,d.length-g),n[o+1][1]=p.substring(g),o++):(_>=d.length/2||_>=p.length/2)&&(n.splice(o,0,new K.Diff(he,d.substring(0,_))),n[o-1][0]=Oe,n[o-1][1]=p.substring(0,p.length-_),n[o+1][0]=Pe,n[o+1][1]=d.substring(_),o++),o++}o++}};K.prototype.diff_cleanupSemanticLossless=function(n){function e(_,y){if(!_||!y)return 6;var b=_.charAt(_.length-1),C=y.charAt(0),x=b.match(K.nonAlphaNumericRegex_),M=C.match(K.nonAlphaNumericRegex_),W=x&&b.match(K.whitespaceRegex_),S=M&&C.match(K.whitespaceRegex_),R=W&&b.match(K.linebreakRegex_),O=S&&C.match(K.linebreakRegex_),U=R&&_.match(K.blanklineEndRegex_),I=O&&y.match(K.blanklineStartRegex_);return U||I?5:R||O?4:x&&!W&&S?3:W||S?2:x||M?1:0}for(var t=1;t<n.length-1;){if(n[t-1][0]==he&&n[t+1][0]==he){var r=n[t-1][1],s=n[t][1],o=n[t+1][1],i=this.diff_commonSuffix(r,s);if(i){var l=s.substring(s.length-i);r=r.substring(0,r.length-i),s=l+s.substring(0,s.length-i),o=l+o}for(var c=r,f=s,d=o,p=e(r,s)+e(s,o);s.charAt(0)===o.charAt(0);){r+=s.charAt(0),s=s.substring(1)+o.charAt(0),o=o.substring(1);var g=e(r,s)+e(s,o);g>=p&&(p=g,c=r,f=s,d=o)}n[t-1][1]!=c&&(c?n[t-1][1]=c:(n.splice(t-1,1),t--),n[t][1]=f,d?n[t+1][1]=d:(n.splice(t+1,1),t--))}t++}};K.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/;K.whitespaceRegex_=/\s/;K.linebreakRegex_=/[\r\n]/;K.blanklineEndRegex_=/\n\r?\n$/;K.blanklineStartRegex_=/^\r?\n\r?\n/;K.prototype.diff_cleanupEfficiency=function(n){for(var e=!1,t=[],r=0,s=null,o=0,i=!1,l=!1,c=!1,f=!1;o<n.length;)n[o][0]==he?(n[o][1].length<this.Diff_EditCost&&(c||f)?(t[r++]=o,i=c,l=f,s=n[o][1]):(r=0,s=null),c=f=!1):(n[o][0]==Pe?f=!0:c=!0,s&&(i&&l&&c&&f||s.length<this.Diff_EditCost/2&&i+l+c+f==3)&&(n.splice(t[r-1],0,new K.Diff(Pe,s)),n[t[r-1]+1][0]=Oe,r--,s=null,i&&l?(c=f=!0,r=0):(r--,o=r>0?t[r-1]:-1,c=f=!1),e=!0)),o++;e&&this.diff_cleanupMerge(n)};K.prototype.diff_cleanupMerge=function(n){n.push(new K.Diff(he,""));for(var e=0,t=0,r=0,s="",o="",i;e<n.length;)switch(n[e][0]){case Oe:r++,o+=n[e][1],e++;break;case Pe:t++,s+=n[e][1],e++;break;case he:t+r>1?(t!==0&&r!==0&&(i=this.diff_commonPrefix(o,s),i!==0&&(e-t-r>0&&n[e-t-r-1][0]==he?n[e-t-r-1][1]+=o.substring(0,i):(n.splice(0,0,new K.Diff(he,o.substring(0,i))),e++),o=o.substring(i),s=s.substring(i)),i=this.diff_commonSuffix(o,s),i!==0&&(n[e][1]=o.substring(o.length-i)+n[e][1],o=o.substring(0,o.length-i),s=s.substring(0,s.length-i))),e-=t+r,n.splice(e,t+r),s.length&&(n.splice(e,0,new K.Diff(Pe,s)),e++),o.length&&(n.splice(e,0,new K.Diff(Oe,o)),e++),e++):e!==0&&n[e-1][0]==he?(n[e-1][1]+=n[e][1],n.splice(e,1)):e++,r=0,t=0,s="",o="";break}n[n.length-1][1]===""&&n.pop();var l=!1;for(e=1;e<n.length-1;)n[e-1][0]==he&&n[e+1][0]==he&&(n[e][1].substring(n[e][1].length-n[e-1][1].length)==n[e-1][1]?(n[e][1]=n[e-1][1]+n[e][1].substring(0,n[e][1].length-n[e-1][1].length),n[e+1][1]=n[e-1][1]+n[e+1][1],n.splice(e-1,1),l=!0):n[e][1].substring(0,n[e+1][1].length)==n[e+1][1]&&(n[e-1][1]+=n[e+1][1],n[e][1]=n[e][1].substring(n[e+1][1].length)+n[e+1][1],n.splice(e+1,1),l=!0)),e++;l&&this.diff_cleanupMerge(n)};K.prototype.diff_xIndex=function(n,e){var t=0,r=0,s=0,o=0,i;for(i=0;i<n.length&&(n[i][0]!==Oe&&(t+=n[i][1].length),n[i][0]!==Pe&&(r+=n[i][1].length),!(t>e));i++)s=t,o=r;return n.length!=i&&n[i][0]===Pe?o:o+(e-s)};K.prototype.diff_prettyHtml=function(n){for(var e=[],t=/&/g,r=/</g,s=/>/g,o=/\n/g,i=0;i<n.length;i++){var l=n[i][0],c=n[i][1],f=c.replace(t,"&amp;").replace(r,"&lt;").replace(s,"&gt;").replace(o,"&para;<br>");switch(l){case Oe:e[i]='<ins style="background:#e6ffe6;">'+f+"</ins>";break;case Pe:e[i]='<del style="background:#ffe6e6;">'+f+"</del>";break;case he:e[i]="<span>"+f+"</span>";break}}return e.join("")};K.prototype.diff_text1=function(n){for(var e=[],t=0;t<n.length;t++)n[t][0]!==Oe&&(e[t]=n[t][1]);return e.join("")};K.prototype.diff_text2=function(n){for(var e=[],t=0;t<n.length;t++)n[t][0]!==Pe&&(e[t]=n[t][1]);return e.join("")};K.prototype.diff_levenshtein=function(n){for(var e=0,t=0,r=0,s=0;s<n.length;s++){var o=n[s][0],i=n[s][1];switch(o){case Oe:t+=i.length;break;case Pe:r+=i.length;break;case he:e+=Math.max(t,r),t=0,r=0;break}}return e+=Math.max(t,r),e};K.prototype.diff_toDelta=function(n){for(var e=[],t=0;t<n.length;t++)switch(n[t][0]){case Oe:e[t]="+"+encodeURI(n[t][1]);break;case Pe:e[t]="-"+n[t][1].length;break;case he:e[t]="="+n[t][1].length;break}return e.join("	").replace(/%20/g," ")};K.prototype.diff_fromDelta=function(n,e){for(var t=[],r=0,s=0,o=e.split(/\t/g),i=0;i<o.length;i++){var l=o[i].substring(1);switch(o[i].charAt(0)){case"+":try{t[r++]=new K.Diff(Oe,decodeURI(l))}catch(d){throw new Error("Illegal escape in diff_fromDelta: "+l)}break;case"-":case"=":var c=parseInt(l,10);if(isNaN(c)||c<0)throw new Error("Invalid number in diff_fromDelta: "+l);var f=n.substring(s,s+=c);o[i].charAt(0)=="="?t[r++]=new K.Diff(he,f):t[r++]=new K.Diff(Pe,f);break;default:if(o[i])throw new Error("Invalid diff operation in diff_fromDelta: "+o[i])}}if(s!=n.length)throw new Error("Delta length ("+s+") does not equal source text length ("+n.length+").");return t};K.prototype.match_main=function(n,e,t){if(n==null||e==null||t==null)throw new Error("Null input. (match_main)");return t=Math.max(0,Math.min(t,n.length)),n==e?0:n.length?n.substring(t,t+e.length)==e?t:this.match_bitap_(n,e,t):-1};K.prototype.match_bitap_=function(n,e,t){if(e.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var r=this.match_alphabet_(e),s=this;function o(S,R){var O=S/e.length,U=Math.abs(t-R);return s.Match_Distance?O+U/s.Match_Distance:U?1:O}var i=this.Match_Threshold,l=n.indexOf(e,t);l!=-1&&(i=Math.min(o(0,l),i),l=n.lastIndexOf(e,t+e.length),l!=-1&&(i=Math.min(o(0,l),i)));var c=1<<e.length-1;l=-1;for(var f,d,p=e.length+n.length,g,_=0;_<e.length;_++){for(f=0,d=p;f<d;)o(_,t+d)<=i?f=d:p=d,d=Math.floor((p-f)/2+f);p=d;var y=Math.max(1,t-d+1),b=Math.min(t+d,n.length)+e.length,C=Array(b+2);C[b+1]=(1<<_)-1;for(var x=b;x>=y;x--){var M=r[n.charAt(x-1)];if(_===0?C[x]=(C[x+1]<<1|1)&M:C[x]=(C[x+1]<<1|1)&M|((g[x+1]|g[x])<<1|1)|g[x+1],C[x]&c){var W=o(_,x-1);if(W<=i)if(i=W,l=x-1,l>t)y=Math.max(1,2*t-l);else break}}if(o(_+1,t)>i)break;g=C}return l};K.prototype.match_alphabet_=function(n){for(var e={},t=0;t<n.length;t++)e[n.charAt(t)]=0;for(var t=0;t<n.length;t++)e[n.charAt(t)]|=1<<n.length-t-1;return e};K.prototype.patch_addContext_=function(n,e){if(e.length!=0){if(n.start2===null)throw Error("patch not initialized");for(var t=e.substring(n.start2,n.start2+n.length1),r=0;e.indexOf(t)!=e.lastIndexOf(t)&&t.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)r+=this.Patch_Margin,t=e.substring(n.start2-r,n.start2+n.length1+r);r+=this.Patch_Margin;var s=e.substring(n.start2-r,n.start2);s&&n.diffs.unshift(new K.Diff(he,s));var o=e.substring(n.start2+n.length1,n.start2+n.length1+r);o&&n.diffs.push(new K.Diff(he,o)),n.start1-=s.length,n.start2-=s.length,n.length1+=s.length+o.length,n.length2+=s.length+o.length}};K.prototype.patch_make=function(n,e,t){var r,s;if(typeof n=="string"&&typeof e=="string"&&typeof t=="undefined")r=n,s=this.diff_main(r,e,!0),s.length>2&&(this.diff_cleanupSemantic(s),this.diff_cleanupEfficiency(s));else if(n&&typeof n=="object"&&typeof e=="undefined"&&typeof t=="undefined")s=n,r=this.diff_text1(s);else if(typeof n=="string"&&e&&typeof e=="object"&&typeof t=="undefined")r=n,s=e;else if(typeof n=="string"&&typeof e=="string"&&t&&typeof t=="object")r=n,s=t;else throw new Error("Unknown call format to patch_make.");if(s.length===0)return[];for(var o=[],i=new K.patch_obj,l=0,c=0,f=0,d=r,p=r,g=0;g<s.length;g++){var _=s[g][0],y=s[g][1];switch(!l&&_!==he&&(i.start1=c,i.start2=f),_){case Oe:i.diffs[l++]=s[g],i.length2+=y.length,p=p.substring(0,f)+y+p.substring(f);break;case Pe:i.length1+=y.length,i.diffs[l++]=s[g],p=p.substring(0,f)+p.substring(f+y.length);break;case he:y.length<=2*this.Patch_Margin&&l&&s.length!=g+1?(i.diffs[l++]=s[g],i.length1+=y.length,i.length2+=y.length):y.length>=2*this.Patch_Margin&&l&&(this.patch_addContext_(i,d),o.push(i),i=new K.patch_obj,l=0,d=p,c=f);break}_!==Oe&&(c+=y.length),_!==Pe&&(f+=y.length)}return l&&(this.patch_addContext_(i,d),o.push(i)),o};K.prototype.patch_deepCopy=function(n){for(var e=[],t=0;t<n.length;t++){var r=n[t],s=new K.patch_obj;s.diffs=[];for(var o=0;o<r.diffs.length;o++)s.diffs[o]=new K.Diff(r.diffs[o][0],r.diffs[o][1]);s.start1=r.start1,s.start2=r.start2,s.length1=r.length1,s.length2=r.length2,e[t]=s}return e};K.prototype.patch_apply=function(n,e){if(n.length==0)return[e,[]];n=this.patch_deepCopy(n);var t=this.patch_addPadding(n);e=t+e+t,this.patch_splitMax(n);for(var r=0,s=[],o=0;o<n.length;o++){var i=n[o].start2+r,l=this.diff_text1(n[o].diffs),c,f=-1;if(l.length>this.Match_MaxBits?(c=this.match_main(e,l.substring(0,this.Match_MaxBits),i),c!=-1&&(f=this.match_main(e,l.substring(l.length-this.Match_MaxBits),i+l.length-this.Match_MaxBits),(f==-1||c>=f)&&(c=-1))):c=this.match_main(e,l,i),c==-1)s[o]=!1,r-=n[o].length2-n[o].length1;else{s[o]=!0,r=c-i;var d;if(f==-1?d=e.substring(c,c+l.length):d=e.substring(c,f+this.Match_MaxBits),l==d)e=e.substring(0,c)+this.diff_text2(n[o].diffs)+e.substring(c+l.length);else{var p=this.diff_main(l,d,!1);if(l.length>this.Match_MaxBits&&this.diff_levenshtein(p)/l.length>this.Patch_DeleteThreshold)s[o]=!1;else{this.diff_cleanupSemanticLossless(p);for(var g=0,_,y=0;y<n[o].diffs.length;y++){var b=n[o].diffs[y];b[0]!==he&&(_=this.diff_xIndex(p,g)),b[0]===Oe?e=e.substring(0,c+_)+b[1]+e.substring(c+_):b[0]===Pe&&(e=e.substring(0,c+_)+e.substring(c+this.diff_xIndex(p,g+b[1].length))),b[0]!==Pe&&(g+=b[1].length)}}}}}return e=e.substring(t.length,e.length-t.length),[e,s]};K.prototype.patch_addPadding=function(n){for(var e=this.Patch_Margin,t="",r=1;r<=e;r++)t+=String.fromCharCode(r);for(var r=0;r<n.length;r++)n[r].start1+=e,n[r].start2+=e;var s=n[0],o=s.diffs;if(o.length==0||o[0][0]!=he)o.unshift(new K.Diff(he,t)),s.start1-=e,s.start2-=e,s.length1+=e,s.length2+=e;else if(e>o[0][1].length){var i=e-o[0][1].length;o[0][1]=t.substring(o[0][1].length)+o[0][1],s.start1-=i,s.start2-=i,s.length1+=i,s.length2+=i}if(s=n[n.length-1],o=s.diffs,o.length==0||o[o.length-1][0]!=he)o.push(new K.Diff(he,t)),s.length1+=e,s.length2+=e;else if(e>o[o.length-1][1].length){var i=e-o[o.length-1][1].length;o[o.length-1][1]+=t.substring(0,i),s.length1+=i,s.length2+=i}return t};K.prototype.patch_splitMax=function(n){for(var e=this.Match_MaxBits,t=0;t<n.length;t++)if(!(n[t].length1<=e)){var r=n[t];n.splice(t--,1);for(var s=r.start1,o=r.start2,i="";r.diffs.length!==0;){var l=new K.patch_obj,c=!0;for(l.start1=s-i.length,l.start2=o-i.length,i!==""&&(l.length1=l.length2=i.length,l.diffs.push(new K.Diff(he,i)));r.diffs.length!==0&&l.length1<e-this.Patch_Margin;){var f=r.diffs[0][0],d=r.diffs[0][1];f===Oe?(l.length2+=d.length,o+=d.length,l.diffs.push(r.diffs.shift()),c=!1):f===Pe&&l.diffs.length==1&&l.diffs[0][0]==he&&d.length>2*e?(l.length1+=d.length,s+=d.length,c=!1,l.diffs.push(new K.Diff(f,d)),r.diffs.shift()):(d=d.substring(0,e-l.length1-this.Patch_Margin),l.length1+=d.length,s+=d.length,f===he?(l.length2+=d.length,o+=d.length):c=!1,l.diffs.push(new K.Diff(f,d)),d==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(d.length))}i=this.diff_text2(l.diffs),i=i.substring(i.length-this.Patch_Margin);var p=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);p!==""&&(l.length1+=p.length,l.length2+=p.length,l.diffs.length!==0&&l.diffs[l.diffs.length-1][0]===he?l.diffs[l.diffs.length-1][1]+=p:l.diffs.push(new K.Diff(he,p))),c||n.splice(++t,0,l)}}};K.prototype.patch_toText=function(n){for(var e=[],t=0;t<n.length;t++)e[t]=n[t];return e.join("")};K.prototype.patch_fromText=function(n){var e=[];if(!n)return e;for(var t=n.split(`
`),r=0,s=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;r<t.length;){var o=t[r].match(s);if(!o)throw new Error("Invalid patch string: "+t[r]);var i=new K.patch_obj;for(e.push(i),i.start1=parseInt(o[1],10),o[2]===""?(i.start1--,i.length1=1):o[2]=="0"?i.length1=0:(i.start1--,i.length1=parseInt(o[2],10)),i.start2=parseInt(o[3],10),o[4]===""?(i.start2--,i.length2=1):o[4]=="0"?i.length2=0:(i.start2--,i.length2=parseInt(o[4],10)),r++;r<t.length;){var l=t[r].charAt(0);try{var c=decodeURI(t[r].substring(1))}catch(f){throw new Error("Illegal escape in patch_fromText: "+c)}if(l=="-")i.diffs.push(new K.Diff(Pe,c));else if(l=="+")i.diffs.push(new K.Diff(Oe,c));else if(l==" ")i.diffs.push(new K.Diff(he,c));else{if(l=="@")break;if(l!=="")throw new Error('Invalid patch mode "'+l+'" in: '+c)}r++}}return e};K.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0};K.patch_obj.prototype.toString=function(){var n,e;this.length1===0?n=this.start1+",0":this.length1==1?n=this.start1+1:n=this.start1+1+","+this.length1,this.length2===0?e=this.start2+",0":this.length2==1?e=this.start2+1:e=this.start2+1+","+this.length2;for(var t=["@@ -"+n+" +"+e+` @@
`],r,s=0;s<this.diffs.length;s++){switch(this.diffs[s][0]){case Oe:r="+";break;case Pe:r="-";break;case he:r=" ";break}t[s+1]=r+encodeURI(this.diffs[s][1])+`
`}return t.join("").replace(/%20/g," ")};so.exports=K;so.exports.diff_match_patch=K;so.exports.DIFF_DELETE=Pe;so.exports.DIFF_INSERT=Oe;so.exports.DIFF_EQUAL=he});var Ag=Xl((Mf,co)=>{(function(n,e){typeof Mf=="object"&&typeof co!="undefined"?co.exports=e():typeof define=="function"&&define.amd?define(e):n.moment=e()})(Mf,function(){"use strict";var n;function e(){return n.apply(null,arguments)}function t(a){n=a}function r(a){return a instanceof Array||Object.prototype.toString.call(a)==="[object Array]"}function s(a){return a!=null&&Object.prototype.toString.call(a)==="[object Object]"}function o(a,u){return Object.prototype.hasOwnProperty.call(a,u)}function i(a){if(Object.getOwnPropertyNames)return Object.getOwnPropertyNames(a).length===0;var u;for(u in a)if(o(a,u))return!1;return!0}function l(a){return a===void 0}function c(a){return typeof a=="number"||Object.prototype.toString.call(a)==="[object Number]"}function f(a){return a instanceof Date||Object.prototype.toString.call(a)==="[object Date]"}function d(a,u){var h=[],m,w=a.length;for(m=0;m<w;++m)h.push(u(a[m],m));return h}function p(a,u){for(var h in u)o(u,h)&&(a[h]=u[h]);return o(u,"toString")&&(a.toString=u.toString),o(u,"valueOf")&&(a.valueOf=u.valueOf),a}function g(a,u,h,m){return Od(a,u,h,m,!0).utc()}function _(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function y(a){return a._pf==null&&(a._pf=_()),a._pf}var b;Array.prototype.some?b=Array.prototype.some:b=function(a){var u=Object(this),h=u.length>>>0,m;for(m=0;m<h;m++)if(m in u&&a.call(this,u[m],m,u))return!0;return!1};function C(a){if(a._isValid==null){var u=y(a),h=b.call(u.parsedDateParts,function(w){return w!=null}),m=!isNaN(a._d.getTime())&&u.overflow<0&&!u.empty&&!u.invalidEra&&!u.invalidMonth&&!u.invalidWeekday&&!u.weekdayMismatch&&!u.nullInput&&!u.invalidFormat&&!u.userInvalidated&&(!u.meridiem||u.meridiem&&h);if(a._strict&&(m=m&&u.charsLeftOver===0&&u.unusedTokens.length===0&&u.bigHour===void 0),Object.isFrozen==null||!Object.isFrozen(a))a._isValid=m;else return m}return a._isValid}function x(a){var u=g(NaN);return a!=null?p(y(u),a):y(u).userInvalidated=!0,u}var M=e.momentProperties=[],W=!1;function S(a,u){var h,m,w,v=M.length;if(l(u._isAMomentObject)||(a._isAMomentObject=u._isAMomentObject),l(u._i)||(a._i=u._i),l(u._f)||(a._f=u._f),l(u._l)||(a._l=u._l),l(u._strict)||(a._strict=u._strict),l(u._tzm)||(a._tzm=u._tzm),l(u._isUTC)||(a._isUTC=u._isUTC),l(u._offset)||(a._offset=u._offset),l(u._pf)||(a._pf=y(u)),l(u._locale)||(a._locale=u._locale),v>0)for(h=0;h<v;h++)m=M[h],w=u[m],l(w)||(a[m]=w);return a}function R(a){S(this,a),this._d=new Date(a._d!=null?a._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),W===!1&&(W=!0,e.updateOffset(this),W=!1)}function O(a){return a instanceof R||a!=null&&a._isAMomentObject!=null}function U(a){e.suppressDeprecationWarnings===!1&&typeof console!="undefined"&&console.warn&&console.warn("Deprecation warning: "+a)}function I(a,u){var h=!0;return p(function(){if(e.deprecationHandler!=null&&e.deprecationHandler(null,a),h){var m=[],w,v,P,ee=arguments.length;for(v=0;v<ee;v++){if(w="",typeof arguments[v]=="object"){w+=`
[`+v+"] ";for(P in arguments[0])o(arguments[0],P)&&(w+=P+": "+arguments[0][P]+", ");w=w.slice(0,-2)}else w=arguments[v];m.push(w)}U(a+`
Arguments: `+Array.prototype.slice.call(m).join("")+`
`+new Error().stack),h=!1}return u.apply(this,arguments)},u)}var oe={};function ue(a,u){e.deprecationHandler!=null&&e.deprecationHandler(a,u),oe[a]||(U(u),oe[a]=!0)}e.suppressDeprecationWarnings=!1,e.deprecationHandler=null;function se(a){return typeof Function!="undefined"&&a instanceof Function||Object.prototype.toString.call(a)==="[object Function]"}function ge(a){var u,h;for(h in a)o(a,h)&&(u=a[h],se(u)?this[h]=u:this["_"+h]=u);this._config=a,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function be(a,u){var h=p({},a),m;for(m in u)o(u,m)&&(s(a[m])&&s(u[m])?(h[m]={},p(h[m],a[m]),p(h[m],u[m])):u[m]!=null?h[m]=u[m]:delete h[m]);for(m in a)o(a,m)&&!o(u,m)&&s(a[m])&&(h[m]=p({},h[m]));return h}function $(a){a!=null&&this.set(a)}var j;Object.keys?j=Object.keys:j=function(a){var u,h=[];for(u in a)o(a,u)&&h.push(u);return h};var V={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function z(a,u,h){var m=this._calendar[a]||this._calendar.sameElse;return se(m)?m.call(u,h):m}function ke(a,u,h){var m=""+Math.abs(a),w=u-m.length,v=a>=0;return(v?h?"+":"":"-")+Math.pow(10,Math.max(0,w)).toString().substr(1)+m}var vt=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,nt=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,yt={},le={};function G(a,u,h,m){var w=m;typeof m=="string"&&(w=function(){return this[m]()}),a&&(le[a]=w),u&&(le[u[0]]=function(){return ke(w.apply(this,arguments),u[1],u[2])}),h&&(le[h]=function(){return this.localeData().ordinal(w.apply(this,arguments),a)})}function ln(a){return a.match(/\[[\s\S]/)?a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function Wt(a){var u=a.match(vt),h,m;for(h=0,m=u.length;h<m;h++)le[u[h]]?u[h]=le[u[h]]:u[h]=ln(u[h]);return function(w){var v="",P;for(P=0;P<m;P++)v+=se(u[P])?u[P].call(w,a):u[P];return v}}function Or(a,u){return a.isValid()?(u=os(u,a.localeData()),yt[u]=yt[u]||Wt(u),yt[u](a)):a.localeData().invalidDate()}function os(a,u){var h=5;function m(w){return u.longDateFormat(w)||w}for(nt.lastIndex=0;h>=0&&nt.test(a);)a=a.replace(nt,m),nt.lastIndex=0,h-=1;return a}var is={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function ho(a){var u=this._longDateFormat[a],h=this._longDateFormat[a.toUpperCase()];return u||!h?u:(this._longDateFormat[a]=h.match(vt).map(function(m){return m==="MMMM"||m==="MM"||m==="DD"||m==="dddd"?m.slice(1):m}).join(""),this._longDateFormat[a])}var po="Invalid date";function mo(){return this._invalidDate}var go="%d",yo=/\d{1,2}/;function wo(a){return this._ordinal.replace("%d",a)}var _o={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function bo(a,u,h,m){var w=this._relativeTime[h];return se(w)?w(a,u,h,m):w.replace(/%d/i,a)}function vo(a,u){var h=this._relativeTime[a>0?"future":"past"];return se(h)?h(u):h.replace(/%s/i,u)}var Ir={};function Ze(a,u){var h=a.toLowerCase();Ir[h]=Ir[h+"s"]=Ir[u]=a}function F(a){return typeof a=="string"?Ir[a]||Ir[a.toLowerCase()]:void 0}function de(a){var u={},h,m;for(m in a)o(a,m)&&(h=F(m),h&&(u[h]=a[m]));return u}var Ue={};function Ae(a,u){Ue[a]=u}function cn(a){var u=[],h;for(h in a)o(a,h)&&u.push({unit:h,priority:Ue[h]});return u.sort(function(m,w){return m.priority-w.priority}),u}function as(a){return a%4===0&&a%100!==0||a%400===0}function wt(a){return a<0?Math.ceil(a)||0:Math.floor(a)}function ye(a){var u=+a,h=0;return u!==0&&isFinite(u)&&(h=wt(u)),h}function ls(a,u){return function(h){return h!=null?(pd(this,a,h),e.updateOffset(this,u),this):ki(this,a)}}function ki(a,u){return a.isValid()?a._d["get"+(a._isUTC?"UTC":"")+u]():NaN}function pd(a,u,h){a.isValid()&&!isNaN(h)&&(u==="FullYear"&&as(a.year())&&a.month()===1&&a.date()===29?(h=ye(h),a._d["set"+(a._isUTC?"UTC":"")+u](h,a.month(),Ri(h,a.month()))):a._d["set"+(a._isUTC?"UTC":"")+u](h))}function Ay(a){return a=F(a),se(this[a])?this[a]():this}function Dy(a,u){if(typeof a=="object"){a=de(a);var h=cn(a),m,w=h.length;for(m=0;m<w;m++)this[h[m].unit](a[h[m].unit])}else if(a=F(a),se(this[a]))return this[a](u);return this}var md=/\d/,It=/\d\d/,gd=/\d{3}/,Rl=/\d{4}/,Ci=/[+-]?\d{6}/,Ie=/\d\d?/,yd=/\d\d\d\d?/,wd=/\d\d\d\d\d\d?/,Ei=/\d{1,3}/,Fl=/\d{1,4}/,Ti=/[+-]?\d{1,6}/,cs=/\d+/,Ai=/[+-]?\d+/,My=/Z|[+-]\d\d:?\d\d/gi,Di=/Z|[+-]\d\d(?::?\d\d)?/gi,Ry=/[+-]?\d+(\.\d{1,3})?/,xo=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,Mi;Mi={};function X(a,u,h){Mi[a]=se(u)?u:function(m,w){return m&&h?h:u}}function Fy(a,u){return o(Mi,a)?Mi[a](u._strict,u._locale):new RegExp(Py(a))}function Py(a){return Lt(a.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(u,h,m,w,v){return h||m||w||v}))}function Lt(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var Pl={};function De(a,u){var h,m=u,w;for(typeof a=="string"&&(a=[a]),c(u)&&(m=function(v,P){P[u]=ye(v)}),w=a.length,h=0;h<w;h++)Pl[a[h]]=m}function So(a,u){De(a,function(h,m,w,v){w._w=w._w||{},u(h,w._w,w,v)})}function Oy(a,u,h){u!=null&&o(Pl,a)&&Pl[a](u,h._a,h,a)}var _t=0,Lr=1,br=2,st=3,nr=4,$r=5,Pn=6,Iy=7,Ly=8;function $y(a,u){return(a%u+u)%u}var qe;Array.prototype.indexOf?qe=Array.prototype.indexOf:qe=function(a){var u;for(u=0;u<this.length;++u)if(this[u]===a)return u;return-1};function Ri(a,u){if(isNaN(a)||isNaN(u))return NaN;var h=$y(u,12);return a+=(u-h)/12,h===1?as(a)?29:28:31-h%7%2}G("M",["MM",2],"Mo",function(){return this.month()+1}),G("MMM",0,0,function(a){return this.localeData().monthsShort(this,a)}),G("MMMM",0,0,function(a){return this.localeData().months(this,a)}),Ze("month","M"),Ae("month",8),X("M",Ie),X("MM",Ie,It),X("MMM",function(a,u){return u.monthsShortRegex(a)}),X("MMMM",function(a,u){return u.monthsRegex(a)}),De(["M","MM"],function(a,u){u[Lr]=ye(a)-1}),De(["MMM","MMMM"],function(a,u,h,m){var w=h._locale.monthsParse(a,m,h._strict);w!=null?u[Lr]=w:y(h).invalidMonth=a});var Uy="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),_d="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),bd=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,Ny=xo,By=xo;function Hy(a,u){return a?r(this._months)?this._months[a.month()]:this._months[(this._months.isFormat||bd).test(u)?"format":"standalone"][a.month()]:r(this._months)?this._months:this._months.standalone}function Vy(a,u){return a?r(this._monthsShort)?this._monthsShort[a.month()]:this._monthsShort[bd.test(u)?"format":"standalone"][a.month()]:r(this._monthsShort)?this._monthsShort:this._monthsShort.standalone}function Wy(a,u,h){var m,w,v,P=a.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],m=0;m<12;++m)v=g([2e3,m]),this._shortMonthsParse[m]=this.monthsShort(v,"").toLocaleLowerCase(),this._longMonthsParse[m]=this.months(v,"").toLocaleLowerCase();return h?u==="MMM"?(w=qe.call(this._shortMonthsParse,P),w!==-1?w:null):(w=qe.call(this._longMonthsParse,P),w!==-1?w:null):u==="MMM"?(w=qe.call(this._shortMonthsParse,P),w!==-1?w:(w=qe.call(this._longMonthsParse,P),w!==-1?w:null)):(w=qe.call(this._longMonthsParse,P),w!==-1?w:(w=qe.call(this._shortMonthsParse,P),w!==-1?w:null))}function Ky(a,u,h){var m,w,v;if(this._monthsParseExact)return Wy.call(this,a,u,h);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),m=0;m<12;m++){if(w=g([2e3,m]),h&&!this._longMonthsParse[m]&&(this._longMonthsParse[m]=new RegExp("^"+this.months(w,"").replace(".","")+"$","i"),this._shortMonthsParse[m]=new RegExp("^"+this.monthsShort(w,"").replace(".","")+"$","i")),!h&&!this._monthsParse[m]&&(v="^"+this.months(w,"")+"|^"+this.monthsShort(w,""),this._monthsParse[m]=new RegExp(v.replace(".",""),"i")),h&&u==="MMMM"&&this._longMonthsParse[m].test(a))return m;if(h&&u==="MMM"&&this._shortMonthsParse[m].test(a))return m;if(!h&&this._monthsParse[m].test(a))return m}}function vd(a,u){var h;if(!a.isValid())return a;if(typeof u=="string"){if(/^\d+$/.test(u))u=ye(u);else if(u=a.localeData().monthsParse(u),!c(u))return a}return h=Math.min(a.date(),Ri(a.year(),u)),a._d["set"+(a._isUTC?"UTC":"")+"Month"](u,h),a}function xd(a){return a!=null?(vd(this,a),e.updateOffset(this,!0),this):ki(this,"Month")}function Yy(){return Ri(this.year(),this.month())}function Jy(a){return this._monthsParseExact?(o(this,"_monthsRegex")||Sd.call(this),a?this._monthsShortStrictRegex:this._monthsShortRegex):(o(this,"_monthsShortRegex")||(this._monthsShortRegex=Ny),this._monthsShortStrictRegex&&a?this._monthsShortStrictRegex:this._monthsShortRegex)}function qy(a){return this._monthsParseExact?(o(this,"_monthsRegex")||Sd.call(this),a?this._monthsStrictRegex:this._monthsRegex):(o(this,"_monthsRegex")||(this._monthsRegex=By),this._monthsStrictRegex&&a?this._monthsStrictRegex:this._monthsRegex)}function Sd(){function a(P,ee){return ee.length-P.length}var u=[],h=[],m=[],w,v;for(w=0;w<12;w++)v=g([2e3,w]),u.push(this.monthsShort(v,"")),h.push(this.months(v,"")),m.push(this.months(v,"")),m.push(this.monthsShort(v,""));for(u.sort(a),h.sort(a),m.sort(a),w=0;w<12;w++)u[w]=Lt(u[w]),h[w]=Lt(h[w]);for(w=0;w<24;w++)m[w]=Lt(m[w]);this._monthsRegex=new RegExp("^("+m.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+h.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+u.join("|")+")","i")}G("Y",0,0,function(){var a=this.year();return a<=9999?ke(a,4):"+"+a}),G(0,["YY",2],0,function(){return this.year()%100}),G(0,["YYYY",4],0,"year"),G(0,["YYYYY",5],0,"year"),G(0,["YYYYYY",6,!0],0,"year"),Ze("year","y"),Ae("year",1),X("Y",Ai),X("YY",Ie,It),X("YYYY",Fl,Rl),X("YYYYY",Ti,Ci),X("YYYYYY",Ti,Ci),De(["YYYYY","YYYYYY"],_t),De("YYYY",function(a,u){u[_t]=a.length===2?e.parseTwoDigitYear(a):ye(a)}),De("YY",function(a,u){u[_t]=e.parseTwoDigitYear(a)}),De("Y",function(a,u){u[_t]=parseInt(a,10)});function ko(a){return as(a)?366:365}e.parseTwoDigitYear=function(a){return ye(a)+(ye(a)>68?1900:2e3)};var kd=ls("FullYear",!0);function jy(){return as(this.year())}function Gy(a,u,h,m,w,v,P){var ee;return a<100&&a>=0?(ee=new Date(a+400,u,h,m,w,v,P),isFinite(ee.getFullYear())&&ee.setFullYear(a)):ee=new Date(a,u,h,m,w,v,P),ee}function Co(a){var u,h;return a<100&&a>=0?(h=Array.prototype.slice.call(arguments),h[0]=a+400,u=new Date(Date.UTC.apply(null,h)),isFinite(u.getUTCFullYear())&&u.setUTCFullYear(a)):u=new Date(Date.UTC.apply(null,arguments)),u}function Fi(a,u,h){var m=7+u-h,w=(7+Co(a,0,m).getUTCDay()-u)%7;return-w+m-1}function Cd(a,u,h,m,w){var v=(7+h-m)%7,P=Fi(a,m,w),ee=1+7*(u-1)+v+P,pe,Me;return ee<=0?(pe=a-1,Me=ko(pe)+ee):ee>ko(a)?(pe=a+1,Me=ee-ko(a)):(pe=a,Me=ee),{year:pe,dayOfYear:Me}}function Eo(a,u,h){var m=Fi(a.year(),u,h),w=Math.floor((a.dayOfYear()-m-1)/7)+1,v,P;return w<1?(P=a.year()-1,v=w+Ur(P,u,h)):w>Ur(a.year(),u,h)?(v=w-Ur(a.year(),u,h),P=a.year()+1):(P=a.year(),v=w),{week:v,year:P}}function Ur(a,u,h){var m=Fi(a,u,h),w=Fi(a+1,u,h);return(ko(a)-m+w)/7}G("w",["ww",2],"wo","week"),G("W",["WW",2],"Wo","isoWeek"),Ze("week","w"),Ze("isoWeek","W"),Ae("week",5),Ae("isoWeek",5),X("w",Ie),X("ww",Ie,It),X("W",Ie),X("WW",Ie,It),So(["w","ww","W","WW"],function(a,u,h,m){u[m.substr(0,1)]=ye(a)});function zy(a){return Eo(a,this._week.dow,this._week.doy).week}var Xy={dow:0,doy:6};function Zy(){return this._week.dow}function Qy(){return this._week.doy}function ew(a){var u=this.localeData().week(this);return a==null?u:this.add((a-u)*7,"d")}function tw(a){var u=Eo(this,1,4).week;return a==null?u:this.add((a-u)*7,"d")}G("d",0,"do","day"),G("dd",0,0,function(a){return this.localeData().weekdaysMin(this,a)}),G("ddd",0,0,function(a){return this.localeData().weekdaysShort(this,a)}),G("dddd",0,0,function(a){return this.localeData().weekdays(this,a)}),G("e",0,0,"weekday"),G("E",0,0,"isoWeekday"),Ze("day","d"),Ze("weekday","e"),Ze("isoWeekday","E"),Ae("day",11),Ae("weekday",11),Ae("isoWeekday",11),X("d",Ie),X("e",Ie),X("E",Ie),X("dd",function(a,u){return u.weekdaysMinRegex(a)}),X("ddd",function(a,u){return u.weekdaysShortRegex(a)}),X("dddd",function(a,u){return u.weekdaysRegex(a)}),So(["dd","ddd","dddd"],function(a,u,h,m){var w=h._locale.weekdaysParse(a,m,h._strict);w!=null?u.d=w:y(h).invalidWeekday=a}),So(["d","e","E"],function(a,u,h,m){u[m]=ye(a)});function rw(a,u){return typeof a!="string"?a:isNaN(a)?(a=u.weekdaysParse(a),typeof a=="number"?a:null):parseInt(a,10)}function nw(a,u){return typeof a=="string"?u.weekdaysParse(a)%7||7:isNaN(a)?null:a}function Ol(a,u){return a.slice(u,7).concat(a.slice(0,u))}var sw="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),Ed="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),ow="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),iw=xo,aw=xo,lw=xo;function cw(a,u){var h=r(this._weekdays)?this._weekdays:this._weekdays[a&&a!==!0&&this._weekdays.isFormat.test(u)?"format":"standalone"];return a===!0?Ol(h,this._week.dow):a?h[a.day()]:h}function uw(a){return a===!0?Ol(this._weekdaysShort,this._week.dow):a?this._weekdaysShort[a.day()]:this._weekdaysShort}function fw(a){return a===!0?Ol(this._weekdaysMin,this._week.dow):a?this._weekdaysMin[a.day()]:this._weekdaysMin}function dw(a,u,h){var m,w,v,P=a.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],m=0;m<7;++m)v=g([2e3,1]).day(m),this._minWeekdaysParse[m]=this.weekdaysMin(v,"").toLocaleLowerCase(),this._shortWeekdaysParse[m]=this.weekdaysShort(v,"").toLocaleLowerCase(),this._weekdaysParse[m]=this.weekdays(v,"").toLocaleLowerCase();return h?u==="dddd"?(w=qe.call(this._weekdaysParse,P),w!==-1?w:null):u==="ddd"?(w=qe.call(this._shortWeekdaysParse,P),w!==-1?w:null):(w=qe.call(this._minWeekdaysParse,P),w!==-1?w:null):u==="dddd"?(w=qe.call(this._weekdaysParse,P),w!==-1||(w=qe.call(this._shortWeekdaysParse,P),w!==-1)?w:(w=qe.call(this._minWeekdaysParse,P),w!==-1?w:null)):u==="ddd"?(w=qe.call(this._shortWeekdaysParse,P),w!==-1||(w=qe.call(this._weekdaysParse,P),w!==-1)?w:(w=qe.call(this._minWeekdaysParse,P),w!==-1?w:null)):(w=qe.call(this._minWeekdaysParse,P),w!==-1||(w=qe.call(this._weekdaysParse,P),w!==-1)?w:(w=qe.call(this._shortWeekdaysParse,P),w!==-1?w:null))}function hw(a,u,h){var m,w,v;if(this._weekdaysParseExact)return dw.call(this,a,u,h);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),m=0;m<7;m++){if(w=g([2e3,1]).day(m),h&&!this._fullWeekdaysParse[m]&&(this._fullWeekdaysParse[m]=new RegExp("^"+this.weekdays(w,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[m]=new RegExp("^"+this.weekdaysShort(w,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[m]=new RegExp("^"+this.weekdaysMin(w,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[m]||(v="^"+this.weekdays(w,"")+"|^"+this.weekdaysShort(w,"")+"|^"+this.weekdaysMin(w,""),this._weekdaysParse[m]=new RegExp(v.replace(".",""),"i")),h&&u==="dddd"&&this._fullWeekdaysParse[m].test(a))return m;if(h&&u==="ddd"&&this._shortWeekdaysParse[m].test(a))return m;if(h&&u==="dd"&&this._minWeekdaysParse[m].test(a))return m;if(!h&&this._weekdaysParse[m].test(a))return m}}function pw(a){if(!this.isValid())return a!=null?this:NaN;var u=this._isUTC?this._d.getUTCDay():this._d.getDay();return a!=null?(a=rw(a,this.localeData()),this.add(a-u,"d")):u}function mw(a){if(!this.isValid())return a!=null?this:NaN;var u=(this.day()+7-this.localeData()._week.dow)%7;return a==null?u:this.add(a-u,"d")}function gw(a){if(!this.isValid())return a!=null?this:NaN;if(a!=null){var u=nw(a,this.localeData());return this.day(this.day()%7?u:u-7)}else return this.day()||7}function yw(a){return this._weekdaysParseExact?(o(this,"_weekdaysRegex")||Il.call(this),a?this._weekdaysStrictRegex:this._weekdaysRegex):(o(this,"_weekdaysRegex")||(this._weekdaysRegex=iw),this._weekdaysStrictRegex&&a?this._weekdaysStrictRegex:this._weekdaysRegex)}function ww(a){return this._weekdaysParseExact?(o(this,"_weekdaysRegex")||Il.call(this),a?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(o(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=aw),this._weekdaysShortStrictRegex&&a?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function _w(a){return this._weekdaysParseExact?(o(this,"_weekdaysRegex")||Il.call(this),a?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(o(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=lw),this._weekdaysMinStrictRegex&&a?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function Il(){function a(xt,Wr){return Wr.length-xt.length}var u=[],h=[],m=[],w=[],v,P,ee,pe,Me;for(v=0;v<7;v++)P=g([2e3,1]).day(v),ee=Lt(this.weekdaysMin(P,"")),pe=Lt(this.weekdaysShort(P,"")),Me=Lt(this.weekdays(P,"")),u.push(ee),h.push(pe),m.push(Me),w.push(ee),w.push(pe),w.push(Me);u.sort(a),h.sort(a),m.sort(a),w.sort(a),this._weekdaysRegex=new RegExp("^("+w.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+m.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+h.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+u.join("|")+")","i")}function Ll(){return this.hours()%12||12}function bw(){return this.hours()||24}G("H",["HH",2],0,"hour"),G("h",["hh",2],0,Ll),G("k",["kk",2],0,bw),G("hmm",0,0,function(){return""+Ll.apply(this)+ke(this.minutes(),2)}),G("hmmss",0,0,function(){return""+Ll.apply(this)+ke(this.minutes(),2)+ke(this.seconds(),2)}),G("Hmm",0,0,function(){return""+this.hours()+ke(this.minutes(),2)}),G("Hmmss",0,0,function(){return""+this.hours()+ke(this.minutes(),2)+ke(this.seconds(),2)});function Td(a,u){G(a,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),u)})}Td("a",!0),Td("A",!1),Ze("hour","h"),Ae("hour",13);function Ad(a,u){return u._meridiemParse}X("a",Ad),X("A",Ad),X("H",Ie),X("h",Ie),X("k",Ie),X("HH",Ie,It),X("hh",Ie,It),X("kk",Ie,It),X("hmm",yd),X("hmmss",wd),X("Hmm",yd),X("Hmmss",wd),De(["H","HH"],st),De(["k","kk"],function(a,u,h){var m=ye(a);u[st]=m===24?0:m}),De(["a","A"],function(a,u,h){h._isPm=h._locale.isPM(a),h._meridiem=a}),De(["h","hh"],function(a,u,h){u[st]=ye(a),y(h).bigHour=!0}),De("hmm",function(a,u,h){var m=a.length-2;u[st]=ye(a.substr(0,m)),u[nr]=ye(a.substr(m)),y(h).bigHour=!0}),De("hmmss",function(a,u,h){var m=a.length-4,w=a.length-2;u[st]=ye(a.substr(0,m)),u[nr]=ye(a.substr(m,2)),u[$r]=ye(a.substr(w)),y(h).bigHour=!0}),De("Hmm",function(a,u,h){var m=a.length-2;u[st]=ye(a.substr(0,m)),u[nr]=ye(a.substr(m))}),De("Hmmss",function(a,u,h){var m=a.length-4,w=a.length-2;u[st]=ye(a.substr(0,m)),u[nr]=ye(a.substr(m,2)),u[$r]=ye(a.substr(w))});function vw(a){return(a+"").toLowerCase().charAt(0)==="p"}var xw=/[ap]\.?m?\.?/i,Sw=ls("Hours",!0);function kw(a,u,h){return a>11?h?"pm":"PM":h?"am":"AM"}var Dd={calendar:V,longDateFormat:is,invalidDate:po,ordinal:go,dayOfMonthOrdinalParse:yo,relativeTime:_o,months:Uy,monthsShort:_d,week:Xy,weekdays:sw,weekdaysMin:ow,weekdaysShort:Ed,meridiemParse:xw},Ne={},To={},Ao;function Cw(a,u){var h,m=Math.min(a.length,u.length);for(h=0;h<m;h+=1)if(a[h]!==u[h])return h;return m}function Md(a){return a&&a.toLowerCase().replace("_","-")}function Ew(a){for(var u=0,h,m,w,v;u<a.length;){for(v=Md(a[u]).split("-"),h=v.length,m=Md(a[u+1]),m=m?m.split("-"):null;h>0;){if(w=Pi(v.slice(0,h).join("-")),w)return w;if(m&&m.length>=h&&Cw(v,m)>=h-1)break;h--}u++}return Ao}function Tw(a){return a.match("^[^/\\\\]*$")!=null}function Pi(a){var u=null,h;if(Ne[a]===void 0&&typeof co!="undefined"&&co&&co.exports&&Tw(a))try{u=Ao._abbr,h=require,h("./locale/"+a),un(u)}catch(m){Ne[a]=null}return Ne[a]}function un(a,u){var h;return a&&(l(u)?h=Nr(a):h=$l(a,u),h?Ao=h:typeof console!="undefined"&&console.warn&&console.warn("Locale "+a+" not found. Did you forget to load it?")),Ao._abbr}function $l(a,u){if(u!==null){var h,m=Dd;if(u.abbr=a,Ne[a]!=null)ue("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),m=Ne[a]._config;else if(u.parentLocale!=null)if(Ne[u.parentLocale]!=null)m=Ne[u.parentLocale]._config;else if(h=Pi(u.parentLocale),h!=null)m=h._config;else return To[u.parentLocale]||(To[u.parentLocale]=[]),To[u.parentLocale].push({name:a,config:u}),null;return Ne[a]=new $(be(m,u)),To[a]&&To[a].forEach(function(w){$l(w.name,w.config)}),un(a),Ne[a]}else return delete Ne[a],null}function Aw(a,u){if(u!=null){var h,m,w=Dd;Ne[a]!=null&&Ne[a].parentLocale!=null?Ne[a].set(be(Ne[a]._config,u)):(m=Pi(a),m!=null&&(w=m._config),u=be(w,u),m==null&&(u.abbr=a),h=new $(u),h.parentLocale=Ne[a],Ne[a]=h),un(a)}else Ne[a]!=null&&(Ne[a].parentLocale!=null?(Ne[a]=Ne[a].parentLocale,a===un()&&un(a)):Ne[a]!=null&&delete Ne[a]);return Ne[a]}function Nr(a){var u;if(a&&a._locale&&a._locale._abbr&&(a=a._locale._abbr),!a)return Ao;if(!r(a)){if(u=Pi(a),u)return u;a=[a]}return Ew(a)}function Dw(){return j(Ne)}function Ul(a){var u,h=a._a;return h&&y(a).overflow===-2&&(u=h[Lr]<0||h[Lr]>11?Lr:h[br]<1||h[br]>Ri(h[_t],h[Lr])?br:h[st]<0||h[st]>24||h[st]===24&&(h[nr]!==0||h[$r]!==0||h[Pn]!==0)?st:h[nr]<0||h[nr]>59?nr:h[$r]<0||h[$r]>59?$r:h[Pn]<0||h[Pn]>999?Pn:-1,y(a)._overflowDayOfYear&&(u<_t||u>br)&&(u=br),y(a)._overflowWeeks&&u===-1&&(u=Iy),y(a)._overflowWeekday&&u===-1&&(u=Ly),y(a).overflow=u),a}var Mw=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Rw=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Fw=/Z|[+-]\d\d(?::?\d\d)?/,Oi=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],Nl=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],Pw=/^\/?Date\((-?\d+)/i,Ow=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,Iw={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function Rd(a){var u,h,m=a._i,w=Mw.exec(m)||Rw.exec(m),v,P,ee,pe,Me=Oi.length,xt=Nl.length;if(w){for(y(a).iso=!0,u=0,h=Me;u<h;u++)if(Oi[u][1].exec(w[1])){P=Oi[u][0],v=Oi[u][2]!==!1;break}if(P==null){a._isValid=!1;return}if(w[3]){for(u=0,h=xt;u<h;u++)if(Nl[u][1].exec(w[3])){ee=(w[2]||" ")+Nl[u][0];break}if(ee==null){a._isValid=!1;return}}if(!v&&ee!=null){a._isValid=!1;return}if(w[4])if(Fw.exec(w[4]))pe="Z";else{a._isValid=!1;return}a._f=P+(ee||"")+(pe||""),Hl(a)}else a._isValid=!1}function Lw(a,u,h,m,w,v){var P=[$w(a),_d.indexOf(u),parseInt(h,10),parseInt(m,10),parseInt(w,10)];return v&&P.push(parseInt(v,10)),P}function $w(a){var u=parseInt(a,10);return u<=49?2e3+u:u<=999?1900+u:u}function Uw(a){return a.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function Nw(a,u,h){if(a){var m=Ed.indexOf(a),w=new Date(u[0],u[1],u[2]).getDay();if(m!==w)return y(h).weekdayMismatch=!0,h._isValid=!1,!1}return!0}function Bw(a,u,h){if(a)return Iw[a];if(u)return 0;var m=parseInt(h,10),w=m%100,v=(m-w)/100;return v*60+w}function Fd(a){var u=Ow.exec(Uw(a._i)),h;if(u){if(h=Lw(u[4],u[3],u[2],u[5],u[6],u[7]),!Nw(u[1],h,a))return;a._a=h,a._tzm=Bw(u[8],u[9],u[10]),a._d=Co.apply(null,a._a),a._d.setUTCMinutes(a._d.getUTCMinutes()-a._tzm),y(a).rfc2822=!0}else a._isValid=!1}function Hw(a){var u=Pw.exec(a._i);if(u!==null){a._d=new Date(+u[1]);return}if(Rd(a),a._isValid===!1)delete a._isValid;else return;if(Fd(a),a._isValid===!1)delete a._isValid;else return;a._strict?a._isValid=!1:e.createFromInputFallback(a)}e.createFromInputFallback=I("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(a){a._d=new Date(a._i+(a._useUTC?" UTC":""))});function us(a,u,h){return a!=null?a:u!=null?u:h}function Vw(a){var u=new Date(e.now());return a._useUTC?[u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate()]:[u.getFullYear(),u.getMonth(),u.getDate()]}function Bl(a){var u,h,m=[],w,v,P;if(!a._d){for(w=Vw(a),a._w&&a._a[br]==null&&a._a[Lr]==null&&Ww(a),a._dayOfYear!=null&&(P=us(a._a[_t],w[_t]),(a._dayOfYear>ko(P)||a._dayOfYear===0)&&(y(a)._overflowDayOfYear=!0),h=Co(P,0,a._dayOfYear),a._a[Lr]=h.getUTCMonth(),a._a[br]=h.getUTCDate()),u=0;u<3&&a._a[u]==null;++u)a._a[u]=m[u]=w[u];for(;u<7;u++)a._a[u]=m[u]=a._a[u]==null?u===2?1:0:a._a[u];a._a[st]===24&&a._a[nr]===0&&a._a[$r]===0&&a._a[Pn]===0&&(a._nextDay=!0,a._a[st]=0),a._d=(a._useUTC?Co:Gy).apply(null,m),v=a._useUTC?a._d.getUTCDay():a._d.getDay(),a._tzm!=null&&a._d.setUTCMinutes(a._d.getUTCMinutes()-a._tzm),a._nextDay&&(a._a[st]=24),a._w&&typeof a._w.d!="undefined"&&a._w.d!==v&&(y(a).weekdayMismatch=!0)}}function Ww(a){var u,h,m,w,v,P,ee,pe,Me;u=a._w,u.GG!=null||u.W!=null||u.E!=null?(v=1,P=4,h=us(u.GG,a._a[_t],Eo(Le(),1,4).year),m=us(u.W,1),w=us(u.E,1),(w<1||w>7)&&(pe=!0)):(v=a._locale._week.dow,P=a._locale._week.doy,Me=Eo(Le(),v,P),h=us(u.gg,a._a[_t],Me.year),m=us(u.w,Me.week),u.d!=null?(w=u.d,(w<0||w>6)&&(pe=!0)):u.e!=null?(w=u.e+v,(u.e<0||u.e>6)&&(pe=!0)):w=v),m<1||m>Ur(h,v,P)?y(a)._overflowWeeks=!0:pe!=null?y(a)._overflowWeekday=!0:(ee=Cd(h,m,w,v,P),a._a[_t]=ee.year,a._dayOfYear=ee.dayOfYear)}e.ISO_8601=function(){},e.RFC_2822=function(){};function Hl(a){if(a._f===e.ISO_8601){Rd(a);return}if(a._f===e.RFC_2822){Fd(a);return}a._a=[],y(a).empty=!0;var u=""+a._i,h,m,w,v,P,ee=u.length,pe=0,Me,xt;for(w=os(a._f,a._locale).match(vt)||[],xt=w.length,h=0;h<xt;h++)v=w[h],m=(u.match(Fy(v,a))||[])[0],m&&(P=u.substr(0,u.indexOf(m)),P.length>0&&y(a).unusedInput.push(P),u=u.slice(u.indexOf(m)+m.length),pe+=m.length),le[v]?(m?y(a).empty=!1:y(a).unusedTokens.push(v),Oy(v,m,a)):a._strict&&!m&&y(a).unusedTokens.push(v);y(a).charsLeftOver=ee-pe,u.length>0&&y(a).unusedInput.push(u),a._a[st]<=12&&y(a).bigHour===!0&&a._a[st]>0&&(y(a).bigHour=void 0),y(a).parsedDateParts=a._a.slice(0),y(a).meridiem=a._meridiem,a._a[st]=Kw(a._locale,a._a[st],a._meridiem),Me=y(a).era,Me!==null&&(a._a[_t]=a._locale.erasConvertYear(Me,a._a[_t])),Bl(a),Ul(a)}function Kw(a,u,h){var m;return h==null?u:a.meridiemHour!=null?a.meridiemHour(u,h):(a.isPM!=null&&(m=a.isPM(h),m&&u<12&&(u+=12),!m&&u===12&&(u=0)),u)}function Yw(a){var u,h,m,w,v,P,ee=!1,pe=a._f.length;if(pe===0){y(a).invalidFormat=!0,a._d=new Date(NaN);return}for(w=0;w<pe;w++)v=0,P=!1,u=S({},a),a._useUTC!=null&&(u._useUTC=a._useUTC),u._f=a._f[w],Hl(u),C(u)&&(P=!0),v+=y(u).charsLeftOver,v+=y(u).unusedTokens.length*10,y(u).score=v,ee?v<m&&(m=v,h=u):(m==null||v<m||P)&&(m=v,h=u,P&&(ee=!0));p(a,h||u)}function Jw(a){if(!a._d){var u=de(a._i),h=u.day===void 0?u.date:u.day;a._a=d([u.year,u.month,h,u.hour,u.minute,u.second,u.millisecond],function(m){return m&&parseInt(m,10)}),Bl(a)}}function qw(a){var u=new R(Ul(Pd(a)));return u._nextDay&&(u.add(1,"d"),u._nextDay=void 0),u}function Pd(a){var u=a._i,h=a._f;return a._locale=a._locale||Nr(a._l),u===null||h===void 0&&u===""?x({nullInput:!0}):(typeof u=="string"&&(a._i=u=a._locale.preparse(u)),O(u)?new R(Ul(u)):(f(u)?a._d=u:r(h)?Yw(a):h?Hl(a):jw(a),C(a)||(a._d=null),a))}function jw(a){var u=a._i;l(u)?a._d=new Date(e.now()):f(u)?a._d=new Date(u.valueOf()):typeof u=="string"?Hw(a):r(u)?(a._a=d(u.slice(0),function(h){return parseInt(h,10)}),Bl(a)):s(u)?Jw(a):c(u)?a._d=new Date(u):e.createFromInputFallback(a)}function Od(a,u,h,m,w){var v={};return(u===!0||u===!1)&&(m=u,u=void 0),(h===!0||h===!1)&&(m=h,h=void 0),(s(a)&&i(a)||r(a)&&a.length===0)&&(a=void 0),v._isAMomentObject=!0,v._useUTC=v._isUTC=w,v._l=h,v._i=a,v._f=u,v._strict=m,qw(v)}function Le(a,u,h,m){return Od(a,u,h,m,!1)}var Gw=I("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var a=Le.apply(null,arguments);return this.isValid()&&a.isValid()?a<this?this:a:x()}),zw=I("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var a=Le.apply(null,arguments);return this.isValid()&&a.isValid()?a>this?this:a:x()});function Id(a,u){var h,m;if(u.length===1&&r(u[0])&&(u=u[0]),!u.length)return Le();for(h=u[0],m=1;m<u.length;++m)(!u[m].isValid()||u[m][a](h))&&(h=u[m]);return h}function Xw(){var a=[].slice.call(arguments,0);return Id("isBefore",a)}function Zw(){var a=[].slice.call(arguments,0);return Id("isAfter",a)}var Qw=function(){return Date.now?Date.now():+new Date},Do=["year","quarter","month","week","day","hour","minute","second","millisecond"];function e_(a){var u,h=!1,m,w=Do.length;for(u in a)if(o(a,u)&&!(qe.call(Do,u)!==-1&&(a[u]==null||!isNaN(a[u]))))return!1;for(m=0;m<w;++m)if(a[Do[m]]){if(h)return!1;parseFloat(a[Do[m]])!==ye(a[Do[m]])&&(h=!0)}return!0}function t_(){return this._isValid}function r_(){return sr(NaN)}function Ii(a){var u=de(a),h=u.year||0,m=u.quarter||0,w=u.month||0,v=u.week||u.isoWeek||0,P=u.day||0,ee=u.hour||0,pe=u.minute||0,Me=u.second||0,xt=u.millisecond||0;this._isValid=e_(u),this._milliseconds=+xt+Me*1e3+pe*6e4+ee*1e3*60*60,this._days=+P+v*7,this._months=+w+m*3+h*12,this._data={},this._locale=Nr(),this._bubble()}function Li(a){return a instanceof Ii}function Vl(a){return a<0?Math.round(-1*a)*-1:Math.round(a)}function n_(a,u,h){var m=Math.min(a.length,u.length),w=Math.abs(a.length-u.length),v=0,P;for(P=0;P<m;P++)(h&&a[P]!==u[P]||!h&&ye(a[P])!==ye(u[P]))&&v++;return v+w}function Ld(a,u){G(a,0,0,function(){var h=this.utcOffset(),m="+";return h<0&&(h=-h,m="-"),m+ke(~~(h/60),2)+u+ke(~~h%60,2)})}Ld("Z",":"),Ld("ZZ",""),X("Z",Di),X("ZZ",Di),De(["Z","ZZ"],function(a,u,h){h._useUTC=!0,h._tzm=Wl(Di,a)});var s_=/([\+\-]|\d\d)/gi;function Wl(a,u){var h=(u||"").match(a),m,w,v;return h===null?null:(m=h[h.length-1]||[],w=(m+"").match(s_)||["-",0,0],v=+(w[1]*60)+ye(w[2]),v===0?0:w[0]==="+"?v:-v)}function Kl(a,u){var h,m;return u._isUTC?(h=u.clone(),m=(O(a)||f(a)?a.valueOf():Le(a).valueOf())-h.valueOf(),h._d.setTime(h._d.valueOf()+m),e.updateOffset(h,!1),h):Le(a).local()}function Yl(a){return-Math.round(a._d.getTimezoneOffset())}e.updateOffset=function(){};function o_(a,u,h){var m=this._offset||0,w;if(!this.isValid())return a!=null?this:NaN;if(a!=null){if(typeof a=="string"){if(a=Wl(Di,a),a===null)return this}else Math.abs(a)<16&&!h&&(a=a*60);return!this._isUTC&&u&&(w=Yl(this)),this._offset=a,this._isUTC=!0,w!=null&&this.add(w,"m"),m!==a&&(!u||this._changeInProgress?Bd(this,sr(a-m,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,e.updateOffset(this,!0),this._changeInProgress=null)),this}else return this._isUTC?m:Yl(this)}function i_(a,u){return a!=null?(typeof a!="string"&&(a=-a),this.utcOffset(a,u),this):-this.utcOffset()}function a_(a){return this.utcOffset(0,a)}function l_(a){return this._isUTC&&(this.utcOffset(0,a),this._isUTC=!1,a&&this.subtract(Yl(this),"m")),this}function c_(){if(this._tzm!=null)this.utcOffset(this._tzm,!1,!0);else if(typeof this._i=="string"){var a=Wl(My,this._i);a!=null?this.utcOffset(a):this.utcOffset(0,!0)}return this}function u_(a){return this.isValid()?(a=a?Le(a).utcOffset():0,(this.utcOffset()-a)%60===0):!1}function f_(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function d_(){if(!l(this._isDSTShifted))return this._isDSTShifted;var a={},u;return S(a,this),a=Pd(a),a._a?(u=a._isUTC?g(a._a):Le(a._a),this._isDSTShifted=this.isValid()&&n_(a._a,u.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}function h_(){return this.isValid()?!this._isUTC:!1}function p_(){return this.isValid()?this._isUTC:!1}function $d(){return this.isValid()?this._isUTC&&this._offset===0:!1}var m_=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,g_=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function sr(a,u){var h=a,m=null,w,v,P;return Li(a)?h={ms:a._milliseconds,d:a._days,M:a._months}:c(a)||!isNaN(+a)?(h={},u?h[u]=+a:h.milliseconds=+a):(m=m_.exec(a))?(w=m[1]==="-"?-1:1,h={y:0,d:ye(m[br])*w,h:ye(m[st])*w,m:ye(m[nr])*w,s:ye(m[$r])*w,ms:ye(Vl(m[Pn]*1e3))*w}):(m=g_.exec(a))?(w=m[1]==="-"?-1:1,h={y:On(m[2],w),M:On(m[3],w),w:On(m[4],w),d:On(m[5],w),h:On(m[6],w),m:On(m[7],w),s:On(m[8],w)}):h==null?h={}:typeof h=="object"&&("from"in h||"to"in h)&&(P=y_(Le(h.from),Le(h.to)),h={},h.ms=P.milliseconds,h.M=P.months),v=new Ii(h),Li(a)&&o(a,"_locale")&&(v._locale=a._locale),Li(a)&&o(a,"_isValid")&&(v._isValid=a._isValid),v}sr.fn=Ii.prototype,sr.invalid=r_;function On(a,u){var h=a&&parseFloat(a.replace(",","."));return(isNaN(h)?0:h)*u}function Ud(a,u){var h={};return h.months=u.month()-a.month()+(u.year()-a.year())*12,a.clone().add(h.months,"M").isAfter(u)&&--h.months,h.milliseconds=+u-+a.clone().add(h.months,"M"),h}function y_(a,u){var h;return a.isValid()&&u.isValid()?(u=Kl(u,a),a.isBefore(u)?h=Ud(a,u):(h=Ud(u,a),h.milliseconds=-h.milliseconds,h.months=-h.months),h):{milliseconds:0,months:0}}function Nd(a,u){return function(h,m){var w,v;return m!==null&&!isNaN(+m)&&(ue(u,"moment()."+u+"(period, number) is deprecated. Please use moment()."+u+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),v=h,h=m,m=v),w=sr(h,m),Bd(this,w,a),this}}function Bd(a,u,h,m){var w=u._milliseconds,v=Vl(u._days),P=Vl(u._months);a.isValid()&&(m=m==null?!0:m,P&&vd(a,ki(a,"Month")+P*h),v&&pd(a,"Date",ki(a,"Date")+v*h),w&&a._d.setTime(a._d.valueOf()+w*h),m&&e.updateOffset(a,v||P))}var w_=Nd(1,"add"),__=Nd(-1,"subtract");function Hd(a){return typeof a=="string"||a instanceof String}function b_(a){return O(a)||f(a)||Hd(a)||c(a)||x_(a)||v_(a)||a===null||a===void 0}function v_(a){var u=s(a)&&!i(a),h=!1,m=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],w,v,P=m.length;for(w=0;w<P;w+=1)v=m[w],h=h||o(a,v);return u&&h}function x_(a){var u=r(a),h=!1;return u&&(h=a.filter(function(m){return!c(m)&&Hd(a)}).length===0),u&&h}function S_(a){var u=s(a)&&!i(a),h=!1,m=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],w,v;for(w=0;w<m.length;w+=1)v=m[w],h=h||o(a,v);return u&&h}function k_(a,u){var h=a.diff(u,"days",!0);return h<-6?"sameElse":h<-1?"lastWeek":h<0?"lastDay":h<1?"sameDay":h<2?"nextDay":h<7?"nextWeek":"sameElse"}function C_(a,u){arguments.length===1&&(arguments[0]?b_(arguments[0])?(a=arguments[0],u=void 0):S_(arguments[0])&&(u=arguments[0],a=void 0):(a=void 0,u=void 0));var h=a||Le(),m=Kl(h,this).startOf("day"),w=e.calendarFormat(this,m)||"sameElse",v=u&&(se(u[w])?u[w].call(this,h):u[w]);return this.format(v||this.localeData().calendar(w,this,Le(h)))}function E_(){return new R(this)}function T_(a,u){var h=O(a)?a:Le(a);return this.isValid()&&h.isValid()?(u=F(u)||"millisecond",u==="millisecond"?this.valueOf()>h.valueOf():h.valueOf()<this.clone().startOf(u).valueOf()):!1}function A_(a,u){var h=O(a)?a:Le(a);return this.isValid()&&h.isValid()?(u=F(u)||"millisecond",u==="millisecond"?this.valueOf()<h.valueOf():this.clone().endOf(u).valueOf()<h.valueOf()):!1}function D_(a,u,h,m){var w=O(a)?a:Le(a),v=O(u)?u:Le(u);return this.isValid()&&w.isValid()&&v.isValid()?(m=m||"()",(m[0]==="("?this.isAfter(w,h):!this.isBefore(w,h))&&(m[1]===")"?this.isBefore(v,h):!this.isAfter(v,h))):!1}function M_(a,u){var h=O(a)?a:Le(a),m;return this.isValid()&&h.isValid()?(u=F(u)||"millisecond",u==="millisecond"?this.valueOf()===h.valueOf():(m=h.valueOf(),this.clone().startOf(u).valueOf()<=m&&m<=this.clone().endOf(u).valueOf())):!1}function R_(a,u){return this.isSame(a,u)||this.isAfter(a,u)}function F_(a,u){return this.isSame(a,u)||this.isBefore(a,u)}function P_(a,u,h){var m,w,v;if(!this.isValid())return NaN;if(m=Kl(a,this),!m.isValid())return NaN;switch(w=(m.utcOffset()-this.utcOffset())*6e4,u=F(u),u){case"year":v=$i(this,m)/12;break;case"month":v=$i(this,m);break;case"quarter":v=$i(this,m)/3;break;case"second":v=(this-m)/1e3;break;case"minute":v=(this-m)/6e4;break;case"hour":v=(this-m)/36e5;break;case"day":v=(this-m-w)/864e5;break;case"week":v=(this-m-w)/6048e5;break;default:v=this-m}return h?v:wt(v)}function $i(a,u){if(a.date()<u.date())return-$i(u,a);var h=(u.year()-a.year())*12+(u.month()-a.month()),m=a.clone().add(h,"months"),w,v;return u-m<0?(w=a.clone().add(h-1,"months"),v=(u-m)/(m-w)):(w=a.clone().add(h+1,"months"),v=(u-m)/(w-m)),-(h+v)||0}e.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",e.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function O_(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function I_(a){if(!this.isValid())return null;var u=a!==!0,h=u?this.clone().utc():this;return h.year()<0||h.year()>9999?Or(h,u?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):se(Date.prototype.toISOString)?u?this.toDate().toISOString():new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",Or(h,"Z")):Or(h,u?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function L_(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var a="moment",u="",h,m,w,v;return this.isLocal()||(a=this.utcOffset()===0?"moment.utc":"moment.parseZone",u="Z"),h="["+a+'("]',m=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",w="-MM-DD[T]HH:mm:ss.SSS",v=u+'[")]',this.format(h+m+w+v)}function $_(a){a||(a=this.isUtc()?e.defaultFormatUtc:e.defaultFormat);var u=Or(this,a);return this.localeData().postformat(u)}function U_(a,u){return this.isValid()&&(O(a)&&a.isValid()||Le(a).isValid())?sr({to:this,from:a}).locale(this.locale()).humanize(!u):this.localeData().invalidDate()}function N_(a){return this.from(Le(),a)}function B_(a,u){return this.isValid()&&(O(a)&&a.isValid()||Le(a).isValid())?sr({from:this,to:a}).locale(this.locale()).humanize(!u):this.localeData().invalidDate()}function H_(a){return this.to(Le(),a)}function Vd(a){var u;return a===void 0?this._locale._abbr:(u=Nr(a),u!=null&&(this._locale=u),this)}var Wd=I("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(a){return a===void 0?this.localeData():this.locale(a)});function Kd(){return this._locale}var Ui=1e3,fs=60*Ui,Ni=60*fs,Yd=(365*400+97)*24*Ni;function ds(a,u){return(a%u+u)%u}function Jd(a,u,h){return a<100&&a>=0?new Date(a+400,u,h)-Yd:new Date(a,u,h).valueOf()}function qd(a,u,h){return a<100&&a>=0?Date.UTC(a+400,u,h)-Yd:Date.UTC(a,u,h)}function V_(a){var u,h;if(a=F(a),a===void 0||a==="millisecond"||!this.isValid())return this;switch(h=this._isUTC?qd:Jd,a){case"year":u=h(this.year(),0,1);break;case"quarter":u=h(this.year(),this.month()-this.month()%3,1);break;case"month":u=h(this.year(),this.month(),1);break;case"week":u=h(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":u=h(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":u=h(this.year(),this.month(),this.date());break;case"hour":u=this._d.valueOf(),u-=ds(u+(this._isUTC?0:this.utcOffset()*fs),Ni);break;case"minute":u=this._d.valueOf(),u-=ds(u,fs);break;case"second":u=this._d.valueOf(),u-=ds(u,Ui);break}return this._d.setTime(u),e.updateOffset(this,!0),this}function W_(a){var u,h;if(a=F(a),a===void 0||a==="millisecond"||!this.isValid())return this;switch(h=this._isUTC?qd:Jd,a){case"year":u=h(this.year()+1,0,1)-1;break;case"quarter":u=h(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":u=h(this.year(),this.month()+1,1)-1;break;case"week":u=h(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":u=h(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":u=h(this.year(),this.month(),this.date()+1)-1;break;case"hour":u=this._d.valueOf(),u+=Ni-ds(u+(this._isUTC?0:this.utcOffset()*fs),Ni)-1;break;case"minute":u=this._d.valueOf(),u+=fs-ds(u,fs)-1;break;case"second":u=this._d.valueOf(),u+=Ui-ds(u,Ui)-1;break}return this._d.setTime(u),e.updateOffset(this,!0),this}function K_(){return this._d.valueOf()-(this._offset||0)*6e4}function Y_(){return Math.floor(this.valueOf()/1e3)}function J_(){return new Date(this.valueOf())}function q_(){var a=this;return[a.year(),a.month(),a.date(),a.hour(),a.minute(),a.second(),a.millisecond()]}function j_(){var a=this;return{years:a.year(),months:a.month(),date:a.date(),hours:a.hours(),minutes:a.minutes(),seconds:a.seconds(),milliseconds:a.milliseconds()}}function G_(){return this.isValid()?this.toISOString():null}function z_(){return C(this)}function X_(){return p({},y(this))}function Z_(){return y(this).overflow}function Q_(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}G("N",0,0,"eraAbbr"),G("NN",0,0,"eraAbbr"),G("NNN",0,0,"eraAbbr"),G("NNNN",0,0,"eraName"),G("NNNNN",0,0,"eraNarrow"),G("y",["y",1],"yo","eraYear"),G("y",["yy",2],0,"eraYear"),G("y",["yyy",3],0,"eraYear"),G("y",["yyyy",4],0,"eraYear"),X("N",Jl),X("NN",Jl),X("NNN",Jl),X("NNNN",ub),X("NNNNN",fb),De(["N","NN","NNN","NNNN","NNNNN"],function(a,u,h,m){var w=h._locale.erasParse(a,m,h._strict);w?y(h).era=w:y(h).invalidEra=a}),X("y",cs),X("yy",cs),X("yyy",cs),X("yyyy",cs),X("yo",db),De(["y","yy","yyy","yyyy"],_t),De(["yo"],function(a,u,h,m){var w;h._locale._eraYearOrdinalRegex&&(w=a.match(h._locale._eraYearOrdinalRegex)),h._locale.eraYearOrdinalParse?u[_t]=h._locale.eraYearOrdinalParse(a,w):u[_t]=parseInt(a,10)});function eb(a,u){var h,m,w,v=this._eras||Nr("en")._eras;for(h=0,m=v.length;h<m;++h){switch(typeof v[h].since){case"string":w=e(v[h].since).startOf("day"),v[h].since=w.valueOf();break}switch(typeof v[h].until){case"undefined":v[h].until=1/0;break;case"string":w=e(v[h].until).startOf("day").valueOf(),v[h].until=w.valueOf();break}}return v}function tb(a,u,h){var m,w,v=this.eras(),P,ee,pe;for(a=a.toUpperCase(),m=0,w=v.length;m<w;++m)if(P=v[m].name.toUpperCase(),ee=v[m].abbr.toUpperCase(),pe=v[m].narrow.toUpperCase(),h)switch(u){case"N":case"NN":case"NNN":if(ee===a)return v[m];break;case"NNNN":if(P===a)return v[m];break;case"NNNNN":if(pe===a)return v[m];break}else if([P,ee,pe].indexOf(a)>=0)return v[m]}function rb(a,u){var h=a.since<=a.until?1:-1;return u===void 0?e(a.since).year():e(a.since).year()+(u-a.offset)*h}function nb(){var a,u,h,m=this.localeData().eras();for(a=0,u=m.length;a<u;++a)if(h=this.clone().startOf("day").valueOf(),m[a].since<=h&&h<=m[a].until||m[a].until<=h&&h<=m[a].since)return m[a].name;return""}function sb(){var a,u,h,m=this.localeData().eras();for(a=0,u=m.length;a<u;++a)if(h=this.clone().startOf("day").valueOf(),m[a].since<=h&&h<=m[a].until||m[a].until<=h&&h<=m[a].since)return m[a].narrow;return""}function ob(){var a,u,h,m=this.localeData().eras();for(a=0,u=m.length;a<u;++a)if(h=this.clone().startOf("day").valueOf(),m[a].since<=h&&h<=m[a].until||m[a].until<=h&&h<=m[a].since)return m[a].abbr;return""}function ib(){var a,u,h,m,w=this.localeData().eras();for(a=0,u=w.length;a<u;++a)if(h=w[a].since<=w[a].until?1:-1,m=this.clone().startOf("day").valueOf(),w[a].since<=m&&m<=w[a].until||w[a].until<=m&&m<=w[a].since)return(this.year()-e(w[a].since).year())*h+w[a].offset;return this.year()}function ab(a){return o(this,"_erasNameRegex")||ql.call(this),a?this._erasNameRegex:this._erasRegex}function lb(a){return o(this,"_erasAbbrRegex")||ql.call(this),a?this._erasAbbrRegex:this._erasRegex}function cb(a){return o(this,"_erasNarrowRegex")||ql.call(this),a?this._erasNarrowRegex:this._erasRegex}function Jl(a,u){return u.erasAbbrRegex(a)}function ub(a,u){return u.erasNameRegex(a)}function fb(a,u){return u.erasNarrowRegex(a)}function db(a,u){return u._eraYearOrdinalRegex||cs}function ql(){var a=[],u=[],h=[],m=[],w,v,P=this.eras();for(w=0,v=P.length;w<v;++w)u.push(Lt(P[w].name)),a.push(Lt(P[w].abbr)),h.push(Lt(P[w].narrow)),m.push(Lt(P[w].name)),m.push(Lt(P[w].abbr)),m.push(Lt(P[w].narrow));this._erasRegex=new RegExp("^("+m.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+u.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+a.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+h.join("|")+")","i")}G(0,["gg",2],0,function(){return this.weekYear()%100}),G(0,["GG",2],0,function(){return this.isoWeekYear()%100});function Bi(a,u){G(0,[a,a.length],0,u)}Bi("gggg","weekYear"),Bi("ggggg","weekYear"),Bi("GGGG","isoWeekYear"),Bi("GGGGG","isoWeekYear"),Ze("weekYear","gg"),Ze("isoWeekYear","GG"),Ae("weekYear",1),Ae("isoWeekYear",1),X("G",Ai),X("g",Ai),X("GG",Ie,It),X("gg",Ie,It),X("GGGG",Fl,Rl),X("gggg",Fl,Rl),X("GGGGG",Ti,Ci),X("ggggg",Ti,Ci),So(["gggg","ggggg","GGGG","GGGGG"],function(a,u,h,m){u[m.substr(0,2)]=ye(a)}),So(["gg","GG"],function(a,u,h,m){u[m]=e.parseTwoDigitYear(a)});function hb(a){return jd.call(this,a,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function pb(a){return jd.call(this,a,this.isoWeek(),this.isoWeekday(),1,4)}function mb(){return Ur(this.year(),1,4)}function gb(){return Ur(this.isoWeekYear(),1,4)}function yb(){var a=this.localeData()._week;return Ur(this.year(),a.dow,a.doy)}function wb(){var a=this.localeData()._week;return Ur(this.weekYear(),a.dow,a.doy)}function jd(a,u,h,m,w){var v;return a==null?Eo(this,m,w).year:(v=Ur(a,m,w),u>v&&(u=v),_b.call(this,a,u,h,m,w))}function _b(a,u,h,m,w){var v=Cd(a,u,h,m,w),P=Co(v.year,0,v.dayOfYear);return this.year(P.getUTCFullYear()),this.month(P.getUTCMonth()),this.date(P.getUTCDate()),this}G("Q",0,"Qo","quarter"),Ze("quarter","Q"),Ae("quarter",7),X("Q",md),De("Q",function(a,u){u[Lr]=(ye(a)-1)*3});function bb(a){return a==null?Math.ceil((this.month()+1)/3):this.month((a-1)*3+this.month()%3)}G("D",["DD",2],"Do","date"),Ze("date","D"),Ae("date",9),X("D",Ie),X("DD",Ie,It),X("Do",function(a,u){return a?u._dayOfMonthOrdinalParse||u._ordinalParse:u._dayOfMonthOrdinalParseLenient}),De(["D","DD"],br),De("Do",function(a,u){u[br]=ye(a.match(Ie)[0])});var Gd=ls("Date",!0);G("DDD",["DDDD",3],"DDDo","dayOfYear"),Ze("dayOfYear","DDD"),Ae("dayOfYear",4),X("DDD",Ei),X("DDDD",gd),De(["DDD","DDDD"],function(a,u,h){h._dayOfYear=ye(a)});function vb(a){var u=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return a==null?u:this.add(a-u,"d")}G("m",["mm",2],0,"minute"),Ze("minute","m"),Ae("minute",14),X("m",Ie),X("mm",Ie,It),De(["m","mm"],nr);var xb=ls("Minutes",!1);G("s",["ss",2],0,"second"),Ze("second","s"),Ae("second",15),X("s",Ie),X("ss",Ie,It),De(["s","ss"],$r);var Sb=ls("Seconds",!1);G("S",0,0,function(){return~~(this.millisecond()/100)}),G(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),G(0,["SSS",3],0,"millisecond"),G(0,["SSSS",4],0,function(){return this.millisecond()*10}),G(0,["SSSSS",5],0,function(){return this.millisecond()*100}),G(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3}),G(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4}),G(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5}),G(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6}),Ze("millisecond","ms"),Ae("millisecond",16),X("S",Ei,md),X("SS",Ei,It),X("SSS",Ei,gd);var fn,zd;for(fn="SSSS";fn.length<=9;fn+="S")X(fn,cs);function kb(a,u){u[Pn]=ye(("0."+a)*1e3)}for(fn="S";fn.length<=9;fn+="S")De(fn,kb);zd=ls("Milliseconds",!1),G("z",0,0,"zoneAbbr"),G("zz",0,0,"zoneName");function Cb(){return this._isUTC?"UTC":""}function Eb(){return this._isUTC?"Coordinated Universal Time":""}var Y=R.prototype;Y.add=w_,Y.calendar=C_,Y.clone=E_,Y.diff=P_,Y.endOf=W_,Y.format=$_,Y.from=U_,Y.fromNow=N_,Y.to=B_,Y.toNow=H_,Y.get=Ay,Y.invalidAt=Z_,Y.isAfter=T_,Y.isBefore=A_,Y.isBetween=D_,Y.isSame=M_,Y.isSameOrAfter=R_,Y.isSameOrBefore=F_,Y.isValid=z_,Y.lang=Wd,Y.locale=Vd,Y.localeData=Kd,Y.max=zw,Y.min=Gw,Y.parsingFlags=X_,Y.set=Dy,Y.startOf=V_,Y.subtract=__,Y.toArray=q_,Y.toObject=j_,Y.toDate=J_,Y.toISOString=I_,Y.inspect=L_,typeof Symbol!="undefined"&&Symbol.for!=null&&(Y[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"}),Y.toJSON=G_,Y.toString=O_,Y.unix=Y_,Y.valueOf=K_,Y.creationData=Q_,Y.eraName=nb,Y.eraNarrow=sb,Y.eraAbbr=ob,Y.eraYear=ib,Y.year=kd,Y.isLeapYear=jy,Y.weekYear=hb,Y.isoWeekYear=pb,Y.quarter=Y.quarters=bb,Y.month=xd,Y.daysInMonth=Yy,Y.week=Y.weeks=ew,Y.isoWeek=Y.isoWeeks=tw,Y.weeksInYear=yb,Y.weeksInWeekYear=wb,Y.isoWeeksInYear=mb,Y.isoWeeksInISOWeekYear=gb,Y.date=Gd,Y.day=Y.days=pw,Y.weekday=mw,Y.isoWeekday=gw,Y.dayOfYear=vb,Y.hour=Y.hours=Sw,Y.minute=Y.minutes=xb,Y.second=Y.seconds=Sb,Y.millisecond=Y.milliseconds=zd,Y.utcOffset=o_,Y.utc=a_,Y.local=l_,Y.parseZone=c_,Y.hasAlignedHourOffset=u_,Y.isDST=f_,Y.isLocal=h_,Y.isUtcOffset=p_,Y.isUtc=$d,Y.isUTC=$d,Y.zoneAbbr=Cb,Y.zoneName=Eb,Y.dates=I("dates accessor is deprecated. Use date instead.",Gd),Y.months=I("months accessor is deprecated. Use month instead",xd),Y.years=I("years accessor is deprecated. Use year instead",kd),Y.zone=I("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",i_),Y.isDSTShifted=I("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",d_);function Tb(a){return Le(a*1e3)}function Ab(){return Le.apply(null,arguments).parseZone()}function Xd(a){return a}var Ce=$.prototype;Ce.calendar=z,Ce.longDateFormat=ho,Ce.invalidDate=mo,Ce.ordinal=wo,Ce.preparse=Xd,Ce.postformat=Xd,Ce.relativeTime=bo,Ce.pastFuture=vo,Ce.set=ge,Ce.eras=eb,Ce.erasParse=tb,Ce.erasConvertYear=rb,Ce.erasAbbrRegex=lb,Ce.erasNameRegex=ab,Ce.erasNarrowRegex=cb,Ce.months=Hy,Ce.monthsShort=Vy,Ce.monthsParse=Ky,Ce.monthsRegex=qy,Ce.monthsShortRegex=Jy,Ce.week=zy,Ce.firstDayOfYear=Qy,Ce.firstDayOfWeek=Zy,Ce.weekdays=cw,Ce.weekdaysMin=fw,Ce.weekdaysShort=uw,Ce.weekdaysParse=hw,Ce.weekdaysRegex=yw,Ce.weekdaysShortRegex=ww,Ce.weekdaysMinRegex=_w,Ce.isPM=vw,Ce.meridiem=kw;function Hi(a,u,h,m){var w=Nr(),v=g().set(m,u);return w[h](v,a)}function Zd(a,u,h){if(c(a)&&(u=a,a=void 0),a=a||"",u!=null)return Hi(a,u,h,"month");var m,w=[];for(m=0;m<12;m++)w[m]=Hi(a,m,h,"month");return w}function jl(a,u,h,m){typeof a=="boolean"?(c(u)&&(h=u,u=void 0),u=u||""):(u=a,h=u,a=!1,c(u)&&(h=u,u=void 0),u=u||"");var w=Nr(),v=a?w._week.dow:0,P,ee=[];if(h!=null)return Hi(u,(h+v)%7,m,"day");for(P=0;P<7;P++)ee[P]=Hi(u,(P+v)%7,m,"day");return ee}function Db(a,u){return Zd(a,u,"months")}function Mb(a,u){return Zd(a,u,"monthsShort")}function Rb(a,u,h){return jl(a,u,h,"weekdays")}function Fb(a,u,h){return jl(a,u,h,"weekdaysShort")}function Pb(a,u,h){return jl(a,u,h,"weekdaysMin")}un("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(a){var u=a%10,h=ye(a%100/10)===1?"th":u===1?"st":u===2?"nd":u===3?"rd":"th";return a+h}}),e.lang=I("moment.lang is deprecated. Use moment.locale instead.",un),e.langData=I("moment.langData is deprecated. Use moment.localeData instead.",Nr);var Br=Math.abs;function Ob(){var a=this._data;return this._milliseconds=Br(this._milliseconds),this._days=Br(this._days),this._months=Br(this._months),a.milliseconds=Br(a.milliseconds),a.seconds=Br(a.seconds),a.minutes=Br(a.minutes),a.hours=Br(a.hours),a.months=Br(a.months),a.years=Br(a.years),this}function Qd(a,u,h,m){var w=sr(u,h);return a._milliseconds+=m*w._milliseconds,a._days+=m*w._days,a._months+=m*w._months,a._bubble()}function Ib(a,u){return Qd(this,a,u,1)}function Lb(a,u){return Qd(this,a,u,-1)}function eh(a){return a<0?Math.floor(a):Math.ceil(a)}function $b(){var a=this._milliseconds,u=this._days,h=this._months,m=this._data,w,v,P,ee,pe;return a>=0&&u>=0&&h>=0||a<=0&&u<=0&&h<=0||(a+=eh(Gl(h)+u)*864e5,u=0,h=0),m.milliseconds=a%1e3,w=wt(a/1e3),m.seconds=w%60,v=wt(w/60),m.minutes=v%60,P=wt(v/60),m.hours=P%24,u+=wt(P/24),pe=wt(th(u)),h+=pe,u-=eh(Gl(pe)),ee=wt(h/12),h%=12,m.days=u,m.months=h,m.years=ee,this}function th(a){return a*4800/146097}function Gl(a){return a*146097/4800}function Ub(a){if(!this.isValid())return NaN;var u,h,m=this._milliseconds;if(a=F(a),a==="month"||a==="quarter"||a==="year")switch(u=this._days+m/864e5,h=this._months+th(u),a){case"month":return h;case"quarter":return h/3;case"year":return h/12}else switch(u=this._days+Math.round(Gl(this._months)),a){case"week":return u/7+m/6048e5;case"day":return u+m/864e5;case"hour":return u*24+m/36e5;case"minute":return u*1440+m/6e4;case"second":return u*86400+m/1e3;case"millisecond":return Math.floor(u*864e5)+m;default:throw new Error("Unknown unit "+a)}}function Nb(){return this.isValid()?this._milliseconds+this._days*864e5+this._months%12*2592e6+ye(this._months/12)*31536e6:NaN}function Hr(a){return function(){return this.as(a)}}var Bb=Hr("ms"),Hb=Hr("s"),Vb=Hr("m"),Wb=Hr("h"),Kb=Hr("d"),Yb=Hr("w"),Jb=Hr("M"),qb=Hr("Q"),jb=Hr("y");function Gb(){return sr(this)}function zb(a){return a=F(a),this.isValid()?this[a+"s"]():NaN}function In(a){return function(){return this.isValid()?this._data[a]:NaN}}var Xb=In("milliseconds"),Zb=In("seconds"),Qb=In("minutes"),ev=In("hours"),tv=In("days"),rv=In("months"),nv=In("years");function sv(){return wt(this.days()/7)}var Vr=Math.round,hs={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function ov(a,u,h,m,w){return w.relativeTime(u||1,!!h,a,m)}function iv(a,u,h,m){var w=sr(a).abs(),v=Vr(w.as("s")),P=Vr(w.as("m")),ee=Vr(w.as("h")),pe=Vr(w.as("d")),Me=Vr(w.as("M")),xt=Vr(w.as("w")),Wr=Vr(w.as("y")),dn=v<=h.ss&&["s",v]||v<h.s&&["ss",v]||P<=1&&["m"]||P<h.m&&["mm",P]||ee<=1&&["h"]||ee<h.h&&["hh",ee]||pe<=1&&["d"]||pe<h.d&&["dd",pe];return h.w!=null&&(dn=dn||xt<=1&&["w"]||xt<h.w&&["ww",xt]),dn=dn||Me<=1&&["M"]||Me<h.M&&["MM",Me]||Wr<=1&&["y"]||["yy",Wr],dn[2]=u,dn[3]=+a>0,dn[4]=m,ov.apply(null,dn)}function av(a){return a===void 0?Vr:typeof a=="function"?(Vr=a,!0):!1}function lv(a,u){return hs[a]===void 0?!1:u===void 0?hs[a]:(hs[a]=u,a==="s"&&(hs.ss=u-1),!0)}function cv(a,u){if(!this.isValid())return this.localeData().invalidDate();var h=!1,m=hs,w,v;return typeof a=="object"&&(u=a,a=!1),typeof a=="boolean"&&(h=a),typeof u=="object"&&(m=Object.assign({},hs,u),u.s!=null&&u.ss==null&&(m.ss=u.s-1)),w=this.localeData(),v=iv(this,!h,m,w),h&&(v=w.pastFuture(+this,v)),w.postformat(v)}var zl=Math.abs;function ps(a){return(a>0)-(a<0)||+a}function Vi(){if(!this.isValid())return this.localeData().invalidDate();var a=zl(this._milliseconds)/1e3,u=zl(this._days),h=zl(this._months),m,w,v,P,ee=this.asSeconds(),pe,Me,xt,Wr;return ee?(m=wt(a/60),w=wt(m/60),a%=60,m%=60,v=wt(h/12),h%=12,P=a?a.toFixed(3).replace(/\.?0+$/,""):"",pe=ee<0?"-":"",Me=ps(this._months)!==ps(ee)?"-":"",xt=ps(this._days)!==ps(ee)?"-":"",Wr=ps(this._milliseconds)!==ps(ee)?"-":"",pe+"P"+(v?Me+v+"Y":"")+(h?Me+h+"M":"")+(u?xt+u+"D":"")+(w||m||a?"T":"")+(w?Wr+w+"H":"")+(m?Wr+m+"M":"")+(a?Wr+P+"S":"")):"P0D"}var ve=Ii.prototype;ve.isValid=t_,ve.abs=Ob,ve.add=Ib,ve.subtract=Lb,ve.as=Ub,ve.asMilliseconds=Bb,ve.asSeconds=Hb,ve.asMinutes=Vb,ve.asHours=Wb,ve.asDays=Kb,ve.asWeeks=Yb,ve.asMonths=Jb,ve.asQuarters=qb,ve.asYears=jb,ve.valueOf=Nb,ve._bubble=$b,ve.clone=Gb,ve.get=zb,ve.milliseconds=Xb,ve.seconds=Zb,ve.minutes=Qb,ve.hours=ev,ve.days=tv,ve.weeks=sv,ve.months=rv,ve.years=nv,ve.humanize=cv,ve.toISOString=Vi,ve.toString=Vi,ve.toJSON=Vi,ve.locale=Vd,ve.localeData=Kd,ve.toIsoString=I("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Vi),ve.lang=Wd,G("X",0,0,"unix"),G("x",0,0,"valueOf"),X("x",Ai),X("X",Ry),De("X",function(a,u,h){h._d=new Date(parseFloat(a)*1e3)}),De("x",function(a,u,h){h._d=new Date(ye(a))});return e.version="2.29.4",t(Le),e.fn=Y,e.min=Xw,e.max=Zw,e.now=Qw,e.utc=g,e.unix=Tb,e.months=Db,e.isDate=f,e.locale=un,e.invalid=x,e.duration=sr,e.isMoment=O,e.weekdays=Rb,e.parseZone=Ab,e.localeData=Nr,e.isDuration=Li,e.monthsShort=Mb,e.weekdaysMin=Pb,e.defineLocale=$l,e.updateLocale=Aw,e.locales=Dw,e.weekdaysShort=Fb,e.normalizeUnits=F,e.relativeTimeRounding=av,e.relativeTimeThreshold=lv,e.calendarFormat=k_,e.prototype=Y,e.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},e})});var tT={};Zl(tT,{default:()=>Ml});module.exports=gv(tT);var Vt=require("obsidian"),Cy=require("obsidian"),Ey=Ro(Wi());var at=()=>new Map,Ki=n=>{let e=at();return n.forEach((t,r)=>{e.set(r,t)}),e},or=(n,e,t)=>{let r=n.get(e);return r===void 0&&n.set(e,r=t()),r},oh=(n,e)=>{let t=[];for(let[r,s]of n)t.push(e(s,r));return t},ih=(n,e)=>{for(let[t,r]of n)if(e(r,t))return!0;return!1};var xr=()=>new Set;var Yi=n=>n[n.length-1];var ah=(n,e)=>{for(let t=0;t<e.length;t++)n.push(e[t])},ir=Array.from;var ec=Array.isArray;var Ji=class{constructor(){this._observers=at()}on(e,t){return or(this._observers,e,xr).add(t),t}once(e,t){let r=(...s)=>{this.off(e,r),t(...s)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return ir((this._observers.get(e)||at()).values()).forEach(r=>r(...t))}destroy(){this._observers=at()}},gs=class{constructor(){this._observers=at()}on(e,t){or(this._observers,e,xr).add(t)}once(e,t){let r=(...s)=>{this.off(e,r),t(...s)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return ir((this._observers.get(e)||at()).values()).forEach(r=>r(...t))}destroy(){this._observers=at()}};var Rt=Math.floor;var ys=Math.abs;var ws=(n,e)=>n<e?n:e,ar=(n,e)=>n>e?n:e,oT=Number.isNaN;var qi=n=>n!==0?n<0:1/n<0;var rc=Number.MAX_SAFE_INTEGER,iT=Number.MIN_SAFE_INTEGER,aT=1<<31;var lh=Number.isInteger||(n=>typeof n=="number"&&isFinite(n)&&Rt(n)===n),lT=Number.isNaN,cT=Number.parseInt;var wv=String.fromCharCode,uT=String.fromCodePoint,fT=wv(65535),_v=n=>n.toLowerCase(),bv=/^\s*/g,vv=n=>n.replace(bv,""),xv=/([A-Z])/g,nc=(n,e)=>vv(n.replace(xv,t=>`${e}${_v(t)}`));var Sv=n=>{let e=unescape(encodeURIComponent(n)),t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.codePointAt(s);return r},vs=typeof TextEncoder!="undefined"?new TextEncoder:null,kv=n=>vs.encode(n),uh=vs?kv:Sv;var bs=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});bs&&bs.decode(new Uint8Array).length===1&&(bs=null);var Ln=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},Un=()=>new Ln;var Cv=n=>{let e=n.cpos;for(let t=0;t<n.bufs.length;t++)e+=n.bufs[t].length;return e};var $t=n=>{let e=new Uint8Array(Cv(n)),t=0;for(let r=0;r<n.bufs.length;r++){let s=n.bufs[r];e.set(s,t),t+=s.length}return e.set(new Uint8Array(n.cbuf.buffer,0,n.cpos),t),e},Ev=(n,e)=>{let t=n.cbuf.length;t-n.cpos<e&&(n.bufs.push(new Uint8Array(n.cbuf.buffer,0,n.cpos)),n.cbuf=new Uint8Array(ar(t,e)*2),n.cpos=0)},lt=(n,e)=>{let t=n.cbuf.length;n.cpos===t&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(t*2),n.cpos=0),n.cbuf[n.cpos++]=e};var Gi=lt;var fe=(n,e)=>{for(;e>127;)lt(n,128|127&e),e=Rt(e/128);lt(n,127&e)},zi=(n,e)=>{let t=qi(e);for(t&&(e=-e),lt(n,(e>63?128:0)|(t?64:0)|63&e),e=Rt(e/64);e>0;)lt(n,(e>127?128:0)|127&e),e=Rt(e/128)},oc=new Uint8Array(3e4),Tv=oc.length/3,Av=(n,e)=>{if(e.length<Tv){let t=vs.encodeInto(e,oc).written||0;fe(n,t);for(let r=0;r<t;r++)lt(n,oc[r])}else ct(n,uh(e))},Dv=(n,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;fe(n,r);for(let s=0;s<r;s++)lt(n,t.codePointAt(s))},Kr=vs&&vs.encodeInto?Av:Dv;var Oo=(n,e)=>{let t=n.cbuf.length,r=n.cpos,s=ws(t-r,e.length),o=e.length-s;n.cbuf.set(e.subarray(0,s),r),n.cpos+=s,o>0&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(ar(t*2,o)),n.cbuf.set(e.subarray(s)),n.cpos=o)},ct=(n,e)=>{fe(n,e.byteLength),Oo(n,e)},ic=(n,e)=>{Ev(n,e);let t=new DataView(n.cbuf.buffer,n.cpos,e);return n.cpos+=e,t},Mv=(n,e)=>ic(n,4).setFloat32(0,e,!1),Rv=(n,e)=>ic(n,8).setFloat64(0,e,!1),Fv=(n,e)=>ic(n,8).setBigInt64(0,e,!1);var dh=new DataView(new ArrayBuffer(4)),Pv=n=>(dh.setFloat32(0,n),dh.getFloat32(0)===n),Ss=(n,e)=>{switch(typeof e){case"string":lt(n,119),Kr(n,e);break;case"number":lh(e)&&ys(e)<=2147483647?(lt(n,125),zi(n,e)):Pv(e)?(lt(n,124),Mv(n,e)):(lt(n,123),Rv(n,e));break;case"bigint":lt(n,122),Fv(n,e);break;case"object":if(e===null)lt(n,126);else if(ec(e)){lt(n,117),fe(n,e.length);for(let t=0;t<e.length;t++)Ss(n,e[t])}else if(e instanceof Uint8Array)lt(n,116),ct(n,e);else{lt(n,118);let t=Object.keys(e);fe(n,t.length);for(let r=0;r<t.length;r++){let s=t[r];Kr(n,s),Ss(n,e[s])}}break;case"boolean":lt(n,e?120:121);break;default:lt(n,127)}},Po=class extends Ln{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&fe(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}};var hh=n=>{n.count>0&&(zi(n.encoder,n.count===1?n.s:-n.s),n.count>1&&fe(n.encoder,n.count-2))},$n=class{constructor(){this.encoder=new Ln,this.s=0,this.count=0}write(e){this.s===e?this.count++:(hh(this),this.count=1,this.s=e)}toUint8Array(){return hh(this),$t(this.encoder)}};var ph=n=>{if(n.count>0){let e=n.diff*2+(n.count===1?0:1);zi(n.encoder,e),n.count>1&&fe(n.encoder,n.count-2)}},ks=class{constructor(){this.encoder=new Ln,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(ph(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return ph(this),$t(this.encoder)}},ji=class{constructor(){this.sarr=[],this.s="",this.lensE=new $n}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){let e=new Ln;return this.sarr.push(this.s),this.s="",Kr(e,this.sarr.join("")),Oo(e,this.lensE.toUint8Array()),$t(e)}};var Yt=n=>new Error(n),lr=()=>{throw Yt("Method unimplemented")},Jt=()=>{throw Yt("Unexpected case")};var mh=Yt("Unexpected end of array"),gh=Yt("Integer out of Range"),Cs=class{constructor(e){this.arr=e,this.pos=0}},Yr=n=>new Cs(n),yh=n=>n.pos!==n.arr.length;var Ov=(n,e)=>{let t=new Uint8Array(n.arr.buffer,n.pos+n.arr.byteOffset,e);return n.pos+=e,t},ht=n=>Ov(n,ce(n));var Nn=n=>n.arr[n.pos++];var ce=n=>{let e=0,t=1,r=n.arr.length;for(;n.pos<r;){let s=n.arr[n.pos++];if(e=e+(s&127)*t,t*=128,s<128)return e;if(e>rc)throw gh}throw mh},Zi=n=>{let e=n.arr[n.pos++],t=e&63,r=64,s=(e&64)>0?-1:1;if(!(e&128))return s*t;let o=n.arr.length;for(;n.pos<o;){if(e=n.arr[n.pos++],t=t+(e&127)*r,r*=128,e<128)return s*t;if(t>rc)throw gh}throw mh};var Iv=n=>{let e=ce(n);if(e===0)return"";{let t=String.fromCodePoint(Nn(n));if(--e<100)for(;e--;)t+=String.fromCodePoint(Nn(n));else for(;e>0;){let r=e<1e4?e:1e4,s=n.arr.subarray(n.pos,n.pos+r);n.pos+=r,t+=String.fromCodePoint.apply(null,s),e-=r}return decodeURIComponent(escape(t))}},Lv=n=>bs.decode(ht(n)),cr=bs?Lv:Iv;var cc=(n,e)=>{let t=new DataView(n.arr.buffer,n.arr.byteOffset+n.pos,e);return n.pos+=e,t},$v=n=>cc(n,4).getFloat32(0,!1),Uv=n=>cc(n,8).getFloat64(0,!1),Nv=n=>cc(n,8).getBigInt64(0,!1);var Bv=[n=>{},n=>null,Zi,$v,Uv,Nv,n=>!1,n=>!0,cr,n=>{let e=ce(n),t={};for(let r=0;r<e;r++){let s=cr(n);t[s]=Es(n)}return t},n=>{let e=ce(n),t=[];for(let r=0;r<e;r++)t.push(Es(n));return t},ht],Es=n=>Bv[127-Nn(n)](n),Io=class extends Cs{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),yh(this)?this.count=ce(this)+1:this.count=-1),this.count--,this.s}};var Bn=class extends Cs{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Zi(this);let e=qi(this.s);this.count=1,e&&(this.s=-this.s,this.count=ce(this)+2)}return this.count--,this.s}};var Ts=class extends Cs{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){let e=Zi(this),t=e&1;this.diff=Rt(e/2),this.count=1,t&&(this.count=ce(this)+2)}return this.s+=this.diff,this.count--,this.s}},Xi=class{constructor(e){this.decoder=new Bn(e),this.str=cr(this.decoder),this.spos=0}read(){let e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}};var pT=crypto.subtle,wh=crypto.getRandomValues.bind(crypto);var Lo=()=>wh(new Uint32Array(1))[0];var Hv=[1e7]+-1e3+-4e3+-8e3+-1e11,ea=()=>Hv.replace(/[018]/g,n=>(n^Lo()&15>>n/4).toString(16));var Hn=Date.now;var Jr=n=>new Promise(n);var Vv=Promise.all.bind(Promise);var fc=n=>n===void 0?null:n;var dc=class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},vh=new dc,Kv=!0;try{typeof localStorage!="undefined"&&localStorage&&(vh=localStorage,Kv=!1)}catch(n){}var xh=vh;var Sh=Object.assign,Jv=Object.keys,kh=(n,e)=>{for(let t in n)e(n[t],t)};var $o=n=>Jv(n).length;var Ch=n=>{for(let e in n)return!1;return!0},qv=(n,e)=>{for(let t in n)if(!e(n[t],t))return!1;return!0},hc=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),pc=(n,e)=>n===e||$o(n)===$o(e)&&qv(n,(t,r)=>(t!==void 0||hc(e,r))&&e[r]===t);var Uo=(n,e,t=0)=>{try{for(;t<n.length;t++)n[t](...e)}finally{t<n.length&&Uo(n,e,t+1)}};var Th=n=>n,jv=(n,e)=>n===e;var As=(n,e)=>{if(n==null||e==null)return jv(n,e);if(n.constructor!==e.constructor)return!1;if(n===e)return!0;switch(n.constructor){case ArrayBuffer:n=new Uint8Array(n),e=new Uint8Array(e);case Uint8Array:{if(n.byteLength!==e.byteLength)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;break}case Set:{if(n.size!==e.size)return!1;for(let t of n)if(!e.has(t))return!1;break}case Map:{if(n.size!==e.size)return!1;for(let t of n.keys())if(!e.has(t)||!As(n.get(t),e.get(t)))return!1;break}case Object:if($o(n)!==$o(e))return!1;for(let t in n)if(!hc(n,t)||!As(n[t],e[t]))return!1;break;case Array:if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!As(n[t],e[t]))return!1;break;default:return!1}return!0},Ah=(n,e)=>e.includes(n);var No=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]";var yT=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,Sr,Gv=[],zv=()=>{if(Sr===void 0)if(No){Sr=at();let n=process.argv,e=null;for(let t=0;t<n.length;t++){let r=n[t];r[0]==="-"?(e!==null&&Sr.set(e,""),e=r):e!==null?(Sr.set(e,r),e=null):Gv.push(r)}e!==null&&Sr.set(e,"")}else typeof location=="object"?(Sr=at(),(location.search||"?").slice(1).split("&").forEach(n=>{if(n.length!==0){let[e,t]=n.split("=");Sr.set(`--${nc(e,"-")}`,t),Sr.set(`-${nc(e,"-")}`,t)}})):Sr=at();return Sr},gc=n=>zv().has(n);var yc=n=>No?fc(process.env[n.toUpperCase().replaceAll("-","_")]):fc(xh.getItem(n));var Xv=n=>gc("--"+n)||yc(n)!==null,wT=Xv("production"),Dh=No&&Ah(process.env.FORCE_COLOR,["true","1","2"]),Mh=!gc("no-colors")&&(!No||process.stdout.isTTY||Dh)&&(!No||gc("color")||Dh||yc("COLORTERM")!==null||(yc("TERM")||"").includes("color"));var Qv=n=>new Uint8Array(n);var Rh=n=>{let e=Qv(n.byteLength);return e.set(n),e};var wc=class{constructor(e,t){this.left=e,this.right=t}},St=(n,e)=>new wc(n,e);var Fh=(n,e)=>n.forEach(t=>e(t.left,t.right));var kr=typeof document!="undefined"?document:{},tx=n=>kr.createElement(n),rx=()=>kr.createDocumentFragment(),nx=n=>kr.createTextNode(n),_T=typeof DOMParser!="undefined"?new DOMParser:null;var sx=(n,e)=>(Fh(e,(t,r)=>{r===!1?n.removeAttribute(t):r===!0?n.setAttribute(t,""):n.setAttribute(t,r)}),n);var ox=n=>{let e=rx();for(let t=0;t<n.length;t++)Ih(e,n[t]);return e},Ph=(n,e)=>(Ih(n,ox(e)),n);var Bo=(n,e=[],t=[])=>Ph(sx(tx(n),e),t);var Ds=nx;var Oh=n=>oh(n,(e,t)=>`${t}:${e};`).join("");var Ih=(n,e)=>n.appendChild(e),bT=kr.ELEMENT_NODE,vT=kr.TEXT_NODE,xT=kr.CDATA_SECTION_NODE,ST=kr.COMMENT_NODE,kT=kr.DOCUMENT_NODE,CT=kr.DOCUMENT_TYPE_NODE,ET=kr.DOCUMENT_FRAGMENT_NODE;var Cr=Symbol;var Ho=Cr(),Vo=Cr(),bc=Cr(),vc=Cr(),xc=Cr(),Wo=Cr(),Sc=Cr(),Ko=Cr(),kc=Cr(),$h=n=>{var s;n.length===1&&((s=n[0])==null?void 0:s.constructor)===Function&&(n=n[0]());let e=[],t=[],r=0;for(;r<n.length;r++){let o=n[r];o===void 0?e.push("undefined"):o.constructor===String||o.constructor===Number?e.push(o):o.constructor===Object&&t.push(JSON.stringify(o))}return t};var TT=Hn();var lx={[Ho]:St("font-weight","bold"),[Vo]:St("font-weight","normal"),[bc]:St("color","blue"),[xc]:St("color","green"),[vc]:St("color","grey"),[Wo]:St("color","red"),[Sc]:St("color","purple"),[Ko]:St("color","orange"),[kc]:St("color","black")},cx=n=>{var i;n.length===1&&((i=n[0])==null?void 0:i.constructor)===Function&&(n=n[0]());let e=[],t=[],r=at(),s=[],o=0;for(;o<n.length;o++){let l=n[o],c=lx[l];if(c!==void 0)r.set(c.left,c.right);else{if(l===void 0)break;if(l.constructor===String||l.constructor===Number){let f=Oh(r);o>0||f.length>0?(e.push("%c"+l),t.push(f)):e.push(l)}else break}}for(o>0&&(s=t,s.unshift(e.join("")));o<n.length;o++){let l=n[o];l instanceof Symbol||s.push(l)}return s},ux=Mh?cx:$h,Uh=(...n)=>{console.log(...ux(n)),fx.forEach(e=>e.print(n))};var fx=xr();var Nh=n=>({[Symbol.iterator](){return this},next:n}),Bh=(n,e)=>Nh(()=>{let t;do t=n.next();while(!t.done&&!e(t.value));return t}),ta=(n,e)=>Nh(()=>{let{done:t,value:r}=n.next();return{done:t,value:t?void 0:e(r)}});var Jo=class{constructor(e,t){this.clock=e,this.len=t}},Vn=class{constructor(){this.clients=new Map}},tp=(n,e,t)=>e.clients.forEach((r,s)=>{let o=n.doc.store.clients.get(s);for(let i=0;i<r.length;i++){let l=r[i];dp(n,o,l.clock,l.len,t)}}),gx=(n,e)=>{let t=0,r=n.length-1;for(;t<=r;){let s=Rt((t+r)/2),o=n[s],i=o.clock;if(i<=e){if(e<i+o.len)return s;t=s+1}else r=s-1}return null},rp=(n,e)=>{let t=n.clients.get(e.client);return t!==void 0&&gx(t,e.clock)!==null},Nc=n=>{n.clients.forEach(e=>{e.sort((s,o)=>s.clock-o.clock);let t,r;for(t=1,r=1;t<e.length;t++){let s=e[r-1],o=e[t];s.clock+s.len>=o.clock?s.len=ar(s.len,o.clock+o.len-s.clock):(r<t&&(e[r]=o),r++)}e.length=r})},yx=n=>{let e=new Vn;for(let t=0;t<n.length;t++)n[t].clients.forEach((r,s)=>{if(!e.clients.has(s)){let o=r.slice();for(let i=t+1;i<n.length;i++)ah(o,n[i].clients.get(s)||[]);e.clients.set(s,o)}});return Nc(e),e},la=(n,e,t,r)=>{or(n.clients,e,()=>[]).push(new Jo(t,r))},np=()=>new Vn,wx=n=>{let e=np();return n.clients.forEach((t,r)=>{let s=[];for(let o=0;o<t.length;o++){let i=t[o];if(i.deleted){let l=i.id.clock,c=i.length;if(o+1<t.length)for(let f=t[o+1];o+1<t.length&&f.deleted;f=t[++o+1])c+=f.length;s.push(new Jo(l,c))}}s.length>0&&e.clients.set(r,s)}),e},Ls=(n,e)=>{fe(n.restEncoder,e.clients.size),ir(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{n.resetDsCurVal(),fe(n.restEncoder,t);let s=r.length;fe(n.restEncoder,s);for(let o=0;o<s;o++){let i=r[o];n.writeDsClock(i.clock),n.writeDsLen(i.len)}})},Bc=n=>{let e=new Vn,t=ce(n.restDecoder);for(let r=0;r<t;r++){n.resetDsCurVal();let s=ce(n.restDecoder),o=ce(n.restDecoder);if(o>0){let i=or(e.clients,s,()=>[]);for(let l=0;l<o;l++)i.push(new Jo(n.readDsClock(),n.readDsLen()))}}return e},Wh=(n,e,t)=>{let r=new Vn,s=ce(n.restDecoder);for(let o=0;o<s;o++){n.resetDsCurVal();let i=ce(n.restDecoder),l=ce(n.restDecoder),c=t.clients.get(i)||[],f=Qe(t,i);for(let d=0;d<l;d++){let p=n.readDsClock(),g=p+n.readDsLen();if(p<f){f<g&&la(r,i,f,g-f);let _=Tr(c,p),y=c[_];for(!y.deleted&&y.id.clock<p&&(c.splice(_+1,0,wa(e,y,p-y.id.clock)),_++);_<c.length&&(y=c[_++],y.id.clock<g);)y.deleted||(g<y.id.clock+y.length&&c.splice(_,0,wa(e,y,g-y.id.clock)),y.delete(e))}else la(r,i,p,g-p)}}if(r.clients.size>0){let o=new qr;return fe(o.restEncoder,0),Ls(o,r),o.toUint8Array()}return null};var sp=Lo,Er=class extends Ji{constructor({guid:e=ea(),collectionid:t=null,gc:r=!0,gcFilter:s=()=>!0,meta:o=null,autoLoad:i=!1,shouldLoad:l=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=sp(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new pa,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=l,this.autoLoad=i,this.meta=o,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=Jr(f=>{this.on("load",()=>{this.isLoaded=!0,f(this)})});let c=()=>Jr(f=>{let d=p=>{(p===void 0||p===!0)&&(this.off("sync",d),f())};this.on("sync",d)});this.on("sync",f=>{f===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=f===void 0||f===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){let e=this._item;e!==null&&!this.shouldLoad&&Re(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(ir(this.subdocs).map(e=>e.guid))}transact(e,t=null){return Re(this,e,t)}get(e,t=ot){let r=or(this.share,e,()=>{let o=new t;return o._integrate(this,null),o}),s=r.constructor;if(t!==ot&&s!==t)if(s===ot){let o=new t;o._map=r._map,r._map.forEach(i=>{for(;i!==null;i=i.left)i.parent=o}),o._start=r._start;for(let i=o._start;i!==null;i=i.right)i.parent=o;return o._length=r._length,this.share.set(e,o),o._integrate(this,null),o}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,yn)}getText(e=""){return this.get(e,vn)}getMap(e=""){return this.get(e,bn)}getXmlElement(e=""){return this.get(e,xn)}getXmlFragment(e=""){return this.get(e,jr)}toJSON(){let e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){ir(this.subdocs).forEach(t=>t.destroy());let e=this._item;if(e!==null){this._item=null;let t=e.content;t.doc=new Er({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,Re(e.parent.doc,r=>{let s=t.doc;e.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}},ca=class{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return ce(this.restDecoder)}readDsLen(){return ce(this.restDecoder)}},ua=class extends ca{readLeftID(){return me(ce(this.restDecoder),ce(this.restDecoder))}readRightID(){return me(ce(this.restDecoder),ce(this.restDecoder))}readClient(){return ce(this.restDecoder)}readInfo(){return Nn(this.restDecoder)}readString(){return cr(this.restDecoder)}readParentInfo(){return ce(this.restDecoder)===1}readTypeRef(){return ce(this.restDecoder)}readLen(){return ce(this.restDecoder)}readAny(){return Es(this.restDecoder)}readBuf(){return Rh(ht(this.restDecoder))}readJSON(){return JSON.parse(cr(this.restDecoder))}readKey(){return cr(this.restDecoder)}},Ec=class{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=ce(this.restDecoder),this.dsCurrVal}readDsLen(){let e=ce(this.restDecoder)+1;return this.dsCurrVal+=e,e}},wn=class extends Ec{constructor(e){super(e),this.keys=[],ce(e),this.keyClockDecoder=new Ts(ht(e)),this.clientDecoder=new Bn(ht(e)),this.leftClockDecoder=new Ts(ht(e)),this.rightClockDecoder=new Ts(ht(e)),this.infoDecoder=new Io(ht(e),Nn),this.stringDecoder=new Xi(ht(e)),this.parentInfoDecoder=new Io(ht(e),Nn),this.typeRefDecoder=new Bn(ht(e)),this.lenDecoder=new Bn(ht(e))}readLeftID(){return new gn(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new gn(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Es(this.restDecoder)}readBuf(){return ht(this.restDecoder)}readJSON(){return Es(this.restDecoder)}readKey(){let e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{let t=this.stringDecoder.read();return this.keys.push(t),t}}},fa=class{constructor(){this.restEncoder=Un()}toUint8Array(){return $t(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){fe(this.restEncoder,e)}writeDsLen(e){fe(this.restEncoder,e)}},Wn=class extends fa{writeLeftID(e){fe(this.restEncoder,e.client),fe(this.restEncoder,e.clock)}writeRightID(e){fe(this.restEncoder,e.client),fe(this.restEncoder,e.clock)}writeClient(e){fe(this.restEncoder,e)}writeInfo(e){Gi(this.restEncoder,e)}writeString(e){Kr(this.restEncoder,e)}writeParentInfo(e){fe(this.restEncoder,e?1:0)}writeTypeRef(e){fe(this.restEncoder,e)}writeLen(e){fe(this.restEncoder,e)}writeAny(e){Ss(this.restEncoder,e)}writeBuf(e){ct(this.restEncoder,e)}writeJSON(e){Kr(this.restEncoder,JSON.stringify(e))}writeKey(e){Kr(this.restEncoder,e)}},da=class{constructor(){this.restEncoder=Un(),this.dsCurrVal=0}toUint8Array(){return $t(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){let t=e-this.dsCurrVal;this.dsCurrVal=e,fe(this.restEncoder,t)}writeDsLen(e){e===0&&Jt(),fe(this.restEncoder,e-1),this.dsCurrVal+=e}},qr=class extends da{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new ks,this.clientEncoder=new $n,this.leftClockEncoder=new ks,this.rightClockEncoder=new ks,this.infoEncoder=new Po(Gi),this.stringEncoder=new ji,this.parentInfoEncoder=new Po(Gi),this.typeRefEncoder=new $n,this.lenEncoder=new $n}toUint8Array(){let e=Un();return fe(e,0),ct(e,this.keyClockEncoder.toUint8Array()),ct(e,this.clientEncoder.toUint8Array()),ct(e,this.leftClockEncoder.toUint8Array()),ct(e,this.rightClockEncoder.toUint8Array()),ct(e,$t(this.infoEncoder)),ct(e,this.stringEncoder.toUint8Array()),ct(e,$t(this.parentInfoEncoder)),ct(e,this.typeRefEncoder.toUint8Array()),ct(e,this.lenEncoder.toUint8Array()),Oo(e,$t(this.restEncoder)),$t(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){Ss(this.restEncoder,e)}writeBuf(e){ct(this.restEncoder,e)}writeJSON(e){Ss(this.restEncoder,e)}writeKey(e){let t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}},_x=(n,e,t,r)=>{r=ar(r,e[0].id.clock);let s=Tr(e,r);fe(n.restEncoder,e.length-s),n.writeClient(t),fe(n.restEncoder,r);let o=e[s];o.write(n,r-o.id.clock);for(let i=s+1;i<e.length;i++)e[i].write(n,0)},Hc=(n,e,t)=>{let r=new Map;t.forEach((s,o)=>{Qe(e,o)>s&&r.set(o,s)}),_a(e).forEach((s,o)=>{t.has(o)||r.set(o,0)}),fe(n.restEncoder,r.size),ir(r.entries()).sort((s,o)=>o[0]-s[0]).forEach(([s,o])=>{_x(n,e.clients.get(s),s,o)})},bx=(n,e)=>{let t=at(),r=ce(n.restDecoder);for(let s=0;s<r;s++){let o=ce(n.restDecoder),i=new Array(o),l=n.readClient(),c=ce(n.restDecoder);t.set(l,{i:0,refs:i});for(let f=0;f<o;f++){let d=n.readInfo();switch(31&d){case 0:{let p=n.readLen();i[f]=new Ft(me(l,c),p),c+=p;break}case 10:{let p=ce(n.restDecoder);i[f]=new Pt(me(l,c),p),c+=p;break}default:{let p=(d&192)===0,g=new Be(me(l,c),null,(d&128)===128?n.readLeftID():null,null,(d&64)===64?n.readRightID():null,p?n.readParentInfo()?e.get(n.readString()):n.readLeftID():null,p&&(d&32)===32?n.readString():null,Rp(n,d));i[f]=g,c+=g.length}}}}return t},vx=(n,e,t)=>{let r=[],s=ir(t.keys()).sort((_,y)=>_-y);if(s.length===0)return null;let o=()=>{if(s.length===0)return null;let _=t.get(s[s.length-1]);for(;_.refs.length===_.i;)if(s.pop(),s.length>0)_=t.get(s[s.length-1]);else return null;return _},i=o();if(i===null)return null;let l=new pa,c=new Map,f=(_,y)=>{let b=c.get(_);(b==null||b>y)&&c.set(_,y)},d=i.refs[i.i++],p=new Map,g=()=>{for(let _ of r){let y=_.id.client,b=t.get(y);b?(b.i--,l.clients.set(y,b.refs.slice(b.i)),t.delete(y),b.i=0,b.refs=[]):l.clients.set(y,[_]),s=s.filter(C=>C!==y)}r.length=0};for(;;){if(d.constructor!==Pt){let y=or(p,d.id.client,()=>Qe(e,d.id.client))-d.id.clock;if(y<0)r.push(d),f(d.id.client,d.id.clock-1),g();else{let b=d.getMissing(n,e);if(b!==null){r.push(d);let C=t.get(b)||{refs:[],i:0};if(C.refs.length===C.i)f(b,Qe(e,b)),g();else{d=C.refs[C.i++];continue}}else(y===0||y<d.length)&&(d.integrate(n,y),p.set(d.id.client,d.id.clock+d.length))}}if(r.length>0)d=r.pop();else if(i!==null&&i.i<i.refs.length)d=i.refs[i.i++];else{if(i=o(),i===null)break;d=i.refs[i.i++]}}if(l.clients.size>0){let _=new qr;return Hc(_,l,new Map),fe(_.restEncoder,0),{missing:c,update:_.toUint8Array()}}return null},xx=(n,e)=>Hc(n,e.doc.store,e.beforeState),Sx=(n,e,t,r=new wn(n))=>Re(e,s=>{s.local=!1;let o=!1,i=s.doc,l=i.store,c=bx(r,i),f=vx(s,l,c),d=l.pendingStructs;if(d){for(let[g,_]of d.missing)if(_<Qe(l,g)){o=!0;break}if(f){for(let[g,_]of f.missing){let y=d.missing.get(g);(y==null||y>_)&&d.missing.set(g,_)}d.update=ma([d.update,f.update])}}else l.pendingStructs=f;let p=Wh(r,s,l);if(l.pendingDs){let g=new wn(Yr(l.pendingDs));ce(g.restDecoder);let _=Wh(g,s,l);p&&_?l.pendingDs=ma([p,_]):l.pendingDs=p||_}else l.pendingDs=p;if(o){let g=l.pendingStructs.update;l.pendingStructs=null,op(s.doc,g)}},t,!1);var op=(n,e,t,r=wn)=>{let s=Yr(e);Sx(s,n,t,new r(s))},qn=(n,e,t)=>op(n,e,t,ua),kx=(n,e,t=new Map)=>{Hc(n,e.store,t),Ls(n,wx(e.store))},Cx=(n,e=new Uint8Array([0]),t=new qr)=>{let r=ip(e);kx(t,n,r);let s=[t.toUint8Array()];if(n.store.pendingDs&&s.push(n.store.pendingDs),n.store.pendingStructs&&s.push(Ux(n.store.pendingStructs.update,e)),s.length>1){if(t.constructor===Wn)return Lx(s.map((o,i)=>i===0?o:Bx(o)));if(t.constructor===qr)return ma(s)}return s[0]},jn=(n,e)=>Cx(n,e,new Wn),Ex=n=>{let e=new Map,t=ce(n.restDecoder);for(let r=0;r<t;r++){let s=ce(n.restDecoder),o=ce(n.restDecoder);e.set(s,o)}return e},ip=n=>Ex(new ca(Yr(n))),ap=(n,e)=>(fe(n.restEncoder,e.size),ir(e.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{fe(n.restEncoder,t),fe(n.restEncoder,r)}),n),Tx=(n,e)=>ap(n,_a(e.store)),Ax=(n,e=new da)=>(n instanceof Map?ap(e,n):Tx(e,n),e.toUint8Array()),lp=n=>Ax(n,new fa),Tc=class{constructor(){this.l=[]}},Kh=()=>new Tc,Yh=(n,e)=>n.l.push(e),Jh=(n,e)=>{let t=n.l,r=t.length;n.l=t.filter(s=>e!==s),r===n.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},cp=(n,e,t)=>Uo(n.l,[e,t]),gn=class{constructor(e,t){this.client=e,this.clock=t}},Rs=(n,e)=>n===e||n!==null&&e!==null&&n.client===e.client&&n.clock===e.clock,me=(n,e)=>new gn(n,e);var up=n=>{for(let[e,t]of n.doc.share.entries())if(t===n)return e;throw Jt()};var ha=class{constructor(e,t,r,s=0){this.type=e,this.tname=t,this.item=r,this.assoc=s}};var Vc=n=>new ha(n.type==null?null:me(n.type.client,n.type.clock),n.tname||null,n.item==null?null:me(n.item.client,n.item.clock),n.assoc==null?0:n.assoc),Ac=class{constructor(e,t,r=0){this.type=e,this.index=t,this.assoc=r}},Dx=(n,e,t=0)=>new Ac(n,e,t),ra=(n,e,t)=>{let r=null,s=null;return n._item===null?s=up(n):r=me(n._item.id.client,n._item.id.clock),new ha(r,s,e,t)},Wc=(n,e,t=0)=>{let r=n._start;if(t<0){if(e===0)return ra(n,null,t);e--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>e)return ra(n,me(r.id.client,r.id.clock+e),t);e-=r.length}if(r.right===null&&t<0)return ra(n,r.lastId,t);r=r.right}return ra(n,null,t)};var Kc=(n,e)=>{let t=e.store,r=n.item,s=n.type,o=n.tname,i=n.assoc,l=null,c=0;if(r!==null){if(Qe(t,r.client)<=r.clock)return null;let f=ep(t,r),d=f.item;if(!(d instanceof Be))return null;if(l=d.parent,l._item===null||!l._item.deleted){c=d.deleted||!d.countable?0:f.diff+(i>=0?0:1);let p=d.left;for(;p!==null;)!p.deleted&&p.countable&&(c+=p.length),p=p.left}}else{if(o!==null)l=e.get(o);else if(s!==null){if(Qe(t,s.client)<=s.clock)return null;let{item:f}=ep(t,s);if(f instanceof Be&&f.content instanceof jt)l=f.content.type;else return null}else throw Jt();i>=0?c=l._length:c=0}return Dx(l,c,n.assoc)},Yc=(n,e)=>n===e||n!==null&&e!==null&&n.tname===e.tname&&Rs(n.item,e.item)&&Rs(n.type,e.type)&&n.assoc===e.assoc,Dc=class{constructor(e,t){this.ds=e,this.sv=t}};var Mx=(n,e)=>new Dc(n,e),$T=Mx(np(),new Map);var Ms=(n,e)=>e===void 0?!n.deleted:e.sv.has(n.id.client)&&(e.sv.get(n.id.client)||0)>n.id.clock&&!rp(e.ds,n.id),Mc=(n,e)=>{let t=or(n.meta,Mc,xr),r=n.doc.store;t.has(e)||(e.sv.forEach((s,o)=>{s<Qe(r,o)&&_n(n,me(o,s))}),tp(n,e.ds,s=>{}),t.add(e))};var pa=class{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}},_a=n=>{let e=new Map;return n.clients.forEach((t,r)=>{let s=t[t.length-1];e.set(r,s.id.clock+s.length)}),e},Qe=(n,e)=>{let t=n.clients.get(e);if(t===void 0)return 0;let r=t[t.length-1];return r.id.clock+r.length},fp=(n,e)=>{let t=n.clients.get(e.id.client);if(t===void 0)t=[],n.clients.set(e.id.client,t);else{let r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw Jt()}t.push(e)},Tr=(n,e)=>{let t=0,r=n.length-1,s=n[r],o=s.id.clock;if(o===e)return r;let i=Rt(e/(o+s.length-1)*r);for(;t<=r;){if(s=n[i],o=s.id.clock,o<=e){if(e<o+s.length)return i;t=i+1}else r=i-1;i=Rt((t+r)/2)}throw Jt()},Rx=(n,e)=>{let t=n.clients.get(e.client);return t[Tr(t,e.clock)]},oa=Rx,Rc=(n,e,t)=>{let r=Tr(e,t),s=e[r];return s.id.clock<t&&s instanceof Be?(e.splice(r+1,0,wa(n,s,t-s.id.clock)),r+1):r},_n=(n,e)=>{let t=n.doc.store.clients.get(e.client);return t[Rc(n,t,e.clock)]},qh=(n,e,t)=>{let r=e.clients.get(t.client),s=Tr(r,t.clock),o=r[s];return t.clock!==o.id.clock+o.length-1&&o.constructor!==Ft&&r.splice(s+1,0,wa(n,o,t.clock-o.id.clock+1)),o},Fx=(n,e,t)=>{let r=n.clients.get(e.id.client);r[Tr(r,e.id.clock)]=t},dp=(n,e,t,r,s)=>{if(r===0)return;let o=t+r,i=Rc(n,e,t),l;do l=e[i++],o<l.id.clock+l.length&&Rc(n,e,o),s(l);while(i<e.length&&e[i].id.clock<o)},Fc=class{constructor(e,t,r){this.doc=e,this.deleteSet=new Vn,this.beforeState=_a(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}},jh=(n,e)=>e.deleteSet.clients.size===0&&!ih(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:(Nc(e.deleteSet),xx(n,e),Ls(n,e.deleteSet),!0),Gh=(n,e,t)=>{let r=e._item;(r===null||r.id.clock<(n.beforeState.get(r.id.client)||0)&&!r.deleted)&&or(n.changed,e,xr).add(t)},ia=(n,e)=>{let t=n[e],r=n[e-1],s=e;for(;s>0;t=r,r=n[--s-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof Be&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}let o=e-s;return o&&n.splice(e+1-o,o),o},Px=(n,e,t)=>{for(let[r,s]of n.clients.entries()){let o=e.clients.get(r);for(let i=s.length-1;i>=0;i--){let l=s[i],c=l.clock+l.len;for(let f=Tr(o,l.clock),d=o[f];f<o.length&&d.id.clock<c;d=o[++f]){let p=o[f];if(l.clock+l.len<=p.id.clock)break;p instanceof Be&&p.deleted&&!p.keep&&t(p)&&p.gc(e,!1)}}}},Ox=(n,e)=>{n.clients.forEach((t,r)=>{let s=e.clients.get(r);for(let o=t.length-1;o>=0;o--){let i=t[o],l=ws(s.length-1,1+Tr(s,i.clock+i.len-1));for(let c=l,f=s[c];c>0&&f.id.clock>=i.clock;f=s[c])c-=1+ia(s,c)}})};var hp=(n,e)=>{if(e<n.length){let t=n[e],r=t.doc,s=r.store,o=t.deleteSet,i=t._mergeStructs;try{Nc(o),t.afterState=_a(t.doc.store),r.emit("beforeObserverCalls",[t,r]);let l=[];t.changed.forEach((c,f)=>l.push(()=>{(f._item===null||!f._item.deleted)&&f._callObserver(t,c)})),l.push(()=>{t.changedParentTypes.forEach((c,f)=>{f._dEH.l.length>0&&(f._item===null||!f._item.deleted)&&(c=c.filter(d=>d.target._item===null||!d.target._item.deleted),c.forEach(d=>{d.currentTarget=f,d._path=null}),c.sort((d,p)=>d.path.length-p.path.length),cp(f._dEH,c,t))})}),l.push(()=>r.emit("afterTransaction",[t,r])),Uo(l,[]),t._needFormattingCleanup&&Xx(t)}finally{r.gc&&Px(o,s,r.gcFilter),Ox(o,s),t.afterState.forEach((d,p)=>{let g=t.beforeState.get(p)||0;if(g!==d){let _=s.clients.get(p),y=ar(Tr(_,g),1);for(let b=_.length-1;b>=y;)b-=1+ia(_,b)}});for(let d=i.length-1;d>=0;d--){let{client:p,clock:g}=i[d].id,_=s.clients.get(p),y=Tr(_,g);y+1<_.length&&ia(_,y+1)>1||y>0&&ia(_,y)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&(Uh(Ko,Ho,"[yjs] ",Vo,Wo,"Changed the client-id because another client seems to be using it."),r.clientID=sp()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){let d=new Wn;jh(d,t)&&r.emit("update",[d.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){let d=new qr;jh(d,t)&&r.emit("updateV2",[d.toUint8Array(),t.origin,r,t])}let{subdocsAdded:l,subdocsLoaded:c,subdocsRemoved:f}=t;(l.size>0||f.size>0||c.size>0)&&(l.forEach(d=>{d.clientID=r.clientID,d.collectionid==null&&(d.collectionid=r.collectionid),r.subdocs.add(d)}),f.forEach(d=>r.subdocs.delete(d)),r.emit("subdocs",[{loaded:c,added:l,removed:f},r,t]),f.forEach(d=>d.destroy())),n.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,n])):hp(n,e+1)}}},Re=(n,e,t=null,r=!0)=>{let s=n._transactionCleanups,o=!1,i=null;n._transaction===null&&(o=!0,n._transaction=new Fc(n,t,r),s.push(n._transaction),s.length===1&&n.emit("beforeAllTransactions",[n]),n.emit("beforeTransaction",[n._transaction,n]));try{i=e(n._transaction)}finally{if(o){let l=n._transaction===s[0];n._transaction=null,l&&hp(s,0)}}return i};function*Ix(n){let e=ce(n.restDecoder);for(let t=0;t<e;t++){let r=ce(n.restDecoder),s=n.readClient(),o=ce(n.restDecoder);for(let i=0;i<r;i++){let l=n.readInfo();if(l===10){let c=ce(n.restDecoder);yield new Pt(me(s,o),c),o+=c}else if(31&l){let c=(l&192)===0,f=new Be(me(s,o),null,(l&128)===128?n.readLeftID():null,null,(l&64)===64?n.readRightID():null,c?n.readParentInfo()?n.readString():n.readLeftID():null,c&&(l&32)===32?n.readString():null,Rp(n,l));yield f,o+=f.length}else{let c=n.readLen();yield new Ft(me(s,o),c),o+=c}}}}var qo=class{constructor(e,t){this.gen=Ix(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Pt);return this.curr}};var jo=class{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}},Lx=n=>ma(n,ua,Wn);var $x=(n,e)=>{if(n.constructor===Ft){let{client:t,clock:r}=n.id;return new Ft(me(t,r+e),n.length-e)}else if(n.constructor===Pt){let{client:t,clock:r}=n.id;return new Pt(me(t,r+e),n.length-e)}else{let t=n,{client:r,clock:s}=t.id;return new Be(me(r,s+e),null,me(r,s+e-1),null,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e))}},ma=(n,e=wn,t=qr)=>{if(n.length===1)return n[0];let r=n.map(d=>new e(Yr(d))),s=r.map(d=>new qo(d,!0)),o=null,i=new t,l=new jo(i);for(;s=s.filter(g=>g.curr!==null),s.sort((g,_)=>{if(g.curr.id.client===_.curr.id.client){let y=g.curr.id.clock-_.curr.id.clock;return y===0?g.curr.constructor===_.curr.constructor?0:g.curr.constructor===Pt?1:-1:y}else return _.curr.id.client-g.curr.id.client}),s.length!==0;){let d=s[0],p=d.curr.id.client;if(o!==null){let g=d.curr,_=!1;for(;g!==null&&g.id.clock+g.length<=o.struct.id.clock+o.struct.length&&g.id.client>=o.struct.id.client;)g=d.next(),_=!0;if(g===null||g.id.client!==p||_&&g.id.clock>o.struct.id.clock+o.struct.length)continue;if(p!==o.struct.id.client)pn(l,o.struct,o.offset),o={struct:g,offset:0},d.next();else if(o.struct.id.clock+o.struct.length<g.id.clock)if(o.struct.constructor===Pt)o.struct.length=g.id.clock+g.length-o.struct.id.clock;else{pn(l,o.struct,o.offset);let y=g.id.clock-o.struct.id.clock-o.struct.length;o={struct:new Pt(me(p,o.struct.id.clock+o.struct.length),y),offset:0}}else{let y=o.struct.id.clock+o.struct.length-g.id.clock;y>0&&(o.struct.constructor===Pt?o.struct.length-=y:g=$x(g,y)),o.struct.mergeWith(g)||(pn(l,o.struct,o.offset),o={struct:g,offset:0},d.next())}}else o={struct:d.curr,offset:0},d.next();for(let g=d.curr;g!==null&&g.id.client===p&&g.id.clock===o.struct.id.clock+o.struct.length&&g.constructor!==Pt;g=d.next())pn(l,o.struct,o.offset),o={struct:g,offset:0}}o!==null&&(pn(l,o.struct,o.offset),o=null),Jc(l);let c=r.map(d=>Bc(d)),f=yx(c);return Ls(i,f),i.toUint8Array()},Ux=(n,e,t=wn,r=qr)=>{let s=ip(e),o=new r,i=new jo(o),l=new t(Yr(n)),c=new qo(l,!1);for(;c.curr;){let d=c.curr,p=d.id.client,g=s.get(p)||0;if(c.curr.constructor===Pt){c.next();continue}if(d.id.clock+d.length>g)for(pn(i,d,ar(g-d.id.clock,0)),c.next();c.curr&&c.curr.id.client===p;)pn(i,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===p&&c.curr.id.clock+c.curr.length<=g;)c.next()}Jc(i);let f=Bc(l);return Ls(o,f),o.toUint8Array()};var pp=n=>{n.written>0&&(n.clientStructs.push({written:n.written,restEncoder:$t(n.encoder.restEncoder)}),n.encoder.restEncoder=Un(),n.written=0)},pn=(n,e,t)=>{n.written>0&&n.currClient!==e.id.client&&pp(n),n.written===0&&(n.currClient=e.id.client,n.encoder.writeClient(e.id.client),fe(n.encoder.restEncoder,e.id.clock+t)),e.write(n.encoder,t),n.written++},Jc=n=>{pp(n);let e=n.encoder.restEncoder;fe(e,n.clientStructs.length);for(let t=0;t<n.clientStructs.length;t++){let r=n.clientStructs[t];fe(e,r.written),Oo(e,r.restEncoder)}},Nx=(n,e,t,r)=>{let s=new t(Yr(n)),o=new qo(s,!1),i=new r,l=new jo(i);for(let f=o.curr;f!==null;f=o.next())pn(l,e(f),0);Jc(l);let c=Bc(s);return Ls(i,c),i.toUint8Array()};var Bx=n=>Nx(n,Th,wn,Wn),zh="You must not compute changes after the event-handler fired.",Fs=class{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Hx(this.currentTarget,this.target))}deletes(e){return rp(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Yt(zh);let e=new Map,t=this.target;this.transaction.changed.get(t).forEach(s=>{if(s!==null){let o=t._map.get(s),i,l;if(this.adds(o)){let c=o.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(o))if(c!==null&&this.deletes(c))i="delete",l=Yi(c.content.getContent());else return;else c!==null&&this.deletes(c)?(i="update",l=Yi(c.content.getContent())):(i="add",l=void 0)}else if(this.deletes(o))i="delete",l=Yi(o.content.getContent());else return;e.set(s,{action:i,oldValue:l})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Yt(zh);let t=this.target,r=xr(),s=xr(),o=[];if(e={added:r,deleted:s,delta:o,keys:this.keys},this.transaction.changed.get(t).has(null)){let l=null,c=()=>{l&&o.push(l)};for(let f=t._start;f!==null;f=f.right)f.deleted?this.deletes(f)&&!this.adds(f)&&((l===null||l.delete===void 0)&&(c(),l={delete:0}),l.delete+=f.length,s.add(f)):this.adds(f)?((l===null||l.insert===void 0)&&(c(),l={insert:[]}),l.insert=l.insert.concat(f.content.getContent()),r.add(f)):((l===null||l.retain===void 0)&&(c(),l={retain:0}),l.retain+=f.length);l!==null&&l.retain===void 0&&c()}this._changes=e}return e}},Hx=(n,e)=>{let t=[];for(;e._item!==null&&e!==n;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,s=e._item.parent._start;for(;s!==e._item&&s!==null;)s.deleted||r++,s=s.right;t.unshift(r)}e=e._item.parent}return t},mp=80,qc=0,Pc=class{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=qc++}},Vx=n=>{n.timestamp=qc++},gp=(n,e,t)=>{n.p.marker=!1,n.p=e,e.marker=!0,n.index=t,n.timestamp=qc++},Wx=(n,e,t)=>{if(n.length>=mp){let r=n.reduce((s,o)=>s.timestamp<o.timestamp?s:o);return gp(r,e,t),r}else{let r=new Pc(e,t);return n.push(r),r}},ba=(n,e)=>{if(n._start===null||e===0||n._searchMarker===null)return null;let t=n._searchMarker.length===0?null:n._searchMarker.reduce((o,i)=>ys(e-o.index)<ys(e-i.index)?o:i),r=n._start,s=0;for(t!==null&&(r=t.p,s=t.index,Vx(t));r.right!==null&&s<e;){if(!r.deleted&&r.countable){if(e<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>e;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return t!==null&&ys(t.index-s)<r.parent.length/mp?(gp(t,r,s),t):Wx(n._searchMarker,r,s)},Go=(n,e,t)=>{for(let r=n.length-1;r>=0;r--){let s=n[r];if(t>0){let o=s.p;for(o.marker=!1;o&&(o.deleted||!o.countable);)o=o.left,o&&!o.deleted&&o.countable&&(s.index-=o.length);if(o===null||o.marker===!0){n.splice(r,1);continue}s.p=o,o.marker=!0}(e<s.index||t>0&&e===s.index)&&(s.index=ar(e,s.index+t))}};var va=(n,e,t)=>{let r=n,s=e.changedParentTypes;for(;or(s,n,()=>[]).push(t),n._item!==null;)n=n._item.parent;cp(r._eH,t,e)},ot=class{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Kh(),this._dEH=Kh(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw lr()}clone(){throw lr()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Yh(this._eH,e)}observeDeep(e){Yh(this._dEH,e)}unobserve(e){Jh(this._eH,e)}unobserveDeep(e){Jh(this._dEH,e)}toJSON(){}},yp=(n,e,t)=>{e<0&&(e=n._length+e),t<0&&(t=n._length+t);let r=t-e,s=[],o=n._start;for(;o!==null&&r>0;){if(o.countable&&!o.deleted){let i=o.content.getContent();if(i.length<=e)e-=i.length;else{for(let l=e;l<i.length&&r>0;l++)s.push(i[l]),r--;e=0}}o=o.right}return s},wp=n=>{let e=[],t=n._start;for(;t!==null;){if(t.countable&&!t.deleted){let r=t.content.getContent();for(let s=0;s<r.length;s++)e.push(r[s])}t=t.right}return e};var zo=(n,e)=>{let t=0,r=n._start;for(;r!==null;){if(r.countable&&!r.deleted){let s=r.content.getContent();for(let o=0;o<s.length;o++)e(s[o],t++,n)}r=r.right}},_p=(n,e)=>{let t=[];return zo(n,(r,s)=>{t.push(e(r,s,n))}),t},Kx=n=>{let e=n._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}let s=t[r++];return t.length<=r&&(t=null),{done:!1,value:s}}}},bp=(n,e)=>{let t=ba(n,e),r=n._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},ga=(n,e,t,r)=>{let s=t,o=n.doc,i=o.clientID,l=o.store,c=t===null?e._start:t.right,f=[],d=()=>{f.length>0&&(s=new Be(me(i,Qe(l,i)),s,s&&s.lastId,c,c&&c.id,e,null,new ur(f)),s.integrate(n,0),f=[])};r.forEach(p=>{if(p===null)f.push(p);else switch(p.constructor){case Number:case Object:case Boolean:case Array:case String:f.push(p);break;default:switch(d(),p.constructor){case Uint8Array:case ArrayBuffer:s=new Be(me(i,Qe(l,i)),s,s&&s.lastId,c,c&&c.id,e,null,new Kn(new Uint8Array(p))),s.integrate(n,0);break;case Er:s=new Be(me(i,Qe(l,i)),s,s&&s.lastId,c,c&&c.id,e,null,new Jn(p)),s.integrate(n,0);break;default:if(p instanceof ot)s=new Be(me(i,Qe(l,i)),s,s&&s.lastId,c,c&&c.id,e,null,new jt(p)),s.integrate(n,0);else throw new Error("Unexpected content type in insert operation")}}}),d()},vp=()=>Yt("Length exceeded!"),xp=(n,e,t,r)=>{if(t>e._length)throw vp();if(t===0)return e._searchMarker&&Go(e._searchMarker,t,r.length),ga(n,e,null,r);let s=t,o=ba(e,t),i=e._start;for(o!==null&&(i=o.p,t-=o.index,t===0&&(i=i.prev,t+=i&&i.countable&&!i.deleted?i.length:0));i!==null;i=i.right)if(!i.deleted&&i.countable){if(t<=i.length){t<i.length&&_n(n,me(i.id.client,i.id.clock+t));break}t-=i.length}return e._searchMarker&&Go(e._searchMarker,s,r.length),ga(n,e,i,r)},Yx=(n,e,t)=>{let s=(e._searchMarker||[]).reduce((o,i)=>i.index>o.index?i:o,{index:0,p:e._start}).p;if(s)for(;s.right;)s=s.right;return ga(n,e,s,t)},Sp=(n,e,t,r)=>{if(r===0)return;let s=t,o=r,i=ba(e,t),l=e._start;for(i!==null&&(l=i.p,t-=i.index);l!==null&&t>0;l=l.right)!l.deleted&&l.countable&&(t<l.length&&_n(n,me(l.id.client,l.id.clock+t)),t-=l.length);for(;r>0&&l!==null;)l.deleted||(r<l.length&&_n(n,me(l.id.client,l.id.clock+r)),l.delete(n),r-=l.length),l=l.right;if(r>0)throw vp();e._searchMarker&&Go(e._searchMarker,s,-o+r)},ya=(n,e,t)=>{let r=e._map.get(t);r!==void 0&&r.delete(n)},jc=(n,e,t,r)=>{let s=e._map.get(t)||null,o=n.doc,i=o.clientID,l;if(r==null)l=new ur([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:l=new ur([r]);break;case Uint8Array:l=new Kn(r);break;case Er:l=new Jn(r);break;default:if(r instanceof ot)l=new jt(r);else throw new Error("Unexpected content type")}new Be(me(i,Qe(o.store,i)),s,s&&s.lastId,null,null,e,t,l).integrate(n,0)},Gc=(n,e)=>{let t=n._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},kp=n=>{let e={};return n._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},Cp=(n,e)=>{let t=n._map.get(e);return t!==void 0&&!t.deleted};var Jx=(n,e)=>{let t={};return n._map.forEach((r,s)=>{let o=r;for(;o!==null&&(!e.sv.has(o.id.client)||o.id.clock>=(e.sv.get(o.id.client)||0));)o=o.left;o!==null&&Ms(o,e)&&(t[s]=o.content.getContent()[o.length-1])}),t},na=n=>Bh(n.entries(),e=>!e[1].deleted),Oc=class extends Fs{constructor(e,t){super(e,t),this._transaction=t}},yn=class extends ot{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){let t=new yn;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new yn}clone(){let e=new yn;return e.insert(0,this.toArray().map(t=>t instanceof ot?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(e,t){super._callObserver(e,t),va(this,e,new Oc(this,e))}insert(e,t){this.doc!==null?Re(this.doc,r=>{xp(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?Re(this.doc,t=>{Yx(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?Re(this.doc,r=>{Sp(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return bp(this,e)}toArray(){return wp(this)}slice(e=0,t=this.length){return yp(this,e,t)}toJSON(){return this.map(e=>e instanceof ot?e.toJSON():e)}map(e){return _p(this,e)}forEach(e){zo(this,e)}[Symbol.iterator](){return Kx(this)}_write(e){e.writeTypeRef(h0)}},qx=n=>new yn,Ic=class extends Fs{constructor(e,t,r){super(e,t),this.keysChanged=r}},bn=class extends ot{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new bn}clone(){let e=new bn;return this.forEach((t,r)=>{e.set(r,t instanceof ot?t.clone():t)}),e}_callObserver(e,t){va(this,e,new Ic(this,e,t))}toJSON(){let e={};return this._map.forEach((t,r)=>{if(!t.deleted){let s=t.content.getContent()[t.length-1];e[r]=s instanceof ot?s.toJSON():s}}),e}get size(){return[...na(this._map)].length}keys(){return ta(na(this._map),e=>e[0])}values(){return ta(na(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return ta(na(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Re(this.doc,t=>{ya(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?Re(this.doc,r=>{jc(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return Gc(this,e)}has(e){return Cp(this,e)}clear(){this.doc!==null?Re(this.doc,e=>{this.forEach(function(t,r,s){ya(e,s,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(p0)}},jx=n=>new bn,mn=(n,e)=>n===e||typeof n=="object"&&typeof e=="object"&&n&&e&&pc(n,e),Xo=class{constructor(e,t,r,s){this.left=e,this.right=t,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&Jt(),this.right.content.constructor){case je:this.right.deleted||$s(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}},Xh=(n,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case je:e.right.deleted||$s(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&_n(n,me(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},sa=(n,e,t,r)=>{let s=new Map,o=r?ba(e,t):null;if(o){let i=new Xo(o.p.left,o.p,o.index,s);return Xh(n,i,t-o.index)}else{let i=new Xo(null,e._start,0,s);return Xh(n,i,t)}},Ep=(n,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===je&&mn(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();let s=n.doc,o=s.clientID;r.forEach((i,l)=>{let c=t.left,f=t.right,d=new Be(me(o,Qe(s.store,o)),c,c&&c.lastId,f,f&&f.id,e,null,new je(l,i));d.integrate(n,0),t.right=d,t.forward()})},$s=(n,e)=>{let{key:t,value:r}=e;r===null?n.delete(t):n.set(t,r)},Tp=(n,e)=>{var t;for(;n.right!==null;){if(!(n.right.deleted||n.right.content.constructor===je&&mn((t=e[n.right.content.key])!=null?t:null,n.right.content.value)))break;n.forward()}},Ap=(n,e,t,r)=>{var l;let s=n.doc,o=s.clientID,i=new Map;for(let c in r){let f=r[c],d=(l=t.currentAttributes.get(c))!=null?l:null;if(!mn(d,f)){i.set(c,d);let{left:p,right:g}=t;t.right=new Be(me(o,Qe(s.store,o)),p,p&&p.lastId,g,g&&g.id,e,null,new je(c,f)),t.right.integrate(n,0),t.forward()}}return i},Cc=(n,e,t,r,s)=>{t.currentAttributes.forEach((g,_)=>{s[_]===void 0&&(s[_]=null)});let o=n.doc,i=o.clientID;Tp(t,s);let l=Ap(n,e,t,s),c=r.constructor===String?new qt(r):r instanceof ot?new jt(r):new Gr(r),{left:f,right:d,index:p}=t;e._searchMarker&&Go(e._searchMarker,t.index,c.getLength()),d=new Be(me(i,Qe(o.store,i)),f,f&&f.lastId,d,d&&d.id,e,null,c),d.integrate(n,0),t.right=d,t.index=p,t.forward(),Ep(n,e,t,l)},Zh=(n,e,t,r,s)=>{let o=n.doc,i=o.clientID;Tp(t,s);let l=Ap(n,e,t,s);e:for(;t.right!==null&&(r>0||l.size>0&&(t.right.deleted||t.right.content.constructor===je));){if(!t.right.deleted)switch(t.right.content.constructor){case je:{let{key:c,value:f}=t.right.content,d=s[c];if(d!==void 0){if(mn(d,f))l.delete(c);else{if(r===0)break e;l.set(c,f)}t.right.delete(n)}else t.currentAttributes.set(c,f);break}default:r<t.right.length&&_n(n,me(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;t.right=new Be(me(i,Qe(o.store,i)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new qt(c)),t.right.integrate(n,0),t.forward()}Ep(n,e,t,l)},Dp=(n,e,t,r,s)=>{var f,d;let o=e,i=at();for(;o&&(!o.countable||o.deleted);){if(!o.deleted&&o.content.constructor===je){let p=o.content;i.set(p.key,p)}o=o.right}let l=0,c=!1;for(;e!==o;){if(t===e&&(c=!0),!e.deleted){let p=e.content;switch(p.constructor){case je:{let{key:g,value:_}=p,y=(f=r.get(g))!=null?f:null;(i.get(g)!==p||y===_)&&(e.delete(n),l++,!c&&((d=s.get(g))!=null?d:null)===_&&y!==_&&(y===null?s.delete(g):s.set(g,y))),!c&&!e.deleted&&$s(s,p);break}}}e=e.right}return l},Gx=(n,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;let t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===je){let r=e.content.key;t.has(r)?e.delete(n):t.add(r)}e=e.left}},zx=n=>{let e=0;return Re(n.doc,t=>{let r=n._start,s=n._start,o=at(),i=Ki(o);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case je:$s(i,s.content);break;default:e+=Dp(t,r,s,o,i),o=Ki(i),r=s;break}s=s.right}}),e},Xx=n=>{let e=new Set,t=n.doc;for(let[r,s]of n.afterState.entries()){let o=n.beforeState.get(r)||0;s!==o&&dp(n,t.store.clients.get(r),o,s,i=>{!i.deleted&&i.content.constructor===je&&i.constructor!==Ft&&e.add(i.parent)})}Re(t,r=>{tp(n,n.deleteSet,s=>{if(s instanceof Ft||!s.parent._hasFormatting||e.has(s.parent))return;let o=s.parent;s.content.constructor===je?e.add(o):Gx(r,s)});for(let s of e)zx(s)})},Qh=(n,e,t)=>{let r=t,s=Ki(e.currentAttributes),o=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case jt:case Gr:case qt:t<e.right.length&&_n(n,me(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(n);break}e.forward()}o&&Dp(n,o,e.right,s,e.currentAttributes);let i=(e.left||e.right).parent;return i._searchMarker&&Go(i._searchMarker,e.index,-r+t),e},Lc=class extends Fs{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){let e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){let e=this.target.doc,t=[];Re(e,r=>{var _,y,b;let s=new Map,o=new Map,i=this.target._start,l=null,c={},f="",d=0,p=0,g=()=>{if(l!==null){let C=null;switch(l){case"delete":p>0&&(C={delete:p}),p=0;break;case"insert":(typeof f=="object"||f.length>0)&&(C={insert:f},s.size>0&&(C.attributes={},s.forEach((x,M)=>{x!==null&&(C.attributes[M]=x)}))),f="";break;case"retain":d>0&&(C={retain:d},Ch(c)||(C.attributes=Sh({},c))),d=0;break}C&&t.push(C),l=null}};for(;i!==null;){switch(i.content.constructor){case jt:case Gr:this.adds(i)?this.deletes(i)||(g(),l="insert",f=i.content.getContent()[0],g()):this.deletes(i)?(l!=="delete"&&(g(),l="delete"),p+=1):i.deleted||(l!=="retain"&&(g(),l="retain"),d+=1);break;case qt:this.adds(i)?this.deletes(i)||(l!=="insert"&&(g(),l="insert"),f+=i.content.str):this.deletes(i)?(l!=="delete"&&(g(),l="delete"),p+=i.length):i.deleted||(l!=="retain"&&(g(),l="retain"),d+=i.length);break;case je:{let{key:C,value:x}=i.content;if(this.adds(i)){if(!this.deletes(i)){let M=(_=s.get(C))!=null?_:null;mn(M,x)?x!==null&&i.delete(r):(l==="retain"&&g(),mn(x,(y=o.get(C))!=null?y:null)?delete c[C]:c[C]=x)}}else if(this.deletes(i)){o.set(C,x);let M=(b=s.get(C))!=null?b:null;mn(M,x)||(l==="retain"&&g(),c[C]=M)}else if(!i.deleted){o.set(C,x);let M=c[C];M!==void 0&&(mn(M,x)?M!==null&&i.delete(r):(l==="retain"&&g(),x===null?delete c[C]:c[C]=x))}i.deleted||(l==="insert"&&g(),$s(s,i.content));break}}i=i.right}for(g();t.length>0;){let C=t[t.length-1];if(C.retain!==void 0&&C.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}},vn=class extends ot{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new vn}clone(){let e=new vn;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);let r=new Lc(this,e,t);va(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===qt&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?Re(this.doc,r=>{let s=new Xo(null,this._start,0,new Map);for(let o=0;o<e.length;o++){let i=e[o];if(i.insert!==void 0){let l=!t&&typeof i.insert=="string"&&o===e.length-1&&s.right===null&&i.insert.slice(-1)===`
`?i.insert.slice(0,-1):i.insert;(typeof l!="string"||l.length>0)&&Cc(r,this,s,l,i.attributes||{})}else i.retain!==void 0?Zh(r,this,s,i.retain,i.attributes||{}):i.delete!==void 0&&Qh(r,s,i.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){let s=[],o=new Map,i=this.doc,l="",c=this._start;function f(){if(l.length>0){let p={},g=!1;o.forEach((y,b)=>{g=!0,p[b]=y});let _={insert:l};g&&(_.attributes=p),s.push(_),l=""}}let d=()=>{for(;c!==null;){if(Ms(c,e)||t!==void 0&&Ms(c,t))switch(c.content.constructor){case qt:{let p=o.get("ychange");e!==void 0&&!Ms(c,e)?(p===void 0||p.user!==c.id.client||p.type!=="removed")&&(f(),o.set("ychange",r?r("removed",c.id):{type:"removed"})):t!==void 0&&!Ms(c,t)?(p===void 0||p.user!==c.id.client||p.type!=="added")&&(f(),o.set("ychange",r?r("added",c.id):{type:"added"})):p!==void 0&&(f(),o.delete("ychange")),l+=c.content.str;break}case jt:case Gr:{f();let p={insert:c.content.getContent()[0]};if(o.size>0){let g={};p.attributes=g,o.forEach((_,y)=>{g[y]=_})}s.push(p);break}case je:Ms(c,e)&&(f(),$s(o,c.content));break}c=c.right}f()};return e||t?Re(i,p=>{e&&Mc(p,e),t&&Mc(p,t),d()},"cleanup"):d(),s}insert(e,t,r){if(t.length<=0)return;let s=this.doc;s!==null?Re(s,o=>{let i=sa(o,this,e,!r);r||(r={},i.currentAttributes.forEach((l,c)=>{r[c]=l})),Cc(o,this,i,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){let s=this.doc;s!==null?Re(s,o=>{let i=sa(o,this,e,!r);Cc(o,this,i,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(t===0)return;let r=this.doc;r!==null?Re(r,s=>{Qh(s,sa(s,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;let s=this.doc;s!==null?Re(s,o=>{let i=sa(o,this,e,!1);i.right!==null&&Zh(o,this,i,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?Re(this.doc,t=>{ya(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?Re(this.doc,r=>{jc(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return Gc(this,e)}getAttributes(){return kp(this)}_write(e){e.writeTypeRef(m0)}},Zx=n=>new vn,Yo=class{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===xn||t.constructor===jr)&&t._start!==null)e=t._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}},jr=class extends ot{constructor(){super(),this._prelimContent=[]}get firstChild(){let e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new jr}clone(){let e=new jr;return e.insert(0,this.toArray().map(t=>t instanceof ot?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Yo(this,e)}querySelector(e){e=e.toUpperCase();let r=new Yo(this,s=>s.nodeName&&s.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),ir(new Yo(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){va(this,e,new $c(this,t,e))}toString(){return _p(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){let s=e.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),zo(this,o=>{s.insertBefore(o.toDOM(e,t,r),null)}),s}insert(e,t){this.doc!==null?Re(this.doc,r=>{xp(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)Re(this.doc,r=>{let s=e&&e instanceof ot?e._item:e;ga(r,this,s,t)});else{let r=this._prelimContent,s=e===null?0:r.findIndex(o=>o===e)+1;if(s===0&&e!==null)throw Yt("Reference item not found");r.splice(s,0,...t)}}delete(e,t=1){this.doc!==null?Re(this.doc,r=>{Sp(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return wp(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return bp(this,e)}slice(e=0,t=this.length){return yp(this,e,t)}forEach(e){zo(this,e)}_write(e){e.writeTypeRef(y0)}},Qx=n=>new jr,xn=class extends jr{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new xn(this.nodeName)}clone(){let e=new xn(this.nodeName),t=this.getAttributes();return kh(t,(r,s)=>{typeof r=="string"&&e.setAttribute(s,r)}),e.insert(0,this.toArray().map(r=>r instanceof ot?r.clone():r)),e}toString(){let e=this.getAttributes(),t=[],r=[];for(let l in e)r.push(l);r.sort();let s=r.length;for(let l=0;l<s;l++){let c=r[l];t.push(c+'="'+e[c]+'"')}let o=this.nodeName.toLocaleLowerCase(),i=t.length>0?" "+t.join(" "):"";return`<${o}${i}>${super.toString()}</${o}>`}removeAttribute(e){this.doc!==null?Re(this.doc,t=>{ya(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?Re(this.doc,r=>{jc(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return Gc(this,e)}hasAttribute(e){return Cp(this,e)}getAttributes(e){return e?Jx(this,e):kp(this)}toDOM(e=document,t={},r){let s=e.createElement(this.nodeName),o=this.getAttributes();for(let i in o){let l=o[i];typeof l=="string"&&s.setAttribute(i,l)}return zo(this,i=>{s.appendChild(i.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(g0),e.writeKey(this.nodeName)}},e0=n=>new xn(n.readKey()),$c=class extends Fs{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}},Ps=class extends bn{constructor(e){super(),this.hookName=e}_copy(){return new Ps(this.hookName)}clone(){let e=new Ps(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){let s=t[this.hookName],o;return s!==void 0?o=s.createDom(this):o=document.createElement(this.hookName),o.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(o,this),o}_write(e){e.writeTypeRef(w0),e.writeKey(this.hookName)}},t0=n=>new Ps(n.readKey()),Os=class extends vn{get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new Os}clone(){let e=new Os;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){let s=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(e=>{let t=[];for(let s in e.attributes){let o=[];for(let i in e.attributes[s])o.push({key:i,value:e.attributes[s][i]});o.sort((i,l)=>i.key<l.key?-1:1),t.push({nodeName:s,attrs:o})}t.sort((s,o)=>s.nodeName<o.nodeName?-1:1);let r="";for(let s=0;s<t.length;s++){let o=t[s];r+=`<${o.nodeName}`;for(let i=0;i<o.attrs.length;i++){let l=o.attrs[i];r+=` ${l.key}="${l.value}"`}r+=">"}r+=e.insert;for(let s=t.length-1;s>=0;s--)r+=`</${t[s].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(_0)}},r0=n=>new Os,Zo=class{constructor(e,t){this.id=e,this.length=t}get deleted(){throw lr()}mergeWith(e){return!1}write(e,t,r){throw lr()}integrate(e,t){throw lr()}},n0=0,Ft=class extends Zo{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),fp(e.doc.store,this)}write(e,t){e.writeInfo(n0),e.writeLen(this.length-t)}getMissing(e,t){return null}},Kn=class{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Kn(this.content)}splice(e){throw lr()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}},s0=n=>new Kn(n.readBuf()),Yn=class{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Yn(this.len)}splice(e){let t=new Yn(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){la(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}},o0=n=>new Yn(n.readLen()),Mp=(n,e)=>new Er({guid:n,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1}),Jn=class{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;let t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Jn(Mp(this.doc.guid,this.opts))}splice(e){throw lr()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}},i0=n=>new Jn(Mp(n.readString(),n.readAny())),Gr=class{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Gr(this.embed)}splice(e){throw lr()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}},a0=n=>new Gr(n.readJSON()),je=class{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new je(this.key,this.value)}splice(e){throw lr()}mergeWith(e){return!1}integrate(e,t){let r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}},l0=n=>new je(n.readKey(),n.readJSON()),Is=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Is(this.arr)}splice(e){let t=new Is(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let s=t;s<r;s++){let o=this.arr[s];e.writeString(o===void 0?"undefined":JSON.stringify(o))}}getRef(){return 2}},c0=n=>{let e=n.readLen(),t=[];for(let r=0;r<e;r++){let s=n.readString();s==="undefined"?t.push(void 0):t.push(JSON.parse(s))}return new Is(t)},ur=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ur(this.arr)}splice(e){let t=new ur(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let s=t;s<r;s++){let o=this.arr[s];e.writeAny(o)}}getRef(){return 8}},u0=n=>{let e=n.readLen(),t=[];for(let r=0;r<e;r++)t.push(n.readAny());return new ur(t)},qt=class{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new qt(this.str)}splice(e){let t=new qt(this.str.slice(e));this.str=this.str.slice(0,e);let r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"\uFFFD",t.str="\uFFFD"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}},f0=n=>new qt(n.readString()),d0=[qx,jx,Zx,e0,Qx,t0,r0],h0=0,p0=1,m0=2,g0=3,y0=4,w0=5,_0=6,jt=class{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new jt(this.type._copy())}splice(e){throw lr()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}},b0=n=>new jt(d0[n.readTypeRef()](n)),ep=(n,e)=>{let t=e,r=0,s;do r>0&&(t=me(t.client,t.clock+r)),s=oa(n,t),r=t.clock-s.id.clock,t=s.redone;while(t!==null&&s instanceof Be);return{item:s,diff:r}};var wa=(n,e,t)=>{let{client:r,clock:s}=e.id,o=new Be(me(r,s+t),e,me(r,s+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&o.markDeleted(),e.keep&&(o.keep=!0),e.redone!==null&&(o.redone=me(e.redone.client,e.redone.clock+t)),e.right=o,o.right!==null&&(o.right.left=o),n._mergeStructs.push(o),o.parentSub!==null&&o.right===null&&o.parent._map.set(o.parentSub,o),e.length=t,o};var Be=class extends Zo{constructor(e,t,r,s,o,i,l,c){super(e,c.getLength()),this.origin=r,this.left=t,this.right=s,this.rightOrigin=o,this.parent=i,this.parentSub=l,this.redone=null,this.content=c,this.info=this.content.isCountable()?2:0}set marker(e){(this.info&8)>0!==e&&(this.info^=8)}get marker(){return(this.info&8)>0}get keep(){return(this.info&1)>0}set keep(e){this.keep!==e&&(this.info^=1)}get countable(){return(this.info&2)>0}get deleted(){return(this.info&4)>0}set deleted(e){this.deleted!==e&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Qe(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Qe(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===gn&&this.id.client!==this.parent.client&&this.parent.clock>=Qe(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=qh(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=_n(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Ft||this.right&&this.right.constructor===Ft)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Be&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===Be&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===gn){let r=oa(t,this.parent);r.constructor===Ft?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=qh(e,e.doc.store,me(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;let o=new Set,i=new Set;for(;s!==null&&s!==this.right;){if(i.add(s),o.add(s),Rs(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,o.clear();else if(Rs(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&i.has(oa(e.doc.store,s.origin)))o.has(oa(e.doc.store,s.origin))||(r=s,o.clear());else break;s=s.right}this.left=r}if(this.left!==null){let r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),fp(e.doc.store,this),this.content.integrate(e,this),Gh(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new Ft(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:me(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Rs(e.origin,this.lastId)&&this.right===e&&Rs(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){let t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){let t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),la(e.deleteSet,this.id.client,this.id.clock,this.length),Gh(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw Jt();this.content.gc(e),t?Fx(e,this,new Ft(this.id,this.length)):this.content=new Yn(this.length)}write(e,t){let r=t>0?me(this.id.client,this.id.clock+t-1):this.origin,s=this.rightOrigin,o=this.parentSub,i=this.content.getRef()&31|(r===null?0:128)|(s===null?0:64)|(o===null?0:32);if(e.writeInfo(i),r!==null&&e.writeLeftID(r),s!==null&&e.writeRightID(s),r===null&&s===null){let l=this.parent;if(l._item!==void 0){let c=l._item;if(c===null){let f=up(l);e.writeParentInfo(!0),e.writeString(f)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else l.constructor===String?(e.writeParentInfo(!0),e.writeString(l)):l.constructor===gn?(e.writeParentInfo(!1),e.writeLeftID(l)):Jt();o!==null&&e.writeString(o)}this.content.write(e,t)}},Rp=(n,e)=>v0[e&31](n),v0=[()=>{Jt()},o0,c0,s0,f0,a0,l0,b0,u0,i0,()=>{Jt()}],x0=10,Pt=class extends Zo{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){Jt()}write(e,t){e.writeInfo(x0),fe(e.restEncoder,this.length-t)}getMissing(e,t){return null}},Fp=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:{},Pp="__ $YJS$ __";Fp[Pp]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Fp[Pp]=!0;var ut=require("obsidian");var Gn=n=>Jr((e,t)=>{n.onerror=r=>t(new Error(r.target.error)),n.onsuccess=r=>e(r.target.result)}),Op=(n,e)=>Jr((t,r)=>{let s=indexedDB.open(n);s.onupgradeneeded=o=>e(o.target.result),s.onerror=o=>r(Yt(o.target.error)),s.onsuccess=o=>{let i=o.target.result;i.onversionchange=()=>{i.close()},t(i)}}),Ip=n=>Gn(indexedDB.deleteDatabase(n)),Lp=(n,e)=>e.forEach(t=>n.createObjectStore.apply(n,t)),Us=(n,e,t="readwrite")=>{let r=n.transaction(e,t);return e.map(s=>E0(r,s))},zc=(n,e)=>Gn(n.count(e)),$p=(n,e)=>Gn(n.get(e)),Xc=(n,e)=>Gn(n.delete(e)),Up=(n,e,t)=>Gn(n.put(e,t));var xa=(n,e)=>Gn(n.add(e)),Np=(n,e,t)=>Gn(n.getAll(e,t));var S0=(n,e,t)=>{let r=null;return C0(n,e,s=>(r=s,!1),t).then(()=>r)},Bp=(n,e=null)=>S0(n,e,"prev");var k0=(n,e)=>Jr((t,r)=>{n.onerror=r,n.onsuccess=async s=>{let o=s.target.result;if(o===null||await e(o)===!1)return t();o.continue()}});var C0=(n,e,t,r="next")=>k0(n.openKeyCursor(e,r),s=>t(s.key)),E0=(n,e)=>n.objectStore(e);var Hp=(n,e)=>IDBKeyRange.upperBound(n,e),Vp=(n,e)=>IDBKeyRange.lowerBound(n,e);var Zc="custom",Wp="updates",Kp=500,Bs=(n,e=()=>{},t=()=>{})=>{let[r]=Us(n.db,[Wp]);return Np(r,Vp(n._dbref,!1)).then(s=>{n._destroyed||(e(r),Re(n.doc,()=>{s.forEach(o=>qn(n.doc,o))},n,!1),t(r))}).then(()=>Bp(r).then(s=>{n._dbref=s+1})).then(()=>zc(r).then(s=>{n._dbsize=s})).then(()=>r)},A0=(n,e=!0)=>Bs(n).then(t=>{(e||n._dbsize>=Kp)&&xa(t,jn(n.doc)).then(()=>Xc(t,Hp(n._dbref,!0))).then(()=>zc(t).then(r=>{n._dbsize=r}))});var Ns=class extends gs{constructor(e,t){super(),this.doc=t,this.name=e,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._db=Op(e,r=>Lp(r,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=Jr(r=>this.on("synced",()=>r(this))),this._db.then(r=>{this.db=r,Bs(this,i=>xa(i,jn(t)),()=>{if(this._destroyed)return this;this.synced=!0,this.emit("synced",[this])})}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(r,s)=>{if(this.db&&s!==this){let[o]=Us(this.db,[Wp]);xa(o,r),++this._dbsize>=Kp&&(this._storeTimeoutId!==null&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{A0(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},t.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),t.on("destroy",this.destroy)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(e=>{e.close()})}clearData(){return this.destroy().then(()=>{Ip(this.name)})}get(e){return this._db.then(t=>{let[r]=Us(t,[Zc],"readonly");return $p(r,e)})}set(e,t){return this._db.then(r=>{let[s]=Us(r,[Zc]);return Up(s,t,e)})}del(e){return this._db.then(t=>{let[r]=Us(t,[Zc]);return Xc(r,e)})}};var Sa,D0=new Uint8Array(16);function Qc(){if(!Sa&&(Sa=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Sa))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Sa(D0)}var pt=[];for(let n=0;n<256;++n)pt.push((n+256).toString(16).slice(1));function Yp(n,e=0){return pt[n[e+0]]+pt[n[e+1]]+pt[n[e+2]]+pt[n[e+3]]+"-"+pt[n[e+4]]+pt[n[e+5]]+"-"+pt[n[e+6]]+pt[n[e+7]]+"-"+pt[n[e+8]]+pt[n[e+9]]+"-"+pt[n[e+10]]+pt[n[e+11]]+pt[n[e+12]]+pt[n[e+13]]+pt[n[e+14]]+pt[n[e+15]]}var M0=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),eu={randomUUID:M0};function R0(n,e,t){if(eu.randomUUID&&!e&&!n)return eu.randomUUID();n=n||{};let r=n.random||(n.rng||Qc)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let s=0;s<16;++s)e[t+s]=r[s];return e}return Yp(r)}var Hs=R0;var Zt=Ro(Wi());var Jp=0,ka=1,qp=2,Ca=(n,e)=>{fe(n,Jp);let t=lp(e);ct(n,t)},tu=(n,e,t)=>{fe(n,ka),ct(n,jn(e,t))},F0=(n,e,t)=>tu(e,t,ht(n)),jp=(n,e,t)=>{try{qn(e,ht(n),t)}catch(r){console.error("Caught error while handling a Yjs update",r)}},Gp=(n,e)=>{fe(n,qp),ct(n,e)},P0=jp,zp=(n,e,t,r)=>{let s=ce(n);switch(s){case Jp:F0(n,e,t);break;case ka:jp(n,t,r);break;case qp:P0(n,t,r);break;default:throw new Error("Unknown message type")}return s};var I0=0;var Xp=(n,e,t)=>{switch(ce(n)){case I0:t(e,cr(n))}};var ru=3e4,Ea=class extends gs{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let t=Hn();this.getLocalState()!==null&&ru/2<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let r=[];this.meta.forEach((s,o)=>{o!==this.clientID&&ru<=t-s.lastUpdated&&this.states.has(o)&&r.push(o)}),r.length>0&&Ta(this,r,"timeout")},Rt(ru/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){let t=this.clientID,r=this.meta.get(t),s=r===void 0?0:r.clock+1,o=this.states.get(t);e===null?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:s,lastUpdated:Hn()});let i=[],l=[],c=[],f=[];e===null?f.push(t):o==null?e!=null&&i.push(t):(l.push(t),As(o,e)||c.push(t)),(i.length>0||c.length>0||f.length>0)&&this.emit("change",[{added:i,updated:c,removed:f},"local"]),this.emit("update",[{added:i,updated:l,removed:f},"local"])}setLocalStateField(e,t){let r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:t})}getStates(){return this.states}},Ta=(n,e,t)=>{let r=[];for(let s=0;s<e.length;s++){let o=e[s];if(n.states.has(o)){if(n.states.delete(o),o===n.clientID){let i=n.meta.get(o);n.meta.set(o,{clock:i.clock+1,lastUpdated:Hn()})}r.push(o)}}r.length>0&&(n.emit("change",[{added:[],updated:[],removed:r},t]),n.emit("update",[{added:[],updated:[],removed:r},t]))},Vs=(n,e,t=n.states)=>{let r=e.length,s=Un();fe(s,r);for(let o=0;o<r;o++){let i=e[o],l=t.get(i)||null,c=n.meta.get(i).clock;fe(s,i),fe(s,c),Kr(s,JSON.stringify(l))}return $t(s)};var Zp=(n,e,t)=>{let r=Yr(e),s=Hn(),o=[],i=[],l=[],c=[],f=ce(r);for(let d=0;d<f;d++){let p=ce(r),g=ce(r),_=JSON.parse(cr(r)),y=n.meta.get(p),b=n.states.get(p),C=y===void 0?0:y.clock;(C<g||C===g&&_===null&&n.states.has(p))&&(_===null?p===n.clientID&&n.getLocalState()!=null?g++:n.states.delete(p):n.states.set(p,_),n.meta.set(p,{clock:g,lastUpdated:s}),y===void 0&&_!==null?o.push(p):y!==void 0&&_===null?c.push(p):_!==null&&(As(_,b)||l.push(p),i.push(p)))}(o.length>0||l.length>0||c.length>0)&&n.emit("change",[{added:o,updated:l,removed:c},t]),(o.length>0||i.length>0||c.length>0)&&n.emit("update",[{added:o,updated:i,removed:c},t])};var Ks=()=>new Map,nm=(n,e,t)=>{let r=n.get(e);return r===void 0&&n.set(e,r=t()),r},sm=()=>new Set,U0=Array.from,zT=Array.isArray,om=String.fromCharCode,XT=String.fromCodePoint,ZT=om(65535),N0=n=>n.toLowerCase(),B0=/^\s*/g,H0=n=>n.replace(B0,""),V0=/([A-Z])/g,Qp=(n,e)=>H0(n.replace(V0,t=>`${e}${N0(t)}`)),W0=n=>{let e=unescape(encodeURIComponent(n)),t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.codePointAt(s);return r},ei=typeof TextEncoder!="undefined"?new TextEncoder:null,K0=n=>ei.encode(n),Y0=ei?K0:W0,nu=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});nu&&nu.decode(new Uint8Array).length===1&&(nu=null);var em=n=>n===void 0?null:n,J0=class{constructor(){this.map=new Map}setItem(n,e){this.map.set(n,e)}getItem(n){return this.map.get(n)}},im=new J0,cu=!0;try{typeof localStorage!="undefined"&&(im=localStorage,cu=!1)}catch(n){}var am=im,q0=n=>cu||addEventListener("storage",n),j0=n=>cu||removeEventListener("storage",n),G0=(n,e)=>{let t=[];for(let r in n)t.push(e(n[r],r));return t},z0=(n,e)=>e.includes(n),qs=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name),lm=typeof window!="undefined"&&typeof document!="undefined"&&!qs,QT=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,Ar,X0=[],Z0=()=>{if(Ar===void 0)if(qs){Ar=Ks();let n=process.argv,e=null;for(let t=0;t<n.length;t++){let r=n[t];r[0]==="-"?(e!==null&&Ar.set(e,""),e=r):e!==null?(Ar.set(e,r),e=null):X0.push(r)}e!==null&&Ar.set(e,"")}else typeof location=="object"?(Ar=Ks(),(location.search||"?").slice(1).split("&").forEach(n=>{if(n.length!==0){let[e,t]=n.split("=");Ar.set(`--${Qp(e,"-")}`,t),Ar.set(`-${Qp(e,"-")}`,t)}})):Ar=Ks();return Ar},ou=n=>Z0().has(n),iu=n=>em(qs?process.env[n.toUpperCase()]:am.getItem(n)),Q0=n=>ou("--"+n)||iu(n)!==null,eA=Q0("production"),tm=qs&&z0(process.env.FORCE_COLOR,["true","1","2"]),tA=!ou("no-colors")&&(!qs||process.stdout.isTTY||tm)&&(!qs||ou("color")||tm||iu("COLORTERM")!==null||(iu("TERM")||"").includes("color")),cm=Math.floor,um=(n,e)=>n<e?n:e,e1=(n,e)=>n>e?n:e,rA=Number.isNaN,t1=Math.pow,fm=128,r1=1<<17,n1=1<<18,s1=1<<19,o1=1<<20,i1=1<<21,a1=1<<22,l1=1<<23,c1=1<<24,u1=1<<25,f1=1<<26,d1=1<<27,h1=1<<28,p1=1<<29,m1=1<<30,nA=1<<31,Aa=127,sA=r1-1,oA=n1-1,iA=s1-1,aA=o1-1,lA=i1-1,cA=a1-1,uA=l1-1,fA=c1-1,dA=u1-1,hA=f1-1,pA=d1-1,mA=h1-1,gA=p1-1,yA=m1-1,g1=Number.MAX_SAFE_INTEGER,wA=Number.MIN_SAFE_INTEGER,_A=1<<31,bA=Number.isInteger||(n=>typeof n=="number"&&isFinite(n)&&cm(n)===n),vA=Number.isNaN,xA=Number.parseInt,y1=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},fr=()=>new y1,uu=n=>{let e=n.cpos;for(let t=0;t<n.bufs.length;t++)e+=n.bufs[t].length;return e},Gt=n=>{let e=new Uint8Array(uu(n)),t=0;for(let r=0;r<n.bufs.length;r++){let s=n.bufs[r];e.set(s,t),t+=s.length}return e.set(pm(n.cbuf.buffer,0,n.cpos),t),e},Da=(n,e)=>{let t=n.cbuf.length;n.cpos===t&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(t*2),n.cpos=0),n.cbuf[n.cpos++]=e},kt=(n,e)=>{for(;e>Aa;)Da(n,fm|Aa&e),e=cm(e/128);Da(n,Aa&e)},au=new Uint8Array(3e4),w1=au.length/3,_1=(n,e)=>{if(e.length<w1){let t=ei.encodeInto(e,au).written||0;kt(n,t);for(let r=0;r<t;r++)Da(n,au[r])}else Ys(n,Y0(e))},b1=(n,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;kt(n,r);for(let s=0;s<r;s++)Da(n,t.codePointAt(s))},SA=ei&&ei.encodeInto?_1:b1,v1=(n,e)=>{let t=n.cbuf.length,r=n.cpos,s=um(t-r,e.length),o=e.length-s;n.cbuf.set(e.subarray(0,s),r),n.cpos+=s,o>0&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(e1(t*2,o)),n.cbuf.set(e.subarray(s)),n.cpos=o)},Ys=(n,e)=>{kt(n,e.byteLength),v1(n,e)},kA=new DataView(new ArrayBuffer(4)),dm=n=>new Error(n),x1=dm("Unexpected end of array"),S1=dm("Integer out of Range"),k1=class{constructor(n){this.arr=n,this.pos=0}},C1=n=>new k1(n),E1=(n,e)=>{let t=pm(n.arr.buffer,n.pos+n.arr.byteOffset,e);return n.pos+=e,t},T1=n=>E1(n,hm(n)),hm=n=>{let e=0,t=1,r=n.arr.length;for(;n.pos<r;){let s=n.arr[n.pos++];if(e=e+(s&Aa)*t,t*=128,s<fm)return e;if(e>g1)throw S1}throw x1},A1=n=>new Uint8Array(n),pm=(n,e,t)=>new Uint8Array(n,e,t),D1=n=>new Uint8Array(n),M1=n=>{let e="";for(let t=0;t<n.byteLength;t++)e+=om(n[t]);return btoa(e)},R1=n=>Buffer.from(n.buffer,n.byteOffset,n.byteLength).toString("base64"),F1=n=>{let e=atob(n),t=A1(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},P1=n=>{let e=Buffer.from(n,"base64");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},O1=lm?M1:R1,I1=lm?F1:P1,mm=new Map,L1=class{constructor(n){this.room=n,this.onmessage=null,this._onChange=e=>e.key===n&&this.onmessage!==null&&this.onmessage({data:I1(e.newValue||"")}),q0(this._onChange)}postMessage(n){am.setItem(this.room,O1(D1(n)))}close(){j0(this._onChange)}},$1=typeof BroadcastChannel=="undefined"?L1:BroadcastChannel,fu=n=>nm(mm,n,()=>{let e=sm(),t=new $1(n);return t.onmessage=r=>e.forEach(s=>s(r.data,"broadcastchannel")),{bc:t,subs:e}}),U1=(n,e)=>(fu(n).subs.add(e),e),N1=(n,e)=>{let t=fu(n),r=t.subs.delete(e);return r&&t.subs.size===0&&(t.bc.close(),mm.delete(n)),r},Ws=(n,e,t=null)=>{let r=fu(n);r.bc.postMessage(e),r.subs.forEach(s=>s(e,t))},lu=Date.now,B1=class{constructor(){this._observers=Ks()}on(n,e){nm(this._observers,n,sm).add(e)}once(n,e){let t=(...r)=>{this.off(n,t),e(...r)};this.on(n,t)}off(n,e){let t=this._observers.get(n);t!==void 0&&(t.delete(e),t.size===0&&this._observers.delete(n))}emit(n,e){return U0((this._observers.get(n)||Ks()).values()).forEach(t=>t(...e))}destroy(){this._observers=Ks()}},H1=n=>G0(n,(e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`).join("&"),zn=0,gm=3,Js=1,V1=2,ti=[];ti[zn]=(n,e,t,r,s)=>{kt(n,zn);let o=zp(e,n,t.doc,t);r&&o===ka&&!t.synced&&(t.synced=!0)};ti[gm]=(n,e,t,r,s)=>{kt(n,Js),Ys(n,Vs(t.awareness,Array.from(t.awareness.getStates().keys())))};ti[Js]=(n,e,t,r,s)=>{Zp(t.awareness,T1(e),t)};ti[V1]=(n,e,t,r,s)=>{Xp(e,t.doc,(o,i)=>W1(t,i))};var rm=3e4,W1=(n,e)=>console.warn(`Permission denied to access ${n.url}.
${e}`),ym=(n,e,t)=>{let r=C1(e),s=fr(),o=hm(r),i=n.messageHandlers[o];return i?i(s,r,n,t,o):console.error("Unable to compute message"),s},wm=n=>{if(n.shouldConnect&&n.ws===null){let e=new n._WS(n.url);e.binaryType="arraybuffer",n.ws=e,n.wsconnecting=!0,n.wsconnected=!1,n.synced=!1,e.onmessage=t=>{n.wsLastMessageReceived=lu();let r=ym(n,new Uint8Array(t.data),!0);uu(r)>1&&e.send(Gt(r))},e.onerror=t=>{n.emit("connection-error",[t,n])},e.onclose=t=>{n.emit("connection-close",[t,n]),n.ws=null,n.wsconnecting=!1,n.wsconnected?(n.wsconnected=!1,n.synced=!1,Ta(n.awareness,Array.from(n.awareness.getStates().keys()).filter(r=>r!==n.doc.clientID),n),n.emit("status",[{status:"disconnected"}])):n.wsUnsuccessfulReconnects++,setTimeout(wm,um(t1(2,n.wsUnsuccessfulReconnects)*100,n.maxBackoffTime),n)},e.onopen=()=>{n.wsLastMessageReceived=lu(),n.wsconnecting=!1,n.wsconnected=!0,n.wsUnsuccessfulReconnects=0,n.emit("status",[{status:"connected"}]);let t=fr();if(kt(t,zn),Ca(t,n.doc),e.send(Gt(t)),n.awareness.getLocalState()!==null){let r=fr();kt(r,Js),Ys(r,Vs(n.awareness,[n.doc.clientID])),e.send(Gt(r))}},n.emit("status",[{status:"connecting"}])}},su=(n,e)=>{let t=n.ws;n.wsconnected&&t&&t.readyState===t.OPEN&&t.send(e),n.bcconnected&&Ws(n.bcChannel,e,n)},_m=class extends B1{constructor(n,e,t,{connect:r=!0,awareness:s=new Ea(t),params:o={},WebSocketPolyfill:i=WebSocket,resyncInterval:l=-1,maxBackoffTime:c=2500,disableBc:f=!1}={}){for(super();n[n.length-1]==="/";)n=n.slice(0,n.length-1);let d=H1(o);this.maxBackoffTime=c,this.bcChannel=n+"/"+e,this.url=n+"/"+e+(d.length===0?"":"?"+d),this.roomname=e,this.doc=t,this._WS=i,this.awareness=s,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=f,this.wsUnsuccessfulReconnects=0,this.messageHandlers=ti.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=r,this._resyncInterval=0,l>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){let p=fr();kt(p,zn),Ca(p,t),this.ws.send(Gt(p))}},l)),this._bcSubscriber=(p,g)=>{if(g!==this){let _=ym(this,new Uint8Array(p),!1);uu(_)>1&&Ws(this.bcChannel,Gt(_),this)}},this._updateHandler=(p,g)=>{if(g!==this){let _=fr();kt(_,zn),Gp(_,p),su(this,Gt(_))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:p,updated:g,removed:_},y)=>{let b=p.concat(g).concat(_),C=fr();kt(C,Js),Ys(C,Vs(s,b)),su(this,Gt(C))},this._unloadHandler=()=>{Ta(this.awareness,[t.clientID],"window unload")},typeof window!="undefined"?window.addEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.on("exit",this._unloadHandler),s.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{var p;this.wsconnected&&rm<lu()-this.wsLastMessageReceived&&((p=this.ws)==null||p.close())},rm/10),r&&this.connect()}get synced(){return this._synced}set synced(n){this._synced!==n&&(this._synced=n,this.emit("synced",[n]),this.emit("sync",[n]))}destroy(){this._resyncInterval!==0&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),typeof window!="undefined"?window.removeEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.off("exit",this._unloadHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||(U1(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);let n=fr();kt(n,zn),Ca(n,this.doc),Ws(this.bcChannel,Gt(n),this);let e=fr();kt(e,zn),tu(e,this.doc),Ws(this.bcChannel,Gt(e),this);let t=fr();kt(t,gm),Ws(this.bcChannel,Gt(t),this);let r=fr();kt(r,Js),Ys(r,Vs(this.awareness,[this.doc.clientID])),Ws(this.bcChannel,Gt(r),this)}disconnectBc(){let n=fr();kt(n,Js),Ys(n,Vs(this.awareness,[this.doc.clientID],new Map)),su(this,Gt(n)),this.bcconnected&&(N1(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.wsconnected&&this.ws===null&&(wm(this),this.connectBc())}};var hu=require("obsidian"),dr=new WeakMap,bm,vm=!1;function Ma(n){vm=n}var Zr={maxFileSize:1024*1024,maxBackups:5,disableConsole:!1,batchInterval:1e3,maxRetries:3},zr,Xr,du=[];function xm(n,e,t,r){Xr=n,zr=t,r&&(Zr={...Zr,...r}),e.setInterval(pu,Zr.batchInterval)}async function pu(){if(du.length===0)return;let n=[...du];du.length=0;for(let e=0;e<Zr.maxRetries;e++)try{await K1();let t=n.map(Y1).join(`
`)+`
`;await Xr.adapter.append(zr,t);return}catch(t){console.error(`Failed to write logs (attempt ${e+1}):`,t),e===Zr.maxRetries-1&&console.error("Max retries reached. Discarding log entries.")}}async function K1(){let n=await Xr.adapter.stat(zr);if(n&&n.size>Zr.maxFileSize){for(let e=Zr.maxBackups;e>0;e--){let t=`${zr}.${e}`,r=`${zr}.${e+1}`;await Xr.adapter.exists(t)&&(e===Zr.maxBackups?await Xr.adapter.remove(t):await Xr.adapter.rename(t,r))}await Xr.adapter.exists(zr)&&await Xr.adapter.rename(zr,`${zr}.1`),await Xr.adapter.write(zr,"")}}function Y1(n){return`[${n.timestamp}] [${n.level.toUpperCase()}] ${n.message}
    at ${n.callerInfo}`}function J1(n){return new hu.Notice(n.name+`
`+n.message),n}function q1(n){return new hu.Notice(n.name+`:
An error has occurred, please reload Obsidian.`),n}function j1(n){if(typeof n=="object"&&n!==null){let e=new WeakSet;try{return JSON.stringify(n,(t,r)=>{var s;if(typeof r=="object"&&r!==null){if(e.has(r))return"[Circular]";e.add(r)}return typeof t=="string"&&(t.toLowerCase().includes("authorization")||t.toLowerCase().includes("token"))?"[REDACTED]":r instanceof Error?{name:r.name,message:r.message,stack:(s=r.stack)==null?void 0:s.split(`
`).map(o=>o.trim()).join(" ")}:r},2)}catch(t){return t instanceof Error?t instanceof RangeError?`[Complex Object: ${Object.prototype.toString.call(n)}]`:`[Unserializable: ${t.message}]`:"[Unknown Error]"}}return String(n)}function Q(n,e="log"){return(...t)=>{if(vm){let r=new Date().toISOString(),s=new Error().stack,o=s?s.split(`
`)[2].trim():"",i=t.map(j1).join(" "),l=`[${r}] [${e.toUpperCase()}] ${n}: ${i}
    at ${o}`;Zr.disableConsole||console[e](l),bm&&bm(l).catch(c=>console.error("Failed to write log:",c))}}}var G1=!1,mu=G1?J1:q1;var Xn=class extends Error{constructor(e){super(e),this.name="TimeoutError",Object.setPrototypeOf(this,Xn.prototype)}};function Fa(n,e,t){let r,s=new Promise((o,i)=>{r=window.setTimeout(()=>{Q("[Promise]","error")(`[${n}] Timeout on promise`,e),i(new Xn(`[${n}]: Timeout after ${t} ms`))},t)});return Promise.race([e,s]).finally(()=>{clearTimeout(r)})}var Ra=class{constructor(e,t){this.currentPromise=null;this.promiseFunction=e,this.checkFunction=t}getPromise(){let[e,t]=this.checkFunction();return e?Promise.resolve(t):(this.currentPromise||(this.currentPromise=this.promiseFunction().then(r=>(this.currentPromise=null,r),r=>{throw this.currentPromise=null,r})),this.currentPromise)}};var gu=class{constructor(){this.platform="s3rn";this.product="relay"}},yu=class{constructor(e){this.relayId=e;this.platform="s3rn";this.product="relay"}},zt=class{constructor(e,t){this.relayId=e;this.folderId=t;this.platform="s3rn";this.product="relay"}},hr=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.documentId=r;this.platform="s3rn";this.product="relay"}},Sn=class{constructor(e){this.folderId=e;this.platform="s3rn";this.product="relay"}},Zn=class{constructor(e,t){this.folderId=e;this.documentId=t;this.platform="s3rn";this.product="relay"}},Dr=class{static validateUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}static encode(e){let t=`${e.platform}:${e.product}`;if("relayId"in e){if(!this.validateUUID(e.relayId))throw new Error("Invalid relay UUID");t+=`:relay:${e.relayId}`}if("folderId"in e){if(!this.validateUUID(e.folderId))throw new Error("Invalid folder UUID");t+=`:folder:${e.folderId}`}if("documentId"in e){if(!this.validateUUID(e.documentId))throw new Error("Invalid document UUID");t+=`:doc:${e.documentId}`}return t}static decode(e){let t=e.split(":");if(t.length<3)throw new Error("Invalid s3rn format");let[,r,s,o,i,l,c,f]=t;if(!this.validateUUID(o))throw new Error("Invalid UUID");if(l&&!this.validateUUID(l))throw new Error("Invalid UUID");if(f&&!this.validateUUID(f))throw new Error("Invalid UUID");if(r==="relay"&&s==="relay"&&i==="folder"&&c==="doc")return new hr(o,l,f);if(r==="relay"&&s==="relay"&&i=="folder")return new zt(o,l);if(r==="relay"&&s==="folder"&&i==="document")return new Zn(o,l);if(r==="relay"&&s==="folder")return new Sn(o);if(r==="relay"&&s==="relay")return new yu(o);if(s===void 0)return new gu;throw new Error("Invalid s3rn format for the given product type")}};var km=require("obsidian");var z1={3:"disconnected",2:"disconnected",1:"connected",0:"connecting"};function Sm(n,e,t){let r={token:n.token},s=new _m(n.url,n.docId,e,{connect:!1,params:r,disableBc:!0});return t&&s.awareness.setLocalStateField("user",{name:t.name,color:t.color.color,colorLight:t.color.light}),s}var js=class{constructor(e,t,r){this.PROVIDER_MAX_ERRORS=3;this.debug=Q("[HasProvider]","debug");this.log=Q("[HasProvider]","log");this.warn=Q("[HasProvider]","warn");this.error=Q("[HasProvider]","error");var l;this._s3rn=e,this.listeners=new Map,this.loginManager=r,this.ydoc=new Er,this.tokenStore=t,this.clientToken=this.tokenStore.getTokenSync(Dr.encode(this.s3rn))||{token:"",url:"",docId:"-",expiryTime:0};let s=(l=this.loginManager)==null?void 0:l.user;this._provider=Sm(this.clientToken,this.ydoc,s);let o=this.providerConnectionErrorSubscription(c=>{this.log(`[${this.path}] disconnection event`,c);let f=this._provider.url&&this._provider.shouldConnect&&this._provider.wsUnsuccessfulReconnects<this.PROVIDER_MAX_ERRORS;this.disconnect(),f&&this.connect()});o.on(),this._offConnectionError=o.off;let i=this.providerStateSubscription(c=>{this.notifyListeners()});i.on(),this._offState=i.off}get s3rn(){return this._s3rn}set s3rn(e){this._s3rn=e,this.refreshProvider(this.clientToken)}notifyListeners(){this.debug("[Provider State]",this.path,this.state),this.listeners.forEach(e=>{e(this.state)})}subscribe(e,t){return this.listeners.set(e,t),()=>{this.unsubscribe(e)}}unsubscribe(e){this.listeners.delete(e)}async getProviderToken(){this.log("get provider token");let e=this.tokenStore.getToken(Dr.encode(this.s3rn),this.path||"unknown",this.refreshProvider.bind(this));return km.Platform.isIosApp?e:Fa("getProviderToken",e,1e4)}providerActive(){var e;if(this.clientToken){let t=this._provider.url==this.clientToken.url,r=Date.now()>(((e=this.clientToken)==null?void 0:e.expiryTime)||0);return t&&!r}return!1}refreshProvider(e){var o;this.clientToken=e;let t=new Er,r=Sm(e,t),s=r.url;if(this._provider)this._provider.url!==s&&(this._provider.url=s,this._provider.wsUnsuccessfulReconnects=0,this.log(`Token Refreshed: setting new provider url, ${this._provider.url}`),(o=this._provider.ws)==null||o.close());else throw new Error("missing provider!");r.awareness.destroy(),r.destroy(),t.destroy()}get connected(){return this.state.status==="connected"}connect(){return this.connected?Promise.resolve(!0):this.getProviderToken().then(e=>(this.refreshProvider(e),this._provider.connect(),this.notifyListeners(),!0)).catch(e=>!1)}get state(){var e;return{status:z1[((e=this._provider.ws)==null?void 0:e.readyState)||3],intent:this.intent}}get intent(){return this._provider.shouldConnect?"connected":"disconnected"}get synced(){return this._provider.synced}disconnect(){var e;this._provider.shouldConnect=!1,(e=this._provider.ws)==null||e.close(),this._provider.ws=null,this.notifyListeners()}withActiveProvider(){return this.providerActive()?new Promise(e=>{e(this)}):this.getProviderToken().then(e=>this)}onceConnected(){return new Promise(e=>{let t=r=>{r.status==="connected"&&e()};this._provider.on("status",t)})}onceProviderSynced(){var e;return(e=this._provider)!=null&&e.synced?new Promise(t=>{t()}):new Promise(t=>{this._provider.once("synced",t)})}_injectIntent(e){return r=>{e({status:r.status,intent:this.intent})}}providerConnectionErrorSubscription(e){return{on:()=>{this._provider.on("connection-error",e)},off:()=>{this._provider.off("connection-error",e)}}}providerStateSubscription(e){return{on:()=>{this._provider.on("status",this._injectIntent(e))},off:()=>{this._provider.off("status",this._injectIntent(e))}}}destroy(){this._offConnectionError&&this._offConnectionError(),this._offState&&this._offState(),this._provider&&(this._provider.disconnect(),this._provider.awareness.destroy(),this._provider._observers.clear(),this._provider.destroy(),window.clearInterval(this._provider.awareness._checkInterval)),this.loginManager=null}};var kn=class{constructor(e,t,r){this.vault=e;this.contents=r;this.parent=null;this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.stat={ctime:Date.now(),mtime:Date.now(),size:0}}delete(){return Promise.resolve()}rename(e){return this.path=e,this.name=e.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),Promise.resolve()}getBasePath(){return this.path.substring(0,this.path.lastIndexOf("/"))}},Pa=class{constructor(){this.dbName="RelayDiskBuffer";this.storeName="diskBuffers";this.dbPromise=null}async getDB(){return this.dbPromise||(this.dbPromise=this.openDB()),this.dbPromise}async openDB(){return new Promise((e,t)=>{let r=indexedDB.open(this.dbName,1);r.onerror=()=>t(r.error),r.onsuccess=()=>e(r.result),r.onupgradeneeded=s=>{s.target.result.createObjectStore(this.storeName,{keyPath:"guid"})}})}async saveDiskBuffer(e,t){let r=await this.getDB();return new Promise((s,o)=>{try{let c=r.transaction(this.storeName,"readwrite").objectStore(this.storeName).put({guid:e,contents:t});c.onerror=()=>o(c.error),c.onsuccess=()=>s()}catch(i){o(i)}})}async loadDiskBuffer(e){let t=await this.getDB();return new Promise((r,s)=>{try{let l=t.transaction(this.storeName,"readonly").objectStore(this.storeName).get(e);l.onerror=()=>s(l.error),l.onsuccess=()=>r(l.result?l.result.contents:null)}catch(o){s(o)}})}async removeDiskBuffer(e){let t=await this.getDB();return new Promise((r,s)=>{try{let l=t.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(e);l.onerror=()=>s(l.error),l.onsuccess=()=>r()}catch(o){s(o)}})}};var Cn=class extends js{constructor(t,r,s,o){let i=o.relayId?new hr(o.relayId,o.guid,r):new Zn(o.guid,r);super(i,o.tokenStore,s);this.guid=r,this._parent=o,this.path=t,this.name="[CRDT] "+t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault,this.stat={ctime:Date.now(),mtime:Date.now(),size:0},this.offFolderStatusListener=this._parent.subscribe(this.path,l=>{l.intent==="disconnected"&&this.disconnect()}),this.setLoggers(`[SharedDoc](${this.path})`),this._persistence=new Ns(this.guid,this.ydoc),this.ydoc.on("update",(l,c,f)=>{this.updateStats()}),this._tfile=null}setLoggers(t){this.debug=Q(t,"debug"),this.log=Q(t,"log"),this.warn=Q(t,"warn"),this.error=Q(t,"error")}move(t){this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.setLoggers(`[SharedDoc](${this.path})`),this.updateStats()}get parent(){var t;return((t=this.tfile)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}get tfile(){return this._tfile||(this._tfile=this._parent.getTFile(this)),this._tfile}get ytext(){return this.ydoc.getText("contents")}get text(){return this.ytext?this.ytext.toString():""}async diskBuffer(t=!1){if(t||this._diskBuffer===void 0){let r,s=await this._parent.diskBufferStore.loadDiskBuffer(this.guid).catch(o=>null);return s!==null&&s!==""?r=s:r=await this._parent.read(this),this.setDiskBuffer(r)}return this._diskBuffer}setDiskBuffer(t){return this._diskBuffer?this._diskBuffer.contents=t:this._diskBuffer=new kn(this._parent.vault,"local disk",t),this._parent.diskBufferStore.saveDiskBuffer(this.guid,t).catch(r=>{}),this._diskBuffer}async clearDiskBuffer(){this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),await this._parent.diskBufferStore.removeDiskBuffer(this.guid).catch(t=>{})}async checkStale(){await this.whenReady();let t=await this.hasKnownPeers(),r=await this.diskBuffer(!0);if(!t&&this.text.trim()==="")return!1;let s=r.contents,o=this.text.trim()!==s.trim();return o||this.clearDiskBuffer(),o}async connect(){return this.sharedFolder.s3rn instanceof Sn?!1:(this.s3rn instanceof Zn&&(this.sharedFolder.relayId?this.s3rn=new hr(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new Zn(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>super.connect()))}async whenReady(){let t=[];return this._persistence.synced||t.push(this.whenSynced()),this._provider||t.push(this.withActiveProvider()),Promise.all(t).then(r=>this)}whenSynced(){return this._persistence.synced?Promise.resolve():new Promise(t=>{this._persistence.once("synced",t)})}get persistenceSynced(){return this._persistence.synced}hasLocalDB(){return this._persistence._dbsize>3}hasKnownPeers(){return this._hasKnownPeers!==void 0?Promise.resolve(this._hasKnownPeers):this.whenSynced().then(async()=>(await Bs(this._persistence),this._hasKnownPeers=this._persistence._dbsize>3,this.debug("update count",this.path,this._persistence._dbsize),this._hasKnownPeers))}destroy(){this.offFolderStatusListener(),super.destroy(),this.ydoc.destroy(),this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0)}async read(){return this.text}async rename(t){this.move(t)}async delete(){this.destroy()}updateStats(){this.stat.mtime=Date.now(),this.stat.size=this.text.length}async write(t){this.ytext.delete(0,this.ytext.length),this.ytext.insert(0,t),this.updateStats()}async append(t){this.ytext.insert(this.ytext.length,t),this.updateStats()}};var Gs=class{constructor(){this.timeouts=[],this.intervals=[]}getTime(){return Date.now()}setInterval(e,t){let r=window.setInterval(e,t);return this.intervals.push(r),r}clearInterval(e){window.clearInterval(e)}setTimeout(e,t){let r=window.setTimeout(e,t);return this.timeouts.push(r),r}clearTimeout(e){window.clearTimeout(e)}destroy(){for(let e of this.timeouts)this.clearTimeout(e);this.timeouts=[];for(let e of this.intervals)this.clearInterval(e);this.intervals=[]}};var mt=class{constructor(e,t=20){this.timeProvider=e;this.deliveryWindow=t;this.mailboxes=new Map;this.allMailLog=[];this.deliveredMailLog=[];this.isDelivering=!1;this.deliveryInterval=null;this.currentTransactionId=0;this.isInTransaction=!1}static getInstance(){if(this._destroyed)throw new Error("tried to access postie during teardown");return mt.instance||(mt.instance=new mt(new Gs),dr.set(this.instance,"postie")),mt.instance}beginTransaction(){this.isInTransaction=!0,this.currentTransactionId++}commitTransaction(){this.isInTransaction=!1,this.isDelivering||this.scheduleDelivery()}send(e,t,r=!1){let s={sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)};this.allMailLog.push(s),this.mailboxes.has(t)||this.mailboxes.set(t,new Set),this.mailboxes.get(t).add(e),r?this.deliverImmediate(e,t):!this.isInTransaction&&!this.isDelivering&&this.scheduleDelivery()}deliverImmediate(e,t){t(e),this.deliveredMailLog.push({sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)})}scheduleDelivery(){this.isDelivering=!0,this.deliveryInterval=this.timeProvider.setTimeout(()=>{this.deliver(),this.deliveryInterval=null,this.isDelivering=!1,this.mailboxes.size>0&&!this.isInTransaction&&this.scheduleDelivery()},this.deliveryWindow)}deliver(){let e=Q("[postie]","debug");for(let[t,r]of this.mailboxes){for(let s of r)t(s),e("send",s.constructor.name,t),this.deliveredMailLog.push({sender:s,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)});r.clear()}}getAllMailLog(){return[...this.allMailLog]}getDeliveredMailLog(){return[...this.deliveredMailLog]}prettyPrintAllMailLog(){Q("[postie]","warn")("All Mail Log:"),this.prettyPrintMailLog(this.allMailLog)}prettyPrintDeliveredMailLog(){Q("[postie]","warn")("Delivered Mail Log:"),this.prettyPrintMailLog(this.deliveredMailLog)}prettyPrintMailLog(e){let t=Q("[postie]","warn");e.forEach((r,s)=>{t(`Mail #${s+1}:`),t(`  Timestamp: ${new Date(r.timestamp).toISOString()}`),t(`  Transaction ID: ${r.transactionId}`),t(`  Sender: ${r.sender.observableName||r.sender.constructor.name}`),t(`  Recipient: ${r.recipient.name||"Anonymous function"}`),t(`  Recipient Origin: ${r.recipientOrigin||"Unknown"}`),t("---")})}getFunctionOrigin(e){if(e.name)return e.name;let t=e.toString(),r=t.match(/^(function|class)?\s*([^\s(]*)/);if(r&&r[2])return r[2];let s=200,o=t.replace(/\s+/g," ").slice(0,s);return o.length===s&&(o+="..."),`AnonymousFunction(${o})`}static destroy(){mt.instance&&(mt.instance.mailboxes=null,mt.instance.allMailLog=[],mt.instance.deliveredMailLog=[],mt.instance.timeProvider.destroy(),mt.instance.timeProvider=null,mt.instance.isDelivering=!1,mt.instance.isInTransaction=!1,mt.instance.currentTransactionId=0,mt._destroyed=!0,mt.instance=void 0)}},Xt=mt;Xt._destroyed=!1;var wu=new Map;function Cm(){for(let[,n]of wu)n();wu.clear()}var Ut=class{constructor(e){this.observableName=e;let t=Q("[Observable]","warn");wu.set(this,()=>{this._listeners&&this._listeners.size>0&&t(`Missing tear down of ${this._listeners.size} listeners`,this,this._listeners)}),this._listeners=new Set}notifyListeners(){for(let e of this._listeners)Xt.getInstance().send(this,e)}on(e){return this._listeners.add(e),()=>{this.off(e)}}subscribe(e){return this._listeners.add(e),Xt.getInstance().send(this,e,!0),()=>{this.unsubscribe(e)}}off(e){this._listeners.delete(e)}unsubscribe(e){this._listeners.delete(e)}destroy(){this._listeners.clear(),this._listeners=null}};var ri=class extends Ut{constructor(){super();this._set=new Set}add(t){return this._set.add(t),this.notifyListeners(),this}delete(t){let r=this._set.delete(t);return r&&this.notifyListeners(),r}clear(){this._set.clear(),this.notifyListeners()}has(t){return this._set.has(t)}items(){return[...this._set]}get size(){return this._set.size}map(t){return this.items().map(t)}forEach(t){this.items().forEach(t)}find(t){return this.items().find(t)}some(t){for(let r of this._set)if(t(r))return!0;return!1}filter(t){let r=[];for(let s of this._set)t(s)&&r.push(s);return r}};var _u=require("obsidian");var Oa={enableUpdateYDocFromDiskBuffer:!1,enableDownloadOnAddToVault:!1,enableUploadOnShare:!1,enableDocumentStatus:!1,enableNewLinkFormat:!1};function X1(){return new Proxy({},{get:(n,e)=>e})}var Mr=X1();function Rr(n,e,t=()=>{}){Ct.getInstance().flags[n]?e():t()}var Ct=class extends Ut{constructor(){super();this.flags=Oa}static getInstance(){return Ct.instance||(Ct.instance=new Ct),Ct.instance}async setFlags(t,r=!1){let s=Object.keys(this.flags).reduce((o,i)=>(i in t&&(o[i]=t[i]),o),{});this.flags!==s&&(this.flags={...this.flags,...s},r&&this.notifyListeners())}getFlag(t){return this.flags[t]}setFlag(t,r,s=!1){this.flags[t]=r,s&&this.notifyListeners()}static destroy(){Ct.instance=null}};var bu=class extends ri{constructor(){super(...arguments);this.notifyListeners=(0,ut.debounce)(super.notifyListeners,100)}update(){this.notifyListeners()}add(t,r=!0){return this._set.add(t),r&&this.notifyListeners(),this}},Ia=class extends js{constructor(t,r,s,o,i,l,c,f,d,p=!0){let g=d?new zt(d,t):new Sn(t);super(g,l,s);this.backgroundSync=f;this.readyPromise=null;this.unsubscribes=[];this.addLocalDocs=()=>{let t=this.getFiles(),r=[],s=[];t.forEach(i=>{this.checkPath(i.path)&&(this.ids.has(i.path)||s.push(this.getVirtualPath(i.path)))});let o=this.placeHold(s);t.forEach(i=>{if(!this.checkPath(i.path)||!this.checkExtension(i.path)||i instanceof ut.TFolder)return;let l=this.ids.get(this.getVirtualPath(i.path)),c=l&&o.contains(l)||!1,f=p=>{Rr(Mr.enableUploadOnShare,()=>{this.backgroundSync.putDocument(p)})},d=this.createFile(i.path,c,!1,f);r.push(d)}),r.length>0&&this.docset.update()};this.shouldConnect=!0,this.log=Q("[SharedFolder]","log"),this.warn=Q("[SharedFolder]","warn"),this.debug=Q("[SharedFolder]","debug"),this.error=Q("[SharedFolder]","error"),this.guid=t,this.fileManager=i,this.vault=o,this.path=r,this.ids=this.ydoc.getMap("docs"),this.docs=new Map,this.docset=new bu,this.relayManager=c,this._awaitingUpdates=p,this.relayId=d,this.diskBufferStore=new Pa,this.unsubscribes.push(this.relayManager.remoteFolders.subscribe(_=>{this.remote=_.find(y=>y.guid==this.guid)})),this._persistence=new Ns(this.guid,this.ydoc),this._persistence.once("synced",()=>{this.log("",this.ids)}),s.loggedIn&&this.connect(),this.whenReady().then(()=>{this.addLocalDocs()}),this.ydoc.on("update",async(_,y,b)=>{y!=this&&(this.log("file tree",this._debugFileTree()),await this.syncFileTree(b))})}getFiles(){let t=this.vault.getAbstractFileByPath(this.path);if(!(t instanceof ut.TFolder))throw new Error(`Could not find shared folders on file system at ${this.path}`);let r=[];return ut.Vault.recurseChildren(t,s=>{s instanceof ut.TFile&&r.push(s)}),r}connect(){return this.s3rn instanceof zt&&(this.connected||this.shouldConnect)?super.connect():Promise.resolve(!1)}get name(){return this.path.split("/").pop()||""}get location(){return this.path.split("/").slice(0,-1).join("/")}get settings(){return{guid:this.guid,path:this.path,relay:this.relayId}}get remote(){var t;try{(t=this._remote)==null||t.relay}catch(r){return}return this._remote}set remote(t){var r;this._remote!==t&&(this._remote=t,this.relayId=(r=t==null?void 0:t.relay)==null?void 0:r.guid,this.s3rn=this.relayId?new zt(this.relayId,this.guid):new Sn(this.guid),this.notifyListeners())}get ready(){let t=this._persistence.synced,r=this.synced&&this.connected;return t&&(!this._awaitingUpdates||r)}async awaitingUpdates(){return await this.whenSynced(),this._awaitingUpdates&&(await Bs(this._persistence),this.log("update count",this.path,this._persistence._dbsize),this._awaitingUpdates=this._persistence._dbsize<3),this._awaitingUpdates}async whenReady(){let t=async()=>await this.awaitingUpdates()?(await this.onceConnected(),await this.onceProviderSynced(),this):this;return this.readyPromise=this.readyPromise||new Ra(t,()=>[this.ready,this]),this.readyPromise.getPromise()}_debugFileTree(){let t=new Map;return this.ydoc.getMap("docs")._map.forEach((r,s)=>{r.content instanceof ur?t.set(s,r.content.arr[0]):t.set(s,r.content)}),t}whenSynced(){return this._persistence.synced?new Promise(t=>{t()}):new Promise(t=>{this._persistence.once("synced",t)})}toggleConnection(){this.shouldConnect?(this.shouldConnect=!1,this.disconnect()):(this.shouldConnect=!0,this.connect())}get intent(){return this.shouldConnect?"connected":"disconnected"}async _handleServerRename(t,r,s,o){o==null||o.push(`${s.path} was renamed to ${r}`);let i=(0,Zt.dirname)(r);this.existsSync(i)||(await this.mkdir(i),o==null||o.push(`creating directory ${i}`)),this.fileManager.renameFile(s,(0,ut.normalizePath)(this.getPath(r))).then(()=>{t.move(r)})}async _handleServerCreate(t,r){let s=this.createDoc(t,!1,!1),o=Promise.resolve(),i=(0,Zt.dirname)(t);this.existsSync(i)||(o=this.mkdir(i),r==null||r.push(`creating directory ${i}`));let l=_u.moment.now();await s.whenReady();let c=_u.moment.now();return this.debug(`receive delay: received content for ${s.path} after ${c-l}ms`,s.text.toString()),await o,this.flush(s,s.text.toString()),r==null||r.push(`created local file for remotely added doc ${t}`),s}_assertNamespacing(t){try{this.assertPath(this.path+t)}catch(r){this.error("Deleting doc (somehow moved outside of shared folder)",t),this.ids.delete(t);return}}applyRemoteState(t,r,s,o){let i=this.docs.get(t);if(this.existsSync(r))return{op:"noop",path:r,promise:Promise.resolve()};if(s.has(t)&&i){let c=this.getPath(i.path),f=this.vault.getAbstractFileByPath(c);if(f){let d=this._handleServerRename(i,r,f,o);return{op:"rename",path:r,from:c,to:r,promise:d}}}let l=this._handleServerCreate(r,o);return{op:"create",path:r,promise:l}}cleanupExtraLocalFiles(t,r){let s=this.getFiles(),o=[];return s.forEach(i=>{var d,p;let l=this.checkPath(i.path),c=t.contains(i.path.slice(this.path.length)),f=((d=this._provider)==null?void 0:d.synced)&&((p=this._persistence)==null?void 0:p.synced);if(l&&!c&&f){r.push(`deleted local file ${i.path} for remotely deleted doc`);let g=this.vault.adapter.trashLocal(i.path);o.push({op:"delete",path:i.path,promise:g})}}),o}async syncFileTree(t){let r=[],s=t.getMap("docs"),o=[];this.ydoc.transact(()=>{s.forEach((p,g)=>{this._assertNamespacing(g)});let d=new Set(this.ids.values());s.forEach((p,g)=>{this._assertNamespacing(g),r.push(this.applyRemoteState(p,g,d,o))})});let i=r.filter(d=>d.op==="create"),l=r.filter(d=>d.op==="rename"),c=r.map(d=>d.path);await Promise.all([...i,...l].map(d=>d.promise));let f=this.cleanupExtraLocalFiles(c,o);(l.length>0||i.length>0||f.length>0)&&this.docset.update(),this.log(`syncFileTree diff:
`+o.join(`
`))}read(t){let r=(0,Zt.join)(this.path,t.path);return this.vault.adapter.read((0,ut.normalizePath)(r))}existsSync(t){let r=(0,ut.normalizePath)((0,Zt.join)(this.path,t));return this.vault.getAbstractFileByPath(r)!==null}exists(t){let r=(0,Zt.join)(this.path,t.path);return this.vault.adapter.exists((0,ut.normalizePath)(r))}flush(t,r){let s=(0,Zt.join)(this.path,t.path);return this.vault.adapter.write((0,ut.normalizePath)(s),r)}getPath(t){return(0,Zt.join)(this.path,t)}assertPath(t){if(!this.checkPath(t))throw new Error("Path is not in shared folder: "+t)}mkdir(t){let r=(0,Zt.join)(this.path,t);return this.vault.adapter.mkdir((0,ut.normalizePath)(r))}checkPath(t){return t.startsWith(this.path+Zt.sep)}checkExtension(t,r=".md"){return t.endsWith(r)}getVirtualPath(t){return this.assertPath(t),t.slice(this.path.length)}getFile(t,r=!0,s=!1,o=!0){let i=this.getVirtualPath(t);return this.getDoc(i,r,s,o)}getTFile(t){let r=this.vault.getAbstractFileByPath(this.getPath(t.path));return r instanceof ut.TFile?r:null}getDoc(t,r=!0,s=!1,o=!0){let i=this.ids.get(t);if(i!==void 0){let l=this.docs.get(i);return l!==void 0?(l.move(t),l):(this.log("[getDoc]: creating doc for shared ID"),this.createDoc(t,!1,o))}else{if(r)return this.log("[getDoc]: creating new shared ID for existing file"),this.createDoc(t,s,o);throw new Error("No shared doc for vpath: "+t)}}createFile(t,r=!1,s=!0,o=i=>{}){let i=this.getVirtualPath(t);return this.createDoc(i,r,s,o)}placeHold(t){let r=[];return this.ydoc.transact(()=>{t.forEach(s=>{if(!this.ids.has(s)){this.debug("creating entirely new doc for",s);let o=Hs();r.push(o),this.ids.set(s,o)}})},this),r}createDoc(t,r=!1,s=!0,o=i=>{}){!this.synced&&!this.ids.get(t)&&this.warn(`potential for document split at ${t}`);let i=this.ids.get(t),l;if(i===void 0){if(!r)throw new Error("attempting to create a new doc without a local file");l=Hs(),this.ydoc.transact(()=>{this.ids.set(t,l)},this)}else l=i;let c=this.docs.get(l)||new Cn(t,l,this.loginManager,this),f=c.hasKnownPeers(),d=this.awaitingUpdates();return r&&(async()=>{if(!await this.exists(c))return;let[g,_,y]=await Promise.all([this.read(c),f,d]),b=c.ydoc.getText("contents");!y&&!_&&g&&b.toString()!=g&&(this.log(`[${c.path}] No Known Peers: Syncing file into ytext.`),b.insert(0,g),o(c))})(),this.docs.set(l,c),this.docset.add(c,s),c}deleteFile(t){let r=this.getVirtualPath(t);return this.deleteDoc(r)}deleteDoc(t){let r=this.ids.get(t);r&&(this.ydoc.transact(()=>{var o;this.ids.delete(t);let s=(o=this.docs.get(r))==null?void 0:o.destroy();s&&this.docset.delete(s),this.docs.delete(r)},this),this.diskBufferStore.removeDiskBuffer(r))}renameFile(t,r){let s="",o="";try{s=this.getVirtualPath(t)}catch(i){this.log("Moving out of shared folder")}try{o=this.getVirtualPath(r)}catch(i){this.log("Moving in from outside of shared folder")}if(!(!s&&!o))if(!o)this.assertPath(t),this.createDoc(s,!0,!0);else{let i=this.ids.get(o);if(!i)return;let l=this.docs.get(i);if(!s)this.ydoc.transact(()=>{this.ids.delete(o)},this),l&&(l.destroy(),this.docset.delete(l)),this.docs.delete(i);else{let c=this.ids.get(o);if(!c)return;this.ydoc.transact(()=>{this.ids.set(s,c),this.ids.delete(o),l&&l.move(s)},this)}}}destroy(){this.docs.forEach(t=>{t.destroy(),this.docs.delete(t.guid)}),super.destroy(),this.ydoc.destroy(),this.docset.clear(),this.unsubscribes.forEach(t=>{t()}),this.diskBufferStore=null,this.relayManager=null,this.backgroundSync=null,this.loginManager=null,this.tokenStore=null,this.fileManager=null,this.vault=null}},La=class extends ri{constructor(t,r){super();this.relayManager=t;this.update=(0,ut.debounce)(this.notifyListeners,100);this.folderBuilder=r,this._offRemoteUpdates||(this._offRemoteUpdates=this.relayManager.remoteFolders.subscribe(s=>{let o=!1;this.items().forEach(i=>{let l=s.find(c=>c.guid==i.guid);i.remote!=l&&(o=!0),i.remote=l}),o&&this.update()}))}toSettings(){return this.items().map(t=>t.settings)}delete(t){return t==null||t.destroy(),super.delete(t)}lookup(t){let r=this.find(s=>s.checkPath(t));return r||null}destroy(){this.items().forEach(t=>{t.destroy()}),this.clear(),this._offRemoteUpdates&&this._offRemoteUpdates(),this.relayManager=null,this.folderBuilder=null}async _new(t,r,s,o){let i=this.find(d=>d.path==t&&d.guid==r);if(i)return i;let l=this.find(d=>d.guid==r);if(l)throw new Error(`This folder is already mounted at ${l.path}.`);if(this.find(d=>d.path==t))throw new Error("Conflict: Tracked folder exists at this location.");let f=await this.folderBuilder(t,r,s,o);return this._set.add(f),f}async new(t,r,s,o){let i=await this._new(t,r,s,o);return this.notifyListeners(),i}};var Qa=require("@codemirror/state"),Mn=require("obsidian");function Z(){}function Ee(n,e){for(let t in e)n[t]=e[t];return n}function vu(n){return n()}function $a(){return Object.create(null)}function Te(n){n.forEach(vu)}function et(n){return typeof n=="function"}function te(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}function Em(n){return Object.keys(n).length===0}function Et(n,...e){if(n==null){for(let r of e)r(void 0);return Z}let t=n.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function Fe(n,e,t){n.$$.on_destroy.push(Et(e,t))}function He(n,e,t,r){if(n){let s=Tm(n,e,t,r);return n[0](s)}}function Tm(n,e,t,r){return n[1]&&r?Ee(t.ctx.slice(),n[1](r(e))):t.ctx}function Ve(n,e,t,r){if(n[2]&&r){let s=n[2](r(t));if(e.dirty===void 0)return s;if(typeof s=="object"){let o=[],i=Math.max(e.dirty.length,s.length);for(let l=0;l<i;l+=1)o[l]=e.dirty[l]|s[l];return o}return e.dirty|s}return e.dirty}function We(n,e,t,r,s,o){if(s){let i=Tm(e,t,r,o);n.p(i,s)}}function Ke(n){if(n.ctx.length>32){let e=[],t=n.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function Ge(n){let e={};for(let t in n)t[0]!=="$"&&(e[t]=n[t]);return e}function xu(n,e){let t={};e=new Set(e);for(let r in n)!e.has(r)&&r[0]!=="$"&&(t[r]=n[r]);return t}function zs(n){return n==null?"":n}function ni(n,e,t){return n.set(t),e}var Su=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;var Xs=class{constructor(e){it(this,"_listeners","WeakMap"in Su?new WeakMap:void 0);it(this,"_observer");it(this,"options");this.options=e}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return(e=this._observer)!=null?e:this._observer=new ResizeObserver(t=>{var r;for(let s of t)Xs.entries.set(s.target,s),(r=this._listeners.get(s.target))==null||r(s)})}};Xs.entries="WeakMap"in Su?new WeakMap:void 0;var Am=!1;function Dm(){Am=!0}function Mm(){Am=!1}function J(n,e){n.appendChild(e)}function tt(n,e,t){let r=Rm(n);if(!r.getElementById(e)){let s=L("style");s.id=e,s.textContent=t,eS(r,s)}}function Rm(n){if(!n)return document;let e=n.getRootNode?n.getRootNode():n.ownerDocument;return e&&e.host?e:n.ownerDocument}function eS(n,e){return J(n.head||n,e),e.sheet}function T(n,e,t){n.insertBefore(e,t||null)}function E(n){n.parentNode&&n.parentNode.removeChild(n)}function Qt(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function L(n){return document.createElement(n)}function ku(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function ae(n){return document.createTextNode(n)}function q(){return ae(" ")}function $e(){return ae("")}function re(n,e,t,r){return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t,r)}function A(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function si(n,e){for(let t in e)A(n,t,e[t])}function Fm(n){return Array.from(n.childNodes)}function we(n,e){e=""+e,n.data!==e&&(n.data=e)}function er(n,e){n.value=e==null?"":e}function bt(n,e,t,r){t==null?n.style.removeProperty(e):n.style.setProperty(e,t,r?"important":"")}function Cu(n,e,t){n.classList.toggle(e,!!t)}function Ua(n,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(n,{detail:e,bubbles:t,cancelable:r})}function Pm(n){let e={};return n.childNodes.forEach(t=>{e[t.slot||"default"]=!0}),e}var En;function Qr(n){En=n}function Na(){if(!En)throw new Error("Function called outside component initialization");return En}function pr(n){Na().$$.on_mount.push(n)}function Eu(n){Na().$$.on_destroy.push(n)}function mr(){let n=Na();return(e,t,{cancelable:r=!1}={})=>{let s=n.$$.callbacks[e];if(s){let o=Ua(e,t,{cancelable:r});return s.slice().forEach(i=>{i.call(n,o)}),!o.defaultPrevented}return!0}}var Qn=[];var eo=[],Qs=[],Om=[],iS=Promise.resolve(),Au=!1;function Im(){Au||(Au=!0,iS.then(Ba))}function oi(n){Qs.push(n)}var Tu=new Set,Zs=0;function Ba(){if(Zs!==0)return;let n=En;do{try{for(;Zs<Qn.length;){let e=Qn[Zs];Zs++,Qr(e),aS(e.$$)}}catch(e){throw Qn.length=0,Zs=0,e}for(Qr(null),Qn.length=0,Zs=0;eo.length;)eo.pop()();for(let e=0;e<Qs.length;e+=1){let t=Qs[e];Tu.has(t)||(Tu.add(t),t())}Qs.length=0}while(Qn.length);for(;Om.length;)Om.pop()();Au=!1,Tu.clear(),Qr(n)}function aS(n){if(n.fragment!==null){n.update(),Te(n.before_update);let e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(oi)}}function Lm(n){let e=[],t=[];Qs.forEach(r=>n.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),Qs=e}var Ha=new Set,es;function xe(){es={r:0,c:[],p:es}}function Se(){es.r||Te(es.c),es=es.p}function k(n,e){n&&n.i&&(Ha.delete(n),n.i(e))}function D(n,e,t,r){if(n&&n.o){if(Ha.has(n))return;Ha.add(n),es.c.push(()=>{Ha.delete(n),r&&(t&&n.d(1),r())}),n.o(e)}else r&&r()}function ze(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}function Tt(n,e){let t={},r={},s={$$scope:1},o=n.length;for(;o--;){let i=n[o],l=e[o];if(l){for(let c in i)c in l||(r[c]=1);for(let c in l)s[c]||(t[c]=l[c],s[c]=1);n[o]=l}else for(let c in i)s[c]=1}for(let i in r)i in t||(t[i]=void 0);return t}function tr(n){return typeof n=="object"&&n!==null?n:{}}var lS=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],cS=new Set([...lS]);function H(n){n&&n.c()}function N(n,e,t){let{fragment:r,after_update:s}=n.$$;r&&r.m(e,t),oi(()=>{let o=n.$$.on_mount.map(vu).filter(et);n.$$.on_destroy?n.$$.on_destroy.push(...o):Te(o),n.$$.on_mount=[]}),s.forEach(oi)}function B(n,e){let t=n.$$;t.fragment!==null&&(Lm(t.after_update),Te(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function fS(n,e){n.$$.dirty[0]===-1&&(Qn.push(n),Im(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function ie(n,e,t,r,s,o,i=null,l=[-1]){let c=En;Qr(n);let f=n.$$={fragment:null,ctx:[],props:o,update:Z,not_equal:s,bound:$a(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(c?c.$$.context:[])),callbacks:$a(),dirty:l,skip_bound:!1,root:e.target||c.$$.root};i&&i(f.root);let d=!1;if(f.ctx=t?t(n,e.props||{},(p,g,..._)=>{let y=_.length?_[0]:g;return f.ctx&&s(f.ctx[p],f.ctx[p]=y)&&(!f.skip_bound&&f.bound[p]&&f.bound[p](y),d&&fS(n,p)),g}):[],f.update(),d=!0,Te(f.before_update),f.fragment=r?r(f.ctx):!1,e.target){if(e.hydrate){Dm();let p=Fm(e.target);f.fragment&&f.fragment.l(p),p.forEach(E)}else f.fragment&&f.fragment.c();e.intro&&k(n.$$.fragment),N(n,e.target,e.anchor),Mm(),Ba()}Qr(c)}var dS;typeof HTMLElement=="function"&&(dS=class extends HTMLElement{constructor(e,t,r){super();it(this,"$$ctor");it(this,"$$s");it(this,"$$c");it(this,"$$cn",!1);it(this,"$$d",{});it(this,"$$r",!1);it(this,"$$p_d",{});it(this,"$$l",{});it(this,"$$l_u",new Map);this.$$ctor=e,this.$$s=t,r&&this.attachShadow({mode:"open"})}addEventListener(e,t,r){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){let s=this.$$c.$on(e,t);this.$$l_u.set(t,s)}super.addEventListener(e,t,r)}removeEventListener(e,t,r){if(super.removeEventListener(e,t,r),this.$$c){let s=this.$$l_u.get(t);s&&(s(),this.$$l_u.delete(t))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let e=function(o){return()=>{let i;return{c:function(){i=L("slot"),o!=="default"&&A(i,"name",o)},m:function(f,d){T(f,i,d)},d:function(f){f&&E(i)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let t={},r=Pm(this);for(let o of this.$$s)o in r&&(t[o]=[e(o)]);for(let o of this.attributes){let i=this.$$g_p(o.name);i in this.$$d||(this.$$d[i]=Du(i,o.value,this.$$p_d,"toProp"))}for(let o in this.$$p_d)!(o in this.$$d)&&this[o]!==void 0&&(this.$$d[o]=this[o],delete this[o]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});let s=()=>{this.$$r=!0;for(let o in this.$$p_d)if(this.$$d[o]=this.$$c.$$.ctx[this.$$c.$$.props[o]],this.$$p_d[o].reflect){let i=Du(o,this.$$d[o],this.$$p_d,"toAttribute");i==null?this.removeAttribute(this.$$p_d[o].attribute||o):this.setAttribute(this.$$p_d[o].attribute||o,i)}this.$$r=!1};this.$$c.$$.after_update.push(s),s();for(let o in this.$$l)for(let i of this.$$l[o]){let l=this.$$c.$on(o,i);this.$$l_u.set(i,l)}this.$$l={}}}attributeChangedCallback(e,t,r){var s;this.$$r||(e=this.$$g_p(e),this.$$d[e]=Du(e,r,this.$$p_d,"toProp"),(s=this.$$c)==null||s.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(e){return Object.keys(this.$$p_d).find(t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e)||e}});function Du(n,e,t,r){var o;let s=(o=t[n])==null?void 0:o.type;if(e=s==="Boolean"&&typeof e!="boolean"?e!=null:e,!r||!t[n])return e;if(r==="toAttribute")switch(s){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e==null?null:e;default:return e}else switch(s){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var ne=class{constructor(){it(this,"$$");it(this,"$$set")}$destroy(){B(this,1),this.$destroy=Z}$on(e,t){if(!et(t))return Z;let r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{let s=r.indexOf(t);s!==-1&&r.splice(s,1)}}$set(e){this.$$set&&!Em(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var $m="4";typeof window!="undefined"&&(window.__svelte||(window.__svelte={v:new Set})).v.add($m);var hS={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},Mu=hS;function Um(n,e,t){let r=n.slice();return r[11]=e[t][0],r[12]=e[t][1],r}function Ru(n){let e,t=[n[12]],r={};for(let s=0;s<t.length;s+=1)r=Ee(r,t[s]);return{c(){e=ku(n[11]),si(e,r)},m(s,o){T(s,e,o)},p(s,o){si(e,r=Tt(t,[o&32&&s[12]]))},d(s){s&&E(e)}}}function Nm(n){let e=n[11],t,r=n[11]&&Ru(n);return{c(){r&&r.c(),t=$e()},m(s,o){r&&r.m(s,o),T(s,t,o)},p(s,o){s[11]?e?te(e,s[11])?(r.d(1),r=Ru(s),e=s[11],r.c(),r.m(t.parentNode,t)):r.p(s,o):(r=Ru(s),e=s[11],r.c(),r.m(t.parentNode,t)):e&&(r.d(1),r=null,e=s[11])},d(s){s&&E(t),r&&r.d(s)}}}function pS(n){let e,t,r,s,o,i=ze(n[5]),l=[];for(let g=0;g<i.length;g+=1)l[g]=Nm(Um(n,i,g));let c=n[10].default,f=He(c,n,n[9],null),d=[Mu,n[7],{width:n[2]},{height:n[2]},{stroke:n[1]},{"stroke-width":r=n[4]?Number(n[3])*24/Number(n[2]):n[3]},{class:s=n[6]("lucide-icon","lucide",n[0]?`lucide-${n[0]}`:"",n[8].class)}],p={};for(let g=0;g<d.length;g+=1)p=Ee(p,d[g]);return{c(){e=ku("svg");for(let g=0;g<l.length;g+=1)l[g].c();t=$e(),f&&f.c(),si(e,p)},m(g,_){T(g,e,_);for(let y=0;y<l.length;y+=1)l[y]&&l[y].m(e,null);J(e,t),f&&f.m(e,null),o=!0},p(g,[_]){if(_&32){i=ze(g[5]);let y;for(y=0;y<i.length;y+=1){let b=Um(g,i,y);l[y]?l[y].p(b,_):(l[y]=Nm(b),l[y].c(),l[y].m(e,t))}for(;y<l.length;y+=1)l[y].d(1);l.length=i.length}f&&f.p&&(!o||_&512)&&We(f,c,g,g[9],o?Ve(c,g[9],_,null):Ke(g[9]),null),si(e,p=Tt(d,[Mu,_&128&&g[7],(!o||_&4)&&{width:g[2]},(!o||_&4)&&{height:g[2]},(!o||_&2)&&{stroke:g[1]},(!o||_&28&&r!==(r=g[4]?Number(g[3])*24/Number(g[2]):g[3]))&&{"stroke-width":r},(!o||_&257&&s!==(s=g[6]("lucide-icon","lucide",g[0]?`lucide-${g[0]}`:"",g[8].class)))&&{class:s}]))},i(g){o||(k(f,g),o=!0)},o(g){D(f,g),o=!1},d(g){g&&E(e),Qt(l,g),f&&f.d(g)}}}function mS(n,e,t){let r=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode","mergeClasses"],s=xu(e,r),{$$slots:o={},$$scope:i}=e,{name:l=void 0}=e,{color:c="currentColor"}=e,{size:f=24}=e,{strokeWidth:d=2}=e,{absoluteStrokeWidth:p=!1}=e,{iconNode:g}=e,_=(...y)=>y.filter((b,C,x)=>Boolean(b)&&x.indexOf(b)===C).join(" ");return n.$$set=y=>{t(8,e=Ee(Ee({},e),Ge(y))),t(7,s=xu(e,r)),"name"in y&&t(0,l=y.name),"color"in y&&t(1,c=y.color),"size"in y&&t(2,f=y.size),"strokeWidth"in y&&t(3,d=y.strokeWidth),"absoluteStrokeWidth"in y&&t(4,p=y.absoluteStrokeWidth),"iconNode"in y&&t(5,g=y.iconNode),"$$scope"in y&&t(9,i=y.$$scope)},e=Ge(e),[l,c,f,d,p,g,_,s,e,i,o]}var Fu=class extends ne{constructor(e){super(),ie(this,e,mS,pS,te,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5,mergeClasses:6})}get mergeClasses(){return this.$$.ctx[6]}},rr=Fu;function gS(n){let e,t=n[2].default,r=He(t,n,n[3],null);return{c(){r&&r.c()},m(s,o){r&&r.m(s,o),e=!0},p(s,o){r&&r.p&&(!e||o&8)&&We(r,t,s,s[3],e?Ve(t,s[3],o,null):Ke(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){D(r,s),e=!1},d(s){r&&r.d(s)}}}function yS(n){let e,t,r=[{name:"arrow-right-left"},n[1],{iconNode:n[0]}],s={$$slots:{default:[gS]},$$scope:{ctx:n}};for(let o=0;o<r.length;o+=1)s=Ee(s,r[o]);return e=new rr({props:s}),{c(){H(e.$$.fragment)},m(o,i){N(e,o,i),t=!0},p(o,[i]){let l=i&3?Tt(r,[r[0],i&2&&tr(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(l.$$scope={dirty:i,ctx:o}),e.$set(l)},i(o){t||(k(e.$$.fragment,o),t=!0)},o(o){D(e.$$.fragment,o),t=!1},d(o){B(e,o)}}}function wS(n,e,t){let{$$slots:r={},$$scope:s}=e,o=[["path",{d:"m16 3 4 4-4 4"}],["path",{d:"M20 7H4"}],["path",{d:"m8 21-4-4 4-4"}],["path",{d:"M4 17h16"}]];return n.$$set=i=>{t(1,e=Ee(Ee({},e),Ge(i))),"$$scope"in i&&t(3,s=i.$$scope)},e=Ge(e),[o,e,r,s]}var Pu=class extends ne{constructor(e){super(),ie(this,e,wS,yS,te,{})}},Ou=Pu;function _S(n){let e,t=n[2].default,r=He(t,n,n[3],null);return{c(){r&&r.c()},m(s,o){r&&r.m(s,o),e=!0},p(s,o){r&&r.p&&(!e||o&8)&&We(r,t,s,s[3],e?Ve(t,s[3],o,null):Ke(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){D(r,s),e=!1},d(s){r&&r.d(s)}}}function bS(n){let e,t,r=[{name:"chevron-left"},n[1],{iconNode:n[0]}],s={$$slots:{default:[_S]},$$scope:{ctx:n}};for(let o=0;o<r.length;o+=1)s=Ee(s,r[o]);return e=new rr({props:s}),{c(){H(e.$$.fragment)},m(o,i){N(e,o,i),t=!0},p(o,[i]){let l=i&3?Tt(r,[r[0],i&2&&tr(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(l.$$scope={dirty:i,ctx:o}),e.$set(l)},i(o){t||(k(e.$$.fragment,o),t=!0)},o(o){D(e.$$.fragment,o),t=!1},d(o){B(e,o)}}}function vS(n,e,t){let{$$slots:r={},$$scope:s}=e,o=[["path",{d:"m15 18-6-6 6-6"}]];return n.$$set=i=>{t(1,e=Ee(Ee({},e),Ge(i))),"$$scope"in i&&t(3,s=i.$$scope)},e=Ge(e),[o,e,r,s]}var Iu=class extends ne{constructor(e){super(),ie(this,e,vS,bS,te,{})}},Lu=Iu;function xS(n){let e,t=n[2].default,r=He(t,n,n[3],null);return{c(){r&&r.c()},m(s,o){r&&r.m(s,o),e=!0},p(s,o){r&&r.p&&(!e||o&8)&&We(r,t,s,s[3],e?Ve(t,s[3],o,null):Ke(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){D(r,s),e=!1},d(s){r&&r.d(s)}}}function SS(n){let e,t,r=[{name:"folder"},n[1],{iconNode:n[0]}],s={$$slots:{default:[xS]},$$scope:{ctx:n}};for(let o=0;o<r.length;o+=1)s=Ee(s,r[o]);return e=new rr({props:s}),{c(){H(e.$$.fragment)},m(o,i){N(e,o,i),t=!0},p(o,[i]){let l=i&3?Tt(r,[r[0],i&2&&tr(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(l.$$scope={dirty:i,ctx:o}),e.$set(l)},i(o){t||(k(e.$$.fragment,o),t=!0)},o(o){D(e.$$.fragment,o),t=!1},d(o){B(e,o)}}}function kS(n,e,t){let{$$slots:r={},$$scope:s}=e,o=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"}]];return n.$$set=i=>{t(1,e=Ee(Ee({},e),Ge(i))),"$$scope"in i&&t(3,s=i.$$scope)},e=Ge(e),[o,e,r,s]}var $u=class extends ne{constructor(e){super(),ie(this,e,kS,SS,te,{})}},ii=$u;function CS(n){let e,t=n[2].default,r=He(t,n,n[3],null);return{c(){r&&r.c()},m(s,o){r&&r.m(s,o),e=!0},p(s,o){r&&r.p&&(!e||o&8)&&We(r,t,s,s[3],e?Ve(t,s[3],o,null):Ke(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){D(r,s),e=!1},d(s){r&&r.d(s)}}}function ES(n){let e,t,r=[{name:"layers"},n[1],{iconNode:n[0]}],s={$$slots:{default:[CS]},$$scope:{ctx:n}};for(let o=0;o<r.length;o+=1)s=Ee(s,r[o]);return e=new rr({props:s}),{c(){H(e.$$.fragment)},m(o,i){N(e,o,i),t=!0},p(o,[i]){let l=i&3?Tt(r,[r[0],i&2&&tr(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(l.$$scope={dirty:i,ctx:o}),e.$set(l)},i(o){t||(k(e.$$.fragment,o),t=!0)},o(o){D(e.$$.fragment,o),t=!1},d(o){B(e,o)}}}function TS(n,e,t){let{$$slots:r={},$$scope:s}=e,o=[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"}]];return n.$$set=i=>{t(1,e=Ee(Ee({},e),Ge(i))),"$$scope"in i&&t(3,s=i.$$scope)},e=Ge(e),[o,e,r,s]}var Uu=class extends ne{constructor(e){super(),ie(this,e,TS,ES,te,{})}},en=Uu;function AS(n){let e,t=n[2].default,r=He(t,n,n[3],null);return{c(){r&&r.c()},m(s,o){r&&r.m(s,o),e=!0},p(s,o){r&&r.p&&(!e||o&8)&&We(r,t,s,s[3],e?Ve(t,s[3],o,null):Ke(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){D(r,s),e=!1},d(s){r&&r.d(s)}}}function DS(n){let e,t,r=[{name:"satellite"},n[1],{iconNode:n[0]}],s={$$slots:{default:[AS]},$$scope:{ctx:n}};for(let o=0;o<r.length;o+=1)s=Ee(s,r[o]);return e=new rr({props:s}),{c(){H(e.$$.fragment)},m(o,i){N(e,o,i),t=!0},p(o,[i]){let l=i&3?Tt(r,[r[0],i&2&&tr(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(l.$$scope={dirty:i,ctx:o}),e.$set(l)},i(o){t||(k(e.$$.fragment,o),t=!0)},o(o){D(e.$$.fragment,o),t=!1},d(o){B(e,o)}}}function MS(n,e,t){let{$$slots:r={},$$scope:s}=e,o=[["path",{d:"M13 7 9 3 5 7l4 4"}],["path",{d:"m17 11 4 4-4 4-4-4"}],["path",{d:"m8 12 4 4 6-6-4-4Z"}],["path",{d:"m16 8 3-3"}],["path",{d:"M9 21a6 6 0 0 0-6-6"}]];return n.$$set=i=>{t(1,e=Ee(Ee({},e),Ge(i))),"$$scope"in i&&t(3,s=i.$$scope)},e=Ge(e),[o,e,r,s]}var Nu=class extends ne{constructor(e){super(),ie(this,e,MS,DS,te,{})}},gr=Nu;function RS(n){let e,t=n[2].default,r=He(t,n,n[3],null);return{c(){r&&r.c()},m(s,o){r&&r.m(s,o),e=!0},p(s,o){r&&r.p&&(!e||o&8)&&We(r,t,s,s[3],e?Ve(t,s[3],o,null):Ke(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){D(r,s),e=!1},d(s){r&&r.d(s)}}}function FS(n){let e,t,r=[{name:"settings"},n[1],{iconNode:n[0]}],s={$$slots:{default:[RS]},$$scope:{ctx:n}};for(let o=0;o<r.length;o+=1)s=Ee(s,r[o]);return e=new rr({props:s}),{c(){H(e.$$.fragment)},m(o,i){N(e,o,i),t=!0},p(o,[i]){let l=i&3?Tt(r,[r[0],i&2&&tr(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(l.$$scope={dirty:i,ctx:o}),e.$set(l)},i(o){t||(k(e.$$.fragment,o),t=!0)},o(o){D(e.$$.fragment,o),t=!1},d(o){B(e,o)}}}function PS(n,e,t){let{$$slots:r={},$$scope:s}=e,o=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]];return n.$$set=i=>{t(1,e=Ee(Ee({},e),Ge(i))),"$$scope"in i&&t(3,s=i.$$scope)},e=Ge(e),[o,e,r,s]}var Bu=class extends ne{constructor(e){super(),ie(this,e,PS,FS,te,{})}},Hu=Bu;function OS(n){tt(n,"svelte-1gxdage","button.notebook.svelte-1gxdage{color:var(--color-base-30);background-color:transparent}button.notebook-synced.svelte-1gxdage{color:var(--color-accent)}button.system3-connected.svelte-1gxdage{color:var(--color-accent)}button.system3-disconnected.svelte-1gxdage{color:var(--color-base-40)}")}function IS(n){let e,t,r,s,o,i;return t=new en({props:{class:"svg-icon inline-icon"}}),{c(){var l;e=L("button"),H(t.$$.fragment),A(e,"class",r="clickable-icon view-action system3-view-action "+(n[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),A(e,"aria-label",s=n[0].tracking?"Tracking Changes":"Database Corrupted. Connect to Relay servers to resolve."),A(e,"tabindex","0"),A(e,"data-filename",o=(l=n[0].view.file)==null?void 0:l.name)},m(l,c){T(l,e,c),N(t,e,null),i=!0},p(l,c){var f;(!i||c&1&&r!==(r="clickable-icon view-action system3-view-action "+(l[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&A(e,"class",r),(!i||c&1&&s!==(s=l[0].tracking?"Tracking Changes":"Database Corrupted. Connect to Relay servers to resolve."))&&A(e,"aria-label",s),(!i||c&1&&o!==(o=(f=l[0].view.file)==null?void 0:f.name))&&A(e,"data-filename",o)},i(l){i||(k(t.$$.fragment,l),i=!0)},o(l){D(t.$$.fragment,l),i=!1},d(l){l&&E(e),B(t)}}}function LS(n){let e,t,r,s,o,i,l,c,f,d,p,g,_;return t=new en({props:{class:"svg-icon inline-icon"}}),c=new gr({props:{class:"svg-icon inline-icon"}}),{c(){var y;e=L("button"),H(t.$$.fragment),i=q(),l=L("button"),H(c.$$.fragment),A(e,"class",r="clickable-icon view-action system3-view-action "+(n[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),A(e,"aria-label",s=n[0].tracking?"Tracking Changes":"Database Corrupted. Connect to Relay servers to resolve."),A(e,"tabindex","0"),A(e,"data-filename",o=(y=n[0].view.file)==null?void 0:y.name),A(l,"class",f="system3-"+n[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"),A(l,"aria-label",d=`${n[2].relay.name} (${n[1].status})`),A(l,"tabindex","0")},m(y,b){T(y,e,b),N(t,e,null),T(y,i,b),T(y,l,b),N(c,l,null),p=!0,g||(_=[re(l,"click",n[3]),re(l,"keypress",n[4])],g=!0)},p(y,b){var C;(!p||b&1&&r!==(r="clickable-icon view-action system3-view-action "+(y[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&A(e,"class",r),(!p||b&1&&s!==(s=y[0].tracking?"Tracking Changes":"Database Corrupted. Connect to Relay servers to resolve."))&&A(e,"aria-label",s),(!p||b&1&&o!==(o=(C=y[0].view.file)==null?void 0:C.name))&&A(e,"data-filename",o),(!p||b&2&&f!==(f="system3-"+y[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"))&&A(l,"class",f),(!p||b&6&&d!==(d=`${y[2].relay.name} (${y[1].status})`))&&A(l,"aria-label",d)},i(y){p||(k(t.$$.fragment,y),k(c.$$.fragment,y),p=!0)},o(y){D(t.$$.fragment,y),D(c.$$.fragment,y),p=!1},d(y){y&&(E(e),E(i),E(l)),B(t),B(c),g=!1,Te(_)}}}function $S(n){let e,t,r,s,o=[LS,IS],i=[];function l(c,f){return c[2]?0:1}return e=l(n,-1),t=i[e]=o[e](n),{c(){t.c(),r=$e()},m(c,f){i[e].m(c,f),T(c,r,f),s=!0},p(c,[f]){let d=e;e=l(c,f),e===d?i[e].p(c,f):(xe(),D(i[d],1,1,()=>{i[d]=null}),Se(),t=i[e],t?t.p(c,f):(t=i[e]=o[e](c),t.c()),k(t,1),t.m(r.parentNode,r))},i(c){s||(k(t),s=!0)},o(c){D(t),s=!1},d(c){c&&E(r),i[e].d(c)}}}function US(n,e,t){let{view:r}=e,{state:s}=e,{remote:o}=e,i={connected:"connected: click to go offline",connecting:"connecting...",disconnected:"disconnected: click to go online",unknown:"unknown status"},l=()=>{r.toggleConnection()},c=f=>{f.key==="Enter"&&l()};return n.$$set=f=>{"view"in f&&t(0,r=f.view),"state"in f&&t(1,s=f.state),"remote"in f&&t(2,o=f.remote)},[r,s,o,l,c]}var Vu=class extends ne{constructor(e){super(),ie(this,e,US,$S,te,{view:0,state:1,remote:2},OS)}},Bm=Vu;var to=class{constructor(e,t,r){this.view=e,this.text=t,this.onClick=r,this.display()}display(){let e=this.view.containerEl,t=this.view.containerEl.querySelector(".view-content");if(!e)return;let r=e.querySelector(".bannerBox");r||(r=document.createElement("div"),r.classList.add("bannerBox"),e.insertBefore(r,t));let s=e.querySelector(".banner");if(!s){s=document.createElement("div"),s.classList.add("banner");let o=s.createSpan();o.setText(this.text),s.appendChild(o),r.appendChild(s);let i=async()=>{await this.onClick()&&this.destroy()};s.addEventListener("click",i)}return!0}destroy(){let e=this.view.containerEl;if(!e)return;let t=e.querySelector(".bannerBox");return t&&t.replaceChildren(),!0}};var Va=require("@codemirror/state"),Hm=require("@codemirror/view");var rR=Va.Facet.define({combine(n){return n[n.length-1]}}),Wu=Va.Annotation.define(),Ku=class{constructor(e){this.initialSet=!1;this.log=e=>{};var t,r;this.editor=e,this.connectionManager=this.editor.state.field(Tn),this.view=(t=this.connectionManager)==null?void 0:t.findView(e),this.view&&(this.log=Q(`[LiveCMPluginValue][${(r=this.view.view.file)==null?void 0:r.path}]`),this.log("created"),this.view.document&&(this.view.document.whenSynced().then(async()=>{ro(this.view)&&!this.view.tracking&&this.editor.dispatch({changes:await this.getKeyFrame(),annotations:[Wu.of(this)]})}),this._observer=async(s,o)=>{if(!ro(this.view)){this.log("Recived yjs event against a non-live view");return}if(o.origin!==this){let i=s.delta,l=[],c=0;for(let f=0;f<i.length;f++){let d=i[f];d.insert!=null?l.push({from:c,to:c,insert:d.insert}):d.delete!=null?(l.push({from:c,to:c+d.delete,insert:""}),c+=d.delete):d.retain!=null&&(c+=d.retain)}this.view.tracking?this.log("dispatch (incremental)"):(l=await this.getKeyFrame(),this.log("dispatch (full)")),e.dispatch({changes:l,annotations:[Wu.of(this)]}),this.view.tracking=!0}},this.observer=(s,o)=>{var i,l;try{(i=this._observer)==null||i.call(this,s,o)}catch(c){c instanceof RangeError&&ro(this.view)&&(this.view.tracking=!1,(l=this._observer)==null||l.call(this,s,o))}},this._ytext=this.view.document.ytext,this._ytext.observe(this.observer)))}getBufferChange(e){return{from:0,to:this.editor.state.doc.length,insert:e}}async getKeyFrame(){if(!ro(this.view))return[];let e=this.editor.state.doc.toString();return this.view.document.text===e?(this.view.tracking=!0,[]):(this.log("ytext and editor buffer need syncing"),!this.view.document.hasLocalDB()&&this.view.document.text===""?(this.log("local db missing, not setting buffer"),[]):(this.view.tracking||await this.view.checkStale(),ro(this.view)?[this.getBufferChange(this.view.document.text)]:[]))}update(e){var s,o,i,l;if(!e.docChanged||e.transactions.length>0&&e.transactions[0].annotation(Wu)===this)return;let t=e.view;this.view=(s=this.connectionManager)==null?void 0:s.findView(t);let r=(i=(o=this.view)==null?void 0:o.document)==null?void 0:i.ytext;r&&((l=r.doc)==null||l.transact(()=>{let c=0;e.changes.iterChanges((f,d,p,g,_)=>{let y=_.sliceString(0,_.length,`
`);f!==d&&r.delete(f+c,d-f),y.length>0&&r.insert(f+c,y),c+=y.length-(d-f)})},this))}destroy(){var e;this.observer&&((e=this._ytext)==null||e.unobserve(this.observer)),this.connectionManager=null,this.view=void 0,this._ytext=void 0,this.editor=null}},Vm=Hm.ViewPlugin.fromClass(Ku);var Wa=require("@codemirror/state"),Ot=require("@codemirror/view");var Wm=Ot.EditorView.baseTheme({".cm-ySelection":{},".cm-yLineSelection":{padding:0,margin:"0px 2px 0px 4px"},".cm-ySelectionCaret":{position:"relative",borderLeft:"1px solid black",borderRight:"1px solid black",marginLeft:"-1px",marginRight:"-1px",boxSizing:"border-box",display:"inline"},".cm-ySelectionCaretDot":{borderRadius:"50%",position:"absolute",width:".4em",height:".4em",top:"-.2em",left:"-.2em",backgroundColor:"inherit",transition:"transform .3s ease-in-out",boxSizing:"border-box"},".cm-ySelectionCaret:hover > .cm-ySelectionCaretDot":{transformOrigin:"bottom center",transform:"scale(0)"},".cm-ySelectionInfo":{position:"absolute",top:"-1.05em",left:"-1px",fontSize:".75em",fontFamily:"serif",fontStyle:"normal",fontWeight:"normal",lineHeight:"normal",userSelect:"none",color:"white",paddingLeft:"2px",paddingRight:"2px",zIndex:101,transition:"opacity .3s ease-in-out",backgroundColor:"inherit",opacity:0,transitionDelay:"0s",whiteSpace:"nowrap"},".cm-ySelectionCaret:hover > .cm-ySelectionInfo":{opacity:1,transitionDelay:"0s"}}),NS=Wa.Annotation.define(),Yu=class extends Ot.WidgetType{constructor(t,r){super();this.color=t,this.name=r}toDOM(t){return Bo("span",[St("class","cm-ySelectionCaret"),St("style",`background-color: ${this.color}; border-color: ${this.color}`)],[Ds("\u2060"),Bo("div",[St("class","cm-ySelectionCaretDot")]),Ds("\u2060"),Bo("div",[St("class","cm-ySelectionInfo")],[Ds(this.name)]),Ds("\u2060")])}eq(t){return t.color===this.color}compare(t){return t.color===this.color}updateDOM(){return!1}get estimatedHeight(){return-1}ignoreEvent(){return!0}},Ju=class{constructor(e){var r,s;this.editor=e,this.decorations=Wa.RangeSet.of([]),this.connectionManager=this.editor.state.field(Tn);let t=(r=this.connectionManager)==null?void 0:r.findView(e);if(t&&t instanceof An){this.view=t;let o=(s=this.view.document)==null?void 0:s._provider;this._listener=({added:i,updated:l,removed:c},f,d)=>{i.concat(l).concat(c).findIndex(g=>{var _;return g!==((_=this._awareness)==null?void 0:_.doc.clientID)})>=0&&e.dispatch({annotations:[NS.of([])]})},o&&(this._awareness=o.awareness,this._awareness.on("change",this._listener))}}destroy(){var e;this._listener&&((e=this._awareness)==null||e.off("change",this._listener),this._listener=void 0),this.connectionManager=null,this.view=null,this.editor=null}update(e){var f,d,p,g;let t=e.view;this.view=(f=this.connectionManager)==null?void 0:f.findView(t);let r=(p=(d=this.view)==null?void 0:d.document)==null?void 0:p.ytext;if(!(this.view&&r&&r.doc))return;let s=(g=this.view.document)==null?void 0:g._provider;if(!s)return;this._awareness=s.awareness;let o=this._awareness,i=r.doc,l=[],c=this._awareness.getLocalState();if(c!=null){let _=e.view.hasFocus&&e.view.dom.ownerDocument.hasFocus(),y=_?e.state.selection.main:null,b=c.cursor==null?null:Vc(c.cursor.anchor),C=c.cursor==null?null:Vc(c.cursor.head);if(y!=null){let x=Wc(r,y.anchor),M=Wc(r,y.head);(c.cursor==null||!Yc(b,x)||!Yc(C,M))&&o.setLocalStateField("cursor",{anchor:x,head:M})}else c.cursor!=null&&_&&o.setLocalStateField("cursor",null)}o.getStates().forEach((_,y)=>{if(y===o.doc.clientID)return;let b=_.cursor;if(b==null||b.anchor==null||b.head==null)return;let C=Kc(b.anchor,i),x=Kc(b.head,i);if(C==null||x==null||C.type!==r||x.type!==r)return;if(C.index>e.state.doc.length||x.index>e.state.doc.length){Q("[RemoteSelections]","warn")(`cursor positions (${C.index}, ${x.index}) out of range of document length: ${e.state.doc.length}`),this.decorations=Ot.Decoration.none;return}let{color:M="#30bced",name:W="Anonymous"}=_.user||{},S=_.user&&_.user.colorLight||M+"33",R=ws(C.index,x.index),O=ar(C.index,x.index),U=e.view.state.doc.lineAt(R),I=e.view.state.doc.lineAt(O);if(U.number===I.number)l.push({from:R,to:O,value:Ot.Decoration.mark({attributes:{style:`background-color: ${S}`},class:"cm-ySelection"})});else{l.push({from:R,to:U.from+U.length,value:Ot.Decoration.mark({attributes:{style:`background-color: ${S}`},class:"cm-ySelection"})}),l.push({from:I.from,to:O,value:Ot.Decoration.mark({attributes:{style:`background-color: ${S}`},class:"cm-ySelection"})});for(let oe=U.number+1;oe<I.number;oe++){let ue=e.view.state.doc.line(oe).from;l.push({from:ue,to:ue,value:Ot.Decoration.line({attributes:{style:`background-color: ${S}`,class:"cm-yLineSelection"}})})}}l.push({from:x.index,to:x.index,value:Ot.Decoration.widget({side:x.index-C.index>0?-1:1,block:!1,widget:new Yu(M,W)})})}),this.decorations=Ot.Decoration.set(l,!0)}},Km=Ot.ViewPlugin.fromClass(Ju,{decorations:n=>n.decorations});var Ka=require("@codemirror/state"),tn=require("@codemirror/view"),Ym=require("@codemirror/view");var mR=Ka.Annotation.define(),ju=class extends Ym.WidgetType{toDOM(){let e=document.createElement("span");return e.style.display="inline-flex",e.addClass("invalid-link"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-warning"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>',e.title="This link points outside the shared folder and may not be accessible to other users.",e}},qu=Ka.StateEffect.define(),Gu=class{constructor(e){this.log=e=>{};var t;if(this.editor=e,this.connectionManager=this.editor.state.field(Tn),this.decorations=tn.Decoration.none,this.decorationAnchors=[],this.metadata=new Map,this.cb=(r,s)=>{this.updateFromMetadata(s),this.editor.dispatch({effects:qu.of(null)})},!this.connectionManager){Q("[InvalidLinkPluginValue]","warn")("ConnectionManager not found in InvalidLinkPlugin");return}this.view=this.connectionManager.findView(e),this.view&&(this.log=Q(`[InvalidLinkPluginValue][${(t=this.view.view.file)==null?void 0:t.path}]`,"debug"),this.log("created"),this.view.document&&this.view.document.whenSynced().then(()=>{var r,s;if(this.connectionManager&&((s=(r=this.view)==null?void 0:r.document)!=null&&s.tfile)){this.connectionManager.onMeta(this.view.document.tfile,this.cb);let o=app.metadataCache.getFileCache(this.view.document.tfile);o&&(this.updateFromMetadata(o),this.editor.dispatch({effects:qu.of(null)}))}else this.log("unable to subscribe to metadata updates")}))}findInternalLinks(e){let t=[];return e.state.facet(tn.EditorView.decorations).forEach(s=>{(typeof s=="function"?s(e):s).between(0,e.state.doc.length,(i,l,c)=>{var p;(((p=c.spec)==null?void 0:p.class)||"").contains("cm-formatting-link-end")&&t.push({from:i,to:l})})}),t}updateFromMetadata(e){var r,s,o,i;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!((s=(r=this.view)==null?void 0:r.document)!=null&&s.sharedFolder)||!((i=(o=this.view)==null?void 0:o.document)!=null&&i.tfile))return;let t=new Map;for(let l of(e==null?void 0:e.links)||[]){let c=app.metadataCache.getFirstLinkpathDest(l.link,this.view.document.path);c&&!this.view.document.sharedFolder.checkPath(c.path)&&t.set(l.position.start.offset,{from:l.position.start.offset,to:l.position.end.offset,link:l.link,original:l.original})}for(let l of(e==null?void 0:e.embeds)||[]){let c=app.metadataCache.getFirstLinkpathDest(l.link,this.view.document.path);c&&!this.view.document.sharedFolder.checkPath(c.path)&&t.set(l.position.start.offset,{from:l.position.start.offset,to:l.position.end.offset,link:l.link,original:l.original})}this.metadata=t}updateMetadataPositions(e){for(let[t,r]of this.metadata)try{this.metadata.set(t,{from:e.changes.mapPos(r.from),to:e.changes.mapPos(r.to),link:r.link,original:r.original})}catch(s){this.metadata.delete(t)}}updateFromEditor(e){var o,i,l,c;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!((i=(o=this.view)==null?void 0:o.document)!=null&&i.sharedFolder)||!((c=(l=this.view)==null?void 0:l.document)!=null&&c.tfile))return;let t=[],r=new Map(this.metadata),s=this.findInternalLinks(this.editor);for(let f of s){let d=null;for(let[_,y]of r)if(f.from<=y.to&&f.to>=y.from){d=y,r.delete(_);break}if(!d)continue;let p=app.metadataCache.getFirstLinkpathDest(d.link,this.view.document.path);p&&!this.view.document.sharedFolder.checkPath(p.path)&&t.push(f.from)}t.filter(f=>f<=e.state.doc.length),this.decorationAnchors=t}updateDecorations(){this.decorationAnchors.sort();let e=this.decorationAnchors.map(t=>tn.Decoration.widget({widget:new ju,side:1}).range(t));e.length>0?this.decorations=tn.Decoration.set(e,!0):this.decorations=tn.Decoration.none}update(e){let t=!1;return e.transactions.forEach(r=>{r.effects.some(s=>s.is(qu))&&(t=!0)}),(e.docChanged||e.viewportChanged||t)&&(t||this.updateMetadataPositions(e),this.updateFromEditor(e),this.updateDecorations()),this.decorations}destroy(){var e,t;this.connectionManager&&((t=(e=this.view)==null?void 0:e.document)!=null&&t.tfile)&&this.connectionManager.offMeta(this.view.document.tfile),this.connectionManager=null,this.view=void 0,this.metadata.clear(),this.metadata=null,this.editor=null}},Jm=tn.ViewPlugin.fromClass(Gu,{decorations:n=>n.decorations});function rn(){}rn.prototype={diff:function(e,t){var r,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=s.callback;typeof s=="function"&&(o=s,s={}),this.options=s;var i=this;function l(S){return o?(setTimeout(function(){o(void 0,S)},0),!0):S}e=this.castInput(e),t=this.castInput(t),e=this.removeEmpty(this.tokenize(e)),t=this.removeEmpty(this.tokenize(t));var c=t.length,f=e.length,d=1,p=c+f;s.maxEditLength&&(p=Math.min(p,s.maxEditLength));var g=(r=s.timeout)!==null&&r!==void 0?r:1/0,_=Date.now()+g,y=[{oldPos:-1,lastComponent:void 0}],b=this.extractCommon(y[0],t,e,0);if(y[0].oldPos+1>=f&&b+1>=c)return l([{value:this.join(t),count:t.length}]);var C=-1/0,x=1/0;function M(){for(var S=Math.max(C,-d);S<=Math.min(x,d);S+=2){var R=void 0,O=y[S-1],U=y[S+1];O&&(y[S-1]=void 0);var I=!1;if(U){var oe=U.oldPos-S;I=U&&0<=oe&&oe<c}var ue=O&&O.oldPos+1<f;if(!I&&!ue){y[S]=void 0;continue}if(!ue||I&&O.oldPos+1<U.oldPos?R=i.addToPath(U,!0,void 0,0):R=i.addToPath(O,void 0,!0,1),b=i.extractCommon(R,t,e,S),R.oldPos+1>=f&&b+1>=c)return l(BS(i,R.lastComponent,t,e,i.useLongestToken));y[S]=R,R.oldPos+1>=f&&(x=Math.min(x,S-1)),b+1>=c&&(C=Math.max(C,S+1))}d++}if(o)(function S(){setTimeout(function(){if(d>p||Date.now()>_)return o();M()||S()},0)})();else for(;d<=p&&Date.now()<=_;){var W=M();if(W)return W}},addToPath:function(e,t,r,s){var o=e.lastComponent;return o&&o.added===t&&o.removed===r?{oldPos:e.oldPos+s,lastComponent:{count:o.count+1,added:t,removed:r,previousComponent:o.previousComponent}}:{oldPos:e.oldPos+s,lastComponent:{count:1,added:t,removed:r,previousComponent:o}}},extractCommon:function(e,t,r,s){for(var o=t.length,i=r.length,l=e.oldPos,c=l-s,f=0;c+1<o&&l+1<i&&this.equals(t[c+1],r[l+1]);)c++,l++,f++;return f&&(e.lastComponent={count:f,previousComponent:e.lastComponent}),e.oldPos=l,c},equals:function(e,t){return this.options.comparator?this.options.comparator(e,t):e===t||this.options.ignoreCase&&e.toLowerCase()===t.toLowerCase()},removeEmpty:function(e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(e[r]);return t},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};function BS(n,e,t,r,s){for(var o=[],i;e;)o.push(e),i=e.previousComponent,delete e.previousComponent,e=i;o.reverse();for(var l=0,c=o.length,f=0,d=0;l<c;l++){var p=o[l];if(p.removed){if(p.value=n.join(r.slice(d,d+p.count)),d+=p.count,l&&o[l-1].added){var _=o[l-1];o[l-1]=o[l],o[l]=_}}else{if(!p.added&&s){var g=t.slice(f,f+p.count);g=g.map(function(b,C){var x=r[d+C];return x.length>b.length?x:b}),p.value=n.join(g)}else p.value=n.join(t.slice(f,f+p.count));f+=p.count,p.added||(d+=p.count)}}var y=o[c-1];return c>1&&typeof y.value=="string"&&(y.added||y.removed)&&n.equals("",y.value)&&(o[c-2].value+=y.value,o.pop()),o}var yR=new rn;function HS(n,e){if(typeof n=="function")e.callback=n;else if(n)for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t]);return e}var qm=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,jm=/\S/,ef=new rn;ef.equals=function(n,e){return this.options.ignoreCase&&(n=n.toLowerCase(),e=e.toLowerCase()),n===e||this.options.ignoreWhitespace&&!jm.test(n)&&!jm.test(e)};ef.tokenize=function(n){for(var e=n.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),t=0;t<e.length-1;t++)!e[t+1]&&e[t+2]&&qm.test(e[t])&&qm.test(e[t+2])&&(e[t]+=e[t+2],e.splice(t+1,2),t--);return e};function Gm(n,e,t){return t=HS(t,{ignoreWhitespace:!0}),ef.diff(n,e,t)}var tf=new rn;tf.tokenize=function(n){this.options.stripTrailingCr&&(n=n.replace(/\r\n/g,`
`));var e=[],t=n.split(/(\n|\r\n)/);t[t.length-1]||t.pop();for(var r=0;r<t.length;r++){var s=t[r];r%2&&!this.options.newlineIsToken?e[e.length-1]+=s:(this.options.ignoreWhitespace&&(s=s.trim()),e.push(s))}return e};function VS(n,e,t){return tf.diff(n,e,t)}var WS=new rn;WS.tokenize=function(n){return n.split(/(\S.+?[.!?])(?=\s+|$)/)};var KS=new rn;KS.tokenize=function(n){return n.split(/([{}:;,]|\s+)/)};function Ya(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ya=function(e){return typeof e}:Ya=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ya(n)}function zu(n){return YS(n)||JS(n)||qS(n)||jS()}function YS(n){if(Array.isArray(n))return Xu(n)}function JS(n){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(n))return Array.from(n)}function qS(n,e){if(n){if(typeof n=="string")return Xu(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Xu(n,e)}}function Xu(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function jS(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var GS=Object.prototype.toString,ai=new rn;ai.useLongestToken=!0;ai.tokenize=tf.tokenize;ai.castInput=function(n){var e=this.options,t=e.undefinedReplacement,r=e.stringifyReplacer,s=r===void 0?function(o,i){return typeof i=="undefined"?t:i}:r;return typeof n=="string"?n:JSON.stringify(Zu(n,null,null,s),s,"  ")};ai.equals=function(n,e){return rn.prototype.equals.call(ai,n.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"))};function Zu(n,e,t,r,s){e=e||[],t=t||[],r&&(n=r(s,n));var o;for(o=0;o<e.length;o+=1)if(e[o]===n)return t[o];var i;if(GS.call(n)==="[object Array]"){for(e.push(n),i=new Array(n.length),t.push(i),o=0;o<n.length;o+=1)i[o]=Zu(n[o],e,t,r,s);return e.pop(),t.pop(),i}if(n&&n.toJSON&&(n=n.toJSON()),Ya(n)==="object"&&n!==null){e.push(n),i={},t.push(i);var l=[],c;for(c in n)n.hasOwnProperty(c)&&l.push(c);for(l.sort(),o=0;o<l.length;o+=1)c=l[o],i[c]=Zu(n[c],e,t,r,c);e.pop(),t.pop()}else i=n;return i}var Qu=new rn;Qu.tokenize=function(n){return n.slice()};Qu.join=Qu.removeEmpty=function(n){return n};function zm(n,e,t,r,s,o,i){i||(i={}),typeof i.context=="undefined"&&(i.context=4);var l=VS(t,r,i);if(!l)return;l.push({value:"",lines:[]});function c(x){return x.map(function(M){return" "+M})}for(var f=[],d=0,p=0,g=[],_=1,y=1,b=function(M){var W=l[M],S=W.lines||W.value.replace(/\n$/,"").split(`
`);if(W.lines=S,W.added||W.removed){var R;if(!d){var O=l[M-1];d=_,p=y,O&&(g=i.context>0?c(O.lines.slice(-i.context)):[],d-=g.length,p-=g.length)}(R=g).push.apply(R,zu(S.map(function($){return(W.added?"+":"-")+$}))),W.added?y+=S.length:_+=S.length}else{if(d)if(S.length<=i.context*2&&M<l.length-2){var U;(U=g).push.apply(U,zu(c(S)))}else{var I,oe=Math.min(S.length,i.context);(I=g).push.apply(I,zu(c(S.slice(0,oe))));var ue={oldStart:d,oldLines:_-d+oe,newStart:p,newLines:y-p+oe,lines:g};if(M>=l.length-2&&S.length<=i.context){var se=/\n$/.test(t),ge=/\n$/.test(r),be=S.length==0&&g.length>ue.oldLines;!se&&be&&t.length>0&&g.splice(ue.oldLines,0,"\\ No newline at end of file"),(!se&&!be||!ge)&&g.push("\\ No newline at end of file")}f.push(ue),d=0,p=0,g=[]}_+=S.length,y+=S.length}},C=0;C<l.length;C++)b(C);return{oldFileName:n,newFileName:e,oldHeader:s,newHeader:o,hunks:f}}var Qm=require("obsidian");var Ja=class{constructor(e){this.file1Start=e.file1Start,this.file2Start=e.file2Start,this.file1Lines=e.file1Lines,this.file2Lines=e.file2Lines}};var qa=class{constructor(e){this.file1Name=e.file1Name,this.file2Name=e.file2Name,this.differences=e.differences}static fromParsedDiff(e){let t=[];return e.hunks.forEach(r=>{let s=0,o=0;for(let i=0;i<r.lines.length;i+=1){let l=r.lines[i];if(l.startsWith("+")||l.startsWith("-")){let c=i,f=c;for(;f<r.lines.length-1&&(r.lines[f+1].startsWith("+")||r.lines[f+1].startsWith("-"));)f+=1;let d=r.lines.slice(c,f+1).filter(g=>g.startsWith("-")).map(g=>g.slice(1)),p=r.lines.slice(c,f+1).filter(g=>g.startsWith("+")).map(g=>g.slice(1));t.push(new Ja({file1Start:r.oldStart+c-o-1,file2Start:r.newStart+c-s-1,file1Lines:d,file2Lines:p})),s+=d.length,o+=p.length,i+=f-c}}}),new this({file1Name:e.oldFileName,file2Name:e.newFileName,differences:t})}};function rf(n){let e=n.fullText.split(`
`);return e.splice(n.position,0,n.newLine),e.join(`
`)}function li(n){let e=n.fullText.split(`
`);return n.newLine===""?e.splice(n.position,n.linesToReplace):e.splice(n.position,n.linesToReplace,n.newLine),e.join(`
`)}function ci(n){let e=n.fullText.split(`
`);return e.splice(n.position,n.count),e.join(`
`)}function no(n){return n!==""?n:"\u200E"}var yr=class{constructor(e){this.text=e.text,this.onClick=e.onClick}build(e){e.createEl("a",{text:this.text,cls:"no-decoration text-xxs file-diff__action-line"}).onClickEvent(this.onClick)}};var Dn=class{static build(e){e.createEl("span",{text:"|",cls:"text-xxs file-diff__action-line"})}};var nf=require("obsidian");var Zm=Ro(Xm());function Ga(n,e){let t=n.getText("contents"),r=t.toString(),s=new Zm.diff_match_patch,o=s.diff_main(r,e);s.diff_cleanupSemantic(o);let i=0,l=Q("[updateYDocFromDiskBuffer]","debug");l("Updating YDoc:"),l("Current content length:",r.length),l("Disk buffer length:",e.length),o.length!=0&&(n.transact(()=>{for(let[c,f]of o)switch(c){case 1:l(`Inserting "${f}" at position ${i}`),t.insert(i,f),i+=f.length;break;case 0:l(`Keeping "${f}" (length: ${f.length})`),i+=f.length;break;case-1:l(`Deleting "${f}" at position ${i}`),t.delete(i,f.length);break}}),l("Update complete. New content length:",t.toString().length))}var ja=class{constructor(e,t,r){this.loginManager=e;this.timeProvider=t;this.sharedFolders=r;this.subscriptions=[];this.downloadQueue=[];this.log=Q("[BackgroundSync]","log");this.debug=Q("[BackgroundSync]","debug");this.error=Q("[BackgroundSync]","error");dr.set(this,"BackgroundSync")}enqueueDownload(e){this.downloadQueue.push(e)}async downloadItem(e){var i;let t=e.s3rn;this.log("[downloadItem]",`${Dr.encode(t)}`);let r;if(t instanceof hr)r=t.documentId;else if(t instanceof zt)r=t.folderId;else throw new Error("Unable to decode S3RN");if(!this.loginManager.loggedIn)throw new Error("Not logged in");let s={Authorization:`Bearer ${(i=this.loginManager.user)==null?void 0:i.token}`},o=await(0,nf.requestUrl)({url:`https://api.system3.md/relay/${t.relayId}/doc/${r}/as-update`,method:"GET",headers:s});return o.status===200?this.debug("[downloadItem]",r,o.status,o.text):this.error("[downloadItem]",r,o.status,o.text),o}async uploadItem(e){var l;let t=e.s3rn;this.log("[uploadItem]",`${Dr.encode(t)}`);let r;if(t instanceof hr)r=t.documentId;else if(t instanceof zt)r=t.folderId;else throw new Error("Unable to decode S3RN");if(!this.loginManager.loggedIn)throw new Error("Not logged in");let s={Authorization:`Bearer ${(l=this.loginManager.user)==null?void 0:l.token}`,"Content-Type":"application/octet-stream"},o=jn(e.ydoc),i=await(0,nf.requestUrl)({url:`https://api.system3.md/relay/${t.relayId}/doc/${r}/update`,method:"POST",headers:s,body:o.buffer,throw:!1});return i.status===200?this.debug("[uploadItem]",r,i.status,i.text):this.error("[uploadItem]",r,i.status,i.text),i}async getDocument(e){try{let r=(await this.downloadItem(e)).arrayBuffer,s=new Uint8Array(r);qn(e.ydoc,s),e.sharedFolder.flush(e,e.text)}catch(t){console.error(t);return}}async putDocument(e){try{let t=await this.uploadItem(e);if(t.status!==200)throw new Error(`Failed to upload document: ${t.status} ${t.text}`)}catch(t){console.error(t);return}}async putFolderFiles(e){await e.whenReady(),this.log("[putFolderFiles]",`Uploading ${e.docset.size} items`);let t=1;for(let r of e.docset.items())await r.whenReady(),r.text&&await this.uploadItem(r),this.log("[putFolderFiles]",`${t}/${e.docset.size}`),t++}async getFolder(e){let r=(await this.downloadItem(e)).arrayBuffer,s=new Uint8Array(r);qn(e.ydoc,s)}async getFolderFiles(e){await e.whenReady(),this.log("[getFolderFiles]",`Downloading ${e.docset.size} files`);let t=1;for(let r of e.docset.items())await this.getDocument(r),this.log("[getFolderFiles]",`${t}/${e.docset.size}`),t++}destroy(){this.loginManager=null,this.sharedFolders=null,this.subscriptions.forEach(e=>e()),this.downloadQueue=[]}};var za=class{constructor(e){this.difference=e.difference,this.file1=e.file1,this.file2=e.file2,this.file1Content=e.file1Content,this.file2Content=e.file2Content,this.triggerRebuild=e.triggerRebuild}async modify(e,t){if(e instanceof Cn){Ga(e.ydoc,t);return}else if(e instanceof kn){e.contents=t;return}await app.vault.modify(e,t)}build(e){let t=e.createDiv({cls:"flex flex-row gap-1 py-0-5"}),r=this.difference.file1Lines.length>0,s=this.difference.file2Lines.length>0;s&&r?(new yr({text:"Accept Top",onClick:o=>this.acceptTopClick(o,this.difference)}).build(t),Dn.build(t),new yr({text:"Accept Bottom",onClick:o=>this.acceptBottomClick(o,this.difference)}).build(t),Dn.build(t),new yr({text:"Accept All",onClick:o=>this.acceptAllClick(o,this.difference)}).build(t),Dn.build(t),new yr({text:"Accept None",onClick:o=>this.acceptNoneClick(o,this.difference)}).build(t)):r?(new yr({text:`Accept from ${this.file1.name}`,onClick:o=>this.insertFile1Difference(o,this.difference)}).build(t),Dn.build(t),new yr({text:"Discard",onClick:o=>this.discardFile1Difference(o,this.difference)}).build(t)):s&&(new yr({text:`Accept from ${this.file2.name}`,onClick:o=>this.insertFile2Difference(o,this.difference)}).build(t),Dn.build(t),new yr({text:"Discard",onClick:o=>this.discardFile2Difference(o,this.difference)}).build(t))}async acceptTopClick(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),s=li({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,s),this.triggerRebuild()}async acceptBottomClick(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),s=li({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,s),this.triggerRebuild()}async acceptAllClick(e,t){e.preventDefault();let r=[...t.file1Lines,...t.file2Lines].join(`
`),s=li({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,s);let o=li({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,o),this.triggerRebuild()}async acceptNoneClick(e,t){e.preventDefault();let r=ci({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r);let s=ci({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,s),this.triggerRebuild()}async insertFile1Difference(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),s=rf({fullText:this.file2Content,newLine:r,position:t.file2Start});await this.modify(this.file2,s),this.triggerRebuild()}async insertFile2Difference(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),s=rf({fullText:this.file1Content,newLine:r,position:t.file1Start});await this.modify(this.file1,s),this.triggerRebuild()}async discardFile1Difference(e,t){e.preventDefault();let r=ci({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r),this.triggerRebuild()}async discardFile2Difference(e,t){e.preventDefault();let r=ci({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,r),this.triggerRebuild()}};var oo="system3-differences-view";async function eg(n,e){n.detachLeavesOfType(oo);let t=n.getLeaf(!0);t.setViewState({type:oo,active:!0,state:e}),n.revealLeaf(t)}var Xa=class extends Qm.ItemView{constructor(t){super(t);this.file1Lines=[];this.file2Lines=[];this.registerEvent(this.app.vault.on("modify",async r=>{var s,o;r!==((s=this.state)==null?void 0:s.file1)&&r!==((o=this.state)==null?void 0:o.file2)||(await this.updateState(),this.build())}))}async getContent(t){return t instanceof Cn?t.text:t instanceof kn?t.contents:await this.app.vault.cachedRead(t)}getViewType(){return oo}getDisplayText(){var t,r;return(t=this.state)!=null&&t.file1&&((r=this.state)!=null&&r.file2)?`File Diff: ${this.state.file1.name} and ${this.state.file2.name}`:"File Diff"}async setState(t,r){super.setState(t,r),this.state=t,await this.updateState(),this.build()}async onunload(){var t,r;(r=(t=this.state)==null?void 0:t.onResolve)==null||r.call(t)}async updateState(){var r,s;if(((r=this.state)==null?void 0:r.file1)==null||((s=this.state)==null?void 0:s.file2)==null)return;this.file1Content=await this.getContent(this.state.file1),this.file2Content=await this.getContent(this.state.file2),this.file1Lines=this.file1Content.concat(`
`).split(`
`).map(o=>o.trimEnd()),this.file2Lines=this.file2Content.concat(`
`).split(`
`).map(o=>o.trimEnd());let t=zm(this.state.file1.path,this.state.file2.path,this.file1Lines.join(`
`),this.file2Lines.join(`
`));this.fileDifferences=qa.fromParsedDiff(t),this.fileDifferences.differences.length===0&&this.leaf.detach()}build(){this.contentEl.empty();let t=this.contentEl.createDiv({cls:"file-diff__container"});this.buildLines(t),this.scrollToFirstDifference()}buildLines(t){var i,l,c;let r=0,s=0,o=Math.max(((i=this.file1Lines)==null?void 0:i.length)||0,((l=this.file2Lines)==null?void 0:l.length)||0);for(;r<=o||s<=o;){let f=(c=this.fileDifferences)==null?void 0:c.differences.find(d=>d.file1Start===r&&d.file2Start===s);if(f!=null){let d=t.createDiv({cls:"difference"});this.buildDifferenceVisualizer(d,f),r+=f.file1Lines.length,s+=f.file2Lines.length}else{let d=r<=s?this.file1Lines[r]:this.file2Lines[s];t.createDiv({text:no(d),cls:"file-diff__line"}),r+=1,s+=1}}}buildDifferenceVisualizer(t,r){var s;(s=this.state)!=null&&s.showMergeOption&&new za({difference:r,file1:this.state.file1,file2:this.state.file2,file1Content:this.file1Content||"",file2Content:this.file2Content||"",triggerRebuild:async()=>{await this.updateState(),this.build()}}).build(t);for(let o=0;o<r.file1Lines.length;o+=1){let i=r.file1Lines[o],l=r.file2Lines[o],c=t.createDiv({cls:"file-diff__line file-diff__top-line__bg"}),f=this.buildDiffLine(i,l,"file-diff_top-line__character");(o<r.file1Lines.length-1||r.file2Lines.length!==0)&&c.classList.add("file-diff__no-bottom-border"),o!==0&&c.classList.add("file-diff__no-top-border"),c.appendChild(f)}for(let o=0;o<r.file2Lines.length;o+=1){let i=r.file1Lines[o],l=r.file2Lines[o],c=t.createDiv({cls:"file-diff__line file-diff__bottom-line__bg"}),f=this.buildDiffLine(l,i,"file-diff_bottom-line__character");(o==0&&r.file1Lines.length>0||o>0)&&c.classList.add("file-diff__no-top-border"),o<r.file2Lines.length-1&&c.classList.add("file-diff__no-bottom-border"),c.appendChild(f)}}buildDiffLine(t,r,s){let o=document.createElement("div");if(t!=null&&t.length===0)o.textContent=no(t);else if(t!=null&&r!=null){let i=Gm(r,t);for(let l of i){if(l.removed)continue;let c=document.createElement("span");c.textContent=no(l.value),l.added&&c.classList.add(s),o.appendChild(c)}}else if(t!=null&&r==null){let i=document.createElement("span");i.textContent=no(t),i.classList.add(s),o.appendChild(i)}else o.textContent=no(t);return o}scrollToFirstDifference(){var s;if(((s=this.fileDifferences)==null?void 0:s.differences.length)===0)return;let t=this.contentEl.getElementsByClassName("file-diff__container")[0].getBoundingClientRect(),r=this.contentEl.getElementsByClassName("difference")[0].getBoundingClientRect();this.contentEl.scrollTo({top:r.top-t.top-100,behavior:"smooth"})}};var ZS=3;function sf(n,e){n.iterateAllLeaves(t=>{t.view instanceof Mn.MarkdownView&&e(t.view)})}function QS(n,e){var t,r,s,o;if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(((t=n[i].view.file)==null?void 0:t.path)!==((r=e[i].view.file)==null?void 0:r.path)||((s=n[i].document)==null?void 0:s.path)!==((o=e[i].document)==null?void 0:o.path))return!1;return!0}var of=class{constructor(e,t,r){this.document=null;this.canConnect=!1;this._parent=e,this.view=t,this.login=r}attach(){return this.banner=new to(this.view,"Login to enable Live edits",async()=>await this.login()),Promise.resolve(this)}release(){var e;(e=this.banner)==null||e.destroy()}destroy(){this.release(),this.banner=void 0,this.view=null}};function ro(n){return n instanceof An&&n.document!==void 0&&n.document.text!==void 0}var An=class{constructor(e,t,r,s=!0,o=!0){this._parent=e,this.view=t,this.document=r,this._tracking=!1,this.shouldConnect=s,this.canConnect=o,e.networkStatus.online||this.offlineBanner()}toggleConnection(){this.shouldConnect=!this.shouldConnect,this.shouldConnect?this.document.connect().then(e=>{e||(this.shouldConnect=!1)}):this.document.disconnect()}get tracking(){return this._tracking}set tracking(e){let t=this._tracking;this._tracking=e,this._tracking!==t&&this.attach()}get ytext(){return this.document.ytext}mergeBanner(){return this._banner=new to(this.view,"Merge conflict -- click to resolve",async()=>{let e=await this.document.diskBuffer();return await this.document.checkStale()&&this._parent.openDiffView({file1:this.document,file2:e,showMergeOption:!0,onResolve:async()=>{this.document.clearDiskBuffer(),this.view.requestSave()}}),!0}),()=>{}}offlineBanner(){if(this.shouldConnect){let e=new to(this.view,"You're offline -- click to reconnect",async()=>(this._parent.networkStatus.checkStatus(),this.connect(),this._parent.networkStatus.online));this._parent.networkStatus.onceOnline(()=>{this.connect(),e.destroy()})}return()=>{}}setConnectionDot(){let e=this.view.containerEl.querySelector(".view-actions");e&&e.firstChild&&(this._viewActions||(this.clearViewActions(),this.offConnectionStatusSubscription&&this.offConnectionStatusSubscription(),this._viewActions=new Bm({target:e,anchor:e.firstChild,props:{view:this,state:this.document.state,remote:this.document.sharedFolder.remote}}),this.offConnectionStatusSubscription=this.document.subscribe(e,t=>{var r;(r=this._viewActions)==null||r.$set({view:this,state:t,remote:this.document.sharedFolder.remote})})),this._viewActions.$set({view:this,state:this.document.state,remote:this.document.sharedFolder.remote}))}clearViewActions(){let e=this.view.containerEl.querySelector(".view-actions");if(e&&e.firstChild){let t=this.view.containerEl.querySelectorAll(".system3-view-action");t.length>0&&t.forEach(r=>{r.remove()})}}async checkStale(){var t,r;let e=await this.document.checkStale();return e&&((t=this.document._diskBuffer)!=null&&t.contents)&&this.document.text?this.mergeBanner():((r=this._banner)==null||r.destroy(),this._banner=void 0),e}attach(){return this.setConnectionDot(),new Promise(e=>this.document.whenReady().then(t=>{this._parent.networkStatus.online&&this.document.sharedFolder.shouldConnect&&this.shouldConnect&&this.canConnect?this.connect():this.document.disconnect(),e(this)}).catch(()=>{this.offlineBanner()}))}connect(){this.document.connect()}release(){var e,t;(e=this._viewActions)==null||e.$destroy(),this._viewActions=void 0,(t=this._banner)==null||t.destroy(),this._banner=void 0,this.offConnectionStatusSubscription&&(this.offConnectionStatusSubscription(),this.offConnectionStatusSubscription=void 0),this.document.disconnect()}destroy(){this.release(),this.clearViewActions(),this.view.leaf.rebuildView(),this._parent=null,this.view=null,this.document=null}},Za=class{constructor(e,t,r,s){this.app=e;this.offListeners=[];this.folderListeners=new Map;this.workspace=e.workspace,this.sharedFolders=t,this.views=[],this.extensions=[],this._activePromise=null,this.loginManager=r,this.networkStatus=s,this.refreshQueue=[],this._compartment=new Qa.Compartment,this.log=Q("[LiveViews]","log"),this.warn=Q("[LiveViews]","warn"),this.metadataListeners=new Map;let o=(c,f,d)=>{let p=this.metadataListeners.get(c);p==null||p(f,d)},i=this.app.metadataCache.on("changed",o);this.offListeners.push(()=>{this.app.metadataCache.offref(i)}),this.offListeners.push(this.loginManager.on(()=>{this.refresh("[LoginManager]")}));let l=c=>(c.ready||c.whenReady().then(()=>{this.refresh("[Shared Folder Ready]")}).catch(f=>{this.views.forEach(d=>{var p;((p=d.document)==null?void 0:p.sharedFolder)===c&&d.offlineBanner()})}),c.docset.on(()=>{this.refresh("[Docset]")}));this.offListeners.push(this.sharedFolders.on(()=>{this.refresh("[Shared Folders]"),this.folderListeners.forEach((c,f)=>{this.sharedFolders.has(f)||(c(),this.folderListeners.delete(f))}),this.sharedFolders.forEach(c=>{this.folderListeners.has(c)||this.folderListeners.set(c,l(c))})}))}reconfigure(e){e.dispatch({effects:this._compartment.reconfigure([Tn.init(()=>this)])})}onMeta(e,t){this.metadataListeners.set(e,t)}offMeta(e){this.metadataListeners.delete(e)}openDiffView(e){eg(this.workspace,e)}goOffline(){this.log("[System 3][Relay][Live Views] going offline"),this.views.forEach(e=>{var t;return(t=e.document)==null?void 0:t.disconnect()}),this.refresh("[NetworkStatus]")}goOnline(){this.log("[System 3][Relay][Live Views] going online"),this.refresh("[NetworkStatus]"),this.sharedFolders.items().forEach(e=>{e.connect()}),this.viewsAttachedWithConnectionPool(this.views)}docIsOpen(e){return this.views.some(t=>t.document===e)}releaseViews(e){e.forEach(t=>{t.release()})}findFolders(){let e=new Set;return sf(this.workspace,t=>{var o;let r=(o=t.file)==null?void 0:o.path;if(!r)return;let s=this.sharedFolders.lookup(r);s&&e.add(s)}),e.size==0?[]:[...e]}async foldersReady(){let e=new Set;if(sf(this.workspace,r=>{var i;let s=(i=r.file)==null?void 0:i.path;if(!s)return;let o=this.sharedFolders.lookup(s);o&&e.add(o)}),e.size===0)return[];let t=[...e].map(r=>r.whenReady());return Promise.all(t)}getViews(){let e=[];return sf(this.workspace,t=>{var o;let r=(o=t.file)==null?void 0:o.path;if(!r)return;let s=this.sharedFolders.lookup(r);if(s)if(this.loginManager.loggedIn)if(s.ready){let i=s.getFile(r,!0,!0,!0),l=new An(this,t,i);e.push(l)}else this.log(`Folder not ready, skipping views. folder=${s.path}`);else{let i=new of(this,t,()=>this.loginManager.openLoginPage());e.push(i)}}),e}findView(e){return this.views.find(t=>t.view.editor.cm===e)}async viewsReady(e){return await Promise.all(e.filter(t=>t instanceof An).map(async t=>t.document.whenReady().then(r=>t)))}async viewsAttachedWithConnectionPool(e,t=ZS){let r=this.workspace.getActiveViewOfType(Mn.MarkdownView),s=0,o=e.sort((l,c)=>c.view.leaf.activeTime-l.view.leaf.activeTime),i=new Set;for(let l of o)l instanceof An&&(l.view===r||i.has(l.document)?(l.canConnect=!0,i.add(l.document)):s<t?(l.canConnect=!0,i.add(l.document),s++):l.canConnect=!1);return s>t&&this.warn(`[System 3][Relay][Live Views] connection pool (max ${t}): rejected connections for ${s-t} views`),this.viewsAttached(e)}async viewsAttached(e){return await Promise.all(e.map(async t=>t.attach()))}deduplicate(e){let t=[],r=[];return this.views.forEach(s=>{let o=e.find(i=>{if(s.document==i.document&&s.view==i.view)return!0});o?(r.push(s),e.remove(o)):t.push(s)}),e.forEach(s=>{r.push(s)}),[r,t]}async _refreshViews(e,t){let r=`[LiveViews][${e}]`,s=Q(r,"debug"),o=(p,g)=>{s(p,g.map(_=>{var y;return{type:_.constructor.name,file:(y=_.document)==null?void 0:y.path,canConnect:_.canConnect}}))};s("Refresh"),await this.foldersReady();let i=[];try{i=this.getViews()}catch(p){return this.warn("[System 3][Relay][Live Views] error getting views",p),!1}let l=this.findFolders();if(l.length===0&&i.length===0)return this.extensions.length!==0&&(s("Unexpected plugins loaded."),this.wipe()),o("Releasing Views",this.views),this.releaseViews(this.views),this.views=[],!0;this.loginManager.loggedIn&&this.networkStatus.online?l.forEach(p=>{p.connect()}):this.sharedFolders.forEach(p=>{p.disconnect()});let[c,f]=this.deduplicate(i);if(o("Releasing Views",f),this.releaseViews(f),f.length===0&&QS(c,this.views)){let p=await this.viewsAttachedWithConnectionPool(this.views);o("Attached Views",p)}else{let p=await this.viewsReady(c);o("Ready Views",p);let g=await this.viewsAttachedWithConnectionPool(p);o("Attached Views",g),this.views=c}s("loading plugins"),this.load();let d=Mn.moment.utc();return s(`refresh completed in ${d.diff(t)}ms`,r),!0}async refresh(e,t=3e3){let r=Q(e,"warn"),s=Mn.moment.utc();if(this.refreshQueue.push(()=>this._refreshViews(e,s)),this._activePromise!==null)return!1;for(;this.refreshQueue.length>0;)this.refreshQueue.length>2&&(r("refreshQueue size:",this.refreshQueue.length),this.refreshQueue.slice(-2)),Mn.Platform.isIosApp?(this._activePromise=this.refreshQueue.pop()().finally(()=>{this._activePromise=null}),await this._activePromise):(this._activePromise=Fa("Refresh Views",this.refreshQueue.pop()(),t).catch(o=>{if(o instanceof Xn)return this.warn(`[System 3][Relay][Live Views] refresh views timed out... timeout=${t}`,o),this._activePromise=null,!1;throw o}).finally(()=>{this._activePromise=null}),await this._activePromise);return!0}wipe(){this.extensions.length=0,this.workspace.updateOptions()}load(){this.wipe(),this.views.length>0&&(this.extensions.push([this._compartment.of(Tn.init(()=>this)),Vm,Wm,Km,Jm]),this.workspace.updateOptions())}destroy(){this.releaseViews(this.views),this.offListeners.forEach(e=>e()),this.offListeners.length=0,this.metadataListeners.clear(),this.metadataListeners=null,this.folderListeners.forEach(e=>e()),this.folderListeners.clear(),this.folderListeners=null,this.views.forEach(e=>e.destroy()),this.views=[],this.wipe(),this.sharedFolders=null,this.refreshQueue=null,this.networkStatus=null,this._activePromise=null}},Tn=Qa.StateField.define({create(n){},update(n,e){return n}});var io=require("obsidian");function ek(n){tt(n,"svelte-3npei9",".folder-icons.svelte-3npei9{display:inline-flex;align-items:center;vertical-align:middle;border-radius:var(--radius-m);transition:width 0.3s ease;margin-right:0.6em;padding-left:0.2em;padding-right:0.2em;background-color:var(--color-base-05)}.icon.svelte-3npei9{margin-right:0.2em;margin-left:0.2em;width:1em;display:flex;transition:display 0.3s ease}span.system3-connected.svelte-3npei9{color:var(--color-accent)}span.system3-disconnected.svelte-3npei9{color:var(--color-base-40)}span.notebook.svelte-3npei9{color:var(--color-accent)}span.hidden.svelte-3npei9{display:none}")}function tk(n){let e,t,r;return t=new en({props:{class:"inline-icon",style:"width: 0.8em"}}),{c(){e=L("span"),H(t.$$.fragment),A(e,"class","notebook icon svelte-3npei9"),A(e,"aria-label","Tracking Changes")},m(s,o){T(s,e,o),N(t,e,null),r=!0},p:Z,i(s){r||(k(t.$$.fragment,s),r=!0)},o(s){D(t.$$.fragment,s),r=!1},d(s){s&&E(e),B(t)}}}function rk(n){let e,t,r,s,o,i,l,c;return t=new en({props:{class:"inline-icon",style:"width: 0.8em"}}),o=new gr({props:{class:"inline-icon"}}),{c(){e=L("span"),H(t.$$.fragment),r=q(),s=L("span"),H(o.$$.fragment),A(e,"class","notebook icon hidden svelte-3npei9"),A(e,"aria-label","Tracking Changes"),A(s,"class",i="satellite icon system3-"+n[0]+" svelte-3npei9"),A(s,"aria-label",l=`${n[1].relay.name} (${n[0]})`)},m(f,d){T(f,e,d),N(t,e,null),T(f,r,d),T(f,s,d),N(o,s,null),c=!0},p(f,d){(!c||d&1&&i!==(i="satellite icon system3-"+f[0]+" svelte-3npei9"))&&A(s,"class",i),(!c||d&3&&l!==(l=`${f[1].relay.name} (${f[0]})`))&&A(s,"aria-label",l)},i(f){c||(k(t.$$.fragment,f),k(o.$$.fragment,f),c=!0)},o(f){D(t.$$.fragment,f),D(o.$$.fragment,f),c=!1},d(f){f&&(E(e),E(r),E(s)),B(t),B(o)}}}function nk(n){let e,t,r,s,o=[rk,tk],i=[];function l(c,f){return c[1]?0:1}return t=l(n,-1),r=i[t]=o[t](n),{c(){e=L("div"),r.c(),A(e,"class","folder-icons svelte-3npei9")},m(c,f){T(c,e,f),i[t].m(e,null),s=!0},p(c,[f]){let d=t;t=l(c,f),t===d?i[t].p(c,f):(xe(),D(i[d],1,1,()=>{i[d]=null}),Se(),r=i[t],r?r.p(c,f):(r=i[t]=o[t](c),r.c()),k(r,1),r.m(e,null))},i(c){s||(k(r),s=!0)},o(c){D(r),s=!1},d(c){c&&E(e),i[t].d()}}}function sk(n,e,t){let{status:r="disconnected"}=e,{remote:s}=e;return n.$$set=o=>{"status"in o&&t(0,r=o.status),"remote"in o&&t(1,s=o.remote)},[r,s]}var af=class extends ne{constructor(e){super(),ie(this,e,sk,nk,te,{status:0,remote:1},ek)}},tg=af;var lf=class{constructor(e,t){this.el=e,this.mutationObserver=new MutationObserver((r,s)=>{for(let o of r)o.type==="childList"&&e.nextSibling&&(t(e),s.disconnect())}),this.mutationObserver.observe(e.parentElement,{childList:!0,subtree:!0})}destroy(){var e;(e=this.mutationObserver)==null||e.disconnect(),this.mutationObserver=null}},ui=class{visitFolder(e,t,r,s){return null}visitFile(e,t,r,s){return null}},cf=class{constructor(e,t){this.el=e,this.sharedFolder=t,this.siblingWatcher=new lf(this.el,r=>{this.add()}),this.add()}add(){var e;(e=this.el.nextSibling)==null||e.addClass("system3-live")}remove(){var e;(e=this.el.nextSibling)==null||e.removeClass("system3-live")}destroy(){this.siblingWatcher.destroy(),this.remove()}},uf=class extends ui{visitFolder(e,t,r,s){return s?r||new cf(t.selfEl,s):(r&&r.destroy(),null)}},ff=class{constructor(e,t){this.el=e,this.sharedFolder=t,this.el.addClass("system3-pill"),this.pill=new tg({target:this.el,props:{status:this.sharedFolder.state.status,remote:this.sharedFolder.remote}}),this.unsubscribe=this.sharedFolder.subscribe(this.el,r=>{this.pill.$set({status:r.status,remote:this.sharedFolder.remote})})}destroy(){this.pill.$destroy(),this.unsubscribe(),this.el.removeClass("system3-pill")}},df=class extends ui{visitFolder(e,t,r,s){return s?r||new ff(t.selfEl,s):(r&&r.destroy(),null)}},hf=class{constructor(e,t,r){this.el=e,this.document=t,this.document.subscribe(e,s=>{this.docStatus(s)}),this.docStatus(this.document.state)}docStatus(e){(e==null?void 0:e.status)==="connected"?(this.el.removeClass("system3-connecting"),this.el.addClass("system3-connected"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="connecting"?(this.el.removeClass("system3-connected"),this.el.addClass("system3-connecting"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="disconnected"?(this.el.addClass("system3-live"),this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting")):(this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting"),this.el.removeClass("system3-live"))}destroy(){var e;(e=this.document)==null||e.unsubscribe(this.el),this.docStatus()}},pf=class extends ui{visitFile(e,t,r,s){if(s)try{let o=s.ids.get(s.getVirtualPath(e.path));if(!o)return null;let i=s.docs.get(o);return i?r||new hf(t.el,i,e):null}catch(o){return null}return r&&r.destroy(),null}},el=class{constructor(e,t,r){this.fileExplorer=e,this.sharedFolders=t,this.visitors=r,this.storage=new Map;for(let s of this.visitors)this.storage.set(s,new Map)}_getFileExplorerItem(e){try{return this.fileExplorer.view.fileItems[e]}catch(t){return null}}getFileExplorerItem(e,t){return typeof t=="string"?this._getFileExplorerItem(t):this._getFileExplorerItem(t.path)}walk(e,t){if(this.fileExplorer.view.getViewType()!=="file-explorer")return;let r=this.sharedFolders.find(o=>o.path===e.path),s=this.getFileExplorerItem(this.fileExplorer,e);s&&this.storage.forEach((o,i)=>{let l=o.get(s),c=i.visitFolder(e,s,l,r);l&&!c?o.delete(s):c&&o.set(s,c)}),e.children.forEach(o=>{if(o instanceof io.TFolder)this.walk(o,r);else if(o instanceof io.TFile){let i=this.getFileExplorerItem(this.fileExplorer,o);this.storage.forEach((l,c)=>{let f=l.get(i),d=c.visitFile(o,i,f,r||t);f&&!d?l.delete(i):d&&l.set(i,d)})}})}destory(){this.storage.forEach(e=>{e.forEach(t=>{t.destroy()})})}},tl=class{constructor(e,t,r){this.vault=e,this.workspace=t,this.sharedFolders=r,this.treeState=new Map,this.workspace.onLayoutReady(()=>this.refresh()),this.offDocumentListeners=new Map,this.offFolderListener=this.sharedFolders.subscribe(()=>{this.sharedFolders.forEach(s=>{Rr(Mr.enableDocumentStatus,()=>{this.offDocumentListeners.get(s)||this.offDocumentListeners.set(s,s.docset.on(()=>{this.refresh()}))})}),this.refresh()}),this.offLayoutChange=(()=>{let s=this.workspace.on("layout-change",()=>this.quickRefresh());return()=>{this.workspace.offref(s)}})()}makeVisitors(){let e=[];return e.push(new uf),e.push(new df),Rr(Mr.enableDocumentStatus,()=>{e.push(new pf)}),e}getFileExplorers(){let e=[];return this.workspace.iterateAllLeaves(t=>{t.view.getViewType()==="file-explorer"&&(e.includes(t)||e.push(t))}),e}quickRefresh(){let e=this.getFileExplorers(),t=this.sharedFolders.map(r=>r.path);for(let r of e){let s=this.treeState.get(r)||new el(r,this.sharedFolders,this.makeVisitors());this.treeState.set(r,s);for(let o of t){let i=this.vault.getAbstractFileByPath(o);i instanceof io.TFolder&&s.walk(i)}}}refresh(){let e=this.getFileExplorers();for(let t of e){let r=this.treeState.get(t)||new el(t,this.sharedFolders,this.makeVisitors());this.treeState.set(t,r);let s=this.vault.getAbstractFileByPath("/");s instanceof io.TFolder&&r.walk(s)}}destroy(){this.offFolderListener(),this.offDocumentListeners.forEach(e=>e()),this.offDocumentListeners.clear(),this.treeState.forEach(e=>{e.destory()}),this.treeState.clear(),this.offLayoutChange(),this.vault=null,this.workspace=null,this.sharedFolders=null}};var Jg=require("obsidian");function ft(n,e,t,r){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function l(d){try{f(r.next(d))}catch(p){i(p)}}function c(d){try{f(r.throw(d))}catch(p){i(p)}}function f(d){d.done?o(d.value):s(d.value).then(l,c)}f((r=r.apply(n,e||[])).next())})}var Fr=require("obsidian");function rg(n,e,t){let r=n.slice();return r[5]=e[t],r}var ok=n=>({}),ng=n=>({}),ik=n=>({}),sg=n=>({});function ak(n){let e;return{c(){e=ae(n[0])},m(t,r){T(t,e,r)},p(t,r){r&1&&we(e,t[0])},d(t){t&&E(e)}}}function lk(n){let e,t=ze(n[1]),r=[];for(let s=0;s<t.length;s+=1)r[s]=og(rg(n,t,s));return{c(){for(let s=0;s<r.length;s+=1)r[s].c();e=$e()},m(s,o){for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(s,o);T(s,e,o)},p(s,o){if(o&2){t=ze(s[1]);let i;for(i=0;i<t.length;i+=1){let l=rg(s,t,i);r[i]?r[i].p(l,o):(r[i]=og(l),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(s){s&&E(e),Qt(r,s)}}}function og(n){let e;return{c(){e=L("div"),e.textContent=`${n[5]} `},m(t,r){T(t,e,r)},p:Z,d(t){t&&E(e)}}}function ck(n){let e,t=n[1].length>0&&lk(n);return{c(){t&&t.c(),e=$e()},m(r,s){t&&t.m(r,s),T(r,e,s)},p(r,s){r[1].length>0&&t.p(r,s)},d(r){r&&E(e),t&&t.d(r)}}}function uk(n){let e,t,r,s,o,i,l,c,f=n[4].name,d=He(f,n,n[3],sg),p=d||ak(n),g=n[4].description,_=He(g,n,n[3],ng),y=_||ck(n),b=n[4].default,C=He(b,n,n[3],null);return{c(){e=L("div"),t=L("div"),r=L("div"),p&&p.c(),s=q(),o=L("div"),y&&y.c(),i=q(),l=L("div"),C&&C.c(),A(r,"class","setting-item-name"),bt(r,"display","grid"),bt(r,"align-items","center"),A(o,"class","setting-item-description"),A(t,"class","setting-item-info"),bt(t,"display","grid"),A(l,"class","setting-item-control"),A(e,"class","setting-item")},m(x,M){T(x,e,M),J(e,t),J(t,r),p&&p.m(r,null),J(t,s),J(t,o),y&&y.m(o,null),J(e,i),J(e,l),C&&C.m(l,null),c=!0},p(x,[M]){d?d.p&&(!c||M&8)&&We(d,f,x,x[3],c?Ve(f,x[3],M,ik):Ke(x[3]),sg):p&&p.p&&(!c||M&1)&&p.p(x,c?M:-1),_&&_.p&&(!c||M&8)&&We(_,g,x,x[3],c?Ve(g,x[3],M,ok):Ke(x[3]),ng),C&&C.p&&(!c||M&8)&&We(C,b,x,x[3],c?Ve(b,x[3],M,null):Ke(x[3]),null)},i(x){c||(k(p,x),k(y,x),k(C,x),c=!0)},o(x){D(p,x),D(y,x),D(C,x),c=!1},d(x){x&&E(e),p&&p.d(x),y&&y.d(x),C&&C.d(x)}}}function fk(n,e,t){let{$$slots:r={},$$scope:s}=e,{name:o=""}=e,{description:i}=e,l=i!==void 0?i.split(`
`):[];return n.$$set=c=>{"name"in c&&t(0,o=c.name),"description"in c&&t(2,i=c.description),"$$scope"in c&&t(3,s=c.$$scope)},[o,l,i,s,r]}var mf=class extends ne{constructor(e){super(),ie(this,e,fk,uk,te,{name:0,description:2})}},_e=mf;function dk(n){let e,t,r,s,o,i,l,c,f,d,p=n[3].default,g=He(p,n,n[2],null);return{c(){e=L("div"),t=L("div"),r=L("div"),s=ae(n[0]),o=q(),i=L("div"),l=ae(n[1]),c=q(),f=L("div"),g&&g.c(),A(r,"class","setting-item-name"),A(i,"class","setting-item-description"),A(t,"class","setting-item-info"),A(f,"class","setting-item-control"),A(e,"class","setting-item setting-item-heading")},m(_,y){T(_,e,y),J(e,t),J(t,r),J(r,s),J(t,o),J(t,i),J(i,l),J(e,c),J(e,f),g&&g.m(f,null),d=!0},p(_,[y]){(!d||y&1)&&we(s,_[0]),(!d||y&2)&&we(l,_[1]),g&&g.p&&(!d||y&4)&&We(g,p,_,_[2],d?Ve(p,_[2],y,null):Ke(_[2]),null)},i(_){d||(k(g,_),d=!0)},o(_){D(g,_),d=!1},d(_){_&&E(e),g&&g.d(_)}}}function hk(n,e,t){let{$$slots:r={},$$scope:s}=e,{name:o}=e,{description:i=""}=e;return n.$$set=l=>{"name"in l&&t(0,o=l.name),"description"in l&&t(1,i=l.description),"$$scope"in l&&t(2,s=l.$$scope)},[o,i,s,r]}var gf=class extends ne{constructor(e){super(),ie(this,e,hk,dk,te,{name:0,description:1})}},rt=gf;function pk(n){tt(n,"svelte-11qoyvs",".callout.svelte-11qoyvs{mix-blend-mode:normal !important}")}function mk(n){let e,t,r,s,o,i,l,c,f,d,p=n[2].default,g=He(p,n,n[1],null);return{c(){e=L("div"),t=L("div"),r=L("div"),r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-pencil"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path><path d="m15 5 4 4"></path></svg>',s=q(),o=L("div"),i=ae(n[0]),l=q(),c=L("div"),f=L("p"),g&&g.c(),A(r,"class","callout-icon"),A(r,"dir","auto"),A(o,"class","callout-title-inner"),A(o,"dir","auto"),A(t,"class","callout-title"),A(t,"dir","auto"),A(f,"dir","auto"),A(c,"class","callout-content"),A(c,"dir","auto"),A(e,"data-callout-metadata",""),A(e,"data-callout-fold",""),A(e,"data-callout","callout"),A(e,"class","callout svelte-11qoyvs"),A(e,"dir","auto")},m(_,y){T(_,e,y),J(e,t),J(t,r),J(t,s),J(t,o),J(o,i),J(e,l),J(e,c),J(c,f),g&&g.m(f,null),d=!0},p(_,[y]){(!d||y&1)&&we(i,_[0]),g&&g.p&&(!d||y&2)&&We(g,p,_,_[1],d?Ve(p,_[1],y,null):Ke(_[1]),null)},i(_){d||(k(g,_),d=!0)},o(_){D(g,_),d=!1},d(_){_&&E(e),g&&g.d(_)}}}function gk(n,e,t){let{$$slots:r={},$$scope:s}=e,{title:o}=e;return n.$$set=i=>{"title"in i&&t(0,o=i.title),"$$scope"in i&&t(1,s=i.$$scope)},[o,s,r]}var yf=class extends ne{constructor(e){super(),ie(this,e,gk,mk,te,{title:0},pk)}},wf=yf;var ao=[];function yk(n,e){return{subscribe:Je(n,e).subscribe}}function Je(n,e=Z){let t,r=new Set;function s(l){if(te(n,l)&&(n=l,t)){let c=!ao.length;for(let f of r)f[1](),ao.push(f,n);if(c){for(let f=0;f<ao.length;f+=2)ao[f][0](ao[f+1]);ao.length=0}}}function o(l){s(l(n))}function i(l,c=Z){let f=[l,c];return r.add(f),r.size===1&&(t=e(s,o)||Z),l(n),()=>{r.delete(f),r.size===0&&t&&(t(),t=null)}}return{set:s,update:o,subscribe:i}}function fi(n,e,t){let r=!Array.isArray(n),s=r?[n]:n;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");let o=e.length<2;return yk(t,(i,l)=>{let c=!1,f=[],d=0,p=Z,g=()=>{if(d)return;p();let y=e(r?f[0]:f,i,l);o?i(y):p=et(y)?y:Z},_=s.map((y,b)=>Et(y,C=>{f[b]=C,d&=~(1<<b),c&&g()},()=>{d|=1<<b}));return c=!0,g(),function(){Te(_),p(),c=!1}})}var ig=require("obsidian");if(globalThis.Response===void 0||globalThis.Headers===void 0)try{if(console.warn("[Relay] Polyfilling Fetch API (Electron Bug: https://github.com/electron/electron/pull/42419)"),globalThis.blinkfetch){globalThis.fetch=globalThis.blinkFetch;let n=["fetch","Response","FormData","Request","Headers"];for(let e of n)globalThis[e]=globalThis[`blink${e}`]}}catch(n){console.error(n)}var ts=async(n,e)=>{let t=n instanceof URL?n.toString():n,r=(e==null?void 0:e.method)||"GET",s={url:t,method:r,body:e==null?void 0:e.body,headers:e==null?void 0:e.headers,throw:!1},o;if(o=await(0,ig.requestUrl)(s),!o.arrayBuffer.byteLength)return new Response(null,{status:o.status,statusText:o.status.toString(),headers:new Headers(o.headers)});let i=new Response(o.arrayBuffer,{status:o.status,statusText:o.status.toString(),headers:new Headers(o.headers)});Object.defineProperty(i,"json",{value:async()=>JSON.parse(o.text)});let c=o.status>=500?"error":o.status>=400?"warn":"debug",f=o.text;if(Q("[CustomFetch]",c)(o.status.toString(),r,t,f),o.status>=500)throw new Error(f);return i};function wk(n){tt(n,"svelte-1h8zaiy",".object-state-display.svelte-1h8zaiy{padding:10px;margin-top:10px;font-family:monospace}pre.svelte-1h8zaiy{white-space:pre-wrap;word-wrap:break-word}")}function _k(n){let e,t,r=Object.keys(n[0]).join(`
`)+"",s,o;return{c(){e=L("div"),t=L("pre"),s=ae(r),o=ae(`
        `),A(t,"class","svelte-1h8zaiy"),A(e,"class","object-state-display svelte-1h8zaiy")},m(i,l){T(i,e,l),J(e,t),J(t,s),J(t,o)},p(i,[l]){l&1&&r!==(r=Object.keys(i[0]).join(`
`)+"")&&we(s,r)},i:Z,o:Z,d(i){i&&E(e)}}}function bk(n,e,t){let{object:r}=e;return n.$$set=s=>{"object"in s&&t(0,r=s.object)},[r]}var _f=class extends ne{constructor(e){super(),ie(this,e,bk,_k,te,{object:0},wk)}},ag=_f;function vk(n){tt(n,"svelte-1xhkojk","#login-issues.svelte-1xhkojk{color:var(--color-base-40)}")}function xk(n){let e,t,r,s,o,i;e=new rt({props:{name:"Account",$$slots:{default:[Ek]},$$scope:{ctx:n}}});let l=[Ak,Tk],c=[];function f(d,p){return d[2]?0:1}return r=f(n,[-1,-1]),s=c[r]=l[r](n),{c(){H(e.$$.fragment),t=q(),s.c(),o=$e()},m(d,p){N(e,d,p),T(d,t,p),c[r].m(d,p),T(d,o,p),i=!0},p(d,p){let g={};p[0]&4|p[1]&16384&&(g.$$scope={dirty:p,ctx:d}),e.$set(g);let _=r;r=f(d,p),r===_?c[r].p(d,p):(xe(),D(c[_],1,1,()=>{c[_]=null}),Se(),s=c[r],s?s.p(d,p):(s=c[r]=l[r](d),s.c()),k(s,1),s.m(o.parentNode,o))},i(d){i||(k(e.$$.fragment,d),k(s),i=!0)},o(d){D(e.$$.fragment,d),D(s),i=!1},d(d){d&&(E(t),E(o)),B(e,d),c[r].d(d)}}}function Sk(n){var c;let e,t,r,s,o;e=new rt({props:{name:"Account"}}),r=new _e({props:{name:"Your account",description:"You are currently logged in as: "+((c=n[1].user)==null?void 0:c.name)+".",$$slots:{default:[Kk]},$$scope:{ctx:n}}});let i=n[31].default,l=He(i,n,n[45],null);return{c(){H(e.$$.fragment),t=q(),H(r.$$.fragment),s=q(),l&&l.c()},m(f,d){N(e,f,d),T(f,t,d),N(r,f,d),T(f,s,d),l&&l.m(f,d),o=!0},p(f,d){var g;let p={};d[0]&2&&(p.description="You are currently logged in as: "+((g=f[1].user)==null?void 0:g.name)+"."),d[1]&16384&&(p.$$scope={dirty:d,ctx:f}),r.$set(p),l&&l.p&&(!o||d[1]&16384)&&We(l,i,f,f[45],o?Ve(i,f[45],d,null):Ke(f[45]),null)},i(f){o||(k(e.$$.fragment,f),k(r.$$.fragment,f),k(l,f),o=!0)},o(f){D(e.$$.fragment,f),D(r.$$.fragment,f),D(l,f),o=!1},d(f){f&&(E(t),E(s)),B(e,f),B(r,f),l&&l.d(f)}}}function kk(n){let e,t,r,s,o;return{c(){e=L("a"),e.innerHTML="<span>Back</span>",t=ae(`
			|
			`),r=L("a"),r.innerHTML='<span><svg width="1em" height="1em" viewBox="0 -28.5 256 256" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="xMidYMid"><g><path d="M216.856339,16.5966031 C200.285002,8.84328665 182.566144,3.2084988 164.041564,0 C161.766523,4.11318106 159.108624,9.64549908 157.276099,14.0464379 C137.583995,11.0849896 118.072967,11.0849896 98.7430163,14.0464379 C96.9108417,9.64549908 94.1925838,4.11318106 91.8971895,0 C73.3526068,3.2084988 55.6133949,8.86399117 39.0420583,16.6376612 C5.61752293,67.146514 -3.4433191,116.400813 1.08711069,164.955721 C23.2560196,181.510915 44.7403634,191.567697 65.8621325,198.148576 C71.0772151,190.971126 75.7283628,183.341335 79.7352139,175.300261 C72.104019,172.400575 64.7949724,168.822202 57.8887866,164.667963 C59.7209612,163.310589 61.5131304,161.891452 63.2445898,160.431257 C105.36741,180.133187 151.134928,180.133187 192.754523,160.431257 C194.506336,161.891452 196.298154,163.310589 198.110326,164.667963 C191.183787,168.842556 183.854737,172.420929 176.223542,175.320965 C180.230393,183.341335 184.861538,190.991831 190.096624,198.16893 C211.238746,191.588051 232.743023,181.531619 254.911949,164.955721 C260.227747,108.668201 245.831087,59.8662432 216.856339,16.5966031 Z M85.4738752,135.09489 C72.8290281,135.09489 62.4592217,123.290155 62.4592217,108.914901 C62.4592217,94.5396472 72.607595,82.7145587 85.4738752,82.7145587 C98.3405064,82.7145587 108.709962,94.5189427 108.488529,108.914901 C108.508531,123.290155 98.3405064,135.09489 85.4738752,135.09489 Z M170.525237,135.09489 C157.88039,135.09489 147.510584,123.290155 147.510584,108.914901 C147.510584,94.5396472 157.658606,82.7145587 170.525237,82.7145587 C183.391518,82.7145587 193.761324,94.5189427 193.539891,108.914901 C193.539891,123.290155 183.391518,135.09489 170.525237,135.09489 Z" fill="#5865F2" fill-rule="nonzero"></path></g></svg></span>',A(e,"href","#standard"),A(e,"role","button"),A(e,"tabindex","0"),A(r,"href","https://discord.system3.md")},m(i,l){T(i,e,l),T(i,t,l),T(i,r,l),s||(o=[re(e,"keydown",n[35]),re(e,"click",n[36])],s=!0)},p:Z,d(i){i&&(E(e),E(t),E(r)),s=!1,Te(o)}}}function Ck(n){let e,t,r,s,o,i,l;return{c(){e=L("span"),t=ae("login issues? try the "),r=L("a"),r.textContent="debug flow.",s=ae(`
			|
			`),o=L("a"),o.innerHTML='<span><svg width="1em" height="1em" viewBox="0 -28.5 256 256" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="xMidYMid"><g><path d="M216.856339,16.5966031 C200.285002,8.84328665 182.566144,3.2084988 164.041564,0 C161.766523,4.11318106 159.108624,9.64549908 157.276099,14.0464379 C137.583995,11.0849896 118.072967,11.0849896 98.7430163,14.0464379 C96.9108417,9.64549908 94.1925838,4.11318106 91.8971895,0 C73.3526068,3.2084988 55.6133949,8.86399117 39.0420583,16.6376612 C5.61752293,67.146514 -3.4433191,116.400813 1.08711069,164.955721 C23.2560196,181.510915 44.7403634,191.567697 65.8621325,198.148576 C71.0772151,190.971126 75.7283628,183.341335 79.7352139,175.300261 C72.104019,172.400575 64.7949724,168.822202 57.8887866,164.667963 C59.7209612,163.310589 61.5131304,161.891452 63.2445898,160.431257 C105.36741,180.133187 151.134928,180.133187 192.754523,160.431257 C194.506336,161.891452 196.298154,163.310589 198.110326,164.667963 C191.183787,168.842556 183.854737,172.420929 176.223542,175.320965 C180.230393,183.341335 184.861538,190.991831 190.096624,198.16893 C211.238746,191.588051 232.743023,181.531619 254.911949,164.955721 C260.227747,108.668201 245.831087,59.8662432 216.856339,16.5966031 Z M85.4738752,135.09489 C72.8290281,135.09489 62.4592217,123.290155 62.4592217,108.914901 C62.4592217,94.5396472 72.607595,82.7145587 85.4738752,82.7145587 C98.3405064,82.7145587 108.709962,94.5189427 108.488529,108.914901 C108.508531,123.290155 98.3405064,135.09489 85.4738752,135.09489 Z M170.525237,135.09489 C157.88039,135.09489 147.510584,123.290155 147.510584,108.914901 C147.510584,94.5396472 157.658606,82.7145587 170.525237,82.7145587 C183.391518,82.7145587 193.761324,94.5189427 193.539891,108.914901 C193.539891,123.290155 183.391518,135.09489 170.525237,135.09489 Z" fill="#5865F2" fill-rule="nonzero"></path></g></svg></span>',A(r,"href","#debug"),A(r,"role","button"),A(r,"tabindex","0"),A(e,"id","login-issues"),A(e,"class","svelte-1xhkojk"),A(o,"href","https://discord.system3.md")},m(c,f){T(c,e,f),J(e,t),J(e,r),T(c,s,f),T(c,o,f),i||(l=[re(r,"keypress",n[33]),re(r,"click",n[34])],i=!0)},p:Z,d(c){c&&(E(e),E(s),E(o)),i=!1,Te(l)}}}function Ek(n){let e;function t(o,i){return o[2]?Ck:kk}let r=t(n,[-1,-1]),s=r(n);return{c(){s.c(),e=$e()},m(o,i){s.m(o,i),T(o,e,i)},p(o,i){r===(r=t(o,i))&&s?s.p(o,i):(s.d(1),s=r(o),s&&(s.c(),s.m(e.parentNode,e)))},d(o){o&&E(e),s.d(o)}}}function Tk(n){let e,t,r,s,o,i,l,c,f,d,p,g,_,y,b,C,x,M,W,S,R,O,U,I,oe,ue,se;e=new wf({props:{title:"Get Help",$$slots:{default:[Dk]},$$scope:{ctx:n}}});let ge=n[4]&&lg(n);s=new _e({props:{name:"Login",description:"Please complete the login flow in your browser and wait a few seconds.",$$slots:{default:[Rk]},$$scope:{ctx:n}}}),i=new _e({props:{name:"",description:`If your browser doesn't open, you can login manually by
			visiting this URL in your browser. Clicking will copy the link to your clipboard.`,$$slots:{default:[Fk]},$$scope:{ctx:n}}}),c=new rt({props:{name:"Environment",$$slots:{default:[Pk]},$$scope:{ctx:n}}}),d=new _e({props:{name:"User Agent",description:"",$$slots:{default:[Ok]},$$scope:{ctx:n}}}),g=new _e({props:{name:"Fetch",description:"",$$slots:{default:[Ik]},$$scope:{ctx:n}}}),y=new _e({props:{name:"Response",description:"",$$slots:{default:[Lk]},$$scope:{ctx:n}}}),C=new _e({props:{name:"Blink Fetch",description:"",$$slots:{default:[$k]},$$scope:{ctx:n}}}),M=new rt({props:{name:"Connections"}}),S=new ag({props:{object:n[9].cancelControllers}}),O=new rt({props:{name:"Advanced"}}),I=new _e({props:{name:"Debug logs",description:"Enable debug logs to help diagnose issues.",$$slots:{default:[Uk]},$$scope:{ctx:n}}});let be=n[11]&&cg(n);return{c(){H(e.$$.fragment),t=q(),ge&&ge.c(),r=q(),H(s.$$.fragment),o=q(),H(i.$$.fragment),l=q(),H(c.$$.fragment),f=q(),H(d.$$.fragment),p=q(),H(g.$$.fragment),_=q(),H(y.$$.fragment),b=q(),H(C.$$.fragment),x=q(),H(M.$$.fragment),W=q(),H(S.$$.fragment),R=q(),H(O.$$.fragment),U=q(),H(I.$$.fragment),oe=q(),be&&be.c(),ue=$e()},m($,j){N(e,$,j),T($,t,j),ge&&ge.m($,j),T($,r,j),N(s,$,j),T($,o,j),N(i,$,j),T($,l,j),N(c,$,j),T($,f,j),N(d,$,j),T($,p,j),N(g,$,j),T($,_,j),N(y,$,j),T($,b,j),N(C,$,j),T($,x,j),N(M,$,j),T($,W,j),N(S,$,j),T($,R,j),N(O,$,j),T($,U,j),N(I,$,j),T($,oe,j),be&&be.m($,j),T($,ue,j),se=!0},p($,j){let V={};j[1]&16384&&(V.$$scope={dirty:j,ctx:$}),e.$set(V),$[4]?ge?(ge.p($,j),j[0]&16&&k(ge,1)):(ge=lg($),ge.c(),k(ge,1),ge.m(r.parentNode,r)):ge&&(xe(),D(ge,1,1,()=>{ge=null}),Se());let z={};j[0]&32|j[1]&16384&&(z.$$scope={dirty:j,ctx:$}),s.$set(z);let ke={};j[0]&32|j[1]&16384&&(ke.$$scope={dirty:j,ctx:$}),i.$set(ke);let vt={};j[1]&16384&&(vt.$$scope={dirty:j,ctx:$}),c.$set(vt);let nt={};j[1]&16384&&(nt.$$scope={dirty:j,ctx:$}),d.$set(nt);let yt={};j[0]&64|j[1]&16384&&(yt.$$scope={dirty:j,ctx:$}),g.$set(yt);let le={};j[0]&128|j[1]&16384&&(le.$$scope={dirty:j,ctx:$}),y.$set(le);let G={};j[0]&256|j[1]&16384&&(G.$$scope={dirty:j,ctx:$}),C.$set(G);let ln={};j[0]&512&&(ln.object=$[9].cancelControllers),S.$set(ln);let Wt={};j[0]&1024|j[1]&16384&&(Wt.$$scope={dirty:j,ctx:$}),I.$set(Wt),$[11]?be?(be.p($,j),j[0]&2048&&k(be,1)):(be=cg($),be.c(),k(be,1),be.m(ue.parentNode,ue)):be&&(xe(),D(be,1,1,()=>{be=null}),Se())},i($){se||(k(e.$$.fragment,$),k(ge),k(s.$$.fragment,$),k(i.$$.fragment,$),k(c.$$.fragment,$),k(d.$$.fragment,$),k(g.$$.fragment,$),k(y.$$.fragment,$),k(C.$$.fragment,$),k(M.$$.fragment,$),k(S.$$.fragment,$),k(O.$$.fragment,$),k(I.$$.fragment,$),k(be),se=!0)},o($){D(e.$$.fragment,$),D(ge),D(s.$$.fragment,$),D(i.$$.fragment,$),D(c.$$.fragment,$),D(d.$$.fragment,$),D(g.$$.fragment,$),D(y.$$.fragment,$),D(C.$$.fragment,$),D(M.$$.fragment,$),D(S.$$.fragment,$),D(O.$$.fragment,$),D(I.$$.fragment,$),D(be),se=!1},d($){$&&(E(t),E(r),E(o),E(l),E(f),E(p),E(_),E(b),E(x),E(W),E(R),E(U),E(oe),E(ue)),B(e,$),ge&&ge.d($),B(s,$),B(i,$),B(c,$),B(d,$),B(g,$),B(y,$),B(C,$),B(M,$),B(S,$),B(O,$),B(I,$),be&&be.d($)}}}function Ak(n){let e,t,r,s,o=[Hk,Bk],i=[];function l(c,f){return c[3]?1:0}return e=l(n,[-1,-1]),t=i[e]=o[e](n),{c(){t.c(),r=$e()},m(c,f){i[e].m(c,f),T(c,r,f),s=!0},p(c,f){let d=e;e=l(c,f),e===d?i[e].p(c,f):(xe(),D(i[d],1,1,()=>{i[d]=null}),Se(),t=i[e],t?t.p(c,f):(t=i[e]=o[e](c),t.c()),k(t,1),t.m(r.parentNode,r))},i(c){s||(k(t),s=!0)},o(c){D(t),s=!1},d(c){c&&E(r),i[e].d(c)}}}function Dk(n){let e;return{c(){e=L("p"),e.innerHTML='We&#39;re working on improving the login process. Please <a href="https://discord.system3.md">join our Discord</a> and we will help you.'},m(t,r){T(t,e,r)},p:Z,d(t){t&&E(e)}}}function lg(n){let e,t;return e=new wf({props:{title:"Error",$$slots:{default:[Mk]},$$scope:{ctx:n}}}),{c(){H(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s[0]&16|s[1]&16384&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function Mk(n){let e,t;return{c(){e=L("p"),t=ae(n[4])},m(r,s){T(r,e,s),J(e,t)},p(r,s){s[0]&16&&we(t,r[4])},d(r){r&&E(e)}}}function Rk(n){let e,t,r,s,o,i;return{c(){e=L("a"),t=L("button"),r=ae("Login"),t.disabled=s=n[5]==="please wait...",A(e,"href",n[5]),A(e,"target","_blank")},m(l,c){T(l,e,c),J(e,t),J(t,r),o||(i=re(t,"click",n[39]),o=!0)},p(l,c){c[0]&32&&s!==(s=l[5]==="please wait...")&&(t.disabled=s),c[0]&32&&A(e,"href",l[5])},d(l){l&&E(e),o=!1,i()}}}function Fk(n){let e,t,r;return{c(){e=L("input"),A(e,"type","text"),e.value=n[5],e.readOnly=!0,bt(e,"width","100%"),A(e,"id","system3AuthUrl")},m(s,o){T(s,e,o),t||(r=re(e,"click",(0,Fr.debounce)(n[29])),t=!0)},p(s,o){o[0]&32&&e.value!==s[5]&&(e.value=s[5])},d(s){s&&E(e),t=!1,r()}}}function Pk(n){let e,t,r;return{c(){e=L("button"),e.textContent="Refresh"},m(s,o){T(s,e,o),t||(r=re(e,"click",(0,Fr.debounce)(n[40])),t=!0)},p:Z,d(s){s&&E(e),t=!1,r()}}}function Ok(n){let e=navigator.userAgent+"",t;return{c(){t=ae(e)},m(r,s){T(r,t,s)},p:Z,d(r){r&&E(t)}}}function Ik(n){let e;return{c(){e=ae(n[6])},m(t,r){T(t,e,r)},p(t,r){r[0]&64&&we(e,t[6])},d(t){t&&E(e)}}}function Lk(n){let e;return{c(){e=ae(n[7])},m(t,r){T(t,e,r)},p(t,r){r[0]&128&&we(e,t[7])},d(t){t&&E(e)}}}function $k(n){let e;return{c(){e=ae(n[8])},m(t,r){T(t,e,r)},p(t,r){r[0]&256&&we(e,t[8])},d(t){t&&E(e)}}}function Uk(n){let e,t,r,s,o;return{c(){e=L("div"),t=L("input"),A(t,"type","checkbox"),A(t,"tabindex","0"),A(e,"aria-label","custom fetch can help avoid some network restrictions"),A(e,"role","checkbox"),A(e,"aria-checked",n[10]),A(e,"tabindex","0"),A(e,"class",r="checkbox-container mod-small "+(n[10]?"is-enabled":""))},m(i,l){T(i,e,l),J(e,t),t.checked=n[10],s||(o=[re(t,"change",n[41]),re(e,"click",n[42]),re(e,"keydown",(0,Fr.debounce)(n[43]))],s=!0)},p(i,l){l[0]&1024&&(t.checked=i[10]),l[0]&1024&&A(e,"aria-checked",i[10]),l[0]&1024&&r!==(r="checkbox-container mod-small "+(i[10]?"is-enabled":""))&&A(e,"class",r)},d(i){i&&E(e),s=!1,Te(o)}}}function cg(n){let e,t;return e=new _e({props:{name:"Check",description:"Click here once you've completed login",$$slots:{default:[Nk]},$$scope:{ctx:n}}}),{c(){H(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s[1]&16384&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function Nk(n){let e,t,r;return{c(){e=L("button"),e.textContent="Check"},m(s,o){T(s,e,o),t||(r=re(e,"click",(0,Fr.debounce)(n[44])),t=!0)},p:Z,d(s){s&&E(e),t=!1,r()}}}function Bk(n){let e,t;return e=new _e({props:{name:"Login",description:"Please complete the login flow in your browser and wait a few seconds.",$$slots:{default:[Vk]},$$scope:{ctx:n}}}),{c(){H(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s[1]&16384&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function Hk(n){let e,t;return e=new _e({props:{name:"Login",description:"You need to login to use this plugin.",$$slots:{default:[Wk]},$$scope:{ctx:n}}}),{c(){H(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s[1]&16384&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function Vk(n){let e,t,r;return{c(){e=L("button"),e.textContent="Cancel",A(e,"class","mod-destructive")},m(s,o){T(s,e,o),t||(r=re(e,"click",(0,Fr.debounce)(n[38])),t=!0)},p:Z,d(s){s&&E(e),t=!1,r()}}}function Wk(n){let e,t,r;return{c(){e=L("button"),e.textContent="Login with Google"},m(s,o){T(s,e,o),t||(r=re(e,"click",(0,Fr.debounce)(n[37])),t=!0)},p:Z,d(s){s&&E(e),t=!1,r()}}}function Kk(n){let e,t,r;return{c(){e=L("button"),e.textContent="Logout"},m(s,o){T(s,e,o),t||(r=re(e,"click",(0,Fr.debounce)(n[32])),t=!0)},p:Z,d(s){s&&E(e),t=!1,r()}}}function Yk(n){let e,t,r,s,o=[Sk,xk],i=[];function l(c,f){return c[1].hasUser?0:1}return e=l(n,[-1,-1]),t=i[e]=o[e](n),{c(){t.c(),r=$e()},m(c,f){i[e].m(c,f),T(c,r,f),s=!0},p(c,f){let d=e;e=l(c,f),e===d?i[e].p(c,f):(xe(),D(i[d],1,1,()=>{i[d]=null}),Se(),t=i[e],t?t.p(c,f):(t=i[e]=o[e](c),t.c()),k(t,1),t.m(r.parentNode,r))},i(c){s||(k(t),s=!0)},o(c){D(t),s=!1},d(c){c&&E(r),i[e].d(c)}}}function bf(){try{return Response.toString()}catch(n){return"undefined"}}function ug(){try{return fetch.toString()}catch(n){return"undefined"}}function fg(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(n){return"No"}}function Jk(n,e,t){let r,s,o=Z,i=()=>(o(),o=Et(S,F=>t(1,s=F)),S),l,c,f,d,p,g,_,y,b,C;n.$$.on_destroy.push(()=>o());let{$$slots:x={},$$scope:M}=e,{plugin:W}=e,S,R=Je(!0);Fe(n,R,F=>t(2,l=F));let O=Je(!1);Fe(n,O,F=>t(3,c=F)),i(S=W.loginManager);let U=Je(!1);Fe(n,U,F=>t(11,C=F));let I=Je(!1),oe=Je(!1),ue=Je(!0);Fe(n,ue,F=>t(48,r=F));let se=Je("please wait...");Fe(n,se,F=>t(5,d=F));let ge,be,$=Je("");Fe(n,$,F=>t(4,f=F));let j=Je(W.settings.debugging);Fe(n,j,F=>t(10,b=F));function V(){j.set(W.toggleDebugging(!0))}function z(){return ft(this,void 0,void 0,function*(){yield W.loginManager.logout(),I.set(!1),U.set(!1)})}function ke(){return ft(this,void 0,void 0,function*(){try{yield W.loginManager.login()}catch(F){R.set(!1),I.set(!1)}})}let vt=Je(bf());Fe(n,vt,F=>t(7,g=F));let nt=Je(ug());Fe(n,nt,F=>t(6,p=F));let yt=Je(fg());Fe(n,yt,F=>t(8,_=F));let le=Je(W.loginManager.pb);Fe(n,le,F=>t(9,y=F));function G(){vt.set(bf()),nt.set(ug()),yt.set(fg()),le.set(W.loginManager.pb)}function ln(){try{let F=r?ts:fetch;ge=void 0,se.set("please wait..."),S.initiateManualOAuth2CodeFlow(F).then(([de,Ue,Ae])=>{ge=Ue,be=Ae,se.set(de)}).catch(de=>{let Ue=de.message;throw Ue=Ue+`
`+bf(),$.set(Ue),de})}catch(F){$.set(F.message)}}pr(()=>{I.set(!1),ln()});function Wt(){return ft(this,void 0,void 0,function*(){if(!(!ge||!be))return yield W.loginManager.poll(ge,be).then(F=>{I.set(!0),$.set("")}).catch(F=>{U.set(!0),I.set(!1),$.set(F.message)})})}function Or(F){let de=F.target;de.focus(),de.select(),navigator.clipboard.writeText(de.value).then(()=>new Fr.Notice("Invite link copied")).catch(Ue=>{}),Wt()}let os=()=>{z()},is=F=>{F.key==="Enter"&&ni(R,l=!l,l)},ho=()=>{ni(R,l=!l,l)},po=F=>{F.key==="Enter"&&ni(R,l=!l,l)},mo=()=>{ni(R,l=!l,l)},go=async()=>{await ke()},yo=()=>{O.set(!1)},wo=()=>{oe.set(!0),Wt()},_o=()=>{G()};function bo(){b=this.checked,j.set(b)}let vo=()=>{V()},Ir=F=>{F.key==="Enter"&&V()},Ze=()=>{Wt()};return n.$$set=F=>{"plugin"in F&&t(30,W=F.plugin),"$$scope"in F&&t(45,M=F.$$scope)},[S,s,l,c,f,d,p,g,_,y,b,C,R,O,U,oe,ue,se,$,j,V,z,ke,vt,nt,yt,le,G,Wt,Or,W,x,os,is,ho,po,mo,go,yo,wo,_o,bo,vo,Ir,Ze,M]}var vf=class extends ne{constructor(e){super(),ie(this,e,Jk,Yk,te,{plugin:30},vk,[-1,-1])}},dg=vf;function qk(n){let e,t,r,s,o;return t=new Hu({props:{class:"svg-icon lucide-settings",props:{class:"svg-icon lucide-settings"}}}),{c(){e=L("div"),H(t.$$.fragment),A(e,"class","clickable-icon extra-setting-button"),A(e,"aria-label","Options"),A(e,"role","button"),A(e,"tabindex","0")},m(i,l){T(i,e,l),N(t,e,null),r=!0,s||(o=[re(e,"click",n[0]),re(e,"keydown",n[0])],s=!0)},p:Z,i(i){r||(k(t.$$.fragment,i),r=!0)},o(i){D(t.$$.fragment,i),r=!1},d(i){i&&E(e),B(t),s=!1,Te(o)}}}function jk(n){let e=mr();function t(r){(r instanceof MouseEvent||r instanceof KeyboardEvent&&(r.key==="Enter"||r.key===" "))&&e("settings")}return[t]}var xf=class extends ne{constructor(e){super(),ie(this,e,jk,qk,te,{})}},rs=xf;function hg(n){let e,t,r,s=n[0].remote.relay.name+"",o,i;return e=new Ou({props:{class:"svg-icon",style:"margin: 0 1em"}}),r=new gr({props:{class:"svg-icon"}}),{c(){H(e.$$.fragment),t=q(),H(r.$$.fragment),o=ae(s)},m(l,c){N(e,l,c),T(l,t,c),N(r,l,c),T(l,o,c),i=!0},p(l,c){(!i||c&1)&&s!==(s=l[0].remote.relay.name+"")&&we(o,s)},i(l){i||(k(e.$$.fragment,l),k(r.$$.fragment,l),i=!0)},o(l){D(e.$$.fragment,l),D(r.$$.fragment,l),i=!1},d(l){l&&(E(t),E(o)),B(e,l),B(r,l)}}}function Gk(n){let e,t,r=n[0].name+"",s,o,i;t=new ii({props:{class:"svg-icon",style:"margin-right: .2em; width: 1em;"}});let l=n[0].remote&&hg(n);return{c(){e=L("span"),H(t.$$.fragment),s=ae(r),o=q(),l&&l.c(),bt(e,"display","inline-flex"),bt(e,"align-items","center")},m(c,f){T(c,e,f),N(t,e,null),J(e,s),J(e,o),l&&l.m(e,null),i=!0},p(c,[f]){(!i||f&1)&&r!==(r=c[0].name+"")&&we(s,r),c[0].remote?l?(l.p(c,f),f&1&&k(l,1)):(l=hg(c),l.c(),k(l,1),l.m(e,null)):l&&(xe(),D(l,1,1,()=>{l=null}),Se())},i(c){i||(k(t.$$.fragment,c),k(l),i=!0)},o(c){D(t.$$.fragment,c),D(l),i=!1},d(c){c&&E(e),B(t),l&&l.d()}}}function zk(n,e,t){let{folder:r}=e;return n.$$set=s=>{"folder"in s&&t(0,r=s.folder)},[r]}var Sf=class extends ne{constructor(e){super(),ie(this,e,zk,Gk,te,{folder:0})}},pg=Sf;var lo=require("obsidian");function Xk(n){tt(n,"svelte-yg42fv","input.system3-input-invalid.svelte-yg42fv{border:1px solid var(--color-red) !important}span.faint.svelte-yg42fv{color:var(--text-faint)}")}function mg(n,e,t){let r=n.slice();return r[18]=e[t],r}function gg(n,e,t){let r=n.slice();return r[21]=e[t],r}function Zk(n){let e,t,r,s,o,i;return{c(){e=L("input"),r=q(),s=L("button"),s.textContent="Join relay",A(e,"type","text"),A(e,"placeholder","Enter share key"),A(e,"class",t=zs(n[2]?"system3-input-invalid":"")+" svelte-yg42fv"),A(s,"class","mod-cta")},m(l,c){T(l,e,c),er(e,n[1]),T(l,r,c),T(l,s,c),o||(i=[re(e,"input",n[12]),re(e,"input",n[8]),re(s,"click",function(){et((0,lo.debounce)(n[13]))&&(0,lo.debounce)(n[13]).apply(this,arguments)})],o=!0)},p(l,c){n=l,c&4&&t!==(t=zs(n[2]?"system3-input-invalid":"")+" svelte-yg42fv")&&A(e,"class",t),c&2&&e.value!==n[1]&&er(e,n[1])},d(l){l&&(E(e),E(r),E(s)),o=!1,Te(i)}}}function Qk(n){let e,t;function r(){return n[14](n[21])}return e=new rs({}),e.$on("settings",r),{c(){H(e.$$.fragment)},m(s,o){N(e,s,o),t=!0},p(s,o){n=s},i(s){t||(k(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){B(e,s)}}}function eC(n){let e;return{c(){e=L("span"),e.textContent="(Untitled Relay)",A(e,"class","faint svelte-yg42fv")},m(t,r){T(t,e,r)},p:Z,d(t){t&&E(e)}}}function tC(n){let e=n[21].name+"",t;return{c(){t=ae(e)},m(r,s){T(r,t,s)},p(r,s){s&8&&e!==(e=r[21].name+"")&&we(t,e)},d(r){r&&E(t)}}}function rC(n){let e,t,r,s;t=new gr({props:{class:"svg-icon"}});function o(c,f){return c[21].name?tC:eC}let i=o(n,-1),l=i(n);return{c(){e=L("span"),H(t.$$.fragment),r=q(),l.c(),A(e,"slot","name"),bt(e,"display","inline-flex")},m(c,f){T(c,e,f),N(t,e,null),J(e,r),l.m(e,null),s=!0},p(c,f){i===(i=o(c,f))&&l?l.p(c,f):(l.d(1),l=i(c),l&&(l.c(),l.m(e,null)))},i(c){s||(k(t.$$.fragment,c),s=!0)},o(c){D(t.$$.fragment,c),s=!1},d(c){c&&E(e),B(t),l.d()}}}function yg(n){let e,t;return e=new _e({props:{description:"",$$slots:{name:[rC],default:[Qk]},$$scope:{ctx:n}}}),{c(){H(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s&16777224&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function nC(n){let e,t,r;return{c(){e=L("button"),e.textContent="New relay",A(e,"class","mod-cta")},m(s,o){T(s,e,o),t||(r=re(e,"click",(0,lo.debounce)(n[15])),t=!0)},p:Z,d(s){s&&E(e),t=!1,r()}}}function sC(n){let e,t,r;function s(){return n[16](n[18])}return e=new rs({}),e.$on("settings",function(){et((0,lo.debounce)(s))&&(0,lo.debounce)(s).apply(this,arguments)}),{c(){H(e.$$.fragment),t=q()},m(o,i){N(e,o,i),T(o,t,i),r=!0},p(o,i){n=o},i(o){r||(k(e.$$.fragment,o),r=!0)},o(o){D(e.$$.fragment,o),r=!1},d(o){o&&E(t),B(e,o)}}}function oC(n){let e,t;return e=new pg({props:{folder:n[18],slot:"name"}}),{c(){H(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s&16&&(o.folder=r[18]),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function wg(n){let e,t;return e=new _e({props:{description:"",$$slots:{name:[oC],default:[sC]},$$scope:{ctx:n}}}),{c(){H(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s&16777240&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function iC(n){let e,t,r,s,o,i,l,c,f,d,p,g,_;e=new rt({props:{name:"Join a relay",description:""}}),r=new _e({props:{name:"Share key",description:"Enter the code that was shared with you.",$$slots:{default:[Zk]},$$scope:{ctx:n}}}),o=new rt({props:{name:"Relays"}});let y=ze(n[3].values().sort(_g)),b=[];for(let S=0;S<y.length;S+=1)b[S]=yg(gg(n,y,S));let C=S=>D(b[S],1,1,()=>{b[S]=null});c=new _e({props:{name:"",description:"",$$slots:{default:[nC]},$$scope:{ctx:n}}}),d=new rt({props:{name:"Shared folders"}});let x=ze(n[4].items()),M=[];for(let S=0;S<x.length;S+=1)M[S]=wg(mg(n,x,S));let W=S=>D(M[S],1,1,()=>{M[S]=null});return{c(){H(e.$$.fragment),t=q(),H(r.$$.fragment),s=q(),H(o.$$.fragment),i=q();for(let S=0;S<b.length;S+=1)b[S].c();l=q(),H(c.$$.fragment),f=q(),H(d.$$.fragment),p=q();for(let S=0;S<M.length;S+=1)M[S].c();g=$e()},m(S,R){N(e,S,R),T(S,t,R),N(r,S,R),T(S,s,R),N(o,S,R),T(S,i,R);for(let O=0;O<b.length;O+=1)b[O]&&b[O].m(S,R);T(S,l,R),N(c,S,R),T(S,f,R),N(d,S,R),T(S,p,R);for(let O=0;O<M.length;O+=1)M[O]&&M[O].m(S,R);T(S,g,R),_=!0},p(S,[R]){let O={};if(R&16777222&&(O.$$scope={dirty:R,ctx:S}),r.$set(O),R&72){y=ze(S[3].values().sort(_g));let I;for(I=0;I<y.length;I+=1){let oe=gg(S,y,I);b[I]?(b[I].p(oe,R),k(b[I],1)):(b[I]=yg(oe),b[I].c(),k(b[I],1),b[I].m(l.parentNode,l))}for(xe(),I=y.length;I<b.length;I+=1)C(I);Se()}let U={};if(R&16777216&&(U.$$scope={dirty:R,ctx:S}),c.$set(U),R&152){x=ze(S[4].items());let I;for(I=0;I<x.length;I+=1){let oe=mg(S,x,I);M[I]?(M[I].p(oe,R),k(M[I],1)):(M[I]=wg(oe),M[I].c(),k(M[I],1),M[I].m(g.parentNode,g))}for(xe(),I=x.length;I<M.length;I+=1)W(I);Se()}},i(S){if(!_){k(e.$$.fragment,S),k(r.$$.fragment,S),k(o.$$.fragment,S);for(let R=0;R<y.length;R+=1)k(b[R]);k(c.$$.fragment,S),k(d.$$.fragment,S);for(let R=0;R<x.length;R+=1)k(M[R]);_=!0}},o(S){D(e.$$.fragment,S),D(r.$$.fragment,S),D(o.$$.fragment,S),b=b.filter(Boolean);for(let R=0;R<b.length;R+=1)D(b[R]);D(c.$$.fragment,S),D(d.$$.fragment,S),M=M.filter(Boolean);for(let R=0;R<M.length;R+=1)D(M[R]);_=!1},d(S){S&&(E(t),E(s),E(i),E(l),E(f),E(p),E(g)),B(e,S),B(r,S),B(o,S),Qt(b,S),B(c,S),B(d,S),Qt(M,S)}}}function _g(n,e){return n.owner&&!e.owner?-1:e.owner&&!n.owner||n.name>e.name?1:-1}function aC(n,e,t){let r,s=Z,o=()=>(s(),s=Et(c,U=>t(3,r=U)),c),i;n.$$.on_destroy.push(()=>s());let{plugin:l}=e,{relays:c}=e;o();let f=l.sharedFolders;Fe(n,f,U=>t(4,i=U));let d="",p=!1,g=mr();function _(U){U&&g("manageRelay",{relay:U})}function y(U,I){U&&g("manageSharedFolder",{folder:U,relay:I})}function b(){t(2,p=!1)}function C(U){return ft(this,void 0,void 0,function*(){try{let I=yield l.relayManager.acceptInvitation(U);g("joinRelay",{relay:I})}catch(I){t(2,p=!0)}})}function x(){g("createRelay")}function M(){d=this.value,t(1,d)}let W=()=>C(d),S=U=>{_(U)},R=()=>x(),O=U=>{let I=r.values().find(oe=>{var ue;return((ue=U.remote)==null?void 0:ue.relay.guid)===oe.guid});y(U,I)};return n.$$set=U=>{"plugin"in U&&t(11,l=U.plugin),"relays"in U&&o(t(0,c=U.relays))},[c,d,p,r,i,f,_,y,b,C,x,l,M,W,S,R,O]}var kf=class extends ne{constructor(e){super(),ie(this,e,aC,iC,te,{plugin:11,relays:0},Xk)}},Rn=kf;function lC(n){let e,t,r=n[0].name+"",s,o;return t=new ii({props:{class:"svg-icon",style:"margin-right: .2em; width: 1em;"}}),{c(){e=L("span"),H(t.$$.fragment),s=ae(r),bt(e,"display","inline-flex"),bt(e,"align-items","center")},m(i,l){T(i,e,l),N(t,e,null),J(e,s),o=!0},p(i,[l]){(!o||l&1)&&r!==(r=i[0].name+"")&&we(s,r)},i(i){o||(k(t.$$.fragment,i),o=!0)},o(i){D(t.$$.fragment,i),o=!1},d(i){i&&E(e),B(t)}}}function cC(n,e,t){let{folder:r}=e;return n.$$set=s=>{"folder"in s&&t(0,r=s.folder)},[r]}var Cf=class extends ne{constructor(e){super(),ie(this,e,cC,lC,te,{folder:0})}},di=Cf;var Ye=require("obsidian");var Ug=Ro(Wi());var nl=require("obsidian");function uC(n){let e,t,r=n[0].shared&&bg(n);return{c(){e=L("div"),r&&r.c(),A(e,"class","suggestion-icon")},m(s,o){T(s,e,o),r&&r.m(e,null),t=!0},p(s,o){s[0].shared?r?o&1&&k(r,1):(r=bg(s),r.c(),k(r,1),r.m(e,null)):r&&(xe(),D(r,1,1,()=>{r=null}),Se())},i(s){t||(k(r),t=!0)},o(s){D(r),t=!1},d(s){s&&E(e),r&&r.d()}}}function fC(n){let e;return{c(){e=L("span"),e.textContent="Enter to create",A(e,"class","suggestion-action")},m(t,r){T(t,e,r)},p:Z,i:Z,o:Z,d(t){t&&E(e)}}}function bg(n){let e,t;return e=new en({props:{class:"svg-icon"}}),{c(){H(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function dC(n){let e,t,r=n[0].folder+"",s,o,i,l,c,f,d=[fC,uC],p=[];function g(_,y){return _[0].exists?1:0}return l=g(n,-1),c=p[l]=d[l](n),{c(){e=L("div"),t=L("div"),s=ae(r),o=q(),i=L("div"),c.c(),A(t,"class","suggestion-title"),A(e,"class","suggestion-content"),A(i,"class","suggestion-aux")},m(_,y){T(_,e,y),J(e,t),J(t,s),T(_,o,y),T(_,i,y),p[l].m(i,null),f=!0},p(_,[y]){(!f||y&1)&&r!==(r=_[0].folder+"")&&we(s,r);let b=l;l=g(_,y),l===b?p[l].p(_,y):(xe(),D(p[b],1,1,()=>{p[b]=null}),Se(),c=p[l],c?c.p(_,y):(c=p[l]=d[l](_),c.c()),k(c,1),c.m(i,null))},i(_){f||(k(c),f=!0)},o(_){D(c),f=!1},d(_){_&&(E(e),E(o),E(i)),p[l].d()}}}function hC(n,e,t){let{suggestion:r}=e;return n.$$set=s=>{"suggestion"in s&&t(0,r=s.suggestion)},[r]}var Ef=class extends ne{constructor(e){super(),ie(this,e,hC,dC,te,{suggestion:0})}},vg=Ef;var rl=class extends nl.SuggestModal{constructor(t,r,s){super(t);this.sharedFolders=r;this.onChoose=s;this.components=[];this.sharedPaths=new Set(this.sharedFolders.map(o=>o.path)),this.hasRemotes=new Set(this.sharedFolders.filter(o=>o.remote!==void 0).map(o=>o.path)),this.setInstructions([{command:"\u2191/\u2193",purpose:"Navigate"},{command:"Enter",purpose:"Choose and share folder"},{command:"Esc",purpose:"Cancel"}])}sortFn(t,r){return t.exists&&!r.exists?-1:!t.exists&&r.exists?1:t.shared&&!r.shared?-1:r.shared&&!t.shared?1:t.folder.localeCompare(r.folder)}onClose(){super.onClose(),this.components.forEach(t=>{t.$destroy()})}getSuggestions(t){this.components.forEach(l=>{l.$destroy()});let r=t.toLowerCase(),s=[],o=this.app.vault.getAbstractFileByPath(t)!==null;t.length>0&&!o&&s.push({folder:t,exists:!1,shared:!1});let i=l=>{let c=this.sharedPaths.has(l.path),f=this.hasRemotes.has(l.path);if(l.path.toLowerCase().contains(r)&&l.path.length>1&&!f&&s.push({folder:l.path,exists:!0,shared:c}),!c)for(let d of l.children)d instanceof nl.TFolder&&i(d)};return i(this.app.vault.getRoot()),s.sort(this.sortFn)}renderSuggestion(t,r){r.addClass("mod-complex");let s=new vg({target:r,props:{suggestion:t}});this.components.push(s)}onChooseSuggestion(t,r){this.onChoose(t.folder)}};var Tg=require("obsidian");var Af=require("obsidian");var xg=require("obsidian"),Sg=require("obsidian"),sl=class extends Sg.AbstractInputSuggest{constructor(t,r,s){super(t,s);this.app=t;this.sharedFolders=r;this.inputEl=s;this.sharedPaths=new Set(this.sharedFolders.map(o=>o.path))}getSuggestions(t){let r=t.toLowerCase(),s=[],o=i=>{if(!this.sharedPaths.has(i.path)){i.path.toLowerCase().contains(r)&&s.push(i.path);for(let c of i.children)c instanceof xg.TFolder&&o(c)}};return o(this.app.vault.getRoot()),s}renderSuggestion(t,r){r.setText(t)}selectSuggestion(t){this.inputEl.value=t,this.inputEl.trigger("input"),this.close()}};function pC(n){let e,t,r,s;return{c(){e=L("div"),t=L("input"),A(t,"type","text"),A(t,"placeholder","/"),A(e,"class","folder-suggest-container")},m(o,i){T(o,e,i),J(e,t),n[5](t),er(t,n[2]),r||(s=[re(t,"input",mC),re(t,"input",n[6])],r=!0)},p(o,[i]){i&4&&t.value!==o[2]&&er(t,o[2])},i:Z,o:Z,d(o){o&&E(e),n[5](null),r=!1,Te(s)}}}function mC(){}function gC(n,e,t){let r,s=Z,o=()=>(s(),s=Et(d,_=>t(2,r=_)),d);n.$$.on_destroy.push(()=>s());let{app:i}=e,l,c,{sharedFolders:f}=e,{selectedFolder:d=Je()}=e;o(),pr(()=>{c=new sl(i,f,l);let _=y=>{o(t(0,d=y.detail.folder.path))};return l.addEventListener("folder-selected",_),()=>{l.removeEventListener("folder-selected",_)}}),Eu(()=>{c&&c.close()});function p(_){eo[_?"unshift":"push"](()=>{l=_,t(1,l)})}function g(){r=this.value,d.set(r)}return n.$$set=_=>{"app"in _&&t(3,i=_.app),"sharedFolders"in _&&t(4,f=_.sharedFolders),"selectedFolder"in _&&o(t(0,d=_.selectedFolder))},[d,l,r,i,f,p,g]}var Tf=class extends ne{constructor(e){super(),ie(this,e,gC,pC,te,{app:3,sharedFolders:4,selectedFolder:0})}},kg=Tf;function yC(n){tt(n,"svelte-hgd3zf","span.error.svelte-hgd3zf{flex:auto;align-content:center}")}function wC(n){let e,t,r;return{c(){e=L("input"),A(e,"type","text")},m(s,o){T(s,e,o),er(e,n[4]),t||(r=re(e,"input",n[8]),t=!0)},p(s,o){o&16&&e.value!==s[4]&&er(e,s[4])},d(s){s&&E(e),t=!1,r()}}}function _C(n){let e,t;return e=new kg({props:{app:n[0],sharedFolders:n[2],selectedFolder:n[7]}}),{c(){H(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s&1&&(o.app=r[0]),s&4&&(o.sharedFolders=r[2]),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function Cg(n){let e,t;return{c(){e=L("span"),t=ae(n[5]),A(e,"class","mod-warning error svelte-hgd3zf")},m(r,s){T(r,e,s),J(e,t)},p(r,s){s&32&&we(t,r[5])},d(r){r&&E(e)}}}function bC(n){let e,t,r,s,o,i,l,c,f,d,p,g,_;s=new _e({props:{name:"Folder name",description:"Set the name of the folder to be added.",$$slots:{default:[wC]},$$scope:{ctx:n}}}),i=new _e({props:{name:"Folder location",description:"Set the location in your vault.",$$slots:{default:[_C]},$$scope:{ctx:n}}});let y=n[5]&&Cg(n);return{c(){e=L("div"),e.textContent="Add to vault",t=q(),r=L("div"),H(s.$$.fragment),o=q(),H(i.$$.fragment),l=q(),c=L("div"),y&&y.c(),f=q(),d=L("button"),d.textContent="Confirm",A(e,"class","modal-title"),A(d,"class","mod-cta"),A(c,"class","modal-button-container"),A(r,"class","modal-content")},m(b,C){T(b,e,C),T(b,t,C),T(b,r,C),N(s,r,null),J(r,o),N(i,r,null),J(r,l),J(r,c),y&&y.m(c,null),J(c,f),J(c,d),p=!0,g||(_=re(d,"click",function(){et((0,Af.debounce)(n[9]))&&(0,Af.debounce)(n[9]).apply(this,arguments)}),g=!0)},p(b,[C]){n=b;let x={};C&1040&&(x.$$scope={dirty:C,ctx:n}),s.$set(x);let M={};C&1029&&(M.$$scope={dirty:C,ctx:n}),i.$set(M),n[5]?y?y.p(n,C):(y=Cg(n),y.c(),y.m(c,f)):y&&(y.d(1),y=null)},i(b){p||(k(s.$$.fragment,b),k(i.$$.fragment,b),p=!0)},o(b){D(s.$$.fragment,b),D(i.$$.fragment,b),p=!1},d(b){b&&(E(e),E(t),E(r)),B(s),B(i),y&&y.d(),g=!1,_()}}}function vC(n,e,t){let r,{app:s}=e,{remoteFolder:o}=e,{sharedFolders:i}=e,{onConfirm:l}=e,c=o.name,f=Je();Fe(n,f,_=>t(6,r=_));let d="";function p(){c=this.value,t(4,c)}let g=async()=>{l(o,c,r||"").catch(_=>{t(5,d=_.message)})};return n.$$set=_=>{"app"in _&&t(0,s=_.app),"remoteFolder"in _&&t(1,o=_.remoteFolder),"sharedFolders"in _&&t(2,i=_.sharedFolders),"onConfirm"in _&&t(3,l=_.onConfirm)},[s,o,i,l,c,d,r,f,p,g]}var Df=class extends ne{constructor(e){super(),ie(this,e,vC,bC,te,{app:0,remoteFolder:1,sharedFolders:2,onConfirm:3},yC)}},Eg=Df;var ol=class extends Tg.Modal{constructor(t,r,s,o){super(t);this.sharedFolders=r;this.remoteFolder=s;this.onConfirm=o;this.onConfirm=o}onOpen(){let{contentEl:t}=this;this.component=new Eg({target:t,props:{remoteFolder:this.remoteFolder,sharedFolders:this.sharedFolders,onConfirm:async(r,s,o)=>{await this.onConfirm(r,s,o),this.close()},app:this.app}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var Rf=Ro(Ag());function xC(n){tt(n,"svelte-1y54kws",".system3-settings-danger-zone.svelte-1y54kws{margin-top:6em}input.system3-updating.svelte-1y54kws{border:1px solid var(--color-accent) !important}input.system3-input-invalid.svelte-1y54kws{border:1px solid var(--color-red) !important}")}function Dg(n,e,t){let r=n.slice();return r[47]=e[t],r}function Mg(n,e,t){let r=n.slice();return r[50]=e[t],r}function Rg(n){let e,t;return e=new _e({props:{name:"Relay name",description:"Set the relay name.",$$slots:{default:[SC]},$$scope:{ctx:n}}}),{c(){H(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s[0]&297|s[1]&4194304&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function SC(n){let e,t,r,s;return{c(){e=L("input"),A(e,"type","text"),A(e,"spellcheck","false"),A(e,"placeholder","Example: Shared Notes"),A(e,"class",t=zs((n[8]?"system3-updating":"")+(n[5]?"":" system3-input-invalid"))+" svelte-1y54kws")},m(o,i){T(o,e,i),er(e,n[0].name),n[34](e),r||(s=[re(e,"input",n[33]),re(e,"input",n[25])],r=!0)},p(o,i){i[0]&288&&t!==(t=zs((o[8]?"system3-updating":"")+(o[5]?"":" system3-input-invalid"))+" svelte-1y54kws")&&A(e,"class",t),i[0]&1&&e.value!==o[0].name&&er(e,o[0].name)},d(o){o&&E(e),n[34](null),r=!1,Te(s)}}}function kC(n){let e,t;return e=new _e({props:{description:"",$$slots:{name:[TC],default:[EC]},$$scope:{ctx:n}}}),{c(){H(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s[0]&512|s[1]&4194304&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function CC(n){let e,t;return e=new _e({props:{description:"",$$slots:{name:[DC],default:[AC]},$$scope:{ctx:n}}}),{c(){H(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s[0]&1536|s[1]&4194304&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function EC(n){let e,t,r;function s(){return n[36](n[50])}return{c(){e=L("button"),e.textContent="Add to Vault",A(e,"class","mod-cta"),A(e,"aria-label","Add shared folder to vault")},m(o,i){T(o,e,i),t||(r=re(e,"click",function(){et((0,Ye.debounce)(s))&&(0,Ye.debounce)(s).apply(this,arguments)}),t=!0)},p(o,i){n=o},d(o){o&&E(e),t=!1,r()}}}function TC(n){let e,t;return e=new di({props:{folder:n[50],slot:"name"}}),{c(){H(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s[0]&512&&(o.folder=r[50]),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function AC(n){let e,t;function r(){return n[35](n[50])}return e=new rs({}),e.$on("settings",function(){et((0,Ye.debounce)(r))&&(0,Ye.debounce)(r).apply(this,arguments)}),{c(){H(e.$$.fragment)},m(s,o){N(e,s,o),t=!0},p(s,o){n=s},i(s){t||(k(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){B(e,s)}}}function DC(n){let e,t;return e=new di({props:{folder:n[50],slot:"name"}}),{c(){H(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s[0]&512&&(o.folder=r[50]),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function Fg(n){let e,t,r,s,o;function i(...d){return n[32](n[50],...d)}let l=[CC,kC],c=[];function f(d,p){return p[0]&1536&&(e=null),e==null&&(e=!!d[10].find(i)),e?0:1}return t=f(n,[-1,-1]),r=c[t]=l[t](n),{c(){r.c(),s=$e()},m(d,p){c[t].m(d,p),T(d,s,p),o=!0},p(d,p){n=d;let g=t;t=f(n,p),t===g?c[t].p(n,p):(xe(),D(c[g],1,1,()=>{c[g]=null}),Se(),r=c[t],r?r.p(n,p):(r=c[t]=l[t](n),r.c()),k(r,1),r.m(s.parentNode,s))},i(d){o||(k(r),o=!0)},o(d){D(r),o=!1},d(d){d&&E(s),c[t].d(d)}}}function MC(n){let e,t,r;return{c(){e=L("button"),e.textContent="Add",A(e,"class","mod-cta"),A(e,"aria-label","Select a folder to add to the relay")},m(s,o){T(s,e,o),t||(r=re(e,"click",(0,Ye.debounce)(n[37])),t=!0)},p:Z,d(s){s&&E(e),t=!1,r()}}}function RC(n){let e=n[11].values().length+"",t,r,s=n[7].userLimit+"",o;return{c(){t=ae(e),r=ae(" / "),o=ae(s)},m(i,l){T(i,t,l),T(i,r,l),T(i,o,l)},p(i,l){l[0]&2048&&e!==(e=i[11].values().length+"")&&we(t,e),l[0]&128&&s!==(s=i[7].userLimit+"")&&we(o,s)},d(i){i&&(E(t),E(r),E(o))}}}function Pg(n){let e,t,r;function s(){return n[38](n[47])}return{c(){e=L("button"),e.textContent="Kick",A(e,"class","mod-destructive")},m(o,i){T(o,e,i),t||(r=re(e,"click",function(){et((0,Ye.debounce)(s))&&(0,Ye.debounce)(s).apply(this,arguments)}),t=!0)},p(o,i){n=o},d(o){o&&E(e),t=!1,r()}}}function FC(n){let e,t=n[47].role==="Member"&&n[7].owner&&Pg(n);return{c(){t&&t.c(),e=q()},m(r,s){t&&t.m(r,s),T(r,e,s)},p(r,s){r[47].role==="Member"&&r[7].owner?t?t.p(r,s):(t=Pg(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&E(e),t&&t.d(r)}}}function Og(n){let e,t;return e=new _e({props:{name:n[47].user.name,description:n[47].role,$$slots:{default:[FC]},$$scope:{ctx:n}}}),{c(){H(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s[0]&2048&&(o.name=r[47].user.name),s[0]&2048&&(o.description=r[47].role),s[0]&2176|s[1]&4194304&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function PC(n){let e,t,r;return{c(){e=L("input"),e.value=n[4],A(e,"type","text"),e.readOnly=!0,A(e,"id","system3InviteLink")},m(s,o){T(s,e,o),t||(r=re(e,"click",(0,Ye.debounce)(n[29])),t=!0)},p(s,o){o[0]&16&&e.value!==s[4]&&(e.value=s[4])},d(s){s&&E(e),t=!1,r()}}}function OC(n){let e,t,r,s;return e=new rt({props:{name:"Membership",description:""}}),r=new _e({props:{name:"Leave relay",description:"Leave the relay. Local data is preserved.",$$slots:{default:[LC]},$$scope:{ctx:n}}}),{c(){H(e.$$.fragment),t=q(),H(r.$$.fragment)},m(o,i){N(e,o,i),T(o,t,i),N(r,o,i),s=!0},p(o,i){let l={};i[1]&4194304&&(l.$$scope={dirty:i,ctx:o}),r.$set(l)},i(o){s||(k(e.$$.fragment,o),k(r.$$.fragment,o),s=!0)},o(o){D(e.$$.fragment,o),D(r.$$.fragment,o),s=!1},d(o){o&&E(t),B(e,o),B(r,o)}}}function IC(n){let e,t,r,s,o,i,l,c=[UC,$C],f=[];function d(p,g){return p[12]?0:1}return e=d(n,[-1,-1]),t=f[e]=c[e](n),s=new rt({props:{name:"Storage",description:""}}),i=new _e({props:{name:"Destroy relay",description:"This will destroy the relay (deleting all data on the server). Local data is preserved.",$$slots:{default:[qC]},$$scope:{ctx:n}}}),{c(){t.c(),r=q(),H(s.$$.fragment),o=q(),H(i.$$.fragment)},m(p,g){f[e].m(p,g),T(p,r,g),N(s,p,g),T(p,o,g),N(i,p,g),l=!0},p(p,g){let _=e;e=d(p,g),e===_?f[e].p(p,g):(xe(),D(f[_],1,1,()=>{f[_]=null}),Se(),t=f[e],t?t.p(p,g):(t=f[e]=c[e](p),t.c()),k(t,1),t.m(r.parentNode,r));let y={};g[0]&64|g[1]&4194304&&(y.$$scope={dirty:g,ctx:p}),i.$set(y)},i(p){l||(k(t),k(s.$$.fragment,p),k(i.$$.fragment,p),l=!0)},o(p){D(t),D(s.$$.fragment,p),D(i.$$.fragment,p),l=!1},d(p){p&&(E(r),E(o)),f[e].d(p),B(s,p),B(i,p)}}}function LC(n){let e,t,r;return{c(){e=L("button"),e.textContent="Leave",A(e,"class","mod-warning")},m(s,o){T(s,e,o),t||(r=re(e,"click",(0,Ye.debounce)(n[42])),t=!0)},p:Z,d(s){s&&E(e),t=!1,r()}}}function $C(n){let e,t;return e=new _e({props:{name:`Plan: ${n[7].plan}`,description:"",$$slots:{description:[BC],default:[NC]},$$scope:{ctx:n}}}),{c(){H(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s[0]&128&&(o.name=`Plan: ${r[7].plan}`),s[0]&128|s[1]&4194304&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function UC(n){let e,t,r=!n[6].values()[0].active||n[6].values()[0].cancelAt,s,o;e=new _e({props:{name:`Plan: ${n[7].plan}`,description:"",$$slots:{description:[VC],default:[HC]},$$scope:{ctx:n}}});let i=r&&Lg(n);return{c(){H(e.$$.fragment),t=q(),i&&i.c(),s=$e()},m(l,c){N(e,l,c),T(l,t,c),i&&i.m(l,c),T(l,s,c),o=!0},p(l,c){let f={};c[0]&128&&(f.name=`Plan: ${l[7].plan}`),c[0]&4288|c[1]&4194304&&(f.$$scope={dirty:c,ctx:l}),e.$set(f),c[0]&64&&(r=!l[6].values()[0].active||l[6].values()[0].cancelAt),r?i?(i.p(l,c),c[0]&64&&k(i,1)):(i=Lg(l),i.c(),k(i,1),i.m(s.parentNode,s)):i&&(xe(),D(i,1,1,()=>{i=null}),Se())},i(l){o||(k(e.$$.fragment,l),k(i),o=!0)},o(l){D(e.$$.fragment,l),D(i),o=!1},d(l){l&&(E(t),E(s)),B(e,l),i&&i.d(l)}}}function NC(n){let e,t,r;return{c(){e=L("button"),e.textContent="Upgrade",A(e,"class","mod-cta")},m(s,o){T(s,e,o),t||(r=re(e,"click",function(){et((0,Ye.debounce)(n[41]))&&(0,Ye.debounce)(n[41]).apply(this,arguments)}),t=!0)},p(s,o){n=s},d(s){s&&E(e),t=!1,r()}}}function BC(n){let e,t=(n[7].cta||"Thanks for supporting Relay development <3")+"",r;return{c(){e=L("fragment"),r=ae(t),A(e,"slot","description")},m(s,o){T(s,e,o),J(e,r)},p(s,o){o[0]&128&&t!==(t=(s[7].cta||"Thanks for supporting Relay development <3")+"")&&we(r,t)},d(s){s&&E(e)}}}function Ig(n){let e,t,r;return{c(){e=L("button"),e.textContent="Cancel",A(e,"class","mod-destructive")},m(s,o){T(s,e,o),t||(r=re(e,"click",function(){et((0,Ye.debounce)(n[40]))&&(0,Ye.debounce)(n[40]).apply(this,arguments)}),t=!0)},p(s,o){n=s},d(s){s&&E(e),t=!1,r()}}}function HC(n){let e,t,r=n[6].values()[0].active&&!n[6].values()[0].cancelAt,s,o,i,l=r&&Ig(n);return{c(){e=L("button"),e.textContent="Manage",t=q(),l&&l.c(),s=$e()},m(c,f){T(c,e,f),T(c,t,f),l&&l.m(c,f),T(c,s,f),o||(i=re(e,"click",function(){et((0,Ye.debounce)(n[39]))&&(0,Ye.debounce)(n[39]).apply(this,arguments)}),o=!0)},p(c,f){n=c,f[0]&64&&(r=n[6].values()[0].active&&!n[6].values()[0].cancelAt),r?l?l.p(n,f):(l=Ig(n),l.c(),l.m(s.parentNode,s)):l&&(l.d(1),l=null)},d(c){c&&(E(e),E(t),E(s)),l&&l.d(c),o=!1,i()}}}function VC(n){let e,t=n[7].cta+"",r;return{c(){e=L("fragment"),r=ae(t),A(e,"slot","description")},m(s,o){T(s,e,o),J(e,r)},p(s,o){o[0]&128&&t!==(t=s[7].cta+"")&&we(r,t)},d(s){s&&E(e)}}}function Lg(n){let e,t;return e=new _e({props:{description:"",$$slots:{name:[KC],default:[WC]},$$scope:{ctx:n}}}),{c(){H(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s[0]&64|s[1]&4194304&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function WC(n){let e=n[14](n[6].values()[0].cancelAt)+"",t;return{c(){t=ae(e)},m(r,s){T(r,t,s)},p(r,s){s[0]&64&&e!==(e=r[14](r[6].values()[0].cancelAt)+"")&&we(t,e)},d(r){r&&E(t)}}}function KC(n){let e;return{c(){e=L("span"),e.textContent="Status: Cancelled",A(e,"slot","name"),A(e,"class","mod-warning")},m(t,r){T(t,e,r)},p:Z,d(t){t&&E(e)}}}function YC(n){let e,t,r;return{c(){e=L("button"),e.textContent="Destroy",A(e,"class","mod-warning")},m(s,o){T(s,e,o),t||(r=re(e,"click",(0,Ye.debounce)(n[26])),t=!0)},p:Z,d(s){s&&E(e),t=!1,r()}}}function JC(n){let e,t;return{c(){e=L("button"),e.textContent="Destroy",e.disabled=t=!0,A(e,"class","mod-warning"),A(e,"aria-label","Cancel subscription to destroy relay.")},m(r,s){T(r,e,s)},p:Z,d(r){r&&E(e)}}}function qC(n){let e,t;function r(i,l){return l[0]&64&&(e=null),e==null&&(e=i[6].values().length>0&&!i[6].values()[0].cancelAt),e?JC:YC}let s=r(n,[-1,-1]),o=s(n);return{c(){o.c(),t=$e()},m(i,l){o.m(i,l),T(i,t,l)},p(i,l){s===(s=r(i,l))&&o?o.p(i,l):(o.d(1),o=s(i),o&&(o.c(),o.m(t.parentNode,t)))},d(i){i&&E(t),o.d(i)}}}function jC(n){let e,t=n[0].name+"",r,s,o,i,l,c,f,d,p,g,_,y,b,C,x,M,W,S,R,O=n[0].owner&&Rg(n);i=new rt({props:{name:"Shared folders"}});let U=ze(n[9].values()),I=[];for(let V=0;V<U.length;V+=1)I[V]=Fg(Mg(n,U,V));let oe=V=>D(I[V],1,1,()=>{I[V]=null});f=new _e({props:{description:"",name:"",$$slots:{default:[MC]},$$scope:{ctx:n}}}),p=new rt({props:{name:"Users",$$slots:{default:[RC]},$$scope:{ctx:n}}});let ue=ze(n[11].values().sort($g)),se=[];for(let V=0;V<ue.length;V+=1)se[V]=Og(Dg(n,ue,V));let ge=V=>D(se[V],1,1,()=>{se[V]=null});y=new rt({props:{name:"Sharing"}}),C=new _e({props:{name:"Share key",description:"Share this key with your collaborators.",$$slots:{default:[PC]},$$scope:{ctx:n}}});let be=[IC,OC],$=[];function j(V,z){return V[7].owner?0:1}return M=j(n,[-1,-1]),W=$[M]=be[M](n),{c(){e=L("h3"),r=ae(t),s=q(),O&&O.c(),o=q(),H(i.$$.fragment),l=q();for(let V=0;V<I.length;V+=1)I[V].c();c=q(),H(f.$$.fragment),d=q(),H(p.$$.fragment),g=q();for(let V=0;V<se.length;V+=1)se[V].c();_=q(),H(y.$$.fragment),b=q(),H(C.$$.fragment),x=q(),W.c(),S=$e()},m(V,z){T(V,e,z),J(e,r),T(V,s,z),O&&O.m(V,z),T(V,o,z),N(i,V,z),T(V,l,z);for(let ke=0;ke<I.length;ke+=1)I[ke]&&I[ke].m(V,z);T(V,c,z),N(f,V,z),T(V,d,z),N(p,V,z),T(V,g,z);for(let ke=0;ke<se.length;ke+=1)se[ke]&&se[ke].m(V,z);T(V,_,z),N(y,V,z),T(V,b,z),N(C,V,z),T(V,x,z),$[M].m(V,z),T(V,S,z),R=!0},p(V,z){if((!R||z[0]&1)&&t!==(t=V[0].name+"")&&we(r,t),V[0].owner?O?(O.p(V,z),z[0]&1&&k(O,1)):(O=Rg(V),O.c(),k(O,1),O.m(o.parentNode,o)):O&&(xe(),D(O,1,1,()=>{O=null}),Se()),z[0]&285214208){U=ze(V[9].values());let le;for(le=0;le<U.length;le+=1){let G=Mg(V,U,le);I[le]?(I[le].p(G,z),k(I[le],1)):(I[le]=Fg(G),I[le].c(),k(I[le],1),I[le].m(c.parentNode,c))}for(xe(),le=U.length;le<I.length;le+=1)oe(le);Se()}let ke={};z[1]&4194304&&(ke.$$scope={dirty:z,ctx:V}),f.$set(ke);let vt={};if(z[0]&2176|z[1]&4194304&&(vt.$$scope={dirty:z,ctx:V}),p.$set(vt),z[0]&134219904){ue=ze(V[11].values().sort($g));let le;for(le=0;le<ue.length;le+=1){let G=Dg(V,ue,le);se[le]?(se[le].p(G,z),k(se[le],1)):(se[le]=Og(G),se[le].c(),k(se[le],1),se[le].m(_.parentNode,_))}for(xe(),le=ue.length;le<se.length;le+=1)ge(le);Se()}let nt={};z[0]&16|z[1]&4194304&&(nt.$$scope={dirty:z,ctx:V}),C.$set(nt);let yt=M;M=j(V,z),M===yt?$[M].p(V,z):(xe(),D($[yt],1,1,()=>{$[yt]=null}),Se(),W=$[M],W?W.p(V,z):(W=$[M]=be[M](V),W.c()),k(W,1),W.m(S.parentNode,S))},i(V){if(!R){k(O),k(i.$$.fragment,V);for(let z=0;z<U.length;z+=1)k(I[z]);k(f.$$.fragment,V),k(p.$$.fragment,V);for(let z=0;z<ue.length;z+=1)k(se[z]);k(y.$$.fragment,V),k(C.$$.fragment,V),k(W),R=!0}},o(V){D(O),D(i.$$.fragment,V),I=I.filter(Boolean);for(let z=0;z<I.length;z+=1)D(I[z]);D(f.$$.fragment,V),D(p.$$.fragment,V),se=se.filter(Boolean);for(let z=0;z<se.length;z+=1)D(se[z]);D(y.$$.fragment,V),D(C.$$.fragment,V),D(W),R=!1},d(V){V&&(E(e),E(s),E(o),E(l),E(c),E(d),E(g),E(_),E(b),E(x),E(S)),O&&O.d(V),B(i,V),Qt(I,V),B(f,V),B(p,V),Qt(se,V),B(y,V),B(C,V),$[M].d(V)}}}function $g(n,e){return n.role==="Owner"&&e.role!=="Owner"?-1:n.role!=="Owner"&&e.role==="Owner"||n.user.name>e.user.name?1:-1}function GC(n){if(/[\\:*?"<>|]/.test(n))return!1;let t=n.split("/");for(let r of t)if(r===""||r==="."||r==="..")return!1;return!0}function zC(n,e,t){let r,s,o=Z,i=()=>(o(),o=Et(O,F=>t(43,s=F)),O),l,c,f=Z,d=()=>(f(),f=Et(M,F=>t(7,c=F)),M),p,g,_,y=Z,b=()=>(y(),y=Et(R,F=>t(10,_=F)),R),C,x;n.$$.on_destroy.push(()=>o()),n.$$.on_destroy.push(()=>f()),n.$$.on_destroy.push(()=>y());let{relay:M}=e;d();let W=M.folders;Fe(n,W,F=>t(9,g=F));let{plugin:S}=e,{sharedFolders:R}=e;b();let{relayRoles:O}=e;i();function U(F){if(!F)return"Active";let de=(0,Rf.default)(),Ae=(0,Rf.default)(F).diff(de,"days");return Ae<=0?"Subscription has ended":Ae===1?"Active for 1 more day":`Active for ${Ae} more days`}let I=c.subscriptions;Fe(n,I,F=>t(6,l=F));let oe=fi(l,F=>{if(F.values().length!==0)return F.values()[0]});Fe(n,oe,F=>t(12,x=F));let ue=s.filter(F=>{var de;return((de=F.relay)===null||de===void 0?void 0:de.id)===M.id});Fe(n,ue,F=>t(11,C=F));let se=Je(!0);Fe(n,se,F=>t(5,r=F));let ge;pr(()=>{ge&&ge.value===""&&ge.focus()});let be=mr();function $(F){return ft(this,void 0,void 0,function*(){var de;!((de=S.loginManager)===null||de===void 0)&&de.user&&window.open(S.buildApiUrl(`/subscribe?relay=${F.id}&quantity=10&user_email=${S.loginManager.user.name}`),"_blank")})}function j(F){return ft(this,void 0,void 0,function*(){let de=F.token,Ue=F.id;window.open(S.buildApiUrl(`/subscriptions/${Ue}/manage?token=${de}`),"_blank")})}function V(F){return ft(this,void 0,void 0,function*(){let de=F.token,Ue=F.id;window.open(S.buildApiUrl(`/subscriptions/${Ue}/cancel?token=${de}`),"_blank")})}function z(){return ft(this,void 0,void 0,function*(){S.relayManager.leaveRelay(M),be("goBack",{clear:!0})})}let ke;S.relayManager.getRelayInvitationKey(M).then(F=>{t(4,ke=F)});function vt(F,de,Ue){return ft(this,void 0,void 0,function*(){let Ae=(0,Ye.normalizePath)((0,Ug.join)(Ue,de));return S.vault.getFolderByPath(Ae)===null&&(yield S.vault.createFolder(Ae)),S.sharedFolders.new(Ae,F.guid,M.guid,!0).then(cn=>(cn.remote=F,S.sharedFolders.notifyListeners(),Rr(Mr.enableDownloadOnAddToVault,()=>{S.backgroundSync.getFolderFiles(cn)}),cn))})}let nt=Je(!1);Fe(n,nt,F=>t(8,p=F));let yt=(0,Ye.debounce)(()=>{S.relayManager.updateRelay(M),nt.set(!1)},500,!0),le=F=>{new ol(S.app,R,F,vt).open()};function G(){se.set(GC(ge.value)),r&&ge.value!==""&&(nt.set(!0),yt())}function ln(){S.relayManager.destroyRelay(M),be("goBack",{})}function Wt(F){S.relayManager.kick(F)}function Or(F,de){F&&be("manageSharedFolder",{folder:F,relay:de,mount:!1})}function os(F){let de=F.target;de.focus(),de.select(),navigator.clipboard.writeText(de.value).then(()=>new Ye.Notice("Invite link copied")).catch(Ue=>{})}let is=new rl(S.app,R,F=>ft(void 0,void 0,void 0,function*(){let de=(0,Ye.normalizePath)(F),Ue=R.find(wt=>wt.path==F);if(Ue){let wt=yield S.relayManager.createRemoteFolder(Ue,M);Ue.remote=wt,Ue.connect(),S.sharedFolders.notifyListeners();return}S.vault.getFolderByPath(de)===null&&(yield S.vault.createFolder(de));let Ae=ea(),cn=yield S.sharedFolders.new((0,Ye.normalizePath)(F),Ae,M.guid,!1),as=yield S.relayManager.createRemoteFolder(cn,M);cn.remote=as,S.sharedFolders.notifyListeners()})),ho=(F,de)=>de.remote===F;function po(){M.name=this.value,d(t(0,M))}function mo(F){eo[F?"unshift":"push"](()=>{ge=F,t(3,ge)})}let go=F=>{let de=_.find(Ue=>Ue.remote===F);de&&Or(de,F.relay)},yo=F=>{le(F)},wo=()=>{is.open()},_o=F=>{Wt(F)},bo=()=>{j(x)},vo=()=>{V(x)},Ir=()=>{$(c)},Ze=()=>{z()};return n.$$set=F=>{"relay"in F&&d(t(0,M=F.relay)),"plugin"in F&&t(31,S=F.plugin),"sharedFolders"in F&&b(t(1,R=F.sharedFolders)),"relayRoles"in F&&i(t(2,O=F.relayRoles))},[M,R,O,ge,ke,r,l,c,p,g,_,C,x,W,U,I,oe,ue,se,$,j,V,z,nt,le,G,ln,Wt,Or,os,is,S,ho,po,mo,go,yo,wo,_o,bo,vo,Ir,Ze]}var Ff=class extends ne{constructor(e){super(),ie(this,e,zC,jC,te,{relay:0,plugin:31,sharedFolders:1,relayRoles:2},xC,[-1,-1])}},hi=Ff;function XC(n){let e,t,r,s,o,i;return r=new Lu({}),{c(){e=L("div"),t=L("div"),H(r.$$.fragment),A(t,"class","clickable-icon"),A(t,"aria-label","Back"),A(t,"tabindex","0"),A(t,"role","button"),A(e,"class","modal-setting-nav-bar")},m(l,c){T(l,e,c),J(e,t),N(r,t,null),s=!0,o||(i=[re(t,"click",n[0]),re(t,"keypress",n[1])],o=!0)},p:Z,i(l){s||(k(r.$$.fragment,l),s=!0)},o(l){D(r.$$.fragment,l),s=!1},d(l){l&&E(e),B(r),o=!1,Te(i)}}}function ZC(n){let e=mr();function t(){e("goBack",{})}function r(s){s.key==="Escape"&&(e("goBack",{}),s.stopPropagation())}return[t,r]}var Pf=class extends ne{constructor(e){super(),ie(this,e,ZC,XC,te,{})}},Ng=Pf;var uo=require("obsidian");function QC(n){let e,t,r;return{c(){e=L("button"),e.textContent="Delete local",A(e,"class","mod-warning")},m(s,o){T(s,e,o),t||(r=re(e,"click",(0,uo.debounce)(n[12])),t=!0)},p:Z,d(s){s&&E(e),t=!1,r()}}}function eE(n){let e,t,r,s,o,i,l;return{c(){e=L("button"),t=ae("Delete metadata"),A(e,"class",r=n[4]?"mod-disabled":"mod-warning"),e.disabled=s=!!n[4],A(e,"aria-label",o=n[4]?"Metadata is required for sharing.":"")},m(c,f){T(c,e,f),J(e,t),i||(l=re(e,"click",(0,uo.debounce)(n[13])),i=!0)},p(c,f){f&16&&r!==(r=c[4]?"mod-disabled":"mod-warning")&&A(e,"class",r),f&16&&s!==(s=!!c[4])&&(e.disabled=s),f&16&&o!==(o=c[4]?"Metadata is required for sharing.":"")&&A(e,"aria-label",o)},d(c){c&&E(e),i=!1,l()}}}function Bg(n){var s,o,i,l,c;let e,t,r=(((s=n[4])==null?void 0:s.owner)||((l=(i=(o=n[3])==null?void 0:o.remote)==null?void 0:i.creator)==null?void 0:l.id)===((c=n[0].relayManager.user)==null?void 0:c.id))&&Hg(n);return{c(){r&&r.c(),e=$e()},m(f,d){r&&r.m(f,d),T(f,e,d),t=!0},p(f,d){var p,g,_,y,b;(p=f[4])!=null&&p.owner||((y=(_=(g=f[3])==null?void 0:g.remote)==null?void 0:_.creator)==null?void 0:y.id)===((b=f[0].relayManager.user)==null?void 0:b.id)?r?(r.p(f,d),d&25&&k(r,1)):(r=Hg(f),r.c(),k(r,1),r.m(e.parentNode,e)):r&&(xe(),D(r,1,1,()=>{r=null}),Se())},i(f){t||(k(r),t=!0)},o(f){D(r),t=!1},d(f){f&&E(e),r&&r.d(f)}}}function Hg(n){let e,t,r,s;return e=new rt({props:{name:"Remote Folder"}}),r=new _e({props:{name:"Remove from relay",description:"Deletes the remote folder from the relay. Local files will be preserved.",$$slots:{default:[tE]},$$scope:{ctx:n}}}),{c(){H(e.$$.fragment),t=q(),H(r.$$.fragment)},m(o,i){N(e,o,i),T(o,t,i),N(r,o,i),s=!0},p(o,i){let l={};i&262144&&(l.$$scope={dirty:i,ctx:o}),r.$set(l)},i(o){s||(k(e.$$.fragment,o),k(r.$$.fragment,o),s=!0)},o(o){D(e.$$.fragment,o),D(r.$$.fragment,o),s=!1},d(o){o&&E(t),B(e,o),B(r,o)}}}function tE(n){let e,t,r;return{c(){e=L("button"),e.textContent="Delete remote",A(e,"class","mod-destructive")},m(s,o){T(s,e,o),t||(r=re(e,"click",(0,uo.debounce)(n[8])),t=!0)},p:Z,d(s){s&&E(e),t=!1,r()}}}function Vg(n){let e,t;return e=new _e({props:{description:"",$$slots:{name:[nE],default:[rE]},$$scope:{ctx:n}}}),{c(){H(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s&262160&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function rE(n){let e,t;return e=new rs({}),e.$on("settings",function(){et((0,uo.debounce)(n[14]))&&(0,uo.debounce)(n[14]).apply(this,arguments)}),{c(){H(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){n=r},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function nE(n){let e,t,r=n[4].name+"",s,o;return t=new gr({props:{class:"svg-icon"}}),{c(){e=L("span"),H(t.$$.fragment),s=ae(r),A(e,"slot","name"),bt(e,"display","inline-flex")},m(i,l){T(i,e,l),N(t,e,null),J(e,s),o=!0},p(i,l){(!o||l&16)&&r!==(r=i[4].name+"")&&we(s,r)},i(i){o||(k(t.$$.fragment,i),o=!0)},o(i){D(t.$$.fragment,i),o=!1},d(i){i&&E(e),B(t)}}}function sE(n){let e,t,r,s,o,i,l,c,f,d,p,g,_,y;t=new di({props:{folder:n[1]}}),s=new rt({props:{name:"Local folder"}}),i=new _e({props:{name:"Delete from vault",description:"Delete the local Shared Folder and all of its contents.",$$slots:{default:[QC]},$$scope:{ctx:n}}}),c=new _e({props:{name:"Delete metadata",description:"Deletes edit history and disables change tracking.",$$slots:{default:[eE]},$$scope:{ctx:n}}});let b=n[4]&&Bg(n);p=new rt({props:{name:"Relay"}});let C=n[4]&&Vg(n);return{c(){e=L("h3"),H(t.$$.fragment),r=q(),H(s.$$.fragment),o=q(),H(i.$$.fragment),l=q(),H(c.$$.fragment),f=q(),b&&b.c(),d=q(),H(p.$$.fragment),g=q(),C&&C.c(),_=$e()},m(x,M){T(x,e,M),N(t,e,null),T(x,r,M),N(s,x,M),T(x,o,M),N(i,x,M),T(x,l,M),N(c,x,M),T(x,f,M),b&&b.m(x,M),T(x,d,M),N(p,x,M),T(x,g,M),C&&C.m(x,M),T(x,_,M),y=!0},p(x,[M]){let W={};M&2&&(W.folder=x[1]),t.$set(W);let S={};M&262144&&(S.$$scope={dirty:M,ctx:x}),i.$set(S);let R={};M&262160&&(R.$$scope={dirty:M,ctx:x}),c.$set(R),x[4]?b?(b.p(x,M),M&16&&k(b,1)):(b=Bg(x),b.c(),k(b,1),b.m(d.parentNode,d)):b&&(xe(),D(b,1,1,()=>{b=null}),Se()),x[4]?C?(C.p(x,M),M&16&&k(C,1)):(C=Vg(x),C.c(),k(C,1),C.m(_.parentNode,_)):C&&(xe(),D(C,1,1,()=>{C=null}),Se())},i(x){y||(k(t.$$.fragment,x),k(s.$$.fragment,x),k(i.$$.fragment,x),k(c.$$.fragment,x),k(b),k(p.$$.fragment,x),k(C),y=!0)},o(x){D(t.$$.fragment,x),D(s.$$.fragment,x),D(i.$$.fragment,x),D(c.$$.fragment,x),D(b),D(p.$$.fragment,x),D(C),y=!1},d(x){x&&(E(e),E(r),E(o),E(l),E(f),E(d),E(g),E(_)),B(t),B(s,x),B(i,x),B(c,x),b&&b.d(x),B(p,x),C&&C.d(x)}}}function oE(n,e,t){let r,s,o=Z,i=()=>(o(),o=Et(d,U=>t(15,s=U)),d),l;n.$$.on_destroy.push(()=>o());let{plugin:c}=e,{sharedFolder:f}=e,{sharedFolders:d}=e;i();let{relayRoles:p}=e,g=fi(s,U=>U.find(I=>I===f));Fe(n,g,U=>t(3,r=U));let _=fi([g,p],([U,I])=>{var oe;return(oe=I.find(ue=>{var se;return ue.relay===((se=U==null?void 0:U.remote)===null||se===void 0?void 0:se.relay)}))===null||oe===void 0?void 0:oe.relay});Fe(n,_,U=>t(4,l=U));let y;pr(()=>{!f&&y&&y.value===""&&y.focus()});let b=mr();function C(U){U&&b("manageRelay",{relay:U})}function x(){return ft(this,void 0,void 0,function*(){yield c.relayManager.deleteRemote(f),c.sharedFolders.notifyListeners()})}function M(){return ft(this,void 0,void 0,function*(){r&&c.sharedFolders.delete(r),b("goBack",{clear:!0})})}function W(){let U=c.vault.getFolderByPath(f.path);U&&c.app.vault.trash(U,!1),b("goBack",{})}let S=()=>{W()},R=()=>{M()},O=()=>{C(l)};return n.$$set=U=>{"plugin"in U&&t(0,c=U.plugin),"sharedFolder"in U&&t(1,f=U.sharedFolder),"sharedFolders"in U&&i(t(2,d=U.sharedFolders)),"relayRoles"in U&&t(11,p=U.relayRoles)},[c,f,d,r,l,g,_,C,x,M,W,p,S,R,O]}var Of=class extends ne{constructor(e){super(),ie(this,e,oE,sE,te,{plugin:0,sharedFolder:1,sharedFolders:2,relayRoles:11})}},Wg=Of;function iE(n){tt(n,"svelte-p7bayo",".vertical-tab-content.svelte-p7bayo{max-height:var(--modal-max-height)}")}function Kg(n){let e,t;return e=new Ng({}),e.$on("goBack",n[9]),{c(){H(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p:Z,i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function aE(n){let e,t;return e=new dg({props:{plugin:n[0],$$slots:{default:[uE]},$$scope:{ctx:n}}}),{c(){H(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s&1&&(o.plugin=r[0]),s&262145&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function lE(n){let e,t;return e=new hi({props:{plugin:n[0],relayRoles:n[3],relay:n[2],sharedFolders:n[5]}}),e.$on("goBack",n[9]),e.$on("close",n[10]),e.$on("manageSharedFolder",n[7]),{c(){H(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s&1&&(o.plugin=r[0]),s&4&&(o.relay=r[2]),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function cE(n){let e,t;return e=new Wg({props:{plugin:n[0],relayRoles:n[3],sharedFolder:n[1],sharedFolders:n[5]}}),e.$on("goBack",n[9]),e.$on("close",n[10]),e.$on("manageRelay",n[6]),{c(){H(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s&1&&(o.plugin=r[0]),s&2&&(o.sharedFolder=r[1]),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function uE(n){let e,t;return e=new Rn({props:{relays:n[4],plugin:n[0]}}),e.$on("manageRelay",n[6]),e.$on("manageSharedFolder",n[7]),e.$on("createRelay",n[8]),e.$on("joinRelay",n[11]),{c(){H(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s&1&&(o.plugin=r[0]),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function fE(n){let e,t,r,s,o,i=(n[2]||n[1])&&Kg(n),l=[cE,lE,aE],c=[];function f(d,p){return d[1]?0:d[2]?1:2}return r=f(n,-1),s=c[r]=l[r](n),{c(){i&&i.c(),e=q(),t=L("div"),s.c(),A(t,"class","vertical-tab-content svelte-p7bayo")},m(d,p){i&&i.m(d,p),T(d,e,p),T(d,t,p),c[r].m(t,null),o=!0},p(d,[p]){d[2]||d[1]?i?(i.p(d,p),p&6&&k(i,1)):(i=Kg(d),i.c(),k(i,1),i.m(e.parentNode,e)):i&&(xe(),D(i,1,1,()=>{i=null}),Se());let g=r;r=f(d,p),r===g?c[r].p(d,p):(xe(),D(c[g],1,1,()=>{c[g]=null}),Se(),s=c[r],s?s.p(d,p):(s=c[r]=l[r](d),s.c()),k(s,1),s.m(t,null))},i(d){o||(k(i),k(s),o=!0)},o(d){D(i),D(s),o=!1},d(d){d&&(E(e),E(t)),i&&i.d(d),c[r].d()}}}function dE(n,e,t){let r,{plugin:s}=e,o=s.app,i=s.relayManager,l=i.relayRoles,c=i.relays;Fe(n,c,R=>t(13,r=R));let f=s.sharedFolders,d,p=Rn,g,_=[{component:Rn}],{close:y}=e;function b(R){_.push({currentRelay:g,sharedFolder:d,component:p}),t(2,g=R.detail.relay),t(1,d=void 0),p=hi}function C(R){_.push({currentRelay:g,sharedFolder:d,component:p}),t(1,d=R.detail.folder),t(2,g=R.detail.relay)}function x(R){return ft(this,void 0,void 0,function*(){_.push({currentRelay:g,sharedFolder:d,component:p}),t(2,g=yield s.relayManager.createRelay("")),p=hi})}function M(R){if(R.detail.clear){_.length=0,t(2,g=void 0),t(1,d=void 0),p=Rn;return}let O=_.pop();if(O)for(;O;){if(!O.currentRelay&&!O.sharedFolder)t(2,g=O.currentRelay),t(1,d=O.sharedFolder),p=O.component;else if(O.sharedFolder&&f.has(O.sharedFolder)){t(2,g=O.currentRelay),t(1,d=O.sharedFolder),p=O.component;break}else if(O.currentRelay&&i.relays.get(O.currentRelay.id)){t(2,g=O.currentRelay),t(1,d=O.sharedFolder),p=O.component;break}O=_.pop()}else t(2,g=void 0),t(1,d=void 0),p=Rn}function W(R){_.length=0,y()}function S(R){t(2,g=R.detail.relay),p=hi}return n.$$set=R=>{"plugin"in R&&t(0,s=R.plugin),"close"in R&&t(12,y=R.close)},n.$$.update=()=>{if(n.$$.dirty&8196){e:g&&!r.has(g.id)&&(t(2,g=void 0),p=Rn)}if(n.$$.dirty&2){e:d&&!f.has(d)&&(t(1,d=void 0),p=Rn)}},[s,d,g,l,c,f,b,C,x,M,W,S,y,r]}var If=class extends ne{constructor(e){super(),ie(this,e,dE,fE,te,{plugin:0,close:12},iE)}},Yg=If;var il=class extends Jg.PluginSettingTab{constructor(t,r){super(t,r);this.plugin=r}display(){let{containerEl:t}=this;this.targetEl=t.parentElement,this.targetEl.empty(),this.plugin.relayManager.update(),this.component=new Yg({target:this.targetEl,props:{plugin:this.plugin,close:()=>{this.setting.close()}}})}hide(){var t;try{(t=this.component)==null||t.$destroy()}catch(r){console.warn(r)}}destroy(){this.hide(),this.plugin=null}};var ey=require("obsidian");var qg=[{color:"#30bced",light:"#30bced33"},{color:"#6eeb83",light:"#6eeb8333"},{color:"#ffbc42",light:"#ffbc4233"},{color:"#ecd444",light:"#ecd44433"},{color:"#ee6352",light:"#ee635233"},{color:"#9ac2c9",light:"#9ac2c933"},{color:"#8acb88",light:"#8acb8833"},{color:"#1be7ff",light:"#1be7ff33"}],pi=class{constructor(e,t,r){this.id=e,this.name=t,this.token=r,this.color=qg[Lo()%qg.length]}};var At=class extends Error{constructor(e){var t,r,s,o;super("ClientResponseError"),this.url="",this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,At.prototype),e!==null&&typeof e=="object"&&(this.url=typeof e.url=="string"?e.url:"",this.status=typeof e.status=="number"?e.status:0,this.isAbort=!!e.isAbort,this.originalError=e.originalError,e.response!==null&&typeof e.response=="object"?this.response=e.response:e.data!==null&&typeof e.data=="object"?this.response=e.data:this.response={}),this.originalError||e instanceof At||(this.originalError=e),typeof DOMException!="undefined"&&e instanceof DOMException&&(this.isAbort=!0),this.name="ClientResponseError "+this.status,this.message=(t=this.response)==null?void 0:t.message,this.message||(this.isAbort?this.message="The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.":(o=(s=(r=this.originalError)==null?void 0:r.cause)==null?void 0:s.message)!=null&&o.includes("ECONNREFUSED ::1")?this.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":this.message="Something went wrong while processing your request.")}get data(){return this.response}toJSON(){return{...this}}},al=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function hE(n,e){let t={};if(typeof n!="string")return t;let r=Object.assign({},e||{}).decode||pE,s=0;for(;s<n.length;){let o=n.indexOf("=",s);if(o===-1)break;let i=n.indexOf(";",s);if(i===-1)i=n.length;else if(i<o){s=n.lastIndexOf(";",o-1)+1;continue}let l=n.slice(s,o).trim();if(t[l]===void 0){let c=n.slice(o+1,i).trim();c.charCodeAt(0)===34&&(c=c.slice(1,-1));try{t[l]=r(c)}catch(f){t[l]=c}}s=i+1}return t}function jg(n,e,t){let r=Object.assign({},t||{}),s=r.encode||mE;if(!al.test(n))throw new TypeError("argument name is invalid");let o=s(e);if(o&&!al.test(o))throw new TypeError("argument val is invalid");let i=n+"="+o;if(r.maxAge!=null){let l=r.maxAge-0;if(isNaN(l)||!isFinite(l))throw new TypeError("option maxAge is invalid");i+="; Max-Age="+Math.floor(l)}if(r.domain){if(!al.test(r.domain))throw new TypeError("option domain is invalid");i+="; Domain="+r.domain}if(r.path){if(!al.test(r.path))throw new TypeError("option path is invalid");i+="; Path="+r.path}if(r.expires){if(!function(c){return Object.prototype.toString.call(c)==="[object Date]"||c instanceof Date}(r.expires)||isNaN(r.expires.valueOf()))throw new TypeError("option expires is invalid");i+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(i+="; HttpOnly"),r.secure&&(i+="; Secure"),r.priority)switch(typeof r.priority=="string"?r.priority.toLowerCase():r.priority){case"low":i+="; Priority=Low";break;case"medium":i+="; Priority=Medium";break;case"high":i+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return i}function pE(n){return n.indexOf("%")!==-1?decodeURIComponent(n):n}function mE(n){return encodeURIComponent(n)}var Xg;function ll(n){if(n)try{let e=decodeURIComponent(Xg(n.split(".")[1]).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(e)||{}}catch(e){}return{}}function Zg(n,e=0){let t=ll(n);return!(Object.keys(t).length>0&&(!t.exp||t.exp-e>Date.now()/1e3))}Xg=typeof atob=="function"?atob:n=>{let e=String(n).replace(/=+$/,"");if(e.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,s=0,o=0,i="";r=e.charAt(o++);~r&&(t=s%4?64*t+r:r,s++%4)?i+=String.fromCharCode(255&t>>(-2*s&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return i};var Gg="pb_auth",mi=class{constructor(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get model(){return this.baseModel}get isValid(){return!Zg(this.token)}get isAdmin(){return ll(this.token).type==="admin"}get isAuthRecord(){return ll(this.token).type==="authRecord"}save(e,t){this.baseToken=e||"",this.baseModel=t||null,this.triggerChange()}clear(){this.baseToken="",this.baseModel=null,this.triggerChange()}loadFromCookie(e,t=Gg){let r=hE(e||"")[t]||"",s={};try{s=JSON.parse(r),(typeof s===null||typeof s!="object"||Array.isArray(s))&&(s={})}catch(o){}this.save(s.token||"",s.model||null)}exportToCookie(e,t=Gg){var c,f;let r={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},s=ll(this.token);r.expires=s!=null&&s.exp?new Date(1e3*s.exp):new Date("1970-01-01"),e=Object.assign({},r,e);let o={token:this.token,model:this.model?JSON.parse(JSON.stringify(this.model)):null},i=jg(t,JSON.stringify(o),e),l=typeof Blob!="undefined"?new Blob([i]).size:i.length;if(o.model&&l>4096){o.model={id:(c=o==null?void 0:o.model)==null?void 0:c.id,email:(f=o==null?void 0:o.model)==null?void 0:f.email};let d=["collectionId","username","verified"];for(let p in this.model)d.includes(p)&&(o.model[p]=this.model[p]);i=jg(t,JSON.stringify(o),e)}return i}onChange(e,t=!1){return this._onChangeCallbacks.push(e),t&&e(this.token,this.model),()=>{for(let r=this._onChangeCallbacks.length-1;r>=0;r--)if(this._onChangeCallbacks[r]==e)return delete this._onChangeCallbacks[r],void this._onChangeCallbacks.splice(r,1)}}triggerChange(){for(let e of this._onChangeCallbacks)e&&e(this.token,this.model)}},$f=class extends mi{constructor(e="pocketbase_auth"){super(),this.storageFallback={},this.storageKey=e,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(e,t){this._storageSet(this.storageKey,{token:e,model:t}),super.save(e,t)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(e){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let t=window.localStorage.getItem(e)||"";try{return JSON.parse(t)}catch(r){return t}}return this.storageFallback[e]}_storageSet(e,t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=t;typeof t!="string"&&(r=JSON.stringify(t)),window.localStorage.setItem(e,r)}else this.storageFallback[e]=t}_storageRemove(e){var t;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((t=window.localStorage)==null||t.removeItem(e)),delete this.storageFallback[e]}_bindStorageEvent(){typeof window!="undefined"&&(window!=null&&window.localStorage)&&window.addEventListener&&window.addEventListener("storage",e=>{if(e.key!=this.storageKey)return;let t=this._storageGet(this.storageKey)||{};super.save(t.token||"",t.model||null)})}},nn=class{constructor(e){this.client=e}},Uf=class extends nn{async getAll(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/settings",e)}async update(e,t){return t=Object.assign({method:"PATCH",body:e},t),this.client.send("/api/settings",t)}async testS3(e="storage",t){return t=Object.assign({method:"POST",body:{filesystem:e}},t),this.client.send("/api/settings/test/s3",t).then(()=>!0)}async testEmail(e,t,r){return r=Object.assign({method:"POST",body:{email:e,template:t}},r),this.client.send("/api/settings/test/email",r).then(()=>!0)}async generateAppleClientSecret(e,t,r,s,o,i){return i=Object.assign({method:"POST",body:{clientId:e,teamId:t,keyId:r,privateKey:s,duration:o}},i),this.client.send("/api/settings/apple/generate-client-secret",i)}},gi=class extends nn{decode(e){return e}async getFullList(e,t){if(typeof e=="number")return this._getFullList(e,t);let r=500;return(t=Object.assign({},e,t)).batch&&(r=t.batch,delete t.batch),this._getFullList(r,t)}async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send(this.baseCrudPath,r).then(s=>{var o;return s.items=((o=s.items)==null?void 0:o.map(i=>this.decode(i)))||[],s})}async getFirstListItem(e,t){return(t=Object.assign({requestKey:"one_by_filter_"+this.baseCrudPath+"_"+e},t)).query=Object.assign({filter:e,skipTotal:1},t.query),this.getList(1,1,t).then(r=>{var s;if(!((s=r==null?void 0:r.items)!=null&&s.length))throw new At({status:404,response:{code:404,message:"The requested resource wasn't found.",data:{}}});return r.items[0]})}async getOne(e,t){if(!e)throw new At({url:this.client.buildUrl(this.baseCrudPath+"/"),status:404,response:{code:404,message:"Missing required record id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(r=>this.decode(r))}async create(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send(this.baseCrudPath,t).then(r=>this.decode(r))}async update(e,t,r){return r=Object.assign({method:"PATCH",body:t},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),r).then(s=>this.decode(s))}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(()=>!0)}_getFullList(e=500,t){(t=t||{}).query=Object.assign({skipTotal:1},t.query);let r=[],s=async o=>this.getList(o,e||500,t).then(i=>{let l=i.items;return r=r.concat(l),l.length==i.perPage?s(o+1):r});return s(1)}};function Nt(n,e,t,r){let s=r!==void 0;return s||t!==void 0?s?(console.warn(n),e.body=Object.assign({},e.body,t),e.query=Object.assign({},e.query,r),e):Object.assign(e,t):e}function Lf(n){var e;(e=n._resetAutoRefresh)==null||e.call(n)}var Nf=class extends gi{get baseCrudPath(){return"/api/admins"}async update(e,t,r){return super.update(e,t,r).then(s=>{var o,i;return((o=this.client.authStore.model)==null?void 0:o.id)===s.id&&((i=this.client.authStore.model)==null?void 0:i.collectionId)===void 0&&this.client.authStore.save(this.client.authStore.token,s),s})}async delete(e,t){return super.delete(e,t).then(r=>{var s,o;return r&&((s=this.client.authStore.model)==null?void 0:s.id)===e&&((o=this.client.authStore.model)==null?void 0:o.collectionId)===void 0&&this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.admin)||{});return e!=null&&e.token&&(e!=null&&e.admin)&&this.client.authStore.save(e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",admin:t})}async authWithPassword(e,t,r,s){let o={method:"POST",body:{identity:e,password:t}};o=Nt("This form of authWithPassword(email, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(email, pass, options?).",o,r,s);let i=o.autoRefreshThreshold;delete o.autoRefreshThreshold,o.autoRefresh||Lf(this.client);let l=await this.client.send(this.baseCrudPath+"/auth-with-password",o);return l=this.authResponse(l),i&&function(f,d,p,g){Lf(f);let _=f.beforeSend,y=f.authStore.model,b=f.authStore.onChange((C,x)=>{(!C||(x==null?void 0:x.id)!=(y==null?void 0:y.id)||(x!=null&&x.collectionId||y!=null&&y.collectionId)&&(x==null?void 0:x.collectionId)!=(y==null?void 0:y.collectionId))&&Lf(f)});f._resetAutoRefresh=function(){b(),f.beforeSend=_,delete f._resetAutoRefresh},f.beforeSend=async(C,x)=>{var R;let M=f.authStore.token;if((R=x.query)!=null&&R.autoRefresh)return _?_(C,x):{url:C,sendOptions:x};let W=f.authStore.isValid;if(W&&Zg(f.authStore.token,d))try{await p()}catch(O){W=!1}W||await g();let S=x.headers||{};for(let O in S)if(O.toLowerCase()=="authorization"&&M==S[O]&&f.authStore.token){S[O]=f.authStore.token;break}return x.headers=S,_?_(C,x):{url:C,sendOptions:x}}}(this.client,i,()=>this.authRefresh({autoRefresh:!0}),()=>this.authWithPassword(e,t,Object.assign({autoRefresh:!0},o))),l}async authRefresh(e,t){let r={method:"POST"};return r=Nt("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCrudPath+"/auth-refresh",r).then(this.authResponse.bind(this))}async requestPasswordReset(e,t,r){let s={method:"POST",body:{email:e}};return s=Nt("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",s,t,r),this.client.send(this.baseCrudPath+"/request-password-reset",s).then(()=>!0)}async confirmPasswordReset(e,t,r,s,o){let i={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return i=Nt("This form of confirmPasswordReset(resetToken, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(resetToken, password, passwordConfirm, options?).",i,s,o),this.client.send(this.baseCrudPath+"/confirm-password-reset",i).then(()=>!0)}},gE=["requestKey","$cancelKey","$autoCancel","fetch","headers","body","query","params","cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window"];function Qg(n){if(n){n.query=n.query||{};for(let e in n)gE.includes(e)||(n.query[e]=n[e],delete n[e])}}var cl=class extends nn{constructor(){super(...arguments),this.clientId="",this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15e3,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(e,t,r){var i;if(!e)throw new Error("topic must be set.");let s=e;if(r){Qg(r);let l="options="+encodeURIComponent(JSON.stringify({query:r.query,headers:r.headers}));s+=(s.includes("?")?"&":"?")+l}let o=function(l){let c=l,f;try{f=JSON.parse(c==null?void 0:c.data)}catch(d){}t(f||{})};return this.subscriptions[s]||(this.subscriptions[s]=[]),this.subscriptions[s].push(o),this.isConnected?this.subscriptions[s].length===1?await this.submitSubscriptions():(i=this.eventSource)==null||i.addEventListener(s,o):await this.connect(),async()=>this.unsubscribeByTopicAndListener(e,o)}async unsubscribe(e){var r;let t=!1;if(e){let s=this.getSubscriptionsByTopic(e);for(let o in s)if(this.hasSubscriptionListeners(o)){for(let i of this.subscriptions[o])(r=this.eventSource)==null||r.removeEventListener(o,i);delete this.subscriptions[o],t||(t=!0)}}else this.subscriptions={};this.hasSubscriptionListeners()?t&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(e){var r;let t=!1;for(let s in this.subscriptions)if((s+"?").startsWith(e)){t=!0;for(let o of this.subscriptions[s])(r=this.eventSource)==null||r.removeEventListener(s,o);delete this.subscriptions[s]}t&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(e,t){var o;let r=!1,s=this.getSubscriptionsByTopic(e);for(let i in s){if(!Array.isArray(this.subscriptions[i])||!this.subscriptions[i].length)continue;let l=!1;for(let c=this.subscriptions[i].length-1;c>=0;c--)this.subscriptions[i][c]===t&&(l=!0,delete this.subscriptions[i][c],this.subscriptions[i].splice(c,1),(o=this.eventSource)==null||o.removeEventListener(i,t));l&&(this.subscriptions[i].length||delete this.subscriptions[i],r||this.hasSubscriptionListeners(i)||(r=!0))}this.hasSubscriptionListeners()?r&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(e){var t,r;if(this.subscriptions=this.subscriptions||{},e)return!!((t=this.subscriptions[e])!=null&&t.length);for(let s in this.subscriptions)if((r=this.subscriptions[s])!=null&&r.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch(e=>{if(!(e!=null&&e.isAbort))throw e})}getSubscriptionsCancelKey(){return"realtime_"+this.clientId}getSubscriptionsByTopic(e){let t={};e=e.includes("?")?e:e+"?";for(let r in this.subscriptions)(r+"?").startsWith(e)&&(t[r]=this.subscriptions[r]);return t}getNonEmptySubscriptionKeys(){let e=[];for(let t in this.subscriptions)this.subscriptions[t].length&&e.push(t);return e}addAllSubscriptionListeners(){if(this.eventSource){this.removeAllSubscriptionListeners();for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.addEventListener(e,t)}}removeAllSubscriptionListeners(){if(this.eventSource)for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.removeEventListener(e,t)}async connect(){if(!(this.reconnectAttempts>0))return new Promise((e,t)=>{this.pendingConnects.push({resolve:e,reject:t}),this.pendingConnects.length>1||this.initConnect()})}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout(()=>{this.connectErrorHandler(new Error("EventSource connect took too long."))},this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildUrl("/api/realtime")),this.eventSource.onerror=e=>{this.connectErrorHandler(new Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",e=>{let t=e;this.clientId=t==null?void 0:t.lastEventId,this.submitSubscriptions().then(async()=>{let r=3;for(;this.hasUnsentSubscriptions()&&r>0;)r--,await this.submitSubscriptions()}).then(()=>{for(let s of this.pendingConnects)s.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);let r=this.getSubscriptionsByTopic("PB_CONNECT");for(let s in r)for(let o of r[s])o(e)}).catch(r=>{this.clientId="",this.connectErrorHandler(r)})})}hasUnsentSubscriptions(){let e=this.getNonEmptySubscriptionKeys();if(e.length!=this.lastSentSubscriptions.length)return!0;for(let t of e)if(!this.lastSentSubscriptions.includes(t))return!0;return!1}connectErrorHandler(e){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let r of this.pendingConnects)r.reject(new At(e));return this.pendingConnects=[],void this.disconnect()}this.disconnect(!0);let t=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout(()=>{this.initConnect()},t)}disconnect(e=!1){var t;if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),(t=this.eventSource)==null||t.close(),this.eventSource=null,this.clientId="",!e){this.reconnectAttempts=0;for(let r of this.pendingConnects)r.resolve();this.pendingConnects=[]}}},Bf=class extends gi{constructor(e,t){super(e),this.collectionIdOrName=t}get baseCrudPath(){return this.baseCollectionPath+"/records"}get baseCollectionPath(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)}async subscribe(e,t,r){if(!e)throw new Error("Missing topic.");if(!t)throw new Error("Missing subscription callback.");return this.client.realtime.subscribe(this.collectionIdOrName+"/"+e,t,r)}async unsubscribe(e){return e?this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+e):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(e,t){if(typeof e=="number")return super.getFullList(e,t);let r=Object.assign({},e,t);return super.getFullList(r)}async getList(e=1,t=30,r){return super.getList(e,t,r)}async getFirstListItem(e,t){return super.getFirstListItem(e,t)}async getOne(e,t){return super.getOne(e,t)}async create(e,t){return super.create(e,t)}async update(e,t,r){return super.update(e,t,r).then(s=>{var o,i,l;return((o=this.client.authStore.model)==null?void 0:o.id)!==(s==null?void 0:s.id)||((i=this.client.authStore.model)==null?void 0:i.collectionId)!==this.collectionIdOrName&&((l=this.client.authStore.model)==null?void 0:l.collectionName)!==this.collectionIdOrName||this.client.authStore.save(this.client.authStore.token,s),s})}async delete(e,t){return super.delete(e,t).then(r=>{var s,o,i;return!r||((s=this.client.authStore.model)==null?void 0:s.id)!==e||((o=this.client.authStore.model)==null?void 0:o.collectionId)!==this.collectionIdOrName&&((i=this.client.authStore.model)==null?void 0:i.collectionName)!==this.collectionIdOrName||this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.record)||{});return this.client.authStore.save(e==null?void 0:e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",record:t})}async listAuthMethods(e){return e=Object.assign({method:"GET"},e),this.client.send(this.baseCollectionPath+"/auth-methods",e).then(t=>Object.assign({},t,{usernamePassword:!!(t!=null&&t.usernamePassword),emailPassword:!!(t!=null&&t.emailPassword),authProviders:Array.isArray(t==null?void 0:t.authProviders)?t==null?void 0:t.authProviders:[]}))}async authWithPassword(e,t,r,s){let o={method:"POST",body:{identity:e,password:t}};return o=Nt("This form of authWithPassword(usernameOrEmail, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(usernameOrEmail, pass, options?).",o,r,s),this.client.send(this.baseCollectionPath+"/auth-with-password",o).then(i=>this.authResponse(i))}async authWithOAuth2Code(e,t,r,s,o,i,l){let c={method:"POST",body:{provider:e,code:t,codeVerifier:r,redirectUrl:s,createData:o}};return c=Nt("This form of authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, body?, query?) is deprecated. Consider replacing it with authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, options?).",c,i,l),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",c).then(f=>this.authResponse(f))}async authWithOAuth2(...e){if(e.length>1||typeof(e==null?void 0:e[0])=="string")return console.warn("PocketBase: This form of authWithOAuth2() is deprecated and may get removed in the future. Please replace with authWithOAuth2Code() OR use the authWithOAuth2() realtime form as shown in https://pocketbase.io/docs/authentication/#oauth2-integration."),this.authWithOAuth2Code((e==null?void 0:e[0])||"",(e==null?void 0:e[1])||"",(e==null?void 0:e[2])||"",(e==null?void 0:e[3])||"",(e==null?void 0:e[4])||{},(e==null?void 0:e[5])||{},(e==null?void 0:e[6])||{});let t=(e==null?void 0:e[0])||{},r=(await this.listAuthMethods()).authProviders.find(c=>c.name===t.provider);if(!r)throw new At(new Error(`Missing or invalid provider "${t.provider}".`));let s=this.client.buildUrl("/api/oauth2-redirect"),o=new cl(this.client),i=null;function l(){i==null||i.close(),o.unsubscribe()}return t.urlCallback||(i=zg(void 0)),new Promise(async(c,f)=>{var d;try{await o.subscribe("@oauth2",async y=>{let b=o.clientId;try{if(!y.state||b!==y.state)throw new Error("State parameters don't match.");let C=Object.assign({},t);delete C.provider,delete C.scopes,delete C.createData,delete C.urlCallback;let x=await this.authWithOAuth2Code(r.name,y.code,r.codeVerifier,s,t.createData,C);c(x)}catch(C){f(new At(C))}l()});let p={state:o.clientId};(d=t.scopes)!=null&&d.length&&(p.scope=t.scopes.join(" "));let g=this._replaceQueryParams(r.authUrl+s,p);await(t.urlCallback||function(y){i?i.location.href=y:i=zg(y)})(g)}catch(p){l(),f(new At(p))}})}async authRefresh(e,t){let r={method:"POST"};return r=Nt("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCollectionPath+"/auth-refresh",r).then(s=>this.authResponse(s))}async requestPasswordReset(e,t,r){let s={method:"POST",body:{email:e}};return s=Nt("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",s,t,r),this.client.send(this.baseCollectionPath+"/request-password-reset",s).then(()=>!0)}async confirmPasswordReset(e,t,r,s,o){let i={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return i=Nt("This form of confirmPasswordReset(token, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(token, password, passwordConfirm, options?).",i,s,o),this.client.send(this.baseCollectionPath+"/confirm-password-reset",i).then(()=>!0)}async requestVerification(e,t,r){let s={method:"POST",body:{email:e}};return s=Nt("This form of requestVerification(email, body?, query?) is deprecated. Consider replacing it with requestVerification(email, options?).",s,t,r),this.client.send(this.baseCollectionPath+"/request-verification",s).then(()=>!0)}async confirmVerification(e,t,r){let s={method:"POST",body:{token:e}};return s=Nt("This form of confirmVerification(token, body?, query?) is deprecated. Consider replacing it with confirmVerification(token, options?).",s,t,r),this.client.send(this.baseCollectionPath+"/confirm-verification",s).then(()=>!0)}async requestEmailChange(e,t,r){let s={method:"POST",body:{newEmail:e}};return s=Nt("This form of requestEmailChange(newEmail, body?, query?) is deprecated. Consider replacing it with requestEmailChange(newEmail, options?).",s,t,r),this.client.send(this.baseCollectionPath+"/request-email-change",s).then(()=>!0)}async confirmEmailChange(e,t,r,s){let o={method:"POST",body:{token:e,password:t}};return o=Nt("This form of confirmEmailChange(token, password, body?, query?) is deprecated. Consider replacing it with confirmEmailChange(token, password, options?).",o,r,s),this.client.send(this.baseCollectionPath+"/confirm-email-change",o).then(()=>!0)}async listExternalAuths(e,t){return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths",t)}async unlinkExternalAuth(e,t,r){return r=Object.assign({method:"DELETE"},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths/"+encodeURIComponent(t),r).then(()=>!0)}_replaceQueryParams(e,t={}){let r=e,s="";e.indexOf("?")>=0&&(r=e.substring(0,e.indexOf("?")),s=e.substring(e.indexOf("?")+1));let o={},i=s.split("&");for(let l of i){if(l=="")continue;let c=l.split("=");o[decodeURIComponent(c[0].replace(/\+/g," "))]=decodeURIComponent((c[1]||"").replace(/\+/g," "))}for(let l in t)t.hasOwnProperty(l)&&(t[l]==null?delete o[l]:o[l]=t[l]);s="";for(let l in o)o.hasOwnProperty(l)&&(s!=""&&(s+="&"),s+=encodeURIComponent(l.replace(/%20/g,"+"))+"="+encodeURIComponent(o[l].replace(/%20/g,"+")));return s!=""?r+"?"+s:r}};function zg(n){if(typeof window=="undefined"||!(window!=null&&window.open))throw new At(new Error("Not in a browser context - please pass a custom urlCallback function."));let e=1024,t=768,r=window.innerWidth,s=window.innerHeight;e=e>r?r:e,t=t>s?s:t;let o=r/2-e/2,i=s/2-t/2;return window.open(n,"popup_window","width="+e+",height="+t+",top="+i+",left="+o+",resizable,menubar=no")}var Hf=class extends gi{get baseCrudPath(){return"/api/collections"}async import(e,t=!1,r){return r=Object.assign({method:"PUT",body:{collections:e,deleteMissing:t}},r),this.client.send(this.baseCrudPath+"/import",r).then(()=>!0)}},Vf=class extends nn{async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send("/api/logs",r)}async getOne(e,t){if(!e)throw new At({url:this.client.buildUrl("/api/logs/"),status:404,response:{code:404,message:"Missing required log id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send("/api/logs/"+encodeURIComponent(e),t)}async getStats(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/logs/stats",e)}},Wf=class extends nn{async check(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/health",e)}},Kf=class extends nn{getUrl(e,t,r={}){if(!t||!(e!=null&&e.id)||!(e!=null&&e.collectionId)&&!(e!=null&&e.collectionName))return"";let s=[];s.push("api"),s.push("files"),s.push(encodeURIComponent(e.collectionId||e.collectionName)),s.push(encodeURIComponent(e.id)),s.push(encodeURIComponent(t));let o=this.client.buildUrl(s.join("/"));if(Object.keys(r).length){r.download===!1&&delete r.download;let i=new URLSearchParams(r);o+=(o.includes("?")?"&":"?")+i}return o}async getToken(e){return e=Object.assign({method:"POST"},e),this.client.send("/api/files/token",e).then(t=>(t==null?void 0:t.token)||"")}},Yf=class extends nn{async getFullList(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/backups",e)}async create(e,t){return t=Object.assign({method:"POST",body:{name:e}},t),this.client.send("/api/backups",t).then(()=>!0)}async upload(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send("/api/backups/upload",t).then(()=>!0)}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}`,t).then(()=>!0)}async restore(e,t){return t=Object.assign({method:"POST"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}/restore`,t).then(()=>!0)}getDownloadUrl(e,t){return this.client.buildUrl(`/api/backups/${encodeURIComponent(t)}?token=${encodeURIComponent(e)}`)}},ul=class{constructor(e="/",t,r="en-US"){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseUrl=e,this.lang=r,this.authStore=t||new $f,this.admins=new Nf(this),this.collections=new Hf(this),this.files=new Kf(this),this.logs=new Vf(this),this.settings=new Uf(this),this.realtime=new cl(this),this.health=new Wf(this),this.backups=new Yf(this)}collection(e){return this.recordServices[e]||(this.recordServices[e]=new Bf(this,e)),this.recordServices[e]}autoCancellation(e){return this.enableAutoCancellation=!!e,this}cancelRequest(e){return this.cancelControllers[e]&&(this.cancelControllers[e].abort(),delete this.cancelControllers[e]),this}cancelAllRequests(){for(let e in this.cancelControllers)this.cancelControllers[e].abort();return this.cancelControllers={},this}filter(e,t){if(!t)return e;for(let r in t){let s=t[r];switch(typeof s){case"boolean":case"number":s=""+s;break;case"string":s="'"+s.replace(/'/g,"\\'")+"'";break;default:s=s===null?"null":s instanceof Date?"'"+s.toISOString().replace("T"," ")+"'":"'"+JSON.stringify(s).replace(/'/g,"\\'")+"'"}e=e.replaceAll("{:"+r+"}",s)}return e}getFileUrl(e,t,r={}){return this.files.getUrl(e,t,r)}buildUrl(e){var r;let t=this.baseUrl;return typeof window=="undefined"||!window.location||t.startsWith("https://")||t.startsWith("http://")||(t=(r=window.location.origin)!=null&&r.endsWith("/")?window.location.origin.substring(0,window.location.origin.length-1):window.location.origin||"",this.baseUrl.startsWith("/")||(t+=window.location.pathname||"/",t+=t.endsWith("/")?"":"/"),t+=this.baseUrl),e&&(t+=t.endsWith("/")?"":"/",t+=e.startsWith("/")?e.substring(1):e),t}async send(e,t){t=this.initSendOptions(e,t);let r=this.buildUrl(e);if(this.beforeSend){let s=Object.assign({},await this.beforeSend(r,t));s.url!==void 0||s.options!==void 0?(r=s.url||r,t=s.options||t):Object.keys(s).length&&(t=s,console!=null&&console.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))}if(t.query!==void 0){let s=this.serializeQueryParams(t.query);s&&(r+=(r.includes("?")?"&":"?")+s),delete t.query}return this.getHeader(t.headers,"Content-Type")=="application/json"&&t.body&&typeof t.body!="string"&&(t.body=JSON.stringify(t.body)),(t.fetch||fetch)(r,t).then(async s=>{let o={};try{o=await s.json()}catch(i){}if(this.afterSend&&(o=await this.afterSend(s,o)),s.status>=400)throw new At({url:s.url,status:s.status,data:o});return o}).catch(s=>{throw new At(s)})}initSendOptions(e,t){if((t=Object.assign({method:"GET"},t)).body=this.convertToFormDataIfNeeded(t.body),Qg(t),t.query=Object.assign({},t.params,t.query),t.requestKey===void 0&&(t.$autoCancel===!1||t.query.$autoCancel===!1?t.requestKey=null:(t.$cancelKey||t.query.$cancelKey)&&(t.requestKey=t.$cancelKey||t.query.$cancelKey)),delete t.$autoCancel,delete t.query.$autoCancel,delete t.$cancelKey,delete t.query.$cancelKey,this.getHeader(t.headers,"Content-Type")!==null||this.isFormData(t.body)||(t.headers=Object.assign({},t.headers,{"Content-Type":"application/json"})),this.getHeader(t.headers,"Accept-Language")===null&&(t.headers=Object.assign({},t.headers,{"Accept-Language":this.lang})),this.authStore.token&&this.getHeader(t.headers,"Authorization")===null&&(t.headers=Object.assign({},t.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&t.requestKey!==null){let r=t.requestKey||(t.method||"GET")+e;delete t.requestKey,this.cancelRequest(r);let s=new AbortController;this.cancelControllers[r]=s,t.signal=s.signal}return t}convertToFormDataIfNeeded(e){if(typeof FormData=="undefined"||e===void 0||typeof e!="object"||e===null||this.isFormData(e)||!this.hasBlobField(e))return e;let t=new FormData;for(let r in e){let s=this.normalizeFormDataValue(e[r]),o=Array.isArray(s)?s:[s];if(o.length)for(let i of o)t.append(r,i);else t.append(r,"")}return t}normalizeFormDataValue(e){return e===null||typeof e!="object"||e instanceof Date||this.hasBlobField({data:e})||Array.isArray(e)&&!e.filter(t=>typeof t!="string").length?e:JSON.stringify(e)}hasBlobField(e){for(let t in e){let r=Array.isArray(e[t])?e[t]:[e[t]];for(let s of r)if(typeof Blob!="undefined"&&s instanceof Blob||typeof File!="undefined"&&s instanceof File)return!0}return!1}getHeader(e,t){e=e||{},t=t.toLowerCase();for(let r in e)if(r.toLowerCase()==t)return e[r];return null}isFormData(e){return e&&(e.constructor.name==="FormData"||typeof FormData!="undefined"&&e instanceof FormData)}serializeQueryParams(e){let t=[];for(let r in e){if(e[r]===null)continue;let s=e[r],o=encodeURIComponent(r);if(Array.isArray(s))for(let i of s)t.push(o+"="+encodeURIComponent(i));else s instanceof Date?t.push(o+"="+encodeURIComponent(s.toISOString())):typeof s!==null&&typeof s=="object"?t.push(o+"="+encodeURIComponent(JSON.stringify(s))):t.push(o+"="+encodeURIComponent(s))}return t.join("&")}};var fl=class extends mi{constructor(t="pocketbase_auth"){super();this.storageFallback={};this._storageChangeHandler=t=>{if(t.key!=this.storageKey)return;let r=this._storageGet(this.storageKey)||{};super.save(r.token||"",r.model||null)};this.storageKey=t,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(t,r){this._storageSet(this.storageKey,{token:t,model:r}),super.save(t,r)}clear(){this._storageRemove(this.storageKey),super.clear()}destroy(){this._unbindStorageEvent()}_storageGet(t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=window.localStorage.getItem(t)||"";try{return JSON.parse(r)}catch(s){return r}}return this.storageFallback[t]}_storageSet(t,r){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let s=r;typeof r!="string"&&(s=JSON.stringify(r)),window.localStorage.setItem(t,s)}else this.storageFallback[t]=r}_storageRemove(t){var r;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((r=window.localStorage)==null||r.removeItem(t)),delete this.storageFallback[t]}_bindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.addEventListener("storage",this._storageChangeHandler)}_unbindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.removeEventListener("storage",this._storageChangeHandler)}};var dl=class extends Ut{constructor(t,r){super();this._log=Q("[LoginManager]");let s=Q("[Pocketbase]","debug");this.authStore=new fl(`pocketbase_auth_${t}`),this.pb=new ul("https://auth.system3.md",this.authStore),this.pb.beforeSend=(o,i)=>(s(o,i),i.fetch=ts,i.headers=Object.assign({},i.headers,{"Relay-Version":"0.3.3"}),{url:o,options:i}),this.openSettings=r,this.user=this.pb.authStore.isValid?this.makeUser(this.pb.authStore):void 0,dr.set(this,"loginManager")}log(t,...r){this._log(t,...r)}setup(t){var r;return this.pb.authStore.isValid?(this.user=this.makeUser(this.pb.authStore),this.notifyListeners(),t&&this.pb.collection("oauth2_response").create({user:t.record.id,oauth_response:(r=t.meta)==null?void 0:r.rawUser}).then(()=>{this.notifyListeners()}).catch(s=>{this.log(s)}),!0):(this.notifyListeners(),!1)}whoami(){let t={Authorization:`Bearer ${this.pb.authStore.token}`};(0,ey.requestUrl)({url:"https://api.system3.md/whoami",method:"GET",headers:t}).then(r=>{this.log(r.json)}).catch(r=>{this.log(r)})}get loggedIn(){return this.user!==void 0}get hasUser(){return this.user!==void 0}makeUser(t){var r,s;return new pi((r=t.model)==null?void 0:r.id,(s=t.model)==null?void 0:s.email,t.token)}get anon(){return new pi("","Anonymous","")}logout(){this.pb.cancelAllRequests(),this.pb.authStore.clear(),this.user=void 0,this.notifyListeners()}async initiateManualOAuth2CodeFlow(t){let s=(await this.pb.collection("users").listAuthMethods({fetch:t}).catch(i=>{throw i.originalError})).authProviders[0],o=this.pb.buildUrl("/api/oauth2-redirect");return[s.authUrl+o,s,async i=>this.pb.collection("users").authWithOAuth2Code(s.name,i,s.codeVerifier,o,{fetch:t}).then(l=>(this.setup(l),l))]}async poll(t,r){let s=0,o=1e3;return new Promise((i,l)=>{let c=setInterval(()=>{if(s+=1,s>30)return clearInterval(c),l(new Error(`Auth timeout: Timed out after ${s*o/1e3} seconds`));this.pb.collection("code_exchange").getOne(t.state.slice(0,15)).then(f=>{if(f)return clearInterval(c),i(r(f.code))}).catch(f=>{})},o)})}async login(){try{let t=await this.pb.collection("users").authWithOAuth2({provider:"google"});return this.setup(t)}catch(t){return this.log("request failed",t),console.error("Authenticating failed",t),!1}}async openLoginPage(){return await this.openSettings(),await new Promise((r,s)=>{let o=()=>{this.loggedIn&&(this.off(o),r(!0)),r(!1)};this.on(o)})}destroy(){this.pb.cancelAllRequests(),this.pb.realtime.unsubscribe(),this.pb=null,this.authStore.destroy(),this.authStore=null,this.user=void 0,this.openSettings=null,super.destroy()}};function Jf(n,e){let t=Object.keys(e).map(r=>yE(n,r,e[r]));return t.length===1?t[0]:function(){t.forEach(r=>r())}}function yE(n,e,t){let r=n[e],s=n.hasOwnProperty(e),o=s?r:function(){return Object.getPrototypeOf(n)[e].apply(this,arguments)},i=t(o);return r&&Object.setPrototypeOf(i,r),Object.setPrototypeOf(l,i),n[e]=l,c;function l(...f){return i===o&&n[e]===l&&c(),i.apply(this,f)}function c(){n[e]===l&&(s?n[e]=o:delete n[e]),i!==o&&(i=o,Object.setPrototypeOf(l,r||Function))}}var gt=crypto;var Pr=new TextEncoder,Bt=new TextDecoder,lI=2**32;var ty=n=>{let e=n;typeof e=="string"&&(e=Pr.encode(e));let t=32768,r=[];for(let s=0;s<e.length;s+=t)r.push(String.fromCharCode.apply(null,e.subarray(s,s+t)));return btoa(r.join(""))},wr=n=>ty(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),ry=n=>{let e=atob(n),t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},ns=n=>{let e=n;e instanceof Uint8Array&&(e=Bt.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return ry(e)}catch(t){throw new TypeError("The input to be decoded is not correctly encoded.")}};var qf={};Zl(qf,{JOSEAlgNotAllowed:()=>wi,JOSEError:()=>dt,JOSENotSupported:()=>Xe,JWEDecryptionFailed:()=>_i,JWEInvalid:()=>Ht,JWKInvalid:()=>pl,JWKSInvalid:()=>ml,JWKSMultipleMatchingKeys:()=>gl,JWKSNoMatchingKey:()=>bi,JWKSTimeout:()=>yl,JWSInvalid:()=>sn,JWSSignatureVerificationFailed:()=>vi,JWTClaimValidationFailed:()=>yi,JWTExpired:()=>hl,JWTInvalid:()=>Dt});var dt=class extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(t=Error.captureStackTrace)==null||t.call(Error,this,this.constructor)}},yi=class extends dt{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=t,this.reason=r}},hl=class extends dt{static get code(){return"ERR_JWT_EXPIRED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=t,this.reason=r}},wi=class extends dt{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}},Xe=class extends dt{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}},_i=class extends dt{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}},Ht=class extends dt{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}},sn=class extends dt{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}},Dt=class extends dt{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}},pl=class extends dt{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}static get code(){return"ERR_JWK_INVALID"}},ml=class extends dt{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}},bi=class extends dt{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}},gl=class extends dt{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}},yl=class extends dt{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}},vi=class extends dt{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}};var wl=gt.getRandomValues.bind(gt);function xE(n){return typeof n=="object"&&n!==null}function Mt(n){if(!xE(n)||Object.prototype.toString.call(n)!=="[object Object]")return!1;if(Object.getPrototypeOf(n)===null)return!0;let e=n;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(n)===e}var OE=Symbol();var KE,vl,hy;(typeof navigator=="undefined"||!((hy=(vl=navigator.userAgent)==null?void 0:vl.startsWith)!=null&&hy.call(vl,"Mozilla/5.0 ")))&&(KE="jose/v5.3.0");var zf={};Zl(zf,{decode:()=>xl,encode:()=>YE});var YE=wr,xl=ns;function Xf(n){if(typeof n!="string")throw new Dt("JWTs must use Compact JWS serialization, JWT must be a string");let{1:e,length:t}=n.split(".");if(t===5)throw new Dt("Only JWTs using Compact JWS serialization can be decoded");if(t!==3)throw new Dt("Invalid JWT");if(!e)throw new Dt("JWTs must contain a payload");let r;try{r=xl(e)}catch(o){throw new Dt("Failed to base64url decode the payload")}let s;try{s=JSON.parse(Bt.decode(r))}catch(o){throw new Dt("Failed to parse the decoded payload as JSON")}if(!Mt(s))throw new Dt("Invalid JWT Claims Set");return s}var ss=class extends Error{constructor(e){super(e),this.name="[System3] Relay Error"}};function py(n){return n<1e3?`${n}ms`:n<6e4?`${Math.round(n/1e3)}s`:n<36e5?`${Math.round(n/6e4)}m`:`${Math.round(n/36e5)}h`}function JE(n){let e=Xf(n.token);if(typeof e=="string")return 0;let t=e==null?void 0:e.exp;return t?t*1e3:0}var Sl=class{constructor(e,t=5){this.expiryMargin=5*60*1e3;this.activeConnections=0;this._activePromises=new Map,e.getStorage?this.tokenMap=e.getStorage():this.tokenMap=new Map,this.callbacks=new Map,this.refreshQueue=new Set,this._log=e.log,this.refresh=e.refresh,this.timeProvider=e.getTimeProvider(),e.getJwtExpiry?this.getJwtExpiry=e.getJwtExpiry:this.getJwtExpiry=JE,this.maxConnections=t,this.refreshInterval=null}onRefresh(e){return new Promise((r,s)=>{let o=l=>{r(l)},i=l=>{s(l)};this.refresh(e,o,i)})}start(){this.log("starting"),this.report(),this.refreshInterval=this.timeProvider.setInterval(()=>this.checkAndRefreshTokens(),60*1e3),this.checkAndRefreshTokens()}stop(){this.log("stopping"),this.refreshInterval&&(this.timeProvider.clearInterval(this.refreshInterval),this.refreshInterval=null)}_cleanupInvalidTokens(){let e=[];for(let[t,r]of this.tokenMap.entries())this.isTokenValid(r)||e.push(t);for(let t of e)this.tokenMap.delete(t)}checkAndRefreshTokens(){this.log("check and refresh tokens"),this._cleanupInvalidTokens();for(let[e,t]of this.tokenMap.entries())this.callbacks.has(e)&&this.shouldRefresh(t)&&(this.log("adding to refresh queue"),this.addToRefreshQueue(e));this.log(this.report())}dequeue(){if(this.log("getting next item in queue"),this.refreshQueue.size>0){let e=this.refreshQueue.values().next().value;return this.refreshQueue.delete(e),e}return null}addToRefreshQueue(e){if(this.activeConnections<this.maxConnections){this.log(`immediate refresh of ${e}`),this.activeConnections++;let t=s=>{this.onTokenRefreshed(e,s),this.activeConnections--;let o=this.dequeue();o&&this.addToRefreshQueue(o)},r=()=>{this.onRefreshFailure(e),this.activeConnections--;let s=this.dequeue();s&&this.addToRefreshQueue(s)};this.refresh(e,t,r)}else this.log(`enqueued refresh of ${e}`),this.refreshQueue.add(e)}log(e){this._log(e)}onTokenRefreshed(e,t){let r=this.getJwtExpiry(t);if(this.tokenMap.has(e)){let s=this.tokenMap.get(e),o=this.callbacks.get(e);this.log(`new expiry time is ${r}`),this.tokenMap.set(e,{...s,token:t,expiryTime:r}),o(t),this.log(`Token refreshed for ${s.friendlyName} (${e})`)}}onRefreshFailure(e){let t=this.tokenMap.get(e),r=(t==null?void 0:t.attempts)||0+1;r<=3?this.tokenMap.set(e,{...t,attempts:r}):this.tokenMap.delete(e)}isTokenValid(e){return this.timeProvider.getTime()<e.expiryTime}shouldRefresh(e){return this.timeProvider.getTime()+this.expiryMargin>e.expiryTime}getTokenSync(e){var t,r;return(r=(t=this.tokenMap)==null?void 0:t.get(e))==null?void 0:r.token}getTokenFromNetwork(e,t,r){let s=this._activePromises.get(e);if(s)return s;this.tokenMap.set(e,{token:null,friendlyName:t,expiryTime:0,attempts:0}),this.callbacks.set(e,r);let o=this.onRefresh(e).then(i=>(this.onTokenRefreshed(e,i),this._activePromises.delete(e),i)).catch(i=>{throw this.onRefreshFailure(e),this._activePromises.delete(e),i});return this._activePromises.set(e,o),o}async getToken(e,t,r){if(this.log(`getting token ${t}`),this.tokenMap||Promise.reject(new ss("attempted to get token after TokenStore was destroyed.")),this.tokenMap.has(e)){let s=this.tokenMap.get(e);if(s.token&&this.isTokenValid(s))return this.callbacks.set(e,r),s.friendlyName=t,r(s.token),this.log("token was valid, cache hit!"),this._activePromises.delete(e),Promise.resolve(s.token)}return this.getTokenFromNetwork(e,t,r)}_reportWithFilter(e){let t=[],r=this.timeProvider.getTime(),s=Array.from(this.tokenMap.entries()).sort((o,i)=>o[1].expiryTime-i[1].expiryTime);for(let[o,{friendlyName:i,expiryTime:l,attempts:c}]of s){if(!e(o))continue;let f=l-r,d="";f>0?d=`expires in ${py(f-this.expiryMargin)}`:d="expired",t.push(`${o} (${i}): ${c} attempts, (${d})`)}return t}report(){let e=[];return e.push("Token Store Report:"),e.push(`Expiry Margin: ${py(this.expiryMargin)}`),e.push("Active Tokens:"),e.push(...this._reportWithFilter(t=>this.callbacks.has(t))),e.push("Stale Tokens:"),e.push(...this._reportWithFilter(t=>!this.callbacks.has(t))),e.push(`Queue size: ${this.refreshQueue.size}`),e.join(`
`)}async waitForQueue(){return new Promise(e=>{setInterval(()=>{if(this.refreshQueue.size==0)return e()},100)})}clearState(){this.refreshQueue.clear();for(let[e,t]of this.tokenMap.entries())this.isTokenValid(t)?this.tokenMap.set(e,{...t,attempts:0}):this.tokenMap.delete(e)}clear(){this.tokenMap.clear(),this.refreshQueue.clear()}destroy(){this.clear(),this.timeProvider.destroy(),this.timeProvider=null,this.refresh=null,this.callbacks.clear(),this.callbacks=null,this._activePromises.clear(),this._activePromises=null,this.tokenMap=null}};var my=require("obsidian");var kl=class{constructor(e){this.seperator="/";this.namespace=e}fullKey(e){return`${this.namespace}${this.seperator}${e}`}get size(){return Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).length}clear(){Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).forEach(e=>localStorage.removeItem(e))}delete(e){let t=this.fullKey(e),r=localStorage.getItem(t)!==null;return localStorage.removeItem(t),r}forEach(e,t){Object.keys(localStorage).filter(r=>r.startsWith(this.namespace+this.seperator)).forEach(r=>{let s=r.split(`${this.namespace}${this.seperator}`)[1],o=this.get(s);e.call(t,o,s,this)})}get(e){let t=this.fullKey(e),r=localStorage.getItem(t);return r?JSON.parse(r):void 0}has(e){let t=this.fullKey(e);return localStorage.getItem(t)!==null}set(e,t){let r=this.fullKey(e);return localStorage.setItem(r,JSON.stringify(t)),this}keys(){return Object.keys(localStorage).filter(t=>t.startsWith(this.namespace+this.seperator)).map(t=>t.split(`${this.namespace}${this.seperator}`)[1]).values()}values(){return Array.from(this.keys()).map(t=>this.get(t)).values()}entries(){return Array.from(this.keys()).map(t=>[t,this.get(t)]).values()}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return"LocalStorage"}};function qE(n){return n.expiryTime||0}function jE(n,e){return(...t)=>e(n,...t)}async function GE(n,e,t,r){var f;let s=Q("[TokenStore][Refresh]","debug"),o=Q("[TokenStore][Refresh]","error");s(`${e}`);let i=Dr.decode(e),l;if(i instanceof hr)l=JSON.stringify({docId:i.documentId,relay:i.relayId});else if(i instanceof zt)l=JSON.stringify({docId:i.folderId,relay:i.relayId});else{r(new Error("No remote to connect to"));return}if(!n.loggedIn){r(Error("Not logged in"));return}let c={Authorization:`Bearer ${(f=n.user)==null?void 0:f.token}`};(0,my.requestUrl)({url:"https://api.system3.md/token",method:"POST",headers:c,body:l}).then(d=>{d.status!==200&&(s(d.status,d.text),r(Error(`Received status code ${d.status} from an API.`)));let p=d.json;t(p)}).catch(d=>{o(d,l),r(d)})}var Cl=class extends Sl{constructor(e,t,r,s=5){super({log:Q("[LiveTokenStore]","debug"),refresh:jE(e,GE),getJwtExpiry:qE,getStorage:function(){return new kl("TokenStore/"+r)},getTimeProvider:()=>t},s)}};var gy=require("obsidian");var Zf=class{constructor(e,t,r=1e4){this.timeProvider=e;this.onOnline=[];this.onOffline=[];this.online=!0;this._log=Q("[NetworkStatus]"),this.url=t,this.interval=r,this._onceOnline=new Set}log(e,...t){this._log(e,...t)}start(){this.timer||(this.timer=this.checkStatusRepeatedly())}stop(){this.timer&&clearInterval(this.timer)}checkStatusRepeatedly(){return this.timeProvider.setInterval(this._checkStatus.bind(this),this.interval)}checkStatus(){return this.online?Promise.resolve(!0):new Promise(e=>{this._checkStatus().then(()=>{e(this.online)})})}async _checkStatus(){return(0,gy.requestUrl)({url:this.url,method:"HEAD"}).then(e=>{if(e.status===200&&!this.online){this.log("back online"),this.online=!0,this.onOnline.forEach(t=>t()),this._onceOnline.forEach(t=>t()),this._onceOnline.clear();return}else if(e.status!==200&&this.online)throw new Error("disconnected")}).catch(e=>{if(e.message.includes("ERR_NETWORK_CHANGED")){this._checkStatus();return}this.online=!1,this.onOffline.forEach(t=>t())})}onceOnline(e){this._onceOnline.add(e)}addEventListener(e,t){e==="online"?this.onOnline.push(t):e==="offline"&&this.onOffline.push(t)}destroy(){this._onceOnline.clear(),this._onceOnline=null,this.onOnline=null,this.onOffline=null,this.timeProvider=null}},yy=Zf;var _r=class extends Ut{constructor(t){super();this.observableName=t;this._map=new Map,this._derivedMaps=new WeakMap}set(t,r){return this._map.set(t,r),this.notifyListeners(),this}delete(t){let r=this._map.delete(t);return r&&this.notifyListeners(),r}clear(){this._map.clear(),this.notifyListeners()}has(t){return this._map.has(t)}get(t){return this._map.get(t)}keys(){return[...this._map.keys()]}values(){return[...this._map.values()]}entries(){return[...this._map.entries()]}get size(){return this._map.size}forEach(t){this._map.forEach(t)}find(t){for(let[r,s]of this._map)if(t(s,r))return s}some(t){for(let[r,s]of this._map)if(t(s,r))return!0;return!1}filter(t){let r=this._derivedMaps.get(t);if(r)return r;let s=new Qf(this,t);return this._derivedMaps.set(t,s),s}},Qf=class extends _r{constructor(t,r){super();this.parentMap=t;this.predicate=r;this.sub(),this.observableName=t.observableName+"(filter: "+r.toString()+")"}sub(){this.unsub||(this.unsub=this.parentMap.subscribe(()=>{let t=new Map;this.parentMap.forEach((r,s)=>{this.predicate(r,s)&&t.set(s,r)}),this._map=t,this.notifyListeners()}))}subscribe(t){return this.sub(),super.subscribe(t),()=>{this.unsubscribe(t)}}unsubscribe(t){super.unsubscribe(t),this._listeners.size===0&&this.unsub&&(this.unsub(),this.unsub=void 0)}destroy(){this.unsub&&this.unsub()}};function ed(n){return typeof n.id=="string"}function zE(n){return typeof n.name=="string"}var td=class{constructor(e){this.collectionName="roles";this.roles=e}items(){return this.roles.values()}clear(){this.roles.clear()}get(e){return this.roles.get(e)}ingest(e){return this.roles.set(e.id,e),e}delete(e){this.roles.delete(e)}};function wy(n){return typeof n.aggregate_root=="object"}function _y(n){return typeof n.acl=="object"}var Si=class{get aggregate_root(){}get acl(){}},El=class extends Si{constructor(t){super();this.user=t}get id(){return this.user.id}get name(){return this.user.name}update(t){return this.user=t,this}},rd=class extends Si{constructor(t,r,s){super();this.remoteFolder=t;this.relays=r;this.users=s}update(t){return this.remoteFolder=t,this}get id(){return this.remoteFolder.id}get guid(){return this.remoteFolder.guid}get name(){return this.remoteFolder.name}get private(){return this.remoteFolder.private}get creator(){let t=this.users.get(this.remoteFolder.creator);if(!t)throw new Error("invalid remote folder");return t}get relay(){let t=this.relays.get(this.remoteFolder.relay);if(!t)throw new Error("invalid remote folder");return t}get aggregate_root(){return["relays",this.remoteFolder.relay]}get acl(){return["relays",this.remoteFolder.relay]}},nd=class{constructor(e,t,r){this.remoteFolders=e;this.relays=t;this.users=r;this.collectionName="shared_folders"}items(){return this.remoteFolders.values()}clear(){this.remoteFolders.clear()}get(e){return this.remoteFolders.get(e)}ingest(e){let t=this.remoteFolders.get(e.id);if(t)return t.update(e),this.remoteFolders.notifyListeners(),t;let r=new rd(e,this.relays,this.users);return this.remoteFolders.set(e.id,r),r}delete(e){this.remoteFolders.delete(e)}},sd=class{constructor(e,t,r,s,o,i,l){this.relays=e;this.roles=t;this.relayRoles=r;this.relayInvitations=s;this.remoteFolders=o;this.subscriptions=i;this.user=l;this.collectionName="relays"}items(){return this.relays.values()}clear(){this.relays.clear()}get(e){return this.relays.get(e)}ingest(e){let t=this.relays.get(e.id);if(t)return t.update(e),this.relays.notifyListeners(),t;let r=new Tl(e,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.user);return this.relays.set(r.id,r),r}delete(e){this.relays.delete(e)}},od=class{constructor(e,t,r,s){this.collectionName="relay_roles";this.relayRoles=e,this.relays=t,this.users=r,this.roles=s}items(){return this.relayRoles.values()}clear(){this.relayRoles.clear()}get(e){return this.relayRoles.get(e)}ingest(e){let t=this.relayRoles.get(e.id);if(t)return t.update(e),this.relayRoles.notifyListeners(),t;let r=new ud(e,this.relays,this.users,this.roles);return this.relayRoles.set(r.id,r),r}delete(e){this.relayRoles.get(e)&&this.relayRoles.delete(e)}},id=class{constructor(e,t,r){this.collectionName="relay_invitations";this.relayInvitations=e,this.relays=t,this.roles=r}items(){return this.relayInvitations.values()}clear(){this.relayInvitations.clear()}get(e){return this.relayInvitations.get(e)}ingest(e){let t=this.relayInvitations.get(e.id);if(t)return t.update(e),this.relayInvitations.notifyListeners(),t;let r=new fd(e,this.relays,this.roles);return this.relayInvitations.set(r.id,r),r}delete(e){this.relayInvitations.delete(e)}},ad=class{constructor(e){this.users=e;this.collectionName="users"}items(){return this.users.values()}clear(){this.users.clear()}get(e){return this.users.get(e)}ingest(e){let t=this.users.get(e.id);if(t)return t.update(e),this.users.notifyListeners(),t;let r=new El(e);return this.users.set(e.id,r),r}delete(e){this.users.delete(e)}},ld=class{constructor(e,t,r){this.subscriptions=e;this.relays=t;this.users=r;this.collectionName="subscriptions"}items(){return this.subscriptions.values()}clear(){this.subscriptions.clear()}get(e){return this.subscriptions.get(e)}ingest(e){let t=this.subscriptions.get(e.id);if(t)return t.update(e),this.subscriptions.notifyListeners(),t;let r=new dd(e,this.relays,this.users);return this.subscriptions.set(e.id,r),r}delete(e){this.subscriptions.delete(e)}},cd=class{constructor(e){this.collections=new Map,this.relationships=new Map;for(let t of e)this.collections.set(t.collectionName,t);this.error=Q("[Store]","error"),this.warn=Q("[Store]","warn"),dr.set(this,"Store")}getCollection(e){let t=this.collections.get(e);if(!t)throw this.error("No collection found for",e),new Error("No collection found for "+e);return t}clear(){let e=Xt.getInstance();e.beginTransaction(),this.collections.forEach(t=>{t.clear()}),this.collections.clear(),this.relationships.clear(),e.commitTransaction()}destroy(){this.clear(),this.collections=null,this.relationships=null}ingestPage(e){return this.ingestBatch(e==null?void 0:e.items)}ingestBatch(e){if(e)return e.map(t=>this.ingest(t))}ingest(e){let t=Xt.getInstance();t.beginTransaction();let r=this._ingest(e);return t.commitTransaction(),r}_ingest(e){if(!e)return;let t,r=this.collections.get(e.collectionName);if(r?t=r.ingest(e):this.error("No collection found for record",e),wy(t)){let s=t.aggregate_root;if(s){let o=e.id,i=this.relationships.get(s.join(":"))||new Set;i.add([e.collectionName,o].join(":")),this.relationships.set(s.join(":"),i)}}if(_y(t)){let s=t.acl;if(s){let o=e.id,i=this.relationships.get(s.join(":"))||new Set;i.add([e.collectionName,o].join(":")),this.relationships.set(s.join(":"),i)}}if(e.expand)for(let[,s]of Object.entries(e.expand))Array.isArray(s)?this.ingestBatch(s):this.ingest(s);return t}delete(e){this.cascade(e.collectionName,e.id)}graphviz(){let e=`digraph G {
`;for(let[t,r]of this.collections)for(let s of r.items()){if(!ed(s)){this.warn("record has no id",s);continue}let o=t+"_"+s.id;if(zE(s)&&(o=t+"_"+s.name),e+=`  ${t}_${s.id} [label="${o}"];
`,ed(s)&&wy(s)&&s.aggregate_root){let[i,l]=s.aggregate_root;e+=`  ${t}_${s.id} -> ${i}_${l};
`}if(ed(s)&&_y(s)&&s.acl){let[i,l]=s.acl;e+=`  ${t}_${s.id} -> ${i}_${l} [style=dotted];
`}}return e+="}",e}cascade(e,t){let r=this.collections.get(e),s=this.relationships.get([e,t].join(":")),o=Xt.getInstance();o.beginTransaction(),r&&(this.warn("cascade delete parent",e,t),r.delete(t)),this.relationships.delete([e,t].join(":"));for(let i of s||[]){let[l,c]=i.split(":");this.warn("cascade delete child",l,c),this.getCollection(l)&&this.cascade(l,c)}o.commitTransaction()}},ud=class extends Si{constructor(t,r,s,o){super();this.users=s,this.roles=o,this.relays=r,this.relayRole=t}update(t){return this.relayRole=t,this}get id(){return this.relayRole.id}get userId(){return this.relayRole.user}get user(){let t=this.users.get(this.relayRole.user);if(!t)throw new Error(`Unable to find user: ${this.relayRole.user}`);return t}get role(){var t;return(t=this.roles.get(this.relayRole.role))==null?void 0:t.name}get relayId(){return this.relayRole.relay}get relay(){let t=this.relays.get(this.relayRole.relay);if(!t)throw new Error("invalid role");return t}get aggregate_root(){return["relays",this.relayRole.relay]}get acl(){return["users",this.relayRole.user]}},fd=class{constructor(e,t,r){this.relayInvitation=e,this.roles=r,this.relays=t}update(e){return this.relayInvitation=e,this}get key(){return this.relayInvitation.key}get id(){return this.relayInvitation.id}get role(){var e;return(e=this.roles.get(this.relayInvitation.role))==null?void 0:e.name}get relayId(){return this.relayInvitation.relay}get relay(){let e=this.relays.get(this.relayInvitation.relay);if(!e)throw new Error("invalid invitation");return e}get aggregate_root(){return["relays",this.relayInvitation.relay]}},dd=class extends Ut{constructor(t,r,s){super();this.subscription=t;this.relays=r;this.users=s}update(t){return this.subscription=t,this.notifyListeners(),this}get id(){return this.subscription.id}get token(){return this.subscription.token}get active(){return this.subscription.active}get user(){let t=this.users.get(this.subscription.user);if(!t)throw new Error("invalid subscription");return t}get relayId(){return this.subscription.relay}get relay(){let t=this.relays.get(this.subscription.relay);if(!t)throw new Error("invalid subscription");return t}get stripe_cancel_at(){return this.subscription.stripe_cancel_at}get cancelAt(){return this.subscription.stripe_cancel_at!==0?new Date(this.subscription.stripe_cancel_at*1e3):null}get quantity(){return this.subscription.stripe_quantity}get aggregate_root(){return["relays",this.subscription.relay]}get acl(){return["users",this.subscription.user]}},Tl=class extends Ut{constructor(t,r,s,o,i,l){super();this.relay=t;this.relayRoles=r;this.relayInvitations=s;this.remoteFolders=o;this._subscriptions=i;this.user=l;this.log=Q("[RelayAuto]","log"),this.warn=Q("[RelayAuto]","warn")}update(t){return this.relay=t,this.notifyListeners(),this}get cta(){return this.relay.cta}get plan(){return this.relay.plan}get id(){return this.relay.id}get guid(){return this.relay.guid}get name(){return this.relay.name}set name(t){this.relay.name=t}get userLimit(){return this.relay.user_limit}get role(){var s;let t=this.relay.creator===this.user.id,r=(s=this.relayRoles.find(o=>{var i;return((i=o.relay)==null?void 0:i.id)===this.relay.id&&o.user.id===this.user.id}))==null?void 0:s.role;return r||(this.warn("couldn't find role",this.relay.id,this.user,t),t?"Owner":"Member")}get owner(){return this.role==="Owner"}get invitation(){return this.relayInvitations.find(t=>t.relay.id===this.relay.id)}get folders(){return this.remoteFolders.filter(t=>t.relay.id===this.id)}get subscriptions(){return this._subscriptions.filter(t=>t.relay.id===this.id)}get acl(){var r;let t=(r=this.relayRoles.find(s=>s.relay.id===this.id&&s.user.id===this.user.id))==null?void 0:r.id;if(t)return["relay_roles",t]}},Al=class{constructor(e){this.loginManager=e;this.log=Q("[RelayManager]","log"),this.debug=Q("[RelayManager]","debug"),this.warn=Q("[RelayManager]","warn"),this.pb=this.loginManager.pb,this.users=new _r("users"),this.relays=new _r("relays"),this.remoteFolders=new _r("remote folders"),this.relayInvitations=new _r("relay invitations"),this.relayRoles=new _r("relay roles"),this.roles=new _r("roles"),this.roles.set("2arnubkcv7jpce8",{name:"Owner",id:"2arnubkcv7jpce8"}),this.roles.set("x6lllh2qsf9lxk6",{name:"Member",id:"x6lllh2qsf9lxk6"}),this.subscriptions=new _r("subscriptions"),this._offLoginManager=this.loginManager.subscribe(()=>{this.login()}),this.setUser(),this.user&&(dr.set(this,"RelayManager"),this.buildGraph(),this.subscribe(),this.update())}buildGraph(){if(!this.user||this.store)return;let e=new td(this.roles),t=new ad(this.users),r=new sd(this.relays,this.roles,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.user),s=new od(this.relayRoles,this.relays,this.users,this.roles),o=new id(this.relayInvitations,this.relays,this.roles),i=new nd(this.remoteFolders,this.relays,this.users),l=new ld(this.subscriptions,this.relays,this.users);this.store=new cd([e,t,r,s,o,i,l])}setUser(){var e;this.authUser=(e=this.pb)==null?void 0:e.authStore.model,this.authUser&&(this.user=new El(this.authUser),this.users.set(this.user.id,this.user))}login(){this.setUser(),this.buildGraph(),this.subscribe(),this.update()}logout(){var e;(e=this.store)==null||e.clear(),this.user=void 0,this.store=void 0}async getRelayInvitationKey(e){if(!this.pb)return"";let t=this.relayInvitations.find(r=>r.relay.id===e.id);return t!=null&&t.key?t.key:this.pb.collection("relay_invitations").getList(0,200).then(r=>{r.items.forEach(o=>{var i;(i=this.store)==null||i.ingest(o)});let s=this.relayInvitations.find(o=>o.relay.id===e.id);return s?s.key:""})}async subscribe(){var r;if(!this.pb||!this.pb.authStore.isValid||((r=this.pb.authStore.model)==null?void 0:r.id)===void 0)return;let e=[{name:"relays",expand:["relay_invitations_via_relay","shared_folders_via_relay","shared_folders_via_relay.creator","subscriptions_via_relay","subscriptions_via_relay.relay","creator"]},{name:"relay_invitations",expand:["relay"]},{name:"relay_roles",expand:["user","relay"]},{name:"shared_folders",expand:["relay","creator"]},{name:"subscriptions",expand:["user","relay"]}],t=(s,o)=>{var i,l;this.debug(`[Event]: ${s}`,o.action,o.record),o.action==="delete"?(i=this.store)==null||i.delete(o.record):(l=this.store)==null||l.ingest(o.record)};for(let s of e)this.pb.collection(s.name).subscribe("*",o=>t(s.name,o),{expand:s.expand.join(","),fetch:ts})}collection(e){this.pb}async update(){var e;if(!(!this.pb||!this.pb.authStore.isValid||((e=this.pb.authStore.model)==null?void 0:e.id)===void 0))try{await this.pb.collection("users").getOne(this.pb.authStore.model.id,{expand:"relay_roles_via_user,relay_roles_via_user.relay,relay_roles_via_user.role,subscriptions_via_user,subscriptions_via_user.relay"}).then(t=>{var r;(r=this.store)==null||r.ingest(t)}).catch(t=>{t.status===404&&this.loginManager.logout()}),await this.pb.collection("relay_roles").getFullList({expand:"user"}).then(t=>{t.forEach(r=>{var s;(s=this.store)==null||s.ingest(r)})}),await this.pb.collection("relay_invitations").getFullList().then(t=>{t.forEach(r=>{var s;(s=this.store)==null||s.ingest(r)})}),await this.pb.collection("shared_folders").getFullList({expand:"relay,creator"}).then(t=>{t.forEach(r=>{var s;(s=this.store)==null||s.ingest(r)})}),await this.pb.collection("subscriptions").getFullList({expand:"relay,user",fetch:ts}).then(t=>{t.forEach(r=>{var s;(s=this.store)==null||s.ingest(r)})})}catch(t){this.warn("error during update()",t)}}async acceptInvitation(e){var s;if(!this.pb)throw new Error("Failed to accept invitation");let t=await this.pb.send("/api/accept-invitation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:e})});this.debug("[InviteAccept]",t);let r=(s=this.store)==null?void 0:s.ingest(t);if(!r)throw new Error("Failed to accept invitation");return r}async createRelay(e){var o;let t=Hs(),r=await((o=this.pb)==null?void 0:o.collection("relays").create({guid:t,name:e,path:null}));if(!r)throw new Error("Failed to create Relay");if(!this.user)throw new Error("Not Logged In");let s=new Tl(r,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.user);return this.relays.set(s.id,s),s}async updateRelay(e){var s;if(!this.pb)throw new Error("Failed to update relay");let t=await this.pb.collection("relays").update(e.id,{name:e.name.trim()}),r=(s=this.store)==null?void 0:s.ingest(t);if(!r)throw new Error("Failed to update relay");return r}async deleteRemote(e){var r;e.remote=void 0;let t=this.remoteFolders.find(s=>s.guid===e.guid);return t?(await((r=this.pb)==null?void 0:r.collection("shared_folders").delete(t.id)),e.remote=void 0,!0):!1}async createRemoteFolder(e,t){var o,i;if(!this.pb)throw new Error("Failed to create folder");let r=await this.pb.collection("shared_folders").create({name:e.name,guid:e.guid,relay:t.id,creator:(o=this.user)==null?void 0:o.id,private:!1},{expand:"relay"}),s=(i=this.store)==null?void 0:i.ingest(r);if(!s)throw new Error("Failed to create folder");return s}async destroyRelay(e){var t,r;return await((t=this.pb)==null?void 0:t.collection("relays").delete(e.id)),(r=this.store)==null||r.cascade("relays",e.id),!0}async leaveRelay(e){var r,s;let t=this.relayRoles.find(o=>{var i,l;return o.user.id===((i=this.user)==null?void 0:i.id)&&((l=o.relay)==null?void 0:l.id)===e.id});t?await((r=this.pb)==null?void 0:r.collection("relay_roles").delete(t.id)):this.warn("No role found to leave relay"),(s=this.store)==null||s.cascade("relay",e.id)}async kick(e){var t;return(t=this.pb)==null?void 0:t.collection("relay_roles").delete(e.id)}destroy(){var e,t;this._offLoginManager&&this._offLoginManager(),(e=this.pb)==null||e.cancelAllRequests(),this.loginManager=null,this.pb=null,(t=this.store)==null||t.destroy(),this.authUser=null,this.store=null}};var Ty=require("obsidian");var ky=require("obsidian");var xy=require("obsidian");function XE(n){tt(n,"svelte-4kkvmr",".feature-flag-toggle-modal.svelte-4kkvmr{padding:1rem}.feature-flag-item.svelte-4kkvmr{display:flex;justify-content:space-between;align-items:center;padding:0.5rem 0;border-top:1px solid var(--background-modifier-border)}.checkbox-container.svelte-4kkvmr{cursor:pointer}")}function by(n,e,t){let r=n.slice();return r[5]=e[t][0],r[6]=e[t][1],r}function vy(n){let e,t,r,s=n[5]+"",o,i,l,c,f=n[5]+"",d,p,g,_,y,b,C,x,M,W,S,R,O;function U(){return n[2](n[5])}function I(){return n[3](n[5])}return{c(){e=L("div"),t=L("div"),r=L("div"),o=ae(s),i=q(),l=L("div"),c=ae("Toggle "),d=ae(f),p=ae(" on or off"),g=q(),_=L("div"),y=L("div"),b=L("input"),x=q(),M=L("div"),S=q(),A(r,"class","setting-item-name"),A(l,"class","setting-item-description"),A(t,"class","setting-item-info"),A(b,"type","checkbox"),b.checked=C=n[6],A(M,"class","checkbox-toggle"),A(y,"role","checkbox"),A(y,"aria-checked",W=n[6]),A(y,"tabindex","0"),A(y,"class","checkbox-container svelte-4kkvmr"),Cu(y,"is-enabled",n[6]),A(_,"class","setting-item-control"),A(e,"class","feature-flag-item setting-item svelte-4kkvmr")},m(oe,ue){T(oe,e,ue),J(e,t),J(t,r),J(r,o),J(t,i),J(t,l),J(l,c),J(l,d),J(l,p),J(e,g),J(e,_),J(_,y),J(y,b),J(y,x),J(y,M),J(e,S),R||(O=[re(y,"keypress",U),re(y,"click",I)],R=!0)},p(oe,ue){n=oe,ue&1&&s!==(s=n[5]+"")&&we(o,s),ue&1&&f!==(f=n[5]+"")&&we(d,f),ue&1&&C!==(C=n[6])&&(b.checked=C),ue&1&&W!==(W=n[6])&&A(y,"aria-checked",W),ue&1&&Cu(y,"is-enabled",n[6])},d(oe){oe&&E(e),R=!1,Te(O)}}}function ZE(n){let e,t,r,s,o,i=ze(Object.entries(n[0])),l=[];for(let c=0;c<i.length;c+=1)l[c]=vy(by(n,i,c));return{c(){e=L("div"),t=L("h2"),t.textContent="Feature Flags",r=q(),s=L("p"),s.textContent="Make sure you reload obsidian after changing the flags below.",o=q();for(let c=0;c<l.length;c+=1)l[c].c();A(e,"class","feature-flag-toggle-modal svelte-4kkvmr")},m(c,f){T(c,e,f),J(e,t),J(e,r),J(e,s),J(e,o);for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(e,null)},p(c,[f]){if(f&3){i=ze(Object.entries(c[0]));let d;for(d=0;d<i.length;d+=1){let p=by(c,i,d);l[d]?l[d].p(p,f):(l[d]=vy(p),l[d].c(),l[d].m(e,null))}for(;d<l.length;d+=1)l[d].d(1);l.length=i.length}},i:Z,o:Z,d(c){c&&E(e),Qt(l,c)}}}function QE(n,e,t){let r=Ct.getInstance(),s=Object.assign({},r.flags);function o(c){t(0,s[c]=!s[c],s),r.setFlag(c,s[c],!0)}return pr(()=>{Object.keys(s).forEach(c=>{let f=document.getElementById(`toggle-${c}`);f&&(0,xy.setIcon)(f,"check")})}),[s,o,c=>{o(c)},c=>o(c)]}var hd=class extends ne{constructor(e){super(),ie(this,e,QE,ZE,te,{},XE)}},Sy=hd;var Dl=class extends ky.Modal{constructor(t){super(t)}onOpen(){let{contentEl:t}=this;this.component=new Sy({target:t})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var eT={sharedFolders:[],debugging:!1,...Oa},Ml=class extends Ty.Plugin{constructor(){super(...arguments);this.settingsFileLocked=!0;this.fileDiffMergeWarningKey="file-diff-merge-warning"}enableDebugging(t){Ma(!0),console.warn("RelayInstances",dr),t&&(this.settings.debugging=!1,this.saveSettings())}disableDebugging(t){Ma(!1),t&&(this.settings.debugging=!1,this.saveSettings())}toggleDebugging(t){let r=!this.settings.debugging;return Ma(r),t&&(this.settings.debugging=r,this.saveSettings()),r}buildApiUrl(t){return"https://api.system3.md"+t}async onload(){this.timeProvider=new Gs,this.register(()=>{this.timeProvider.destroy()}),xm(this.app.vault,this.timeProvider,".obsidian/plugins/system3-relay/relay.log",{maxFileSize:5*1024*1024,maxBackups:3,disableConsole:!1}),this.log=Q("[System 3][Relay]","log"),this.warn=Q("[System 3][Relay]","warn"),await this.loadSettings();let t=Ct.getInstance();t.setFlags(this.settings),this._offFlagUpdates=t.subscribe(s=>{this.settings={...this.settings,...s.flags},this.saveSettings()}),this.addRibbonIcon("satellite","Relay",()=>{this.openSettings()}),this.settings.debugging&&(this.enableDebugging(),this.addCommand({id:"toggle-feature-flags",name:"Feature Flags",callback:()=>{new Dl(this.app).open()}})),this.vault=this.app.vault;let r=this.vault.getName();this.fileManager=this.app.fileManager,this.loginManager=new dl(this.vault.getName(),this.openSettings.bind(this)),this.relayManager=new Al(this.loginManager),this.sharedFolders=new La(this.relayManager,this._createSharedFolder.bind(this)),this.tokenStore=new Cl(this.loginManager,this.timeProvider,r,3),this.networkStatus=new yy(this.timeProvider,"https://api.system3.md/health?version=0.3.3"),this.backgroundSync=new ja(this.loginManager,this.timeProvider,this.sharedFolders),this.loginManager.setup()||new Vt.Notice("Please sign in to use relay"),this.app.workspace.onLayoutReady(()=>{this.loadSharedFolders(this.settings.sharedFolders),this._liveViews=new Za(this.app,this.sharedFolders,this.loginManager,this.networkStatus),this.registerEditorExtension(this._liveViews.extensions),this.register(this.loginManager.on(()=>{this.loginManager.loggedIn?this._onLogin():this._onLogout()})),this.tokenStore.start(),Cy.Platform.isIosApp||(this.networkStatus.addEventListener("offline",()=>{this.tokenStore.stop(),this.sharedFolders.forEach(s=>s.disconnect()),this._liveViews.goOffline()}),this.networkStatus.addEventListener("online",()=>{this.tokenStore.start(),this.relayManager.subscribe(),this.relayManager.update(),this._liveViews.goOnline()}),this.networkStatus.start()),this.registerView(oo,s=>new Xa(s)),this.registerEvent(this.app.workspace.on("file-menu",(s,o)=>{if(o instanceof Vt.TFolder){let i=this.sharedFolders.find(l=>l.path===o.path);if(!i)return;s.addItem(l=>{l.setTitle(i.connected?"Disconnect":"Connect").setIcon("satellite").onClick(()=>{i.toggleConnection(),this._liveViews.refresh("folder connection toggle")})})}})),this.setup(),this.settingsFileLocked=!1,this._liveViews.refresh("init")})}loadSharedFolders(t){this.log("Loading shared folders");let r=this.settingsFileLocked;this.settingsFileLocked=!0;let s=!1;t.forEach(o=>{if(!this.vault.getFolderByPath(o.path)){this.warn(`[System 3][Relay][Shared Folder]: Invalid settings, ${o.path} does not exist`);return}this.sharedFolders._new(o.path,o.guid,o==null?void 0:o.relay),s=!0}),this._offSaveSettings||(this._offSaveSettings=this.sharedFolders.subscribe(()=>{this.saveSettings()})),this.settingsFileLocked=r,s&&this.sharedFolders.notifyListeners()}async _createSharedFolder(t,r,s,o){return new Ia(r,t,this.loginManager,this.vault,this.fileManager,this.tokenStore,this.relayManager,this.backgroundSync,s,o)}_onLogout(){var t,r;(t=this.tokenStore)==null||t.clear(),(r=this.relayManager)==null||r.logout(),this._liveViews.refresh("logout")}_onLogin(){var t;this.loadSharedFolders(this.settings.sharedFolders),(t=this.relayManager)==null||t.login(),this._liveViews.refresh("login")}async openSettings(){let t=this.app.setting;await t.open(),t.openTabById("system3-relay")}setup(){this.folderNavDecorations=new tl(this.vault,this.app.workspace,this.sharedFolders),this.folderNavDecorations.refresh(),this.settingsTab=new il(this.app,this),this.addSettingTab(this.settingsTab);let t=Q("[Live][Workspace]","log");this.registerEvent(this.app.workspace.on("file-open",f=>{t("file-open"),l._liveViews.refresh("file-open")})),this.registerEvent(this.app.workspace.on("layout-change",()=>{t("layout-change"),this._liveViews.refresh("layout-change")}));let r=Q("[System 3][Relay][Vault]","log"),s=f=>{let d=f.error;d&&d instanceof ss&&mu(d)};window.addEventListener("error",s,!0),this.register(()=>window.removeEventListener("error",s,!0));let o=f=>{f.reason instanceof ss&&mu(f.reason)},i=f=>o(f);window.addEventListener("unhandledrejection",i,!0),this.register(()=>window.removeEventListener("unhandledrejection",i,!0)),this.registerEvent(this.app.vault.on("create",f=>{if(f instanceof Vt.TFolder)return;let d=this.sharedFolders.lookup(f.path);d&&d.whenReady().then(p=>{p.getFile(f.path,!0,!0)})})),this.registerEvent(this.app.vault.on("delete",f=>{if(f instanceof Vt.TFolder){let p=this.sharedFolders.find(g=>g.path===f.path);p&&this.sharedFolders.delete(p);return}let d=this.sharedFolders.lookup(f.path);d&&(r("Delete",f.path),d.whenReady().then(p=>{p.deleteFile(f.path)}))})),this.registerEvent(this.app.vault.on("rename",(f,d)=>{if(f instanceof Vt.TFolder){let y=this.sharedFolders.find(b=>b.path==d);y&&(y.path=f.path,this.sharedFolders.update());return}let p=this.sharedFolders.lookup(d),g=this.sharedFolders.lookup(f.path),_=p||g;p&&g?(r("Rename",f,d),p.renameFile(f.path,d),g.renameFile(f.path,d),this._liveViews.refresh("rename")):_&&(r("Rename",f,d),_.renameFile(f.path,d),this._liveViews.refresh("rename"))})),this.registerEvent(this.app.vault.on("modify",f=>{let d=this.sharedFolders.lookup(f.path);d&&(r("Modify",f.path),Rr(Mr.enableUpdateYDocFromDiskBuffer,()=>{try{let p=d.getFile(f.path,!1,!1);this._liveViews.docIsOpen(p)||d.read(p).then(g=>{g.length!==0&&Ga(p.ydoc,g)})}catch(p){}}),this.app.metadataCache.trigger("resolve",f))}));let l=this,c=Jf(Vt.MarkdownView.prototype,{onUnloadFile(f){return function(d){return l._liveViews.wipe(),f.call(this,d)}}});this.register(c),Rr(Mr.enableNewLinkFormat,()=>{let f=Jf(Vt.MetadataCache.prototype,{fileToLinktext(d){return function(p,g,_){if(l.sharedFolders.lookup(p.path)){_===void 0&&(_=!0);let b=p.extension==="md"&&_?p.basename:p.name,C=(0,Vt.normalizePath)(p.name),x=app.metadataCache.uniqueFileLookup.get(C.toLowerCase());if(x&&x.length===1&&x[0]===p)return b;{let M=p.extension==="md"&&_?p.path.slice(0,p.path.length-3):p.path,W=(0,Ey.relative)(g,M);return W==="../"+b?"./"+b:W}}return d.call(this,p,g,_)}}});this.register(f)})}onunload(){var t,r,s,o,i,l,c,f,d,p,g,_,y,b;this.settingsFileLocked=!0,(t=this._offFlagUpdates)==null||t.call(this),this._offFlagUpdates=null,(r=this._offSaveSettings)==null||r.call(this),this._offSaveSettings=null,(s=this.timeProvider)==null||s.destroy(),(o=this.folderNavDecorations)==null||o.destroy(),this.app.workspace.detachLeavesOfType(oo),(i=this.backgroundSync)==null||i.destroy(),this.backgroundSync=null,(l=this._liveViews)==null||l.destroy(),this._liveViews=null,(c=this.relayManager)==null||c.destroy(),this.relayManager=null,(f=this.tokenStore)==null||f.stop(),(d=this.tokenStore)==null||d.clearState(),(p=this.tokenStore)==null||p.destroy(),this.tokenStore=null,(g=this.networkStatus)==null||g.stop(),(_=this.networkStatus)==null||_.destroy(),this.networkStatus=null,this.sharedFolders.destroy(),this.sharedFolders=null,(y=this.settingsTab)==null||y.destroy(),this.settingsTab=null,(b=this.loginManager)==null||b.destroy(),this.loginManager=null,this.app.workspace.updateOptions(),Ct.destroy(),Xt.destroy(),Cm(),pu()}async loadSettings(){this.settings=Object.assign({},eT,await this.loadData())}async saveSettings(){this.settingsFileLocked?this.log("Saving settings: settings file locked"):(this.settings.sharedFolders=this.sharedFolders.toSettings(),this.log("Saving settings",this.settings),await this.saveData(this.settings),Ct.getInstance().setFlags(this.settings))}};
/*! Bundled license information:

moment/moment.js:
  (*! moment.js *)
  (*! version : 2.29.4 *)
  (*! authors : Tim Wood, Iskren Chernev, Moment.js contributors *)
  (*! license : MIT *)
  (*! momentjs.com *)

lucide-svelte/dist/defaultAttributes.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/arrow-right-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/chevron-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/folder.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/layers.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/satellite.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/settings.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/index.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)
*/

/* nosourcemap */